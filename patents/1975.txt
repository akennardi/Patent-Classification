                                      ABSTRACT
      Embodiments of the present invention provide a signal processing method and
apparatus. The method includes: determining a total quantity of to-be-allocated bits
corresponding    to a    current  frame;  implementing primary bit allocation        on
to-be-processed    sub-bands;    performing  a primary    information    unit  quantity
determining operation for each sub-band that has undergone the primary bit allocation,
so as to obtain a quantity of information units corresponding to each sub-band of the
to-be-processed sub-bands and a total quantity of surplus bits; selecting sub-bands for
secondary bit allocation from the to-be-processed sub-bands according to at least one
of a sub-band characteristic of each sub-band of the to-be-processed sub-bands or the
total quantity of surplus bits; implementing secondary bit allocation on the sub-bands
for secondary bit allocation; and performing, according to the quantities of primarily
allocated bits and quantities of secondarily allocated bits of the sub-bands for
secondary bit allocation, a secondary information unit quantity determining operation
for each sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a
quantity of information units corresponding to each sub-band of the sub-bands for
secondary bit allocation. In the embodiments of the present invention, a waste of bits
can be avoided, and encoding and decoding quality can be improved.

                                          1/12
100
                                                                         S110
 Determine a total quantity of to-be-allocated bits corresponding to
              to-be-processed sub-bands of a current frame
   Implement primary bit allocation on each sub-band of the to-be-       S120
     processed sub-bands according to the total quantity of to-be
  allocated bits, so as to obtain a quantity of primarily allocated bits
           of each sub-band of the to-be-processed sub-bands
    Perform, according to the quantity of primarily allocated bits of
    each sub-band, a primary information unit quantity determining
  operation for each sub-band of the to-be-processed sub-bands that      S130
    has undergone the primary bit allocation, so as to obtain a total
     quantity of surplus bits of the current frame and a quantity of
    information units corresponding to each sub-band of the to-be
                            processed sub-bands
                                                                         S140
     Select sub-bands for secondary bit allocation from the to-be
     processed sub-bands according to a secondary bit allocation
                                 parameter
Implement secondary bit allocation on the sub-bands for secondary        S150
 bit allocation, so as to allocate the surplus bits to the sub-bands for
     secondary bit allocation and obtain a quantity of secondarily
  allocated bits of each sub-band of the sub-bands for secondary bit
                      allocation of the current frame
     Perform, according to the bits obtained when the primary bit
      allocation is performed for the sub-bands for secondary bit
allocation and the bits obtained when the secondary bit allocation is    S160
    performed, a secondary information unit quantity determining
    operation for each sub-band of the sub-bands for secondary bit
      allocation, so as to re-obtain a quantity of information units
 corresponding to each sub-band of the sub-bands for secondary bit
                      allocation of the current frame
                                         FIG. 1

         SIGNAL PROCESSING METHOD AND APPARATUS
                                    TECHNICAL FIELD
   [0001]      The present invention relates to audio encoding and decoding technologies,
   and more specifically, to a signal processing method and apparatus.
 5                                     BACKGROUND
   [0002]      In an existing frequency-domain encoding algorithm, during bit allocation,
   the following processing is included: allocating bits to each sub-band according to a
   sub-band envelope; sorting sub-bands in ascending order according to a quantity of
   allocated bits; starting encoding from a sub-band with a smallest quantity of allocated
10 bits; and evenly allocating surplus bits left in an encoded sub-band to remaining
   unencoded sub-bands, where bits left in each sub-band are insufficient for encoding
   one information unit. Because allocation of surplus bits is merely even allocation to
   sub-bands with larger quantities of originally allocated bits determined by energy
   envelopes, a waste of bits is caused, resulting in a non-ideal encoding effect.
15                                       SUMMARY
   [0003]      Embodiments of the present invention provide a signal processing method
   and apparatus, which can avoid a waste of bits and improve encoding and decoding
   quality.
   [0004]      According to a first aspect, a signal processing method is provided,
20 including: determining a total quantity of to-be-allocated bits corresponding to
   to-be-processed sub-bands of a current frame; implementing primary bit allocation on
   the to-be-processed sub-bands according to the total quantity of to-be-allocated bits,
   so as to obtain a quantity of primarily allocated bits of each sub-band of the
   to-be-processed sub-bands; performing, according to the quantity of primarily
25 allocated bits of each sub-band, a primary information unit quantity determining
   operation for each sub-band that has undergone the primary bit allocation, so as to

   obtain a total quantity of surplus bits of the current frame and a quantity of
   information units corresponding to each sub-band of the to-be-processed sub-bands;
   selecting sub-bands for secondary bit allocation from the to-be-processed sub-bands
   according to a secondary bit allocation parameter, where the secondary bit allocation
 5 parameter includes at least one of a sub-band characteristic of each sub-band of the
   to-be-processed sub-bands or the total quantity of surplus bits; implementing
   secondary bit allocation on the sub-bands for secondary bit allocation, so as to
   allocate the surplus bits to the sub-bands for secondary bit allocation and obtain a
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
10 bit allocation; and performing, according to the quantities of primarily allocated bits
   and the quantities of secondarily allocated bits of the sub-bands for secondary bit
   allocation, a secondary information unit quantity determining operation for each
   sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a quantity of
   information units corresponding to each sub-band of the sub-bands for secondary bit
15 allocation.
   [0005]       With reference to the first aspect, in a first possible implementation
   manner of the first aspect, the sub-band characteristic of each sub-band of the
   to-be-processed sub-bands includes at least one of a characteristic of a signal carried
   in the sub-band, a bit allocation state corresponding to the sub-band, or a frequency
20 range of the sub-band.
   [0006]       With reference to the first aspect or any one of the foregoing possible
   implementation manner of the first aspect, in another possible implementation manner
   of the first aspect, the characteristic of the signal carried in the sub-band includes at
   least one of a type of the signal carried in the sub-band or an envelope value of the
25 sub-band; and/or the bit allocation state corresponding to the sub-band includes at
   least one of a coefficient quantization state of a corresponding previous-frame
   sub-band of the sub-band, a quantity of primary bits per information unit of the
   sub-band, an average quantity of primary bits per unit bandwidth of the sub-band, or a
   quantity of primarily allocated bits of the sub-band, where the average quantity of
30 primary bits per unit bandwidth of the sub-band is determined according to the
   quantity of primarily allocated bits of the sub-band and bandwidth of the sub-band,
   and the quantity of primary bits per information unit of the sub-band is determined
   according to the quantity of primarily allocated bits of the sub-band and a quantity of
   primary information units of the sub-band, where the quantity of primary information
                                                2

   units of the sub-band is obtained from the primary information unit quantity
   determining operation that the sub-band has undergone.
   [0007]       With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
 5 manner of the first aspect, the type of the signal carried in the sub-band includes
   harmonic and/or non-harmonic.
   [0008]       With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the selecting sub-bands for secondary bit allocation from
10 the to-be-processed sub-bands includes: determining a target sub-band set according
   to at least one of the sub-band characteristic of each sub-band of the to-be-processed
   sub-bands or the total quantity of surplus bits, and selecting the sub-bands for
   secondary bit allocation from the target sub-band set, where a sub-band in the target
   sub-band set belongs to the to-be-processed sub-bands.
15 [0009]       With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the determining a target sub-band set includes: determining
   the target sub-band set according to a sub-band characteristic of each sub-band in m
   first sub-band sets and m predetermined conditions in a one-to-one correspondence
20 with the m first sub-band sets, where m is an integer greater than or equal to 1, and a
   sub-band in the m first sub-band sets belongs to the to-be-processed sub-bands, where
   when all sub-band sets of the m first sub-band sets meet the corresponding
   predetermined conditions, a set formed by sub-bands that belong to all the m first
   sub-band sets is determined as the target sub-band set, or when a sub-band set of the
25 m first sub-band sets does not meet a corresponding predetermined condition, a set
   formed by sub-bands of the to-be-processed sub-bands other than sub-bands that
   belong to all the m first sub-band sets is determined as the target sub-band set; or
   when at least one sub-band set of the m first sub-band sets meets a corresponding
   predetermined condition, a set formed by all sub-bands in the at least one sub-band set
30 is determined as the target sub-band set, or when no sub-band set of the m first
   sub-band sets meets a corresponding predetermined condition, a set formed by
   sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set of
   the m first sub-band sets is determined as the target sub-band set.
   [0010]       With reference to the first aspect or any one of the foregoing possible
                                               3

   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, any predetermined condition of the m predetermined
   conditions    includes   at  least  one    of    the  following    conditions:   that  a
   coefficient-quantized sub-band exists in corresponding previous-frame sub-bands of a
 5 corresponding first sub-band set, that an average envelope value of sub-bands in a
   corresponding first sub-band set is greater than a first threshold, or that a sub-band
   carrying a signal of a harmonic type exists in a corresponding first sub-band set.
   [0011]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
10 manner of the first aspect, a frequency of a sub-band in the m first sub-band sets is
   higher than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets.
   [0012]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
15 manner of the first aspect, the selecting the sub-bands for secondary bit allocation
   from the target sub-band set includes: selecting the sub-bands for secondary bit
   allocation from the target sub-band set according to at least one of an average quantity
   of primary bits per unit bandwidth of each sub-band, a quantity of primary bits per
   information unit of each sub-band, or a quantity of primarily allocated bits of each
20 sub-band in the target sub-band set, where the average quantity of primary bits per
   unit bandwidth of the sub-band is determined according to the quantity of primarily
   allocated bits of the sub-band and bandwidth of the sub-band, and the quantity of
   primary bits per information unit of the sub-band is determined according to the
   quantity of primarily allocated bits of the sub-band and a quantity of primary
25 information units of the sub-band, where the quantity of primary information units of
   the sub-band is obtained from the primary information unit quantity determining
   operation that the sub-band has undergone.
   [0013]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
30 manner of the first aspect, the selecting the sub-bands for secondary bit allocation
   from the target sub-band set includes: determining a sub-band with a smallest average
   quantity of primary bits per unit bandwidth, a sub-band with a smallest quantity of
   primary bits per information unit, or a sub-band with a smallest quantity of primarily
   allocated bits in the target sub-band set as a top-priority to-be-enhanced sub-band,
                                              4

   where the top-priority to-be-enhanced sub-band belongs to the sub-bands for
   secondary bit allocation.
   [0014]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
 5 manner of the first aspect, the selecting the sub-bands for secondary bit allocation
   from the target sub-band set further includes: when the total quantity of surplus bits is
   greater than a threshold   aN  and less than aN+1, determining that N sub-bands for
   secondary bit allocation need to be selected, where aN and aN+1 are respectively the Nth
   threshold and the (N+1)th threshold of multiple thresholds sorted in ascending order;
10 and when N is greater than or equal to 2, selecting N-I sub-bands for secondary bit
   allocation from sub-bands in the target sub-band set other than the top-priority
   to-be-enhanced sub-band.
   [0015]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
15 manner of the first aspect, the selecting N-1 sub-bands for secondary bit allocation
   from sub-bands in the target sub-band set other than the top-priority to-be-enhanced
   sub-band includes: determining the N-1 sub-bands for secondary bit allocation based
   on the top-priority to-be-enhanced sub-band for allocation, where the N sub-bands for
   secondary bit allocation are successive in a frequency domain.
20 [0016]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the selecting the sub-bands for secondary bit allocation
   from the target sub-band set further includes: when the total quantity of surplus bits is
   greater than a threshold, determining a second-priority to-be-enhanced sub-band from
25 the target sub-band set, where the sub-bands for secondary bit allocation include the
   second-priority   to-be-enhanced sub-band       and the top-priority    to-be-enhanced
   sub-band.
   [0017]      With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
30 manner of the first aspect, the selecting the sub-bands for secondary bit allocation
   from the target sub-band set further includes: determining a second-priority
   to-be-enhanced sub-band from the target sub-band set; and when the total quantity of
   surplus bits is greater than a threshold, determining that the second-priority
   to-be-enhanced sub-band belongs to the sub-bands for secondary bit allocation.
                                               5

   [00181     With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the determining a second-priority to-be-enhanced sub-band
   from the target sub-band set includes: determining a sub-band with a smaller average
 5 quantity of primary bits per unit bandwidth, a sub-band with a smaller quantity of
   primary bits per information unit, or a sub-band with a smaller quantity of primarily
   allocated bits, of two sub-bands adjacent to the top-priority to-be-enhanced sub-band
   as the second-priority to-be-enhanced sub-band.
   [0019]     With reference to the first aspect or any one of the foregoing possible
10 implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the implementing secondary bit allocation on the sub-bands
   for secondary bit allocation includes: when a quantity of sub-bands included in the
   sub-bands for secondary bit allocation is greater than or equal to 2, implementing
   secondary bit allocation on the sub-bands for secondary bit allocation according to a
15 quantity of primary bits per information unit, an average quantity of primary bits per
   unit bandwidth, or a quantity of primarily allocated bits, of each sub-band of the
   sub-bands for secondary bit allocation.
   [0020]     With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
20 manner of the first aspect, the implementing primary bit allocation on the
   to-be-processed sub-bands according to the total quantity of to-be-allocated bits
   includes: implementing primary bit allocation on the to-be-processed sub-bands
   according to the total quantity of to-be-allocated bits and envelope values of
   sub-bands of the to-be-processed sub-bands.
25 [0021]     With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, when the method is executed by an encoder side, the
   method further includes: performing a quantization operation for each sub-band of the
   to-be-processed     sub-bands   according  to   the  quantity   of information    units
30 corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain a
   quantized spectral coefficient corresponding to each sub-band, where the quantity of
   information units corresponding to each sub-band of the sub-bands for secondary bit
   allocation is the quantity of information units that is obtained from the secondary
   information unit quantity determining operation, and a quantity of information units
                                              6

   corresponding to another sub-band is a quantity of information units that is obtained
   from the primary information unit quantity determining operation; and writing the
   quantized spectral coefficient into a bitstream and outputting the bitstream.
   [0022]       With reference to the first aspect or any one of the foregoing possible
 5 implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
   sub-bands, an envelope value of at least one sub-band of the to-be-processed
   sub-bands, or a coefficient quantization state of a corresponding previous-frame
10 sub-band of at least one sub-band of the to-be-processed sub-bands; and the method
   further includes: writing the at least one parameter into the bitstream.
   [0023]       With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, when the method is executed by a decoder side, the method
15 further includes: performing an inverse quantization operation for each sub-band of
   the to-be-processed sub-bands according to the quantity of information units
   corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain an
   inverse quantized spectral coefficient corresponding to each sub-band, where the
   quantity of information units corresponding to each sub-band of the sub-bands for
20 secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
   information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
   acquiring an output signal according to the inverse quantized spectral coefficient.
25 [0024]       With reference to the first aspect or any one of the foregoing possible
   implementation manners of the first aspect, in another possible implementation
   manner of the first aspect, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
   sub-bands, an envelope value of at least one sub-band of the to-be-processed
30 sub-bands, or a coefficient quantization state of a corresponding previous-frame
   sub-band of at least one sub-band of the to-be-processed sub-bands; and the method
   further includes: acquiring the at least one parameter from a to-be-decoded bitstream.
   [0025]       According to a second aspect, a signal processing apparatus is provided,
   including: a total bit quantity determining unit, configured to determine a total
                                                7

   quantity of to-be-allocated bits corresponding to to-be-processed sub-bands of a
   current frame; a primary bit allocation unit, configured to implement primary bit
   allocation on the to-be-processed sub-bands according to the total quantity of
   to-be-allocated bits, so as to obtain a quantity of primarily allocated bits of each
 5 sub-band of the to-be-processed sub-bands; a primary information unit quantity
   determining unit, configured to perform, according to the quantity of primarily
   allocated bits of each sub-band, a primary information unit quantity determining
   operation for each sub-band that has undergone the primary bit allocation, so as to
   obtain a total quantity of surplus bits of the current frame and a quantity of
10 information units corresponding to each sub-band of the to-be-processed sub-bands; a
   sub-band selection unit, configured to select sub-bands for secondary bit allocation
   from the to-be-processed sub-bands according to a secondary bit allocation parameter,
   where the secondary bit allocation parameter includes at least one of a sub-band
   characteristic of each sub-band of the to-be-processed sub-bands or the total quantity
15 of surplus bits; a secondary bit allocation unit, configured to implement secondary bit
   allocation on the sub-bands for secondary bit allocation, so as to allocate the surplus
   bits to the sub-bands for secondary bit allocation and obtain a quantity of secondarily
   allocated bits of each sub-band of the sub-bands for secondary bit allocation; and a
   secondary information unit quantity determining unit, configured to perform,
20 according to the quantities of primarily allocated bits and the quantities of secondarily
   allocated bits of the sub-bands for secondary bit allocation, a secondary information
   unit quantity determining operation for each sub-band of the sub-bands for secondary
   bit allocation, so as to re-obtain a quantity of information units corresponding to each
   sub-band of the sub-bands for secondary bit allocation.
25 [0026]      With reference to the second aspect, in a first possible implementation
   manner of the second aspect, the sub-band characteristic of each sub-band of the
   to-be-processed sub-bands includes at least one of a characteristic of a signal carried
   in the sub-band, a bit allocation state corresponding to the sub-band, or a frequency
   range of the sub-band.
30 [0027]      With reference to the second aspect or any one of the foregoing possible
   implementation manner of the second aspect, in another possible implementation
   manner of the second aspect, the characteristic of the signal carried in the sub-band
   includes at least one of a type of the signal carried in the sub-band or an envelope
   value of the sub-band; and/or the bit allocation state corresponding to the sub-band
                                                8

   includes at least one of a coefficient quantization state of a corresponding
   previous-frame sub-band of the sub-band, a quantity of primary bits per information
   unit of the sub-band, an average quantity of primary bits per unit bandwidth of the
   sub-band, or a quantity of primarily allocated bits of the sub-band, where the average
 5 quantity of primary bits per unit bandwidth of the sub-band is determined according
   to the quantity of primarily allocated bits of the sub-band and bandwidth of the
   sub-band, and the quantity of primary bits per information unit of the sub-band is
   determined according to the quantity of primarily allocated bits of the sub-band and a
   quantity of primary information units of the sub-band, where the quantity of primary
10 information units of the sub-band is obtained from the primary information unit
   quantity determining operation that the sub-band has undergone.
   [0028]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the type of the signal carried in the sub-band includes
15 harmonic and/or non-harmonic.
   [0029]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the sub-band selection unit includes: a determining
   subunit, configured to determine a target sub-band set according to at least one of the
20 sub-band characteristic of each sub-band of the to-be-processed sub-bands or the total
   quantity of surplus bits; and a selection subunit, configured to select the sub-bands for
   secondary bit allocation from the target sub-band set, where a sub-band in the target
   sub-band set belongs to the to-be-processed sub-bands.
   [0030]      With reference to the second aspect or any one of the foregoing possible
25 implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the determining subunit is specifically configured to:
   determine the target sub-band set according to a sub-band characteristic of each
   sub-band in m first sub-band sets and m predetermined conditions in a one-to-one
   correspondence with the m first sub-band sets, where m is an integer greater than or
30 equal to 1, and a sub-band in the m first sub-band sets belongs to the to-be-processed
   sub-bands, where when all sub-band sets of the m first sub-band sets meet the
   corresponding predetermined conditions, a set formed by sub-bands that belong to all
   the m first sub-band sets is determined as the target sub-band set, or when a sub-band
   set of the m first sub-band sets does not meet a corresponding predetermined
                                               9

   condition, a set formed by sub-bands of the to-be-processed sub-bands other than
   sub-bands that belong to all the m first sub-band sets is determined as the target
   sub-band set; or when at least one sub-band set of the m first sub-band sets meets a
   corresponding predetermined condition, a set formed by all sub-bands in the at least
 5 one sub-band set is determined as the target sub-band set, or when no sub-band set of
   the m first sub-band sets meets a corresponding predetermined condition, a set formed
   by sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set
   of the m first sub-band sets is determined as the target sub-band set.
   [0031]      With reference to the second aspect or any one of the foregoing possible
10 implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, any predetermined condition of the m predetermined
   conditions    includes   at   least   one  of    the   following   conditions:  that   a
   coefficient-quantized sub-band exists in corresponding previous-frame sub-bands of a
   corresponding first sub-band set, that an average envelope value of sub-bands in a
15 corresponding first sub-band set is greater than a first threshold, or that a sub-band
   carrying a signal of a harmonic type exists in a corresponding first sub-band set.
   [0032]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, a frequency of a sub-band in the m first sub-band sets is
20 higher than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets.
   [0033]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the selection subunit is specifically configured to: select
25 the sub-bands for secondary bit allocation from the target sub-band set according to at
   least one of an average quantity of primary bits per unit bandwidth of each sub-band,
   a quantity of primary bits per information unit of each sub-band, or a quantity of
   primarily allocated bits of each sub-band in the target sub-band set.
   [0034]      With reference to the second aspect or any one of the foregoing possible
30 implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the selection subunit is specifically configured to:
   determine a sub-band with a smallest average quantity of primary bits per unit
   bandwidth, a sub-band with a smallest quantity of primary bits per information unit,
   or a sub-band with a smallest quantity of primarily allocated bits in the target
                                              10

   sub-band set as a top-priority to-be-enhanced sub-band, where the top-priority
   to-be-enhanced sub-band belongs to the sub-bands for secondary bit allocation.
   [0035]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
 5 manner of the second aspect, the selection subunit is specifically configured to: when
   the total quantity of surplus bits is greater than a threshold   aN and less than aN+1,
   determine that N sub-bands for secondary bit allocation need to be selected, where   aN
   and aN+1 are respectively the Nth threshold and the (N+1)th threshold of multiple
   thresholds sorted in ascending order; and when N is greater than or equal to 2, select
10 N-I sub-bands for secondary bit allocation from sub-bands in the target sub-band set
   other than the top-priority to-be-enhanced sub-band.
   [0036]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the selection subunit is specifically configured to:
15 determine the N-1 sub-bands for secondary bit allocation based on the top-priority
   to-be-enhanced sub-band for allocation, where the N sub-bands for secondary bit
   allocation are successive in a frequency domain.
   [0037]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
20 manner of the second aspect, the selection subunit is specifically configured to: when
   the total quantity of surplus bits is greater than a threshold, determine a
   second-priority to-be-enhanced sub-band from the target sub-band set, where the
   sub-bands for secondary bit allocation include the second-priority to-be-enhanced
   sub-band and the top-priority to-be-enhanced sub-band.
25 [0038]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the selection subunit is specifically configured to:
   determine a second-priority to-be-enhanced sub-band from the target sub-band set;
   and when the total quantity of surplus bits is greater than a threshold, determine that
30 the second-priority to-be-enhanced sub-band belongs to the sub-bands for secondary
   bit allocation.
   [0039]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the selection subunit is specifically configured to:
                                              11

   determine a sub-band with a smaller average quantity of primary bits per unit
   bandwidth, a sub-band with a smaller quantity of primary bits per information unit, or
   a sub-band with a smaller quantity of primarily allocated bits, of two sub-bands
   adjacent    to the   top-priority to-be-enhanced    sub-band   as   the second-priority
 5 to-be-enhanced sub-band.
   [0040]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the secondary bit allocation unit is specifically
   configured to: when a quantity of sub-bands included in the sub-bands for secondary
10 bit allocation is greater than or equal to 2, implement secondary bit allocation on the
   sub-bands for secondary bit allocation according to a quantity of bits per information
   unit that is obtained from the primary information unit quantity determining operation,
   an average quantity of bits per unit bandwidth or a quantity of primarily allocated bits
   that is obtained from the primary information unit quantity determining operation, of
15 each sub-band of the sub-bands for secondary bit allocation.
   [0041]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the primary bit allocation unit is specifically configured
   to: implement primary bit allocation on the to-be-processed sub-bands according to
20 the total quantity of to-be-allocated bits and envelope values of sub-bands of the
   to-be-processed sub-bands.
   [0042]       With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the apparatus is a encoder, and the apparatus further
25 includes: a quantization unit, configured to perform a quantization operation for each
   sub-band of the to-be-processed sub-bands according to the quantity of information
   units corresponding to each sub-band of the to-be-processed sub-bands, so as to
   obtain a quantized spectral coefficient corresponding to each sub-band, where the
   quantity of information units corresponding to each sub-band of the sub-bands for
30 secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
   information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
   a transport unit, configured to write the quantized spectral coefficient into a bitstream
                                                12

   and output the bitstream.
   [0043]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the secondary bit allocation parameter includes at least
 5 one parameter of a type of a signal carried in at least one sub-band of the
   to-be-processed sub-bands, an envelope value of at least one sub-band of the
   to-be-processed sub-bands, or a coefficient quantization state of a corresponding
   previous-frame sub-band of at least one sub-band of the to-be-processed sub-bands;
   and the transport unit is further configured to: write the at least one parameter into the
10 bitstream.
   [0044]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the apparatus is a decoder, and the apparatus further
   includes: an inverse quantization unit, configured to perform an inverse quantization
15 operation for each sub-band of the to-be-processed sub-bands according to the
   quantity of information units corresponding to each sub-band of the to-be-processed
   sub-bands, so as to obtain an inverse quantized spectral coefficient corresponding to
   each sub-band, where the quantity of information units corresponding to each
   sub-band of the sub-bands for secondary bit allocation is the quantity of information
20 units that is obtained from the secondary information unit quantity determining
   operation, and a quantity of information units corresponding to another sub-band is a
   quantity of information units that is obtained from the primary information unit
   quantity determining operation; and a first acquiring unit, configured to acquire an
   output signal according to the inverse quantized spectral coefficient.
25 [0045]      With reference to the second aspect or any one of the foregoing possible
   implementation manners of the second aspect, in another possible implementation
   manner of the second aspect, the secondary bit allocation parameter includes at least
   one parameter of a type of a signal carried in at least one sub-band of the
   to-be-processed sub-bands, an envelope value of at least one sub-band of the
30 to-be-processed sub-bands, or a coefficient quantization state of a corresponding
   previous-frame sub-band of at least one sub-band of the to-be-processed sub-bands;
   and the apparatus further includes: a second acquiring unit, configured to acquire the
   at least one parameter from a to-be-decoded bitstream.
   [0046]      According to a third aspect, a signal processing apparatus is provided,
                                               13

   where the apparatus includes      a memory and a processor, where the memory is
   configured to store program code; the processor is configured to call the program
   code stored in the memory to perform the following operations: determining a total
   quantity of to-be-allocated bits corresponding to to-be-processed sub-bands of a
 5 current frame; implementing primary bit allocation on the to-be-processed sub-bands
   according to the total quantity of to-be-allocated bits, so as to obtain a quantity of
   primarily allocated bits of each sub-band of the to-be-processed             sub-bands;
   performing, according to the quantity of primarily allocated bits of each sub-band, a
   primary information unit quantity determining operation for each sub-band that has
10 undergone the primary bit allocation, so as to obtain a total quantity of surplus bits of
   the current frame and a quantity of information units corresponding to each sub-band
   of the to-be-processed sub-bands; selecting sub-bands for secondary bit allocation
   from the to-be-processed sub-bands according to a secondary bit allocation parameter,
   where the secondary bit allocation parameter includes at least one of a sub-band
15 characteristic of each sub-band of the to-be-processed sub-bands or the total quantity
   of surplus bits; implementing secondary bit allocation on the sub-bands for secondary
   bit allocation, so as to allocate the surplus bits to the sub-bands for secondary bit
   allocation and obtain a quantity of secondarily allocated bits of each sub-band of the
   sub-bands for secondary bit allocation; and performing, according to the quantities of
20 primarily allocated bits and the quantities of secondarily allocated bits of the
   sub-bands for secondary bit allocation, a secondary information unit quantity
   determining operation for each sub-band of the sub-bands for secondary bit allocation,
   so as to re-obtain a quantity of information units corresponding to each sub-band of
   the sub-bands for secondary bit allocation.
25 [0047]      With reference to the third aspect, in a first possible implementation
   manner of the third aspect, the sub-band characteristic of each sub-band of the
   to-be-processed sub-bands includes at least one of a characteristic of a signal carried
   in the sub-band, a bit allocation state corresponding to the sub-band, or a frequency
   range of the sub-band.
30 [0048]      With reference to the third aspect or any one of the foregoing possible
   implementation manner of the third aspect, in another possible implementation
   manner of the third aspect, the characteristic of the signal carried in the sub-band
   includes at least one of a type of the signal carried in the sub-band or an envelope
   value of the sub-band; and/or the bit allocation state corresponding to the sub-band
                                               14

   includes at least one of a coefficient quantization state of a corresponding
   previous-frame sub-band of the sub-band, a quantity of primary bits per information
   unit of the sub-band, an average quantity of primary bits per unit bandwidth of the
   sub-band, or a quantity of primarily allocated bits of the sub-band, where the average
 5 quantity of primary bits per unit bandwidth of the sub-band is determined according
   to the quantity of primarily allocated bits of the sub-band and bandwidth of the
   sub-band, and the quantity of primary bits per information unit of the sub-band is
   determined according to the quantity of primarily allocated bits of the sub-band and a
   quantity of primary information units of the sub-band, where the quantity of primary
10 information units of the sub-band is obtained from the primary information unit
   quantity determining operation that the sub-band has undergone.
   [0049]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the type of the signal carried in the sub-band includes
15 harmonic and/or non-harmonic.
   [0050]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operations: determining a target
20 sub-band set according to at least one of the sub-band characteristic of each sub-band
   of the to-be-processed sub-bands or the total quantity of surplus bits, and selecting the
   sub-bands for secondary bit allocation from the target sub-band set, where a sub-band
   in the target sub-band set belongs to the to-be-processed sub-bands.
   [0051]      With reference to the third aspect or any one of the foregoing possible
25 implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: determining the target
   sub-band set according to a sub-band characteristic of each sub-band in m first
   sub-band sets and m predetermined conditions in a one-to-one correspondence with
30 the m first sub-band sets, where m is an integer greater than or equal to 1, and a
   sub-band in the m first sub-band sets belongs to the to-be-processed sub-bands, where
   when all sub-band sets of the m first sub-band sets meet the corresponding
   predetermined conditions, a set formed by sub-bands that belong to all the m first
   sub-band sets is determined as the target sub-band set, or when a sub-band set of the
                                               15

   m first sub-band sets does not meet a corresponding predetermined condition, a set
   formed by sub-bands of the to-be-processed sub-bands other than sub-bands that
   belong to all the m first sub-band sets is determined as the target sub-band set; or
   when at least one sub-band set of the m first sub-band sets meets a corresponding
 5 predetermined condition, a set formed by all sub-bands in the at least one sub-band set
   is determined as the target sub-band set, or when no sub-band set of the m first
   sub-band sets meets a corresponding predetermined condition, a set formed by
   sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set of
   the m first sub-band sets is determined as the target sub-band set.
10 [0052]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, any predetermined condition of the m predetermined
   conditions    includes   at   least  one    of   the   following    conditions: that  a
   coefficient-quantized sub-band exists in corresponding previous-frame sub-bands of a
15 corresponding first sub-band set, that an average envelope value of sub-bands in a
   corresponding first sub-band set is greater than a first threshold, or that a sub-band
   carrying a signal of a harmonic type exists in a corresponding first sub-band set.
   [0053]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
20 manner of the third aspect, a frequency of a sub-band in the m first sub-band sets is
   higher than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets.
   [0054]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
25 manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: selecting the
   sub-bands for secondary bit allocation from the target sub-band set according to at
   least one of an average quantity of primary bits per unit bandwidth of each sub-band,
   a quantity of primary bits per information unit of each sub-band, or a quantity of
30 primarily allocated bits of each sub-band in the target sub-band set.
   [0055]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: determining a
                                               16

   sub-band with a smallest average quantity of primary bits per unit bandwidth, a
   sub-band with a smallest quantity of primary bits per information unit, or a sub-band
   with a smallest quantity of primarily allocated bits in the target sub-band set as a
   top-priority to-be-enhanced sub-band, where the top-priority to-be-enhanced sub-band
 5 belongs to the sub-bands for secondary bit allocation.
   [0056]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operations: when the total
10 quantity of surplus bits is greater than a threshold aN  and less than aN+1, determining
   that N sub-bands for secondary bit allocation need to be selected, where     aN  and aN+1
   are respectively the Nth threshold and the (N+1)th threshold of multiple thresholds
   sorted in ascending order; and when N is greater than or equal to 2, selecting N-1
   sub-bands for secondary bit allocation from sub-bands in the target sub-band set other
15 than the top-priority to-be-enhanced sub-band.
   [0057]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: determining the N-1
20 sub-bands for secondary bit allocation based on the top-priority to-be-enhanced
   sub-band for allocation, where the N sub-bands for secondary bit allocation are
   successive in a frequency domain.
   [0058]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
25 manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: when the total quantity
   of surplus bits     is  greater  than a threshold,      determining   a second-priority
   to-be-enhanced sub-band from the target sub-band set, where the sub-bands for
   secondary bit allocation include the second-priority to-be-enhanced sub-band and the
30 top-priority to-be-enhanced sub-band.
   [0059]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operations: determining a
                                               17

   second-priority to-be-enhanced sub-band from the target sub-band set; and when the
   total quantity of surplus bits is greater than a threshold, determining that the
   second-priority to-be-enhanced sub-band belongs to the sub-bands for secondary bit
   allocation.
 5 [0060]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: determining a
   sub-band with a smaller average quantity of primary bits per unit bandwidth, a
10 sub-band with a smaller quantity of primary bits per information unit, or a sub-band
   with a smaller quantity of primarily allocated bits, of two sub-bands adjacent to the
   top-priority to-be-enhanced sub-band as the second-priority to-be-enhanced sub-band.
   [0061]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
15 manner of the third aspect, the processor is configured to call the program code stored
   in the memory to specifically perform the following operation: when a quantity of
   sub-bands included in the sub-bands for secondary bit allocation is greater than or
   equal to 2, implementing secondary bit allocation on the sub-bands for secondary bit
   allocation according to a quantity of primary bits per information unit, an average
20 quantity of primary bits per unit bandwidth, or a quantity of primarily allocated bits,
   of each sub-band of the sub-bands for secondary bit allocation.
   [0062]      With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the processor is configured to call the program code stored
25 in the memory to specifically perform the following operation: implementing primary
   bit allocation on the to-be-processed sub-bands according to the total quantity of
   to-be-allocated bits and envelope values of sub-bands of the to-be-processed
   sub-bands.
   [0063]      With reference to the third aspect or any one of the foregoing possible
30 implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the apparatus is an encoder, and the processor is
   configured to call the program code stored in the memory to further perform the
   following operations: performing a quantization operation for each sub-band of the
   to-be-processed    sub-bands    according   to  the   quantity of information     units
                                              18

   corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain a
   quantized spectral coefficient corresponding to each sub-band, where the quantity of
   information units corresponding to each sub-band of the sub-bands for secondary bit
   allocation is the quantity of information units that is obtained from the secondary
 5 information unit quantity determining operation, and a quantity of information units
   corresponding to another sub-band is a quantity of information units that is obtained
   from the primary information unit quantity determining operation; and writing the
   quantized spectral coefficient into a bitstream and outputting the bitstream.
   [0064]       With reference to the third aspect or any one of the foregoing possible
10 implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
   sub-bands, an envelope value of at least one sub-band of the to-be-processed
   sub-bands, or a coefficient quantization state of a corresponding previous-frame
15 sub-band of at least one sub-band of the to-be-processed sub-bands; and when the
   apparatus is an encoder, the processor is configured to call the program code stored in
   the memory to further perform the following operation: writing the at least one
   parameter into the bitstream.
   [0065]       With reference to the third aspect or any one of the foregoing possible
20 implementation manners of the third aspect, in another possible implementation
   manner of the third aspect, the apparatus is a decoder, and the processor is configured
   to call the program code stored in the memory to further perform the following
   operations: performing an inverse quantization operation for each sub-band of the
   to-be-processed    sub-bands    according    to  the  quantity of information       units
25 corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain an
   inverse quantized spectral coefficient corresponding to each sub-band, where the
   quantity of information units corresponding to each sub-band of the sub-bands for
   secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
30 information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
   acquiring an output signal according to the inverse quantized spectral coefficient.
   [0066]       With reference to the third aspect or any one of the foregoing possible
   implementation manners of the third aspect, in another possible implementation
                                                19

   manner of the third aspect, when the apparatus is a decoder, the secondary bit
   allocation parameter includes at least one parameter of a type of a signal carried in at
   least one sub-band of the to-be-processed sub-bands, an envelope value of at least one
   sub-band of the to-be-processed sub-bands, or a coefficient quantization state of a
 5 corresponding    previous-frame    sub-band     of at   least one     sub-band    of the
   to-be-processed sub-bands; and when the apparatus is a decoder, the processor is
   configured to call the program code stored in the memory to further perform the
   following operation: acquiring the at least one parameter from a to-be-decoded
   bitstream.
10 [0067]      Therefore, in the embodiments of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands according to a total
   quantity of to-be-allocated bits of a current frame, so as to obtain a quantity of
   primarily allocated bits of each sub-band; a primary information unit quantity
   determining operation is performed for a sub-band that has undergone the primary bit
15 allocation, so as to obtain a quantity of information units corresponding to each
   sub-band of the to-be-processed sub-bands and a total quantity of surplus bits of the
   current frame; then, sub-bands for secondary bit allocation are determined according
   to at least one of a sub-band characteristic of each sub-band of the to-be-processed
   sub-bands or the total quantity of surplus bits, and the surplus bits are allocated to the
20 sub-bands for secondary bit allocation to obtain a quantity of secondarily allocated
   bits of each sub-band of the sub-bands for secondary bit allocation; a secondary
   information unit quantity determining operation is performed for each sub-band of the
   sub-bands for secondary bit allocation according to the quantity of primarily allocated
   bits and the quantity of secondarily allocated bits of each sub-band of the sub-bands
25 for secondary bit allocation, so as to re-obtain a quantity of information units
   corresponding to each sub-band of the sub-bands for secondary bit allocation. The
   surplus bits left in encoded sub-bands are not evenly allocated to remaining
   unencoded sub-bands, and therefore, available bits can be more properly and fully
   used and encoding and decoding quality is apparently improved.
30                       BRIEF DESCRIPTION OF DRAWINGS
   [0068]      To describe the technical solutions in the embodiments of the present
   invention more clearly, the following briefly describes the accompanying drawings
                                              20

   required for describing the embodiments. Apparently, the accompanying drawings in
   the following description show merely some embodiments of the present invention,
   and a person of ordinary skill in the art may still derive other drawings from these
   accompanying drawings without creative efforts.
 5 [0069]      FIG. 1 is a schematic flowchart of a signal processing method according to
   an embodiment of the present invention;
   [0070]      FIG. 2 is a schematic flowchart of a signal processing method according to
   another embodiment of the present invention;
   [0071]      FIG. 3 is a schematic diagram of selecting sub-bands for secondary bit
10 allocation according to another embodiment of the present invention;
   [0072]      FIG. 4 is a schematic diagram of selecting sub-bands for secondary bit
   allocation according to another embodiment of the present invention;
   [0073]      FIG. 5 is a schematic diagram of selecting sub-bands for secondary bit
   allocation according to another embodiment of the present invention;
15 [0074]      FIG. 6 is a schematic diagram of selecting sub-bands for secondary bit
   allocation according to another embodiment of the present invention;
   [0075]      FIG. 7 is a schematic diagram of a secondary information unit quantity
   determining operation according to another embodiment of the present invention;
   [0076]      FIG. 8 is a schematic flowchart of a signal processing method according to
20 another embodiment of the present invention;
   [0077]      FIG. 9 is a schematic flowchart of a signal processing method according to
   another embodiment of the present invention;
   [0078]      FIG. 10 is a schematic block diagram of a signal processing apparatus
   according to another embodiment of the present invention;
25 [0079]      FIG. 11 is a schematic block diagram of a signal processing apparatus
   according to another embodiment of the present invention;
   [0080]      FIG. 12 is a schematic block diagram of a signal processing apparatus
   according to another embodiment of the present invention;
   [0081]      FIG. 13 is a schematic block diagram of a signal processing apparatus
30 according to another embodiment of the present invention; and
   [0082]      FIG. 14 is a schematic block diagram of a signal processing apparatus
   according to another embodiment of the present invention.
                                              21

                           DESCRIPTION OF EMBODIMENTS
   [0083]      The following clearly describes the technical solutions in the embodiments
   of the present invention with reference to the accompanying drawings in the
   embodiments of the present invention. Apparently, the described embodiments are
 5 some but not all of the embodiments of the present invention. All other embodiments
   obtained by a person of ordinary skill in the art based on the embodiments of the
   present invention without creative efforts shall fall within the protection scope of the
   present invention.
   [0084]      FIG. 1 is a schematic flowchart of a signal processing method 100
10 according to an embodiment of the present invention. As shown in FIG. 1, the method
   100 includes:
   [0085]      S110. Determine a total quantity of to-be-allocated bits corresponding to
   to-be-processed sub-bands of a current frame.
   [0086]      S 120. Implement primary bit allocation on each sub-band of the
15 to-be-processed sub-bands according to the total quantity of to-be-allocated bits, so as
   to obtain a quantity of primarily allocated bits of each sub-band of the to-be-processed
   sub-bands.
   [0087]      S130. Perform, according to the quantity of primarily allocated bits of each
   sub-band, a primary information unit quantity determining operation for each
20 sub-band of the to-be-processed sub-bands that has undergone the primary bit
   allocation, so as to obtain a total quantity of surplus bits of the current frame and a
   quantity of information units corresponding to each sub-band of the to-be-processed
   sub-bands.
   [0088]      S140.   Select   sub-bands     for   secondary   bit  allocation   from   the
25 to-be-processed sub-bands according to a secondary bit allocation parameter, where
   the secondary bit allocation parameter includes at least one of the total quantity of
   surplus bits or a sub-band characteristic of each sub-band of the to-be-processed
   sub-bands.
   [0089]      S150. Implement secondary bit allocation on the sub-bands for secondary
30 bit allocation, so as to allocate the surplus bits to the sub-bands for secondary bit
   allocation and obtain a quantity of secondarily allocated bits of each sub-band of the
   sub-bands for secondary bit allocation.
   [0090]      S160. Perform, according to the bits obtained when the primary bit
                                                22

   allocation is performed for the sub-bands for secondary bit allocation and the bits
   obtained when the secondary bit allocation is performed, a secondary information unit
   quantity determining operation for each sub-band of the sub-bands for secondary bit
   allocation, so as to re-obtain a quantity of information units corresponding to each
 5 sub-band of the sub-bands for secondary bit allocation.
   [0091]       Specifically, when the bit allocation is performed for the to-be-processed
   sub-bands of the current frame, the total quantity of to-be-allocated bits corresponding
   to the to-be-processed sub-bands may be determined; the primary bit allocation is
   performed for the to-be-processed sub-bands according to the total quantity of
10 to-be-allocated bits, so as to obtain the quantity of primarily allocated bits of each
   sub-band, where the primary bit allocation may be performed for each sub-band
   according to an envelope value of each sub-band; according to the quantity of
   primarily allocated bits of each sub-band, the primary information unit quantity
   determining operation is performed for each sub-band that has undergone the primary
15 bit allocation, and after the primary information unit quantity determining operation is
   performed for all sub-bands, the quantity of information units corresponding to each
   sub-band and the total quantity of surplus bits are obtained; the sub-bands for
   secondary bit allocation are selected from the to-be-processed sub-bands according to
   the secondary bit allocation parameter, and specifically, according to the sub-band
20 characteristic of each sub-band of the to-be-processed sub-bands and/or the total
   quantity of surplus bits; the secondary bit allocation is performed for the selected
   sub-bands for secondary bit allocation, that is, the surplus bits are allocated to the
   sub-bands for secondary bit allocation; then, the secondary information unit quantity
   determining operation is performed for each sub-band of the sub-bands for secondary
25 bit allocation according to the quantities of primarily allocated bits and the quantities
   of secondarily allocated bits of the sub-bands for secondary bit allocation, so as to
   re-obtain the quantity of information units corresponding to each sub-band of the
   sub-bands for secondary bit allocation. Therefore, a subsequent operation may be
   performed according to the quantity of information units corresponding to each
30 sub-band of the to-be-processed sub-bands. For example, for an encoder side, a
   quantization operation may be performed according to the quantity of information
   units corresponding to each sub-band, and for a decoder side, an inverse quantization
   operation may be performed according to the quantity of information units
   corresponding to each sub-band.
                                               23

   [0092]      It should be understood that, on the encoder side, the to-be-processed
   sub-bands in this embodiment of the present invention may be referred to as
   to-be-encoded sub-bands, and on the decoder side, the to-be-processed sub-bands in
   this embodiment of the present invention may be referred to as to-be-decoded
 5 sub-bands.
   [0093]      It should be understood that the           quantity of information units
   corresponding to each sub-band of the sub-bands for secondary bit allocation is the
   quantity of information units that is obtained from the secondary information unit
   quantity determining operation, and a quantity of information units corresponding to
10 another sub-band is a quantity of information units that is obtained from the primary
   information unit quantity determining operation.
   [0094]      It should be understood that, in this embodiment of the present invention,
   the quantity of information units corresponding to each sub-band and a quantity of
   surplus bits corresponding to each sub-band may be obtained by performing a primary
15 information    unit quantity determining operation        for each sub-band        of the
   to-be-processed sub-bands, where a sum of a quantity of bits occupied by the
   information units corresponding to each sub-band and the quantity of surplus bits
   corresponding to each sub-band is the quantity of primarily allocated bits of each
   sub-band, and the quantity of surplus bits corresponding to each sub-band is
20 insufficient for encoding one information unit; then, the total quantity of surplus bits
   of the current frame may be obtained by summing up surplus bits corresponding to all
   sub-bands of the to-be-processed sub-bands of the current frame, and the total surplus
   bits of the current frame are allocated to the sub-bands for secondary bit allocation of
   the to-be-processed sub-bands of the current frame.
25 [0095]      It should be further understood that an information unit in this embodiment
   of the present invention is a unit for encoding, an information unit quantity
   determining operation is a specific process of an encoding or decoding operation, and
   the determining may be specifically performed according to a quantity of allocated
   bits. Certainly, for different encoding methods, an information unit may have different
30 names. For example, in some encoding methods, an information unit is referred to as
   a pulse. Whatever name is used shall fall within the protection scope of the present
   invention, provided that the essence is the same as that in the present invention.
   [0096]      Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands of a current frame
                                               24

   according to a total quantity of to-be-allocated bits, so as to obtain a quantity of
   primarily allocated bits of each sub-band; a primary information unit quantity
   determining operation is performed for a sub-band that has undergone the primary bit
   allocation, so as to obtain a quantity of information units corresponding to each
 5 sub-band of the to-be-processed sub-bands and a total quantity of surplus bits; then,
   sub-bands for secondary bit allocation are determined according to at least one of a
   sub-band characteristic of each sub-band of the to-be-processed sub-bands or the total
   quantity of surplus bits, and the surplus bits are allocated to the sub-bands for
   secondary bit allocation to obtain a quantity of secondarily allocated bits of each
10 sub-band of the sub-bands for secondary bit allocation; a secondary information unit
   quantity determining operation is performed for each sub-band of the sub-bands for
   secondary bit allocation according to the quantity of primarily allocated bits and the
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation, so as to re-obtain a quantity of information units corresponding to each
15 sub-band of the sub-bands for secondary bit allocation. The surplus bits left in
   encoded sub-bands are not evenly allocated to remaining unencoded sub-bands, and
   therefore, available bits can be more properly and fully used and encoding and
   decoding quality is apparently improved.
   [0097]       In this embodiment of the present invention, the secondary bit allocation
20 parameter may include at least one of the total quantity of surplus bits or a sub-band
   characteristic of each sub-band of the to-be-processed sub-bands.
   [0098]       Optionally,   the   sub-band    characteristic of each    sub-band  of the
   to-be-processed sub-bands may include at least one of a characteristic of a signal
   carried in the sub-band, a bit allocation state corresponding to the sub-band, or a
25 frequency range of the sub-band. Alternatively, the sub-band characteristic of each
   sub-band may be merely a number or the like of a sub-band.
   [0099]       Optionally, the characteristic of the signal carried in the sub-band may
   include at least one of a type of the signal carried in the sub-band or an envelope
   value, where the type          of the   carried signal may include harmonic       and/or
30 non-harmonic; and/or
                the bit allocation state corresponding to the sub-band may include at least
   one of a coefficient quantization state of a corresponding previous-frame sub-band of
   the sub-band, a quantity of primary bits per information unit of the sub-band, an
   average quantity of primary bits per unit bandwidth of the sub-band, or a quantity of
                                                 25

   primarily allocated bits of the sub-band.
   [0100]      Optionally, the coefficient quantization state of the corresponding
   previous-frame    sub-band of the sub-band may be a situation whether the
   corresponding previous-frame sub-band of the sub-band is coefficient-quantized, and
 5 specifically, may be determined based on whether a bit is allocated to the
   corresponding previous-frame sub-band of the sub-band, where whether a bit is
   allocated to the corresponding previous-frame sub-band may be determined
   comprehensively according to the primary bit allocation and the secondary bit
   allocation. It may be understood that a bit is allocated to the corresponding
10 previous-frame sub-band provided that a bit is allocated (no matter whether being
   allocated when the primary bit allocation is performed or allocated when the
   secondary bit allocation is performed).
   [0101]      In this embodiment of the present invention, an average quantity of
   primary bits per unit bandwidth of any sub-band is determined according to a quantity
15 of primarily allocated bits of the any sub-band and bandwidth of the any sub-band.
   [0102]      The average quantity of primary bits per unit bandwidth of the sub-band
   may       be      determined       according     to     the    following      formula:
                          Rk [k, ]
   aver _bit[k,]=         didhk]
          aver- ]     bandwidth[k,], where Rkk1 [k,] k indicates a quantity of primarily
   allocated bits of a sub-band ki, and bandwidth[k,] indicates bandwidth of the
20 sub-band.
   [0103]      A quantity of primary bits per information unit of any sub-band is
   determined according to a quantity of primarily allocated bits of the any sub-band and
   a quantity of primary information units of the any sub-band, where the quantity of
   primary information units of the any sub-band is obtained from a primary information
25 unit quantity determining operation is performed for the any sub-band.
   [0104]      The quantity of primary bits per information unit of the sub-band may be
   determined according to the following formula:
                Rk    pulse[k,]= Rk[k]
                                    npluse[k1 ] , where RkIlk       indicates a quantity
   RkIk,] of primarily allocated bits of a sub-band ki, and npluse[k,] indicates
                                                                                        a
30 quantity of information units (that is, a quantity of primary information units of the
                                               26

   sub-band) that is obtained from a primary information unit quantity determining
   operation is performed for the sub-band ki.
   [0105]       It should be understood that this embodiment of the present invention is
   described based on a fact that bandwidth occupied by a signal is divided into multiple
 5 sub-bands in each frame, and a current-frame sub-band and a corresponding
   previous-frame sub-band of the sub-band (that is, the previous frame corresponding to
   the sub-band) are the same in terms of frequency. In some scenarios, for different
   frames, even if sub-bands with a same frequency range are referred to as one
   sub-band. Any used technical solution shall also fall within the protection scope of the
10 present invention provided that the essence of the used technical solution is the same
   as that in the present invention.
   [0106]       In this embodiment of the present invention, in S130, the selecting
   sub-bands for secondary bit allocation from the to-be-processed sub-bands may
   include:
15              determining a target sub-band set according to at least one of the total
   quantity of surplus bits or the sub-band characteristic of each sub-band of the
   to-be-processed sub-bands, and selecting the sub-bands for secondary bit allocation
   from the target sub-band set, where a sub-band in the target sub-band set belongs to
   the to-be-processed sub-bands.
20 [0107]       Specifically, the target sub-band set is determined according to a sub-band
   characteristic of m first sub-band sets and m predetermined conditions in a one-to-one
   correspondence with the m first sub-band sets, where m is an integer greater than or
   equal to 1, where
                when all sub-band sets of the m first sub-band sets meet the corresponding
25 predetermined conditions, a set formed by sub-bands that belong to all the m first
   sub-band sets (when m is greater than or equal to 2, the set is an intersection of the m
   first sub-band sets) is determined as the target sub-band set, or when a sub-band set of
   the m first sub-band sets does not meet a corresponding predetermined condition, a set
   formed by sub-bands of the to-be-processed sub-bands other than sub-bands that
30 belong to all the m first sub-band sets is determined as the target sub-band set; or
   when at least one sub-band set of the m first sub-band sets meets a corresponding
   predetermined condition, a set formed by all sub-bands in the at least one sub-band set
   is determined as the target sub-band set, or when no sub-band set of the m first
   sub-band sets meets a corresponding predetermined condition, a set formed by
                                                27

   sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set of
   the m first sub-band sets is determined as the target sub-band set.
   [0108]      It should be understood that a one-to-one correspondence between the m
   first sub-band sets and the m predetermined conditions means that each sub-band set
 5 of the m first sub-band sets is corresponding to one predetermined condition, and the
   sub-band sets are corresponding to different predetermined conditions.
   [0109]      Optionally, any predetermined        condition of the       m predetermined
   conditions includes at least one of the following conditions:
               that   a   coefficient-quantized    sub-band     exists    in   corresponding
10 previous-frame sub-bands of a corresponding first sub-band set, that an average
   envelope value of sub-bands in a corresponding first sub-band set is greater than a
   first threshold, or that a sub-band carrying a signal of a harmonic type exists in a
   corresponding first sub-band set.
   [0110]      Optionally, the first threshold may be specifically determined according to
15 an average envelope value of sub-bands outside the first sub-band set. For example,
                                                                                BANDS -J -1
                                                                                    1 Ep[i]
                                                                        0 = --      i=0
   the determining may be performed according to a formula                   3 BANDS- J,
   where Ep[i] indicates an envelope value of a sub-band i, BANDS is a quantity of
   to-be-processed sub-bands, the first sub-band set includes a total of J sub-bands,
                                                                BANDS-J-1
                                                                   i       Ep[i]
    Ep[i] indicates an envelope value of a sub-band i, and         i=0             indicates a
20 sum of envelope values of sub-bands other than the J sub-bands.
   [0111]      Optionally, a frequency of a sub-band in the m first sub-band sets is higher
   than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets. That is, whether a high-frequency sub-band
   meets a condition is first determined; if the corresponding condition is met, sub-bands
25 for secondary bit allocation are selected from the high-frequency ones; or if the
   corresponding condition is not met, sub-bands for secondary bit allocation are
   selected from the low-frequency ones.
   [0112]      Optionally, in this embodiment of the present invention, the m first
   sub-band sets may be preconfigured, or may be selected by an encoding/decoding
30 device from to-be-processed sub-band sets.
                                               28

   [0113]      Optionally, in this embodiment of the present invention, no matter whether
   the m first sub-band sets are preconfigured, or selected by an encoding/decoding
   device, when the m first sub-band sets are selected, the m first sub-band sets may be
   determined according to bandwidth occupied by a to-be-encoded or to-be-decoded
 5 signal. For example, the occupied bandwidth is narrowband bandwidth (for example,
   the bandwidth is 4 kHz), a set formed by sub-bands with a bandwidth greater than 2
   kHz may be determined as one first sub-band set, and a set formed by sub-bands with
   a bandwidth greater than 3 kHz may be determined as another first sub-band set. For
   another example, the occupied bandwidth is wideband bandwidth (for example, the
10 bandwidth is 8 kHz), a set formed by sub-bands with a bandwidth greater than 5 kHz
   may be determined as one first sub-band set, and a set formed by sub-bands with a
   bandwidth greater than 6 kHz may be determined as another first sub-band set.
   [0114]      It should be understood that, in this embodiment of the present invention,
   the target sub-band set may be directly selected from the to-be-processed sub-bands
15 according to a predetermined condition. In this case, the predetermined condition may
   be that a sub-band carries a signal of a harmonic type, and then all sub-bands carrying
   signals of a harmonic type may be determined to form the target sub-band set; or the
   predetermined condition may be that a coefficient-quantized sub-band exists in
   corresponding previous-frame sub-bands of the to-be-processed sub-bands, and then
20 all sub-bands of the current frame whose corresponding previous-frame sub-bands are
   coefficient-quantized may be determined to form the target sub-band set; or the
   predetermined condition may be that an envelope value of a sub-band of the current
   frame is greater than a threshold, and then all sub-bands of the current frame whose
   envelope values are greater than the threshold may be determined to form the target
25 sub-band set, where the threshold may be determined according to an average
   envelope value of all sub-bands of the current frame, for example, the average
   envelope value may be directly determined as the threshold, or 4/5 of the average
   envelope value is determined as the threshold; or the predetermined condition
   includes at least two of the foregoing predetermined conditions, and then all
30 sub-bands meeting the at least two conditions are determined to form the target
   sub-band set.
   [0115]      In this embodiment of the present invention, after the target sub-band set is
   determined, the sub-bands for secondary bit allocation may be selected from the target
   sub-band set, where the sub-bands for secondary bit allocation may be selected from
                                               29

   the target sub-band set according to at least one of an average quantity of primary bits
   per unit bandwidth of each sub-band, a quantity of primary bits per information unit
   of each sub-band, or a quantity of primarily allocated bits of each sub-band in the
   target sub-band set.
 5 [0116]      Specifically,   a top-priority   to-be-enhanced    sub-band    may be     first
   determined, where a sub-band with a smallest average quantity of primary bits per
   unit bandwidth, a sub-band with a smallest quantity of bits per information unit, or a
   sub-band with a smallest quantity of primarily allocated bits in the target sub-band set
   may be determined as the top-priority to-be-enhanced sub-band, where the smallest
10 quantity of bits per information unit and the smallest quantity of primarily allocated
   bits are obtained by the primary information unit quantity determining operation, and
   the top-priority to-be-enhanced sub-band belongs to the sub-bands for secondary bit
   allocation. Optionally, all the surplus bits may be directly allocated to the top-priority
   to-be-enhanced sub-band, that is, the sub-bands for secondary allocation may include
15 only the top-priority to-be-enhanced sub-band, or another sub-band that belongs to the
   sub-bands    for secondary bit allocation may be further selected. Specifically,
   determining whether to select another sub-band for secondary bit allocation and
   selecting another sub-band for secondary bit allocation may be implemented in the
   following two manners:
20 [0117]      In a first implementation manner, when the total quantity of surplus bits is
   greater than a threshold   aN and less than aN+1, it is determined that N sub-bands for
   secondary bit allocation need to be selected, where   aN and aN+1 are respectively the Nth
   threshold and the (N+1)th threshold of multiple thresholds sorted in ascending order.
   When N is greater than or equal to 2, N-i sub-bands for secondary bit allocation are
25 selected from sub-bands in the target sub-band set other than the top-priority
   to-be-enhanced sub-band. Certainly, when N is equal to 1, there is no need to further
   select another sub-band for secondary bit allocation.
   [0118]      In this embodiment of the present invention, multiple refers to two or more
   than two. For example, multiple thresholds refer to two or more than two thresholds.
30 [0119]      Optionally, in this embodiment of the present invention, the thresholds
   may be determined according to bandwidth occupied by a to-be-encoded                     or
   to-be-decoded signal and/or bandwidth of the top-priority to-be-enhanced sub-band.
   Optionally, the thresholds are in a positive correlation with bandwidth occupied by a
   to-be-encoded     or to-be-decoded     signal and/or bandwidth       of the top-priority
                                                30

   to-be-enhanced sub-band.
   [0120]      Optionally, the other N-i sub-bands for secondary bit allocation may be
   selected based on the top-priority to-be-enhanced sub-band. To better maintain
   continuity of a spectrum, the N sub-bands for secondary bit allocation are successive
 5 in a frequency domain.
   [0121]      Specifically, when N is 2, a sub-band with a smaller average quantity of
   primary bits per unit bandwidth, a sub-band with a smaller quantity of bits per
   information unit, or a sub-band with a smaller quantity of primarily allocated bits, of
   two sub-bands adjacent to the top-priority to-be-enhanced sub-band may be
10 determined as another sub-band for secondary bit allocation, where the smaller
   quantity of bits per information unit and the smaller quantity of primarily allocated
   bits are obtained by the primary information unit quantity determining operation.
   When N=3, two sub-bands k+i and k-i adjacent to the top-priority to-be-enhanced
   sub-band k may be determined as the sub-bands for secondary bit allocation. If N=4,
15 sub-bands k+i and k-i may be determined as sub-bands for secondary bit allocation,
   and a sub-band with a smaller average quantity of primary bits per unit bandwidth, a
   sub-band with a smaller quantity of bits per information unit, or a sub-band with a
   smaller quantity of primarily allocated bits, of sub-bands k+2 and k-2 adjacent to
   sub-bands k+1 and k-i may be determined as a sub-band for secondary bit allocation,
20 where the smaller quantity of bits per information unit and the smaller quantity of
   primarily allocated bits are obtained from the primary information unit quantity
   determining operation. If N>5, selection may also be further performed according to a
   manner similar to the foregoing manner. It should be understood that the tags k, k+1,
   k-i, and the like of the foregoing sub-bands are merely for ease of description and
25 shall not be construed as a limitation on the present invention.
   [0122]      Certainly, in this embodiment of the present invention, there may be no
   need to ensure that the N sub-bands for secondary bit allocation are successive in a
   frequency domain. For example, N sub-bands with smaller average quantities of
   primary bits per unit bandwidth in the target sub-band set may be determined as the
30 sub-bands for secondary bit allocation according to average quantities of primary bits
   per unit bandwidth of all sub-bands; or N sub-bands with smaller quantities of bits per
   information unit in the target sub-band set may be determined as the sub-bands for
   secondary bit allocation according to quantities of primary bits per information unit of
   all sub-bands; or N sub-bands with quantities of primarily allocated bits in the target
                                               31

   sub-band set may be determined as the sub-bands for secondary bit allocation
   according to quantities of primarily allocated bits of all sub-bands. Alternatively, one
   sub-band is selected from two sub-bands k+1 and k-i adjacent to the top-priority
   to-be-enhanced sub-band k, and one sub-band is selected from sub-bands k+2 and k-2,
 5 and so on, until all N sub-bands are selected.
   [0123]       In a second implementation manner, when the total quantity of surplus bits
   is greater than a threshold a, it may be determined that a second-priority
   to-be-enhanced sub-band needs to be selected, and then, the second-priority
   to-be-enhanced sub-band is determined from the target sub-band set, where the
10 sub-bands for secondary bit allocation include the top-priority to-be-enhanced
   sub-band and the second-priority to-be-enhanced sub-band. Alternatively, the
   second-priority to-be-enhanced sub-band may be first determined from the target
   sub-band set, and then it is determined whether the total quantity of surplus bits is
   greater than a threshold a; if the total quantity of surplus bits is greater than the
15 threshold a, it may be determined that the second-priority to-be-enhanced sub-band
   belongs to the sub-bands for secondary bit allocation; or if the total quantity of surplus
   bits is not greater than the threshold a, the second-priority to-be-enhanced sub-band
   does not belong to the sub-bands for secondary bit allocation. Optionally, the
   top-priority    to-be-enhanced sub-band       and the second-priority     to-be-enhanced
20 sub-band are successive in a frequency domain, and specifically, a sub-band with a
   smaller average quantity of primary bits per unit bandwidth, a sub-band with a smaller
   quantity of primary bits per information unit, or a sub-band with a smaller quantity of
   primarily allocated bits, of two sub-bands adjacent to the top-priority to-be-enhanced
   sub-band may be determined as the second-priority to-be-enhanced sub-band.
25 [0124]       Optionally, the threshold a may be determined according to bandwidth of
   the top-priority     to-be-enhanced     sub-band   and/or bandwidth     occupied by a
   to-be-encoded or to-be-decoded signal. Optionally, the threshold a is in a positive
   correlation with bandwidth of the top-priority to-be-enhanced sub-band and/or
   bandwidth occupied by a to-be-encoded or to-be-decoded signal. For example, when
30 bandwidth of the to-be-encoded signal is 4 kHz, the threshold may be set to 8, or
   when bandwidth of the to-be-encoded signal is 8 kHz, the threshold a may be set to
   12.
   [0125]       Certainly, the top-priority to-be-enhanced sub-band and the second-priority
   to-be-enhanced sub-band in this embodiment of the present invention may not
                                                 32

   necessarily be sub-bands that are successive in a frequency domain. For example, two
   sub-bands with smaller average quantities of bits per unit bandwidth in the target
   sub-band set are determined as the top-priority to-be-enhanced sub-band and the
   second-priority to-be-enhanced sub-band according to average quantities of bits per
 5 unit bandwidth of all sub-bands, where the average quantities of the bits per unit
   bandwidth of all the sub-bands are obtained from the primary information unit
   quantity determining operation; or two sub-bands with smaller quantities of bits per
   information unit in the target sub-band set are determined as the top-priority
   to-be-enhanced sub-band and the second-priority to-be-enhanced sub-band according
10 to quantities of primary bits per information unit of all sub-bands; or two sub-bands
   with quantities of primarily allocated bits in the target sub-band set are determined as
   the top-priority to-be-enhanced sub-band and the second-priority to-be-enhanced
   sub-band according to quantities of primarily allocated bits of all sub-bands.
   [0126]      It should be understood that, in this embodiment of the present invention,
15 the target sub-band set may alternatively not be determined, and the sub-bands for
   secondary bit allocation are selected directly from the to-be-processed sub-bands,
   where a quantity of the sub-bands for secondary bit allocation that need to be selected
   may be determined according to the total quantity of surplus bits. For example, h
   sub-bands with the smallest quantities of primarily allocated bits are determined as the
20 sub-bands for secondary bit allocation (inclusive of h sub-bands). In the present
   invention, all sub-bands with a characteristic may also be determined as the sub-bands
   for secondary bit allocation. For example, sub-bands of the current frame whose
   corresponding previous-frame sub-bands are coefficient-quantized are determined as
   the sub-bands for secondary bit allocation, and so on.
25 [0127]      The foregoing describes how the sub-bands for secondary bit allocation are
   determined. After the sub-bands for secondary bit allocation are determined, the
   surplus bits may be allocated to the sub-bands for secondary bit allocation. The
   following specifically describes how the surplus bits are allocated to the sub-bands for
   secondary bit allocation.
30 [0128]      In this embodiment of the present invention, when a quantity of sub-bands
   included in the sub-bands for secondary bit allocation is 1, all the surplus bits may be
   directly allocated to the one sub-band for secondary bit allocation.
   [0129]      In this embodiment of the present invention, when the sub-bands for
   secondary bit allocation include at least two sub-bands, the secondary bit allocation
                                               33

   may be performed for each sub-band of the sub-bands for secondary bit allocation
   according to a quantity of primary bits per information unit, an average quantity of
   bits per unit bandwidth in the primary bit allocation, or the quantity of primarily
   allocated bits, of each sub-band of the sub-bands for secondary bit allocation.
 5 Specifically, the surplus bits may be allocated to the sub-bands for secondary bit
   allocation according to proportions. Specifically, there may be the following manners
   for determining an allocation proportion. In the following manners, it is assumed that
   there are a total of N sub-bands ki, k2, ..., and kN, and an allocation proportion A for
   a sub-band k, may be determined in the following manners:
                                                 aver_bit[k,]
10             (1)        aver _bit[k ] + aver _bit[k2 ] +...+ aver _bit[kN]
               where aver _ bit[k,] indicates an average quantity of primary bits per
   unit bandwidth of the sub-band k,, that is,
                aver _bit[k,] =      Rk [k,]
                                 bandwidth~k], where Rk1 k,] indicates a quantity
   of primarily allocated bits of the sub-band k,, and bandwidth[k,] indicates
15 bandwidth of the sub-band k,.
                                                   Rk pulse[k,]
               (2)        Rk    pulse(k,] + Rk _ pulse        2] +... + Rk _ pulse[kN
               where R _ pulse[k,]        indicates     a quantity     of primary bits per
                                                            Rk~plse~,] =Rk,    [k, ]
                                                                          Rpusk[k=
   information unit of the sub-band k,, that is,                enpuse[k,]            where
    Rk I[k,] indicates a quantity of primarily allocated bits of the sub-band k,, and
20  npluse[k ] indicates a quantity of primary information units of the sub-band k,.
                                        Rk[k]
               (3)        Rk [k,] + Rk [k2] +...+Rk [kN]
               where Rk [k,] indicates a quantity of primarily allocated bits of the
   sub-band k,.
   [0130]      After the surplus bit allocation proportion for each sub-band of the
                                                  34

   sub-bands for secondary bit allocation is determined, the surplus bits may be allocated
   to each sub-band of the sub-bands for secondary bit allocation according to the
   proportion. Specifically, a quantity of secondarily allocated bits of the sub-band k is
    Rk 2 [k,]=     * bit _surplus, where bit surplus is the total quantity of surplus
 5 bits.
   [0131]      It should be understood that the above mentioned allocation proportion
   determining method is merely a specific embodiment of the present invention and
   shall not be construed as a limitation on the protection scope of the present invention.
   The above mentioned allocation proportion             determining manner may have
10 correspondingly transformations. For example, when the sub-bands for secondary bit
   allocation include two sub-bands, when an allocation proportion            #     for one
   sub-band among the sub-bands for secondary bit allocation is determined in any one
   of the foregoing three manners, a bit allocation proportion for the other sub-band may
   be determined as 1-#8 . All these simple mathematical transformations should fall
15 within the protection scope of the present invention.
   [0132]      It should be further understood that, although it is assumed that there are a
   total of N sub-bands ki, k2, ..., and kN, the purpose is merely to make the description
   applicable to general cases, and N is not limited to being greater than or equal to 3
   herein. In a case in which N is 2, the foregoing several secondary bit allocation
20 proportions are also applicable.
   [0133]      Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands of a current frame
   according to a total quantity of to-be-allocated bits, so as to obtain a quantity of
   primarily allocated bits of each sub-band; a primary information unit quantity
25 determining operation is performed for a sub-band that has undergone the primary bit
   allocation, so as to obtain a quantity of information units corresponding to each
   sub-band of the to-be-processed sub-bands and a total quantity of surplus bits; then,
   sub-bands for secondary bit allocation are determined according to at least one of a
   sub-band characteristic of each sub-band of the to-be-processed sub-bands or the total
30 quantity of surplus bits, and the surplus bits are allocated to the sub-bands for
   secondary bit allocation to obtain a quantity of secondarily allocated bits of each
   sub-band of the sub-bands for secondary bit allocation; a secondary information unit
   quantity determining operation is performed for each sub-band of the sub-bands for
                                                35

   secondary bit allocation according to the quantity of primarily allocated bits and the
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation, so as to re-obtain a quantity of information units corresponding to each
   sub-band of the sub-bands for secondary bit allocation. The surplus bits left in
 5 encoded sub-bands are not evenly allocated to remaining unencoded sub-bands, and
   therefore, available bits can be more properly and fully used and encoding and
   decoding quality is apparently improved.
   [0134]       For clearer understanding of the present invention, the following describes
   the present invention in detail with reference to FIG. 2 to FIG. 9.
10 [0135]       FIG. 2 is a schematic flowchart of a signal processing method 200
   according to an embodiment of the present invention. As shown in FIG. 2, the method
   200 includes:
   [0136]       S201. Determine to-be-processed sub-bands of a current frame and a total
   quantity of to-be-allocated bits corresponding to the to-be-processed sub-bands.
15 [0137]       S202. Implement primary bit allocation on each sub-band according to the
   total quantity of to-be-allocated bits and an envelope value of each sub-band of the
   to-be-processed sub-bands,       so as to allocate     the to-be-allocated bits to the
   to-be-processed sub-bands and obtain a quantity of primarily allocated bits of each
   sub-band.
20 [0138]       S203. Perform a primary information unit quantity determining operation
   for the to-be-processed sub-bands that has undergone the primary bit allocation, so as
   to obtain a quantity of information units corresponding to each sub-band and a total
   quantity of surplus bits of the current frame.
   [0139]       S204. Determine whether a sub-band in the m first sub-band sets meets a
25 corresponding predetermined condition of m predetermined conditions, where a
   sub-band of any one of the first sub-band sets belongs to the to-be-processed
   sub-bands. The following provides detailed description with reference to multiple
   examples.
   [0140]       Example 1: m is 1, the predetermined condition is that a sub-band carrying
30 a signal of a harmonic type exists in first M high-frequency sub-bands, and a first
   sub-band set is the first M high-frequency sub-bands. Then, whether a sub-band
   carrying a signal of a harmonic type exists in the first M high-frequency sub-bands is
   determined.
   [0141]       Example     2:  m    is  1, the    predetermined     condition  is  that  a
                                                36

   coefficient-quantized sub-band exists in corresponding previous-frame sub-bands of
   first L high-frequency sub-bands, and a first sub-band set is the first L high-frequency
   sub-bands. Then, whether a coefficient-quantized sub-band exists in previous-frame
   sub-bands corresponding to the first L high-frequency sub-bands is determined.
 5 [0142]      Example 3: m is 1, and the predetermined condition is that an average
   envelope value of first J high-frequency sub-bands is greater than a threshold, where
   the average envelope value
                                       ave
                                         ver _Ep of the first J high-frequency sub-bands and
   the corresponding threshold 0 may be calculated as follows:
                                   BANDS-1
                                     I       Ep[i]
                aver _Ep      =  i=BANDS-J
                                                    , where Ep[i] indicates an envelope value
10 of a sub-band i, and BANDS is a quantity of sub-bands; and
                        BANDS -J -1
                    1~      I   Ep[i]
                    3 BANDS- J , where Ep[i] indicates an envelope value of a
   sub-band i, and BANDS is a quantity of sub-bands.
   [0143]      In this case, whether the average envelope value aver_ Ep of the first J
   high-frequency sub-bands is greater than the threshold 0 needs to be determined.
15 [0144]      Example 4: m is 2, a first sub-band set is first L high-frequency sub-bands,
   and a corresponding predetermined condition is that a coefficient-quantized sub-band
   exists in corresponding previous-frame sub-bands of the first L high-frequency
   sub-bands; another first sub-band set is the first J high-frequency sub-bands, and a
   corresponding predetermined condition is that an average envelope value of the first J
20 high-frequency     sub-bands         is  greater    than a threshold.   Then,  whether   a
   coefficient-quantized sub-band exists in the corresponding previous-frame sub-bands
   of the first L high-frequency sub-bands needs to be determined, and whether the
   average envelope value of the first J high-frequency sub-bands is greater than the
   threshold needs to be determined.
25 [0145]      Example 5: m is 2, a first sub-band set is first L high-frequency sub-bands,
   and a corresponding predetermined condition is that a coefficient-quantized sub-band
   exists in corresponding previous-frame sub-bands of the first L high-frequency
   sub-bands; another first sub-band set is first M high-frequency sub-bands, and a
   corresponding predetermined condition is that a sub-band carrying a signal of a
                                                     37

   harmonic type exists in the first M high-frequency sub-bands. Then, whether a
   coefficient-quantized sub-band exists in the corresponding previous-frame sub-bands
   of the first L high-frequency sub-bands needs to be determined, and whether a
   sub-band carrying a signal of a harmonic type exists in the first M high-frequency
 5 sub-bands needs to be determined.
   [0146]       Example 6: m is 2, a first sub-band set is first J high-frequency sub-bands,
   and a corresponding predetermined condition is that an average envelope value of the
   first J high-frequency sub-bands is greater than a threshold; another first sub-band set
   is first M high-frequency sub-bands, and a corresponding predetermined condition is
10 that a sub-band carrying a signal of a harmonic type exists in the first M
   high-frequency sub-bands. Then, whether the average envelope value of the first J
   high-frequency sub-bands is greater than the threshold needs to be determined, and
   whether a sub-band carrying a signal of a harmonic type exists in the first M
   high-frequency sub-bands needs to be determined.
15 [0147]       Example 7: m is 3, a first sub-band set is first J high-frequency sub-bands,
   and a corresponding predetermined condition is that an average envelope value of the
   first J high-frequency sub-bands is greater than a threshold; another first sub-band set
   is first M high-frequency sub-bands, and a corresponding predetermined condition is
   that a sub-band carrying a signal of a harmonic type exists in the first M
20 high-frequency sub-bands; and another first sub-band set is first L high-frequency
   sub-bands,      and     a   corresponding     predetermined      condition   is  that   a
   coefficient-quantized sub-band exists in corresponding previous-frame sub-bands of
   the first L high-frequency sub-bands. Then, whether the average envelope value of the
   first J high-frequency sub-bands is greater than the threshold needs to be determined,
25 whether a sub-band carrying a signal of a harmonic type exists in the first M
   high-frequency       sub-bands     needs   to    be    determined,      and   whether   a
   coefficient-quantized sub-band exists in the corresponding previous-frame sub-bands
   of the first L high-frequency sub-bands needs to be determined.
   [0148]       For how a target sub-band set is selected, the following two manners are
30 available:
   [0149]       In a first manner, when all sub-band sets of the m first sub-band sets meet
   the corresponding predetermined conditions, a set formed by sub-bands that belong to
   all the m first sub-band sets is determined as the target sub-band set (that is, S205a is
   performed), or when a sub-band set of the m first sub-band sets does not meet a
                                                38

   corresponding predetermined condition, a set formed by sub-bands other than
   sub-bands that belong to all the m first sub-band sets is determined as the target
   sub-band set (that is, S206a is performed). For example, in example 1, if a sub-band
   carrying a signal of a harmonic type exists in the first M high-frequency sub-bands, a
 5 set formed by the first M high-frequency sub-bands may be determined as the target
   sub-band set; or if no sub-band carrying a signal of a harmonic type exists in the first
   M high-frequency sub-bands, a set formed by sub-bands other than the first M
   high-frequency sub-bands is determined as the target sub-band set. For example, in
   example 4, when a coefficient-quantized sub-band exists in the corresponding
10 previous-frame sub-bands of the first L high-frequency sub-bands, and the average
   envelope value of the first J high-frequency sub-bands is greater than the threshold, an
   intersection of the first L high-frequency sub-bands and the first J high-frequency
   sub-bands     may be     determined    as the target sub-band       set;  or when no
   coefficient-quantized sub-band exists in the corresponding previous-frame sub-bands
15 of the first L high-frequency sub-bands, or the average envelope value of the first J
   high-frequency sub-bands is not greater than the threshold, sub-bands outside the
   intersection are determined as the target sub-band set. For another example, in
   example 7, when the average envelope value of the first J high-frequency sub-bands is
   greater   than    the threshold,   a coefficient-quantized   sub-band    exists in the
20 corresponding previous-frame sub-bands of the first L high-frequency sub-bands, and
   a sub-band carrying a signal of a harmonic type exists in the first M high-frequency
   sub-bands, an intersection of the first J high-frequency sub-bands, the first M
   high-frequency sub-bands, and the first L high-frequency sub-bands may be
   determined as the target sub-band set; or when the average envelope value of the first
25 J high-frequency sub-bands is not greater than the threshold, no coefficient-quantized
   sub-band exists in the corresponding previous-frame sub-bands of the first L
   high-frequency sub-bands, or no sub-band carrying a signal of a harmonic type exists
   in the first M high-frequency sub-bands, sub-bands of the to-be-processed sub-bands
   outside the intersection are determined as the target sub-band set.
30 [0150]       In a second manner, when at least one sub-band set of the m first sub-band
   sets meets a corresponding predetermined condition, a set formed by all sub-bands in
   the at least one sub-band set is determined as the target sub-band set (that is, S205b is
   performed), or when no sub-band set of the m first sub-band sets meets a
   corresponding predetermined       condition, a set formed by sub-bands of the
                                               39

   to-be-processed sub-bands that do not belong to any first sub-band set of the m first
   sub-band sets is determined as the target sub-band set (that is, S206b is performed).
   For example, in example 1, if a sub-band carrying a signal of a harmonic type exists
   in the first M high-frequency sub-bands, a set formed by the first M high-frequency
 5 sub-bands may be determined as the target sub-band set; or if no sub-band carrying a
   signal of a harmonic type exists in the first M high-frequency sub-bands, a set formed
   by sub-bands other than the first M high-frequency sub-bands is determined as the
   target sub-band set. For example, in example 4, when a coefficient-quantized
   sub-band exists in the corresponding previous-frame sub-bands of the first L
10 high-frequency     sub-bands,  and the average       envelope value    of the first J
   high-frequency sub-bands is greater than the threshold, a set formed by first S
   (S=max(J, L)) sub-bands may be determined as the target sub-band set; or when no
   coefficient-quantized sub-band exists in the corresponding previous-frame sub-bands
   of the first L high-frequency sub-bands, or the average envelope value of the first J
15 high-frequency sub-bands is not greater than the threshold, a set formed by sub-bands
   other than the first S sub-bands is determined as the target sub-band set. For another
   example, in example 7, when the average envelope value of the first J high-frequency
   sub-bands is greater than the threshold, a coefficient-quantized sub-band exists in the
   corresponding previous-frame sub-bands of the first L high-frequency sub-bands, and
20 a sub-band carrying a signal of a harmonic type exists in the first M high-frequency
   sub-bands, a set formed by first S (S=max(J, L, M)) sub-bands may be determined as
   the target sub-band set; or when the average envelope value of the first J
   high-frequency sub-bands is not greater than the threshold, no coefficient-quantized
   sub-band exists in the corresponding previous-frame sub-bands of the first L
25 high-frequency sub-bands, or no sub-band carrying a signal of a harmonic type exists
   in the first M high-frequency sub-bands, a set formed by sub-bands other than the first
   S sub-bands is determined as the target sub-band set. For another example, in example
   7, when the average envelope value of the first J high-frequency sub-bands is not
   greater    than  the threshold,   a coefficient-quantized     sub-band  exists in the
30 corresponding previous-frame sub-bands of the first L high-frequency sub-bands, and
   a sub-band carrying a signal of a harmonic type exists in the first M high-frequency
   sub-bands, a set formed by first S (S=max(L, M)) sub-bands may be determined as the
   target sub-band set; or when the average envelope value of the first J high-frequency
   sub-bands is greater than the threshold, no coefficient-quantized sub-band exists in the
                                               40

   corresponding previous-frame sub-bands of the first L high-frequency sub-bands, or
   no sub-band carrying a signal of a harmonic type exists in the first M high-frequency
   sub-bands, a set formed by sub-bands other than the first S sub-bands is determined as
   the target sub-band set.
 5 [0151]       S205a. Determine, as a target sub-band set, a set formed by sub-bands that
   belong to all the m first sub-band sets.
   [0152]       S206a. Determine, as a target sub-band set, a set formed by sub-bands of
   the to-be-processed sub-bands other than sub-bands that belong to all the m first
   sub-band sets.
10 [0153]       S205b. Determine, as a target sub-band set, a set formed by all sub-bands
   of at least one sub-band set that meets a corresponding predetermined condition.
   [0154]       S206b. Determine, as a target sub-band set, a set formed by sub-bands of
   the to-be-processed sub-bands that do not belong to any sub-band set of the m first
   sub-band sets.
15 [0155]       S207. Determine a top-priority to-be-enhanced sub-band k from the target
   sub-band set.
   [0156]       Specifically, a sub-band with a smallest average quantity of primary bits
   per unit bandwidth, a sub-band with a smallest quantity of bits per information unit, or
   a sub-band with a smallest quantity of primarily allocated bits in the target sub-band
20 set may be determined as the top-priority to-be-enhanced sub-band k, where the
   smallest quantity of bits per information unit and the smallest quantity of primarily
   allocated bits are obtained from the primary information unit quantity determining
   operation.
   [0157]       S208. Determine a quantity N of sub-bands for secondary bit allocation
25 and the sub-bands for secondary bit allocation. The quantity N of the sub-bands for
   secondary bit allocation and the sub-bands for secondary bit allocation may be
   determined in the following manners:
   [0158]       Manner 1:
   [0159]       Step 1: Determine a threshold alpha according to bandwidth of the
30 top-priority to-be-enhanced sub-band, where the bandwidth of the top-priority
   to-be-enhanced sub-band may be in a positive correlation with the threshold alpha.
   [0160]       Step 2: Determine whether the total quantity of the surplus bits
   (bit surplus) is greater than the threshold alpha (a shown in FIG. 3); if the total
   quantity of surplus bits is greater than the threshold alpha, determine the quantity N
                                               41

   of the sub-bands for secondary bit allocation as 2; or if the total quantity of surplus
   bits is less than the threshold alpha, determine the quantity N of the sub-bands for
   secondary bit allocation as 1, for example, as shown in FIG. 3.
   [0161]      Step 3: If N is equal to 1, determine that the sub-bands for secondary bit
 5 allocation include only the foregoing top-priority to-be-enhanced sub-band k. If N is
   equal to 2, it is required to further determine another sub-band included in the
   sub-bands for secondary bit allocation in addition to the top-priority to-be-enhanced
   sub-band k. To maintain continuity of a spectrum, one sub-band of two sub-bands k+ 1
   and k-1 adjacent to the top-priority to-be-enhanced sub-band k may be determined as
10 a second-priority to-be-enhanced sub-band ki (for example, as shown in FIG. 4), that
   is, the another sub-band included in the sub-bands for secondary bit allocation.
   Specifically, a sub-band with a smaller quantity of primarily allocated bits, a sub-band
   with a smaller average quantity of bits per unit bandwidth, or a sub-band with a
   smaller quantity of primary bits per information unit, of the two sub-bands k+ 1 and
15 k-1 adjacent to the top-priority to-be-enhanced sub-band k may be determined as the
   second-priority to-be-enhanced sub-band ki, that is, the another sub-band included in
   the sub-bands for secondary bit allocation.
   [0162]      Manner 2:
   [0163]      Step 1: Determine a second-priority to-be-enhanced sub-band k1 . One
20 sub-band of two sub-bands k+ 1 and k-1 adjacent to the top-priority to-be-enhanced
   sub-band k may be determined as the second-priority to-be-enhanced sub-band k, (for
   example, as shown in FIG. 4). Specifically, a sub-band with a smaller quantity of
   primarily allocated bits, a sub-band with a smaller average quantity of primary bits
   per unit bandwidth, or a sub-band with a smaller quantity of bits per information unit,
25 of the two sub-bands adjacent to the top-priority to-be-enhanced sub-band may be
   determined as the second-priority to-be-enhanced sub-band k1 , where the smaller
   quantity of bits per information unit is obtained from the primary information unit
   quantity determining operation.
   [0164]      Step 2: Determine a threshold alpha according to bandwidth of the
30 top-priority to-be-enhanced sub-band k, where the bandwidth of the top-priority
   to-be-enhanced sub-band may be in a positive correlation with the threshold alpha.
   [0165]      Step 3: Determine whether the total quantity of surplus bits bit surplus is
   greater than the threshold alpha; if the total quantity of surplus bits bit surplus is
   greater than the threshold alpha, determine the quantity N of the sub-bands for
                                               42

   secondary bit allocation as 2; or if the total quantity of surplus bits bit surplus is less
   than the threshold alpha, determine the quantity N of the sub-bands for secondary bit
   allocation as 1, for example, as shown in FIG. 3.
   [0166]       Step 4: If N is equal to 1, determine that the sub-bands for secondary bit
 5 allocation include only the foregoing top-priority to-be-enhanced sub-band k; or if N
   is equal to 2, the sub-bands for secondary bit allocation further include the
   second-priority to-be-enhanced sub-band k, determined in step 1 in addition to the
   top-priority to-be-enhanced sub-band k.
   [0167]       Manner 3:
10 [0168]       Step 1: Assume that there are n-I thresholds (alphanj, alphan_2,       ... , and
   alpha,) sorted in ascending order. Whether the total quantity (bit surplus) of the
   surplus bits is greater than the threshold alphan-, may be first determined. If the total
   quantity (bit surplus) of the surplus bits is greater than the threshold alphan-,
   determine that the quantity of sub-bands for secondary bit allocation is N=n; or if the
15 total quantity (bit surplus) of the surplus bits is not greater than the threshold alpha,-,
   determine whether bit surplus is greater than the threshold alphan_2, and if bitsurplus
   is greater than the threshold alphan_2, determine that N=n-1, and so on, for example, as
   shown in FIG. 5, where an indicates alpha,, a,-, indicates alpha,-,, and ai indicates
   alpha.
20 [0169]       Step 2: When N=1, determine that the sub-bands for secondary bit
   allocation include only the foregoing top-priority to-be-enhanced sub-band k; or when
   N>1, the sub-bands for secondary bit allocation further include another sub-band in
   addition to the top-priority to-be-enhanced sub-band k. To maintain continuity of a
   spectrum, if N=2, a sub-band with a smaller quantity of primarily allocated bits, a
25 sub-band with a smaller average quantity of primary bits per unit bandwidth, or a
   sub-band with a smaller quantity of bits per information unit in previous-frame
   sub-bands k+2 and k-2 adjacent to sub-bands k+ 1 and k-I may be determined as one
   sub-band for secondary bit allocation, where the smaller quantity of bits per
   information unit is obtained from the primary information unit quantity determining
30 operation; if N=3, sub-bands k+ 1 and k-1 may be determined as the sub-bands for
   secondary bit allocation; if N=4, sub-bands k+ 1 and k-I may be determined as the
   sub-bands for secondary bit allocation, and a sub-band is selected from sub-bands k+2
   and k-2; or if N is greater than 4, another second-priority to-be-enhanced sub-band
   may be selected in a manner similar to the foregoing manner, for example, as shown
                                                43

   in FIG. 6, second-priority to-be-enhanced sub-bands ki, K2 , k3 , k 4, ..., and kn_1 are
   determined.
   [0170]      It should be understood that the foregoing manner 3 may also have another
   transformation, which should also fall within the protection scope of the present
 5 invention. For example, whether the total quantity of surplus bits bit surplus is
   greater than the threshold alphan2 may be first determined; if the total quantity of
   surplus bits bit-surplus is greater than the threshold alpha/ 2, determine whether the
   total quantity of surplus bits bit surplus is less than alpha/ 2)+j; and if the total
   quantity of surplus bits bitsurplus is less than alphan/2)+1, determine whether the
10 total quantity of surplus bits bit surplus is greater than alphan/2)_j, and so on.
   [0171]      S209. Allocate the surplus bits to the sub-bands for secondary bit
   allocation, so as to obtain a quantity of secondarily allocated bits of each sub-band of
   the sub-bands for secondary bit allocation. After the sub-bands for secondary bit
   allocation are determined, the surplus bits may be allocated to sub-bands included in
15 the sub-bands for secondary bit allocation.
   [0172]      Specifically, when N=1, that is, the sub-bands for secondary bit allocation
   include only the top-priority to-be-enhanced sub-band, the surplus bits may all be
   allocated to the top-priority to-be-enhanced sub-band.
   [0173]      When N>1, the surplus bits may be allocated according to allocation
20 proportions to sub-bands included in the sub-bands for secondary bit allocation, where
   a surplus bit allocation proportion for each sub-band may be determined according to
   a quantity of primary bits per information unit, an average quantity of primary bits per
   unit bandwidth, or a quantity of primarily allocated bits of the sub-band. For a specific
   determining method, reference may be made to the foregoing description.
25 [0174]      S210. Perform, according to the quantity of primarily allocated bits and the
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation, a secondary information unit quantity determining operation for each
   sub-band of the sub-bands for secondary bit allocation.
   [0175]      Specifically, as shown in FIG. 7, bits Rki obtained in primary allocation
30 and bits Rk 2 obtained in secondary allocation are integrated into Rkani, and then the
   secondary information unit quantity determining operation is performed for the
   sub-bands for secondary bit allocation by using Rkani.
   [0176]      Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands according to a total
                                                44

   quantity of to-be-allocated bits, so as to obtain a quantity of primarily allocated bits; a
   primary information unit quantity determining operation is performed for a sub-band
   that has undergone the primary bit allocation, so as to obtain a quantity of information
   units corresponding to each sub-band of the to-be-processed sub-bands and a total
 5 quantity of surplus bits; then, sub-bands for secondary bit allocation are determined
   according to at least one of a sub-band characteristic of each sub-band of the
   to-be-processed sub-bands or the total quantity of surplus bits, and the surplus bits are
   allocated to the sub-bands for secondary bit allocation to obtain a quantity of
   secondarily allocated bits of each sub-band of the sub-bands for secondary bit
10 allocation; a secondary information unit quantity determining operation is performed
   for each sub-band of the sub-bands for secondary bit allocation according to the
   quantity of primarily allocated bits and the quantity of secondarily allocated bits of
   each sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a
   quantity of information units corresponding to each sub-band of the sub-bands for
15 secondary bit allocation. The surplus bits left in encoded sub-bands are not evenly
   allocated to remaining unencoded sub-bands, and therefore, available bits can be more
   properly and fully used and encoding and decoding quality is apparently improved.
   [0177]       The signal processing methods in the embodiments of the present
   invention may be used on a decoder side and an encoder side.
20 [0178]       When used on an encoder side, the method 100 may further include:
   performing a quantization operation for each sub-band according to the quantity of
   information units corresponding to each sub-band of the to-be-processed sub-bands,
   so as to obtain a quantized spectral coefficient corresponding to each sub-band, where
   the quantity of information units corresponding to each sub-band of the sub-bands for
25 secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
   information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
   writing the quantized spectral coefficient into a bitstream and outputting the bitstream.
30 [0179]       Optionally, in the case of use on the encoder side, when the secondary bit
   allocation parameter includes at least one parameter of a type of a signal carried in at
   least one sub-band of the to-be-processed sub-bands, an envelope value of at least one
   sub-band of the to-be-processed sub-bands, or a coefficient quantization state of a
   corresponding     previous-frame     sub-band   of at     least one   sub-band     of the
                                               45

   to-be-processed sub-bands, the method 100 may further include: writing the at least
   one parameter into the bitstream.
   [0180]       The embodiments of the present invention may also be applied to a
   decoder side. When used on a decoder side, the method 100 may further include:
 5              performing an inverse quantization operation for each sub-band of the
   to-be-processed     sub-bands    according   to  the   quantity of information      units
   corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain an
   inverse quantized spectral coefficient corresponding to each sub-band, where the
   quantity of information units corresponding to each sub-band of the sub-bands for
10 secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
   information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
   acquiring an output signal according to the inverse quantized spectral coefficient.
15 [0181]       Optionally, in the case of use on the decoder side, when the secondary bit
   allocation parameter includes at least one parameter of a type of a signal carried in at
   least one sub-band of the to-be-processed sub-bands, an envelope value of at least one
   sub-band of the to-be-processed sub-bands, or a coefficient quantization state of a
   corresponding     previous-frame     sub-band   of at    least one    sub-band   of the
20 to-be-processed sub-bands, the method 100 may further include: acquiring the at least
   one parameter from a to-be-decoded bitstream.
   [0182]       For clearer understanding of the present invention, the following describes
   the signal processing method in the embodiments of the present invention with
   reference to FIG. 8 and FIG. 9, where FIG. 8 shows an encoding method, and FIG. 9
25 shows a decoding method.
   [0183]       FIG. 8 is a schematic diagram of an encoding method according to an
   embodiment of the present invention. As shown in FIG. 8, the method 300 may
   include:
   [0184]       S301. After acquiring an input signal (for example, an audio signal), an
30 encoder side may perform a time-frequency transform on the input signal to obtain a
   frequency-domain signal, where sub-bands occupied by the frequency-domain signal
   are referred to as to-be-encoded sub-bands below.
   [0185]       S302. Determine a sub-band type of each sub-band of the to-be-encoded
   sub-bands, where the sub-band type of each sub-band may be a type of a signal
                                               46

   carried in each sub-band, for example, the type of the signal may be harmonic or
   non-harmonic.
   [0186]      S303. Calculate and quantize a frequency-domain envelope according to
   the sub-band type of each sub-band that is determined in S302, so as to obtain an
 5 envelope value of each sub-band.
   [0187]      S304. Implement primary bit allocation on each sub-band according to the
   envelope value of each sub-band that is obtained in S303 and a total quantity of
   to-be-allocated bits, so as to obtain a quantity of primarily allocated bits of each
   sub-band.
10 [0188]      S305. Perform a primary information unit quantity determining operation
   for each sub-band that has undergone the primary bit allocation, so that a quantity of
   information units corresponding to each sub-band and a total quantity of surplus bits
   may be obtained.
   [0189]      S306.   Determine    sub-bands for secondary bit allocation         from the
15 to-be-encoded sub-bands of a current frame according to at least one of the sub-band
   type of each sub-band of the current frame that is determined in S302, the envelope
   value of each sub-band of the current frame that is determined in S303, the quantity of
   primarily allocated bits of each sub-band of the current frame that is determined in
   S304, or the total quantity of surplus bits that is determined in S305. Optionally,
20 sub-bands for secondary bit allocation may also be determined according to a bit
   allocation state of a corresponding previous-frame sub-band of each sub-band.
   [0190]      S307. Allocate the surplus bits to the sub-bands for secondary bit
   allocation according to the sub-bands for secondary bit allocation determined in S306
   and the total quantity of surplus bits that is determined in S305. For specific allocation,
25 secondary bit allocation may be performed according to the quantity of primarily
   allocated bits of each sub-band that has undergone the primary bit allocation in S304,
   and/or the quantity of primary bits per information unit (and/or an average quantity of
   bits per unit bandwidth).
   [0191]      S308. Perform, according to the quantity of primarily allocated bits that is
30 obtained when the primary bit allocation (S304) is performed for the sub-bands for
   secondary bit allocation and a quantity of secondarily allocated bits that is obtained
   when the secondary bit allocation (S307) is performed, a secondary information unit
   quantity determining operation for each sub-band of the sub-bands for secondary bit
   allocation, so as to re-obtain a quantity of information units corresponding to each
                                                 47

   sub-band of the sub-bands for secondary bit allocation.
   [0192]      S309.    Perform,   according   to   the   quantity   of information     units
   corresponding to each sub-band of the to-be-encoded sub-bands, a quantization
   operation for a sub-band that carries the frequency-domain signal obtained from the
 5 time-frequency transform in S301, so as to obtain a quantized spectral coefficient
   corresponding     to each   sub-band, where the         quantity of information units
   corresponding to each sub-band of the sub-bands for secondary bit allocation of the
   current frame is the quantity of information units that is obtained from the secondary
   information unit quantity determining operation, and a quantity of information units
10 corresponding to another sub-band of the current frame is a quantity of information
   units that is obtained from the primary information unit quantity determining
   operation.
   [0193]      S3 10. Write the quantized spectral coefficient, the bit allocation state of a
   corresponding previous-frame sub-band of each sub-band, and the sub-band type and
15 the envelope value of each sub-band into a bitstream, and output the bitstream, so that
   a decoder side acquires the bitstream and performs decoding. When the bit allocation
   state of a corresponding previous-frame sub-band of each sub-band is not used for
   determining the sub-bands for secondary bit allocation in S306, the bit allocation state
   of a corresponding previous-frame sub-band of each sub-band may alternatively not
20 be transferred to the decoder side.
   [0194]      FIG. 9 is a schematic flowchart of a decoding method 400 according to an
   embodiment of the present invention. As shown in FIG. 9, the method 400 may
   include:
   [0195]      S401. After acquiring a to-be-decoded bitstream, a decoder side may
25 decode the to-be-decoded bitstream to obtain a quantized spectral coefficient of each
   sub-band of to-be-decoded sub-bands, a bit allocation state of a corresponding
   previous-frame sub-band of each sub-band, and a sub-band type and an envelope
   value of each sub-band.
   [0196]      S402. Implement primary bit allocation on each sub-band according to the
30 envelope value of each sub-band of the to-be-decoded sub-bands that is acquired in
   S401 and a total quantity of to-be-allocated bits, so as to obtain a quantity of primarily
   allocated bits of each sub-band.
   [0197]      S403. Perform a primary information unit quantity determining operation
   for each sub-band that has undergone the primary bit allocation, so that a quantity of
                                              48

   information units corresponding to each sub-band and a total quantity of surplus bits
   may be obtained.
   [0198]      S404. Determine sub-bands for secondary bit allocation from the
   to-be-decoded sub-bands according to at least one of the sub-band type of each
 5 sub-band, the envelope value of each sub-band, or the bit allocation state of a
   corresponding previous-frame sub-band of each sub-band that is acquired in S401, or
   the total quantity of surplus bits that is determined in S403 (a specific parameter that
   is used for determining the sub-bands for secondary bit allocation may be kept
   consistent with that on an encoder side).
10 [0199]      S405. Allocate the surplus bits to the sub-bands for secondary bit
   allocation according to the sub-bands for secondary bit allocation determined in S404
   and the total quantity of surplus bits that is determined in S403, so as to obtain a
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation. For specific allocation, secondary bit allocation may be performed
15 according to the quantity of the primarily allocated bits of each sub-band that has
   undergone the primary bit allocation in S402, and/or a quantity of bits per information
   unit (and/or an average quantity of bits per unit bandwidth) after the primary
   information unit quantity determining operation in S403.
   [0200]      S406. Perform, according to the quantity of primarily allocated bits that is
20 obtained when the primary bit allocation (S402) is performed for the sub-bands for
   secondary bit allocation and the quantity of secondarily allocated bits that is obtained
   when the secondary bit allocation (S405) is performed, a secondary information unit
   quantity determining operation for each sub-band of the sub-bands for secondary bit
   allocation, so as to re-obtain a quantity of information units corresponding to each
25 sub-band of the sub-bands for secondary bit allocation.
   [0201]      S407.   Perform,    according     to the  quantity   of information     units
   corresponding to each sub-band of the to-be-decoded sub-bands, an inverse
   quantization operation for each sub-band obtained after the bitstream is decoded in
   S401, so as to obtain an inverse quantized spectral coefficient corresponding to each
30 sub-band, where the quantity of information units corresponding to each sub-band of
   the sub-bands for secondary bit allocation is the quantity of information units that is
   obtained from the secondary information unit quantity determining operation, and a
   quantity of information units corresponding to another sub-band is a quantity of
   information units that is obtained from the primary information unit quantity
                                                49

   determining operation.
   [0202]      S408. Perform a time-frequency transform on the inverse quantized
   spectral coefficient corresponding to each sub-band, so as to obtain an output signal
   (for example, an audio signal).
 5 [0203]      Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands according to a total
   quantity of to-be-allocated bits, so as to obtain a quantity of primarily allocated bits; a
   primary information unit quantity determining operation is performed for a sub-band
   that has undergone the primary bit allocation, so as to obtain a quantity of information
10 units corresponding to each sub-band of the to-be-processed sub-bands and a total
   quantity of surplus bits; then, sub-bands for secondary bit allocation are determined
   according to at least one of a sub-band characteristic of each sub-band of the
   to-be-processed sub-bands or the total quantity of surplus bits, and the surplus bits are
   allocated to the sub-bands for secondary bit allocation to obtain a quantity of
15 secondarily allocated bits of each sub-band of the sub-bands for secondary bit
   allocation; a secondary information unit quantity determining operation is performed
   for each sub-band of the sub-bands for secondary bit allocation according to the
   quantity of primarily allocated bits and the quantity of secondarily allocated bits of
   each sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a
20 quantity of information units corresponding to each sub-band of the sub-bands for
   secondary bit allocation. The surplus bits left in encoded sub-bands are not evenly
   allocated to remaining unencoded sub-bands, and therefore, available bits can be more
   properly and fully used and encoding and decoding quality is apparently improved.
   [0204]      The foregoing has described the method in the embodiments of the present
25 invention with reference to FIG. 1 to FIG. 9, and the following describes a signal
   processing apparatus in the embodiments of the present invention with reference to
   FIG. 10 to FIG. 13.
   [0205]      FIG. 10 is a schematic block diagram of a signal processing apparatus 500
   according to an embodiment of the present invention. As shown in FIG. 10, the
30 apparatus 500 includes:
               a total bit quantity determining unit 510, configured to determine a total
   quantity of to-be-allocated bits corresponding to to-be-processed sub-bands of a
   current frame;
               a primary bit allocation unit 520, configured to implement primary bit
                                                50

   allocation on the to-be-processed sub-bands according to the total quantity of
   to-be-allocated bits, so as to obtain a quantity of primarily allocated bits of each
   sub-band of the to-be-processed sub-bands;
                a primary information unit quantity determining unit 530, configured to
 5 perform, according to the quantity of primarily allocated bits of each sub-band, a
   primary information unit quantity determining operation for each sub-band that has
   undergone the primary bit allocation, so as to obtain a total quantity of surplus bits of
   the current frame and a quantity of information units corresponding to each sub-band
   of the to-be-processed sub-bands;
10              a sub-band selection unit 540, configured to select sub-bands for
   secondary bit allocation from the to-be-processed sub-bands according to a secondary
   bit allocation parameter, where the secondary bit allocation parameter includes at least
   one of a sub-band characteristic of each sub-band of the to-be-processed sub-bands or
   the total quantity of surplus bits;
15              a secondary bit allocation unit 550, configured to implement secondary bit
   allocation on the sub-bands for secondary bit allocation, so as to allocate the surplus
   bits to the sub-bands for secondary bit allocation and obtain a quantity of secondarily
   allocated bits of each sub-band of the sub-bands for secondary bit allocation; and
                a secondary information unit quantity determining unit 560, configured to
20 perform, according to the quantities of primarily allocated bits and the quantities of
   secondarily allocated bits of the sub-bands for secondary bit allocation, a secondary
   information unit quantity determining operation for each sub-band of the sub-bands
   for secondary bit allocation, so as to re-obtain a quantity of information units
   corresponding to each sub-band of the sub-bands for secondary bit allocation.
25 [0206]       Optionally, the     sub-band characteristic     of each sub-band of the
   to-be-processed sub-bands includes at least one of a characteristic of a signal carried
   in the sub-band, a bit allocation state corresponding to the sub-band, or a frequency
   range of the sub-band.
   [0207]       Optionally, the characteristic of the signal carried in the sub-band includes
30 at least one of a type of the signal carried in the sub-band or an envelope value of the
   sub-band; and/or
                the bit allocation state corresponding to the sub-band includes at least one
   of a coefficient quantization state of a corresponding previous-frame sub-band of the
   sub-band, a quantity of primary bits per information unit of the sub-band, an average
                                                 51

   quantity of primary bits per unit bandwidth of the sub-band, or a quantity of primarily
   allocated bits of the sub-band.
   [0208]       In this embodiment of the present invention, an average quantity of
   primary bits per unit bandwidth of any sub-band is determined according to a quantity
 5 of primarily allocated bits of the any sub-band and bandwidth of the any sub-band,
   and a quantity of primary bits per information unit of the any sub-band is determined
   according to the quantity of primarily allocated bits of the any sub-band and a
   quantity of primary information units of the any sub-band, where the quantity of
   primary information units of the any sub-band is obtained from the primary
10 information unit quantity determining operation is performed for the any sub-band.
   [0209]       Optionally, the type of the signal carried in the sub-band includes
   harmonic and/or non-harmonic.
   [0210]       Optionally, as shown in FIG. 11, the sub-band selection unit 540 includes:
                a determining subunit 542, configured to determine a target sub-band set
15 according to at least one of the sub-band characteristic of each sub-band of the
   to-be-processed sub-bands or the total quantity of surplus bits; and
                a selection subunit 546, configured to select the sub-bands for secondary
   bit allocation from the target sub-band set, where a sub-band in the target sub-band set
   belongs to the to-be-processed sub-bands.
20 [0211]       Optionally, the determining subunit 542 is specifically configured to:
                determine the target sub-band set according to a sub-band characteristic of
   each sub-band in m first sub-band sets and m predetermined conditions in a
   one-to-one correspondence with the m first sub-band sets, where m is an integer
   greater than or equal to 1, and a sub-band in the m first sub-band sets belongs to the
25 to-be-processed sub-bands, where
                when all sub-band sets of the m first sub-band sets meet the corresponding
   predetermined conditions, a set formed by sub-bands that belong to all the m first
   sub-band sets is determined as the target sub-band set, or when a sub-band set of the
   m first sub-band sets does not meet a corresponding predetermined condition, a set
30 formed by sub-bands of the to-be-processed sub-bands other than sub-bands that
   belong to all the m first sub-band sets is determined as the target sub-band set; or
                when at least one sub-band set of the m first sub-band sets meets a
   corresponding predetermined condition, a set formed by all sub-bands in the at least
   one sub-band set is determined as the target sub-band set, or when no sub-band set of
                                                52

   the m first sub-band sets meets a corresponding predetermined condition, a set formed
   by sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set
   of the m first sub-band sets is determined as the target sub-band set.
   [0212]      Optionally, any predetermined        condition of the      m predetermined
 5 conditions includes at least one of the following conditions:
               that    a   coefficient-quantized   sub-band     exists   in   corresponding
   previous-frame sub-bands in a corresponding first sub-band set, that an average
   envelope value of sub-bands in a corresponding first sub-band set is greater than a
   first threshold, or that a sub-band carrying a signal of a harmonic type exists in a
10 corresponding first sub-band set.
   [0213]      Optionally, a frequency of a sub-band in the m first sub-band sets is higher
   than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets.
   [0214]      Optionally, the selection subunit 546 is specifically configured to:
15             select the sub-bands for secondary bit allocation from the target sub-band
   set according to at least one of an average quantity of primary bits per unit bandwidth
   of each sub-band, a quantity of primary bits per information unit of each sub-band, or
   a quantity of primarily allocated bits of each sub-band in the target sub-band set.
   [0215]      Optionally, the selection subunit 546 is specifically configured to:
20             determine a sub-band with a smallest average quantity of primary bits per
   unit bandwidth, a sub-band with a smallest quantity of primary bits per information
   unit, or a sub-band with a smallest quantity of primarily allocated bits in the target
   sub-band set as a top-priority to-be-enhanced sub-band, where the top-priority
   to-be-enhanced sub-band belongs to the sub-bands for secondary bit allocation.
25 [0216]      Optionally, the selection subunit 546 is specifically configured to:
               when the total quantity of surplus bits is greater than a threshold   aN and
   less than  aN+1, determine that N sub-bands for secondary bit allocation need to be
   selected, where    aN  and aN+1 are respectively the Nth threshold and the (N+I)th
   threshold of multiple thresholds sorted in ascending order; and
30             when N is greater than or equal to 2, select N-1 sub-bands for secondary
   bit allocation from sub-bands in the target sub-band set other than the top-priority
   to-be-enhanced sub-band.
   [0217]      Optionally, the selection subunit 546 is specifically configured to:
               determine the N-1 sub-bands for secondary bit allocation based on the
                                                53

   top-priority to-be-enhanced sub-band for allocation, where the N sub-bands for
   secondary bit allocation are successive in a frequency domain.
   [0218]      Optionally, the selection subunit 546 is specifically configured to:
               when the total quantity of surplus bits is greater than a threshold,
 5 determine a second-priority to-be-enhanced sub-band from the target sub-band set,
   where the sub-bands for secondary bit allocation include the second-priority
   to-be-enhanced sub-band and the top-priority to-be-enhanced sub-band.
   [0219]      Optionally, the selection subunit 546 is specifically configured to:
               determine a second-priority to-be-enhanced sub-band from the target
10 sub-band set; and
               when the total quantity of surplus bits is greater than a threshold,
   determine that the second-priority to-be-enhanced sub-band belongs to the sub-bands
   for secondary bit allocation.
   [0220]      Optionally, the selection subunit 546 is specifically configured to:
15             determine a sub-band with a smaller average quantity of primary bits per
   unit bandwidth, a sub-band with a smaller quantity of primary bits per information
   unit, or a sub-band with a smaller quantity of primarily allocated bits, of two
   sub-bands adjacent to the top-priority to-be-enhanced sub-band as the second-priority
   to-be-enhanced sub-band.
20 [0221]      Optionally, the secondary bit allocation unit 550 is specifically configured
   to:
               when a quantity of sub-bands included in the sub-bands for secondary bit
   allocation is greater than or equal to 2, implement secondary bit allocation on the
   sub-bands for secondary bit allocation according to a quantity of primary bits per
25 information unit, an average quantity of primary bits per unit bandwidth, or a quantity
   of primarily allocated bits, of each sub-band of the sub-bands for secondary bit
   allocation.
   [0222]      Optionally, the primary bit allocation unit 520 is specifically configured to:
               implement primary bit allocation on the to-be-processed sub-bands
30 according to the total quantity of to-be-allocated bits and envelope values of
   sub-bands of the to-be-processed sub-bands.
   [0223]      The signaling processing apparatus 500 in this embodiment of the present
   invention may be used to implement the signaling processing methods in the method
   embodiments. For brevity, details are not described herein.
                                               54

   [0224]      Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands according to a total
   quantity of to-be-allocated bits of a current frame, so as to obtain a quantity of
   primarily allocated bits; a primary information unit quantity determining operation is
 5 performed for a sub-band that has undergone the primary bit allocation, so as to obtain
   a quantity of information units corresponding to each sub-band of the to-be-processed
   sub-bands and a total quantity of surplus bits; then, sub-bands for secondary bit
   allocation are determined according to at least one of a sub-band characteristic of each
   sub-band of the to-be-processed sub-bands or the total quantity of surplus bits, and the
10 surplus bits are allocated to the sub-bands for secondary bit allocation to obtain a
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation; a secondary information unit quantity determining operation is
   performed for each sub-band of the sub-bands for secondary bit allocation according
   to the quantity of primarily allocated bits and the quantity of secondarily allocated bits
15 of each sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a
   quantity of information units corresponding to each sub-band of the sub-bands for
   secondary bit allocation. The surplus bits left in encoded sub-bands are not evenly
   allocated to remaining unencoded sub-bands, and therefore, available bits can be more
   properly and fully used and encoding and decoding quality is apparently improved.
20 [0225]      Optionally, the signal processing apparatus in this embodiment of the
   present invention may be an encoder or may be a decoder. The following provides
   detailed description with reference to FIG. 12 and FIG. 13.
   [0226]      FIG. 12 is a schematic block diagram of a signal processing apparatus 600
   according to an embodiment of the present invention. A quantization unit 670 and a
25 transport unit 680 may be further included in addition to a total bit quantity
   determining unit 610, a primary bit allocation unit 620, a primary information unit
   quantity determining unit 630, a sub-band selection unit 640, a secondary bit
   allocation unit 650, and a secondary information unit quantity determining unit 660.
   [0227]      The quantization unit 670 is configured to perform a quantization
30 operation for each sub-band of the to-be-processed sub-bands according to the
   quantity of information units corresponding to each sub-band of the to-be-processed
   sub-bands, so as to obtain a quantized spectral coefficient corresponding to each
   sub-band, where the quantity of information units corresponding to each sub-band of
   the sub-bands for secondary bit allocation is the quantity of information units that is
                                                55

   obtained from the secondary information unit quantity determining operation, and a
   quantity of information units corresponding to another sub-band is a quantity of
   information units that is obtained from the primary information unit quantity
   determining operation.
 5 [0228]      The transport unit 680 is configured to write the quantized spectral
   coefficient into a bitstream and output the bitstream.
   [0229]      Optionally, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
   sub-bands, an envelope value of at least one sub-band of the to-be-processed
10 sub-bands, or a coefficient quantization state of a corresponding previous-frame
   sub-band of at least one sub-band of the to-be-processed sub-bands.
   [0230]      The transport unit 680 is further configured to: write the at least one
   parameter into the bitstream.
   [0231]      It should be understood that the total bit quantity determining unit 610, the
15 primary bit allocation unit 620, the primary information unit quantity determining unit
   630, the sub-band selection unit 640, the secondary bit allocation unit 650, and the
   secondary information unit quantity determining unit 660 of the encoder 600 may be
   respectively equivalent to the total bit quantity determining unit 510, the primary bit
   allocation unit 520, the primary information unit quantity determining unit 530, the
20 sub-band selection unit 540, the secondary bit allocation unit 550, and the secondary
   information unit quantity determining unit 560 of the signal processing apparatus 500.
   For brevity, details are not described herein. It should be further understood that the
   encoder 600 may further implement a corresponding procedure of the encoding
   method 300. For brevity, details are not described herein.
25 [0232]      FIG. 13 is a schematic block diagram of a signal processing apparatus 700
   according to an embodiment of the present invention. An inverse quantization unit
   770 and a first acquiring unit 780 may be further included in addition to a total bit
   quantity determining unit 710, a primary bit allocation unit 720, a primary
   information unit quantity determining unit 730, a sub-band selection unit 740, a
30 secondary bit allocation unit 750, and a secondary information unit quantity
   determining unit 760.
   [0233]      The inverse quantization unit 770 is configured to perform an inverse
   quantization operation for each sub-band of the to-be-processed sub-bands according
   to the quantity of information units corresponding to each sub-band of the
                                               56

   to-be-processed sub-bands, so as to obtain an inverse quantized spectral coefficient
   corresponding     to each    sub-band, where the        quantity of information units
   corresponding to each sub-band of the sub-bands for secondary bit allocation is the
   quantity of information units that is obtained from the secondary information unit
 5 quantity determining operation, and a quantity of information units corresponding to
   another sub-band is a quantity of information units that is obtained from the primary
   information unit quantity determining operation.
   [0234]      The first acquiring unit 780 is configured to acquire an output signal
   according to the inverse quantized spectral coefficient.
10 [0235]      Optionally, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
   sub-bands, an envelope value of at least one sub-band of the to-be-processed
   sub-bands, or a coefficient quantization state of a corresponding previous-frame
   sub-band of at least one sub-band of the to-be-processed sub-bands. The decoder 700
15 further includes:
               a second acquiring unit 790, configured to acquire the at least one
   parameter from a to-be-decoded bitstream.
   [0236]      It should be understood that the total bit quantity determining unit 710, the
   primary bit allocation unit 720, the primary information unit quantity determining unit
20 730, the sub-band selection unit 740, the secondary bit allocation unit 750, and the
   secondary information unit quantity determining unit 760 of the signal processing
   apparatus 700 may be respectively equivalent to the total bit quantity determining unit
   510, the primary bit allocation unit 520, the primary information unit quantity
   determining unit 530, the sub-band selection unit 540, the secondary bit allocation
25 unit 550, and the secondary information unit quantity determining unit 560 of the
   signal processing apparatus 500. For brevity, details are not described herein. It
   should be further understood that the decoder 700 may further implement a
   corresponding procedure of the decoding method 400. For brevity, details are not
   described herein.
30 [0237]      FIG. 14 is a schematic block diagram of a signal processing apparatus 800
   according to an embodiment of the present invention. According to the apparatus 800
   shown in FIG. 14, the apparatus 800 includes a memory 810 and a processor 820. The
   memory 810 is configured to store program code, and the processor 820 is configured
   to call the program code stored in the memory 810 to perform the following
                                               57

   operations:
               determining a total quantity of to-be-allocated bits corresponding to
   to-be-processed sub-bands of a current frame;
               implementing primary bit allocation on the to-be-processed sub-bands
 5 according to the total quantity of to-be-allocated bits, so as to obtain a quantity of
   primarily allocated bits of each sub-band of the to-be-processed sub-bands;
               performing, according to the quantity of primarily allocated bits of each
   sub-band, a primary information unit quantity determining operation for each
   sub-band that has undergone the primary bit allocation, so as to obtain a quantity of
10 information units corresponding to each sub-band of the to-be-processed sub-bands
   and a total quantity of surplus bits of the current frame;
               selecting sub-bands for secondary bit allocation from the to-be-processed
   sub-bands according to a secondary bit allocation parameter, where the secondary bit
   allocation parameter includes at least one of a sub-band characteristic of each
15 sub-band of the to-be-processed sub-bands or the total quantity of surplus bits;
               implementing secondary bit allocation on the sub-bands for secondary bit
   allocation, so as to allocate the surplus bits to the sub-bands for secondary bit
   allocation and obtain a quantity of secondarily allocated bits of each sub-band of the
   sub-bands for secondary bit allocation; and
20             performing, according to the quantities of primarily allocated bits and the
   quantities of secondarily allocated bits of the sub-bands for secondary bit allocation, a
   secondary information unit quantity determining operation for each sub-band of the
   sub-bands for secondary bit allocation, so as to re-obtain a quantity of information
   units corresponding to each sub-band of the sub-bands for secondary bit allocation.
25 [0238]      Optionally,   the   sub-band    characteristic  of each     sub-band  of the
   to-be-processed sub-bands includes at least one of a characteristic of a signal carried
   in the sub-band, a bit allocation state corresponding to the sub-band, or a frequency
   range of the sub-band.
   [0239]      Optionally, the characteristic of the signal carried in the sub-band includes
30 at least one of a type of the signal carried in the sub-band or an envelope value of the
   sub-band; and/or
               the bit allocation state corresponding to the sub-band includes at least one
   of a coefficient quantization state of a corresponding previous-frame sub-band of the
   sub-band, a quantity of primary bits per information unit of the sub-band, an average
                                                58

   quantity of primary bits per unit bandwidth of the sub-band, or a quantity of primarily
   allocated bits of the sub-band.
   [0240]      Optionally, the type of the signal carried in the sub-band includes
   harmonic and/or non-harmonic.
 5 [0241]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operations:
               determining a target sub-band set according to at least one of the sub-band
   characteristic of each sub-band of the to-be-processed sub-bands or the total quantity
   of surplus bits, and selecting the sub-bands for secondary bit allocation from the target
10 sub-band set, where a sub-band in the target sub-band set belongs to the
   to-be-processed sub-bands.
   [0242]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               determining the target sub-band set according to a sub-band characteristic
15 of each sub-band in m first sub-band sets and m predetermined conditions in a
   one-to-one correspondence with the m first sub-band sets, where m is an integer
   greater than or equal to 1, and a sub-band in the m first sub-band sets belongs to the
   to-be-processed sub-bands, where
               when all sub-band sets of the m first sub-band sets meet the corresponding
20 predetermined conditions, a set formed by sub-bands that belong to all the m first
   sub-band sets is determined as the target sub-band set, or when a sub-band set of the
   m first sub-band sets does not meet a corresponding predetermined condition, a set
   formed by sub-bands of the to-be-processed sub-bands other than sub-bands that
   belong to all the m first sub-band sets is determined as the target sub-band set; or
25             when at least one sub-band set of the m first sub-band sets meets a
   corresponding predetermined condition, a set formed by all sub-bands in the at least
   one sub-band set is determined as the target sub-band set, or when no sub-band set of
   the m first sub-band sets meets a corresponding predetermined condition, a set formed
   by sub-bands of the to-be-processed sub-bands that do not belong to any sub-band set
30 of the m first sub-band sets is determined as the target sub-band set.
   [0243]      Optionally,    any predetermined      condition of the     m predetermined
   conditions includes at least one of the following conditions:
               that    a   coefficient-quantized    sub-band    exists   in   corresponding
   previous-frame sub-bands of a corresponding first sub-band set, that an average
                                                59

   envelope value of sub-bands in a corresponding first sub-band set is greater than a
   first threshold, or that a sub-band carrying a signal of a harmonic type exists in a
   corresponding first sub-band set.
   [0244]      Optionally, a frequency of a sub-band in the m first sub-band sets is higher
 5 than a frequency of a sub-band of the to-be-processed sub-bands other than the
   sub-bands in the m first sub-band sets.
   [0245]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               selecting the sub-bands for secondary bit allocation from the target
10 sub-band set according to at least one of an average quantity of primary bits per unit
   bandwidth of each sub-band, a quantity of primary bits per information unit of each
   sub-band, or a quantity of primarily allocated bits of each sub-band in the target
   sub-band set.
   [0246]      In this embodiment of the present invention, an average quantity of
15 primary bits per unit bandwidth of any sub-band is determined according to a quantity
   of primarily allocated bits of the any sub-band and bandwidth of the any sub-band,
   and a quantity of primary bits per information unit of the any sub-band is determined
   according to the quantity of primarily allocated bits of the any sub-band and a
   quantity of primary information units of the any sub-band, where the quantity of
20 primary information units of the any sub-band is obtained from the primary
   information unit quantity determining operation is performed for the any sub-band.
   [0247]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               determining a sub-band with a smallest average quantity of bits per unit
25 bandwidth, a sub-band with a smallest quantity of primary bits per information unit,
   or a sub-band with a smallest quantity of primarily allocated bits, obtained from the
   primary information unit quantity determining operation in the target sub-band set as
   a top-priority to-be-enhanced sub-band, where the top-priority to-be-enhanced
   sub-band belongs to the sub-bands for secondary bit allocation.
30 [0248]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operations:
               when the total quantity of surplus bits is greater than a threshold  aN  and
   less than aN+1, determining that N sub-bands for secondary bit allocation need to be
   selected, where    aN and aN+1 are respectively the    Nth  threshold and the (N+1)th
                                              60

   threshold of multiple thresholds sorted in ascending order; and
               when N is greater than or equal to 2, selecting N-1 sub-bands for
   secondary bit allocation from sub-bands in the target sub-band set other than the
   top-priority to-be-enhanced sub-band.
 5 [0249]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               determining the N-1 sub-bands for secondary bit allocation based on the
   top-priority to-be-enhanced sub-band for allocation, where the N sub-bands for
   secondary bit allocation are successive in a frequency domain.
10 [0250]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               when the total quantity of surplus bits is greater than a threshold,
   determining a second-priority to-be-enhanced sub-band from the target sub-band set,
   where the sub-bands for secondary bit allocation include the second-priority
15 to-be-enhanced sub-band and the top-priority to-be-enhanced sub-band.
   [0251]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operations:
               determining a second-priority to-be-enhanced sub-band from the target
   sub-band set; and
20             when the total quantity of surplus bits is greater than a threshold,
   determining that the second-priority to-be-enhanced sub-band belongs to the
   sub-bands for secondary bit allocation.
   [0252]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
25             determining a sub-band with a smaller average quantity of primary bits per
   unit bandwidth, a sub-band with a smaller quantity of primary bits per information
   unit, or a sub-band with a smaller quantity of primarily allocated bits, of two
   sub-bands adjacent to the top-priority to-be-enhanced sub-band as the second-priority
   to-be-enhanced sub-band.
30 [0253]      Optionally, the processor 820 is configured to call the program code stored
   in the memory 810 to specifically perform the following operation:
               when a quantity of sub-bands included in the sub-bands for secondary bit
   allocation is greater than or equal to 2, implementing secondary bit allocation on the
   sub-bands for secondary bit allocation according to a quantity of primary bits per
                                               61

   information unit, an average quantity of primary bits per unit bandwidth, or a quantity
   of primarily allocated bits, of each sub-band of the sub-bands for secondary bit
   allocation.
   [0254]      Optionally, the processor 820 is configured to call the program code stored
 5 in the memory 810 to specifically perform the following operation:
               implementing primary bit allocation on the to-be-processed sub-bands
   according to the total quantity of to-be-allocated bits and envelope values of
   sub-bands of the to-be-processed sub-bands.
   [0255]      Optionally, the apparatus 800 is an encoder, and the processor 820 is
10 configured to call the program code stored in the memory 810 to further perform the
   following operations:
               performing    a   quantization    operation   for   each  sub-band   of   the
   to-be-processed    sub-bands    according    to   the   quantity   of information   units
   corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain a
15 quantized spectral coefficient corresponding to each sub-band, where the quantity of
   information units corresponding to each sub-band of the sub-bands for secondary bit
   allocation is the quantity of information units that is obtained from the secondary
   information unit quantity determining operation, and a quantity of information units
   corresponding to another sub-band is a quantity of information units that is obtained
20 from the primary information unit quantity determining operation; and
               writing the quantized spectral coefficient into a bitstream and outputting
   the bitstream.
   [0256]      Optionally, the secondary bit allocation parameter includes at least one
   parameter of a type of a signal carried in at least one sub-band of the to-be-processed
25 sub-bands, an envelope value of at least one sub-band of the to-be-processed
   sub-bands, or a coefficient quantization state of a corresponding previous-frame
   sub-band of at least one sub-band of the to-be-processed sub-bands. When the
   apparatus 800 is an encoder, the processor 820 is configured to call the program code
   stored in the memory 810 to further perform the following operation: writing the at
30 least one parameter into the bitstream.
   [0257]      Optionally, the apparatus 800 is a decoder, and the processor 820 is
   configured to call the program code stored in the memory 810 to further perform the
   following operations:
               performing an inverse quantization operation for each sub-band of the
                                               62

   to-be-processed     sub-bands   according    to  the  quantity of information      units
   corresponding to each sub-band of the to-be-processed sub-bands, so as to obtain an
   inverse quantized spectral coefficient corresponding to each sub-band, where the
   quantity of information units corresponding to each sub-band of the sub-bands for
 5 secondary bit allocation is the quantity of information units that is obtained from the
   secondary information unit quantity determining operation, and a quantity of
   information units corresponding to another sub-band is a quantity of information units
   that is obtained from the primary information unit quantity determining operation; and
                acquiring an output signal according to the inverse quantized spectral
10 coefficient.
   [0258]       Optionally, when the apparatus 800 is a decoder, the secondary bit
   allocation parameter includes at least one parameter of a type of a signal carried in at
   least one sub-band of the to-be-processed sub-bands, an envelope value of at least one
   sub-band of the to-be-processed sub-bands, or a coefficient quantization state of a
15 corresponding     previous-frame   sub-band     of at   least one    sub-band    of the
   to-be-processed sub-bands. When the apparatus 800 is a decoder, the processor 820 is
   configured to call the program code stored in the memory 810 to further perform the
   following operation: acquiring the at least one parameter from a to-be-decoded
   bitstream.
20 [0259]       The signaling processing apparatus 500 in this embodiment of the present
   invention may be used to implement the signaling processing methods in the method
   embodiments. For brevity, details are not described herein.
   [0260]       Therefore, in this embodiment of the present invention, primary bit
   allocation is first performed for to-be-processed sub-bands according to a total
25 quantity of to-be-allocated bits of a current frame, so as to obtain a quantity of
   primarily allocated bits; a primary information unit quantity determining operation is
   performed for a sub-band that has undergone the primary bit allocation, so as to obtain
   a total quantity of surplus bits and a quantity of information units corresponding to
   each sub-band of the to-be-processed sub-bands; then, sub-bands for secondary bit
30 allocation are determined according to at least one of a sub-band characteristic of each
   sub-band of the to-be-processed sub-bands or the total quantity of surplus bits, and the
   surplus bits are allocated to the sub-bands for secondary bit allocation to obtain a
   quantity of secondarily allocated bits of each sub-band of the sub-bands for secondary
   bit allocation; a secondary information unit quantity determining operation is
                                               63

   performed for each sub-band of the sub-bands for secondary bit allocation according
   to the quantity of primarily allocated bits and the quantity of secondarily allocated bits
   of each sub-band of the sub-bands for secondary bit allocation, so as to re-obtain a
   quantity of information units corresponding to each sub-band of the sub-bands for
 5 secondary bit allocation. The surplus bits left in encoded sub-bands are not evenly
   allocated to remaining unencoded sub-bands, and therefore, available bits can be more
   properly and fully used and encoding and decoding quality is apparently improved.
   [0261]      A person of ordinary skill in the art may be aware that, in combination
   with the examples described in the embodiments disclosed in this specification, units
10 and algorithm steps may be implemented by electronic hardware or a combination of
   computer software and electronic hardware. Whether the functions are performed by
   hardware or software depends on particular applications and design constraint
   conditions of the technical solutions. A person skilled in the art may use different
   methods to implement the described functions for each particular application, but it
15 should not be considered that the implementation goes beyond the scope of the
   present invention.
   [0262]      It may be clearly understood by a person skilled in the art that, for the
   purpose of convenient and brief description, for a detailed working process of the
   foregoing system, apparatus, and unit, reference may be made to a corresponding
20 process in the foregoing method embodiments, and details are not described herein
   again.
   [0263]      In the several embodiments provided in the present application, it should
   be understood that the disclosed system, apparatus, and method may be implemented
   in other manners. For example, the described apparatus embodiment is merely
25 exemplary. For example, the unit division is merely logical function division and may
   be other division in actual implementation. For example, a plurality of units or
   components may be combined or integrated into another system, or some features
   may be ignored or not performed. In addition, the displayed or discussed mutual
   couplings or direct couplings or communication connections may be implemented by
30 using some interfaces. The indirect couplings or communication connections between
   the apparatuses or units may be implemented in electronic, mechanical, or other
   forms.
   [0264]      The units described as separate parts may or may not be physically
   separate, and parts displayed as units may or may not be physical units, may be
                                                64

   located in one position, or may be distributed on a plurality of network units. Some or
   all of the units may be selected according to actual needs to achieve the objectives of
   the solutions of the embodiments.
   [0265]      In addition, functional units in the embodiments of the present invention
 5 may be integrated into one processing unit, or each of the units may exist alone
   physically, or two or more units are integrated into one unit.
   [0266]      When the functions are implemented in the form of a software functional
   unit and sold or used as an independent product, the functions may be stored in a
   computer-readable storage medium. Based on such an understanding, the technical
10 solutions of the present invention essentially, or the part contributing to the prior art,
   or some of the technical solutions may be implemented in a form of a software
   product. The software product is stored in a storage medium, and includes several
   instructions for instructing a computer device (which may be a personal computer, a
   server, or a network device) to perform all or some of the steps of the methods
15 described in the embodiments of the present invention. The foregoing storage medium
   includes: any medium that can store program code, such as a USB flash drive, a
   removable hard disk, a read-only memory (ROM, Read-Only Memory), a random
   access memory (RAM, Random Access Memory), a magnetic disk, or an optical disc.
   [0267]      The foregoing descriptions are merely specific implementation manners of
20 the present invention, but are not intended to limit the protection scope of the present
   invention. Any variation or replacement readily figured out by a person skilled in the
   art within the technical scope disclosed in the present invention shall fall within the
   protection scope of the present invention. Therefore, the protection scope of the
   present invention shall be subject to the protection scope of the claims.
                                               65

                                           CLAIMS
         1. An audio signal processing method, comprising:
        determining     a  total  quantity   of to-be-allocated   bits  corresponding    to
   to-be-processed sub-bands of a current frame of the audio signal;
 5      implementing primary bit allocation on the to-be-processed sub-bands according
   to the total quantity of to-be-allocated bits, so as to obtain a quantity of primarily
   allocated bits of each sub-band of the to-be-processed sub-bands;
        selecting sub-bands for secondary bit allocation from the to-be-processed
   sub-bands    according to a sub-band        characteristic of each   sub-band    of the
10 to-be-processed sub-bands;
        obtaining, according to the quantity of primarily allocated bits of each sub-band
   of the to-be-processed sub-bands besides the sub-bands for secondary bit allocation, a
   quantity of surplus bits of each sub-band of the to-be-processed sub-bands besides the
   sub-bands for secondary bit allocation and a quantity of pulses of each sub-band of
15 the to-be-processed sub-bands besides the sub-bands for secondary bit allocation;
        implementing secondary bit allocation on the sub-bands for secondary bit
   allocation according to the quantity of surplus bits of each sub-band of the
   to-be-processed sub-bands besides the sub-bands for secondary bit allocation, so as to
   obtain a quantity of secondarily allocated bits of each sub-band of the sub-bands for
20 secondary bit allocation; and
        obtaining, according to the quantity of primarily allocated bits of each sub-band
   of the sub-bands for secondary bit allocation and the quantity of secondarily allocated
   bits of each sub-band of the sub-bands for secondary bit allocation, a quantity of
   pulses corresponding to each sub-band of the sub-bands for secondary bit allocation.
25      2. The method according to claim 1, wherein the sub-band characteristic of each
   sub-band comprises at least one of a harmonic characteristic of the sub-band, or a bit
   allocation state corresponding to the sub-band.
        3. The method according to claim 2, wherein:
        the harmonic characteristic of the sub-band indicates the signal type of the
30 sub-band is harmonic or not harmonic; and
        the bit allocation state corresponding to the sub-band comprises at least one of a
   coefficient quantization state of a corresponding sub-band of a previous-frame,    or an
                                               66

   average quantity of primary bits per unit bandwidth of the sub-band, wherein
        the average quantity of primary bits per unit bandwidth of the sub-band is
   determined according to the quantity of primarily allocated bits of the sub-band and
   bandwidth of the sub-band.
 5      4. The method according to any one of claims 1 to 3, wherein a quantity of the
   selected sub-bands for secondary bit allocation is two.
        5. The method according to any one of claims 1 to 4, wherein the selected
   sub-bands for secondary bit allocation are successive in a frequency domain.
        6. A signal processing apparatus, comprising:
10      a memory for storing processor-executable instructions; and
        a processor operatively coupled to the memory, the processor being configured to
   execute the processor-executable instructions to facilitate the following steps:
        determining     a  total  quantity  of to-be-allocated      bits  corresponding  to
   to-be-processed sub-bands of a current frame of the audio signal;
15      implementing primary bit allocation on the to-be-processed sub-bands according
   to the total quantity of to-be-allocated bits, so as to obtain a quantity of primarily
   allocated bits of each sub-band of the to-be-processed sub-bands;
        selecting sub-bands for secondary bit allocation from the to-be-processed
   sub-bands    according to a sub-band       characteristic   of each    sub-band   of the
20 to-be-processed sub-bands;
        obtaining, according to the quantity of primarily allocated bits of each sub-band
   of the to-be-processed sub-bands besides the sub-bands for secondary bit allocation, a
   quantity of surplus bits of each sub-band of the to-be-processed sub-bands besides the
   sub-bands for secondary bit allocation and a quantity of pulses of each sub-band of
25 the to-be-processed sub-bands besides the sub-bands for secondary bit allocation;
        implementing secondary bit allocation on the sub-bands for secondary bit
   allocation according to the quantity of surplus bits of each sub-band of the
   to-be-processed sub-bands besides the sub-bands for secondary bit allocation, so as to
   obtain a quantity of secondarily allocated bits of each sub-band of the sub-bands for
30 secondary bit allocation; and
        obtaining, according to the quantity of primarily allocated bits of each sub-band
   of the sub-bands for secondary bit allocation and the quantity of secondarily allocated
   bits of each sub-band of the sub-bands for secondary bit allocation, a quantity of
   pulses corresponding to each sub-band of the sub-bands for secondary bit allocation.
                                               67

         7. The apparatus according to claim 6, wherein the sub-band characteristic of
   each sub-band comprises at least one of a harmonic characteristic of the sub-band, or
   a bit allocation state corresponding to the sub-band.
         8. The apparatus according to claim 7, wherein:
 5       the harmonic characteristic of the sub-band indicates the signal type of the
   sub-band is harmonic or not harmonic; and
         the bit allocation state corresponding to the sub-band comprises at least one of a
   coefficient quantization state of a corresponding sub-band of a previous-frame,    or an
   average quantity of primary bits per unit bandwidth of the sub-band, wherein
10       the average quantity of primary bits per unit bandwidth of the sub-band is
   determined according to the quantity of primarily allocated bits of the sub-band and
   bandwidth of the sub-band.
         9. The apparatus according to any one of claims 6 to 8, wherein a quantity of the
   selected sub-bands for secondary bit allocation is two.
15       10. The apparatus according to any one of claims 6 to 9, wherein the selected
   sub-bands for secondary bit allocation are successive in a frequency domain.
                                                68

                                                    1/12
<removed-date>
              100
                                                                                        S110
              Determine a total quantity of to-be-allocated bits corresponding to
                       to-be-processed sub-bands of a current frame
<removed-apn>
                Implement primary bit allocation on each sub-band of the to-be-         S120
                  processed sub-bands according to the total quantity of to-be-
               allocated bits, so as to obtain a quantity of primarily allocated bits
                       of each sub-band of the to-be-processed sub-bands
                Perform, according to the quantity of primarily allocated bits of
                each sub-band, a primary information unit quantity determining
               operation for each sub-band of the to-be-processed sub-bands that        S130
                has undergone the primary bit allocation, so as to obtain a total
                 quantity of surplus bits of the current frame and a quantity of
                information units corresponding to each sub-band of the to-be-
                                      processed sub-bands
                                                                                        S140
                 Select sub-bands for secondary bit allocation from the to-be-
                 processed sub-bands according to a secondary bit allocation
                                          parameter
              Implement secondary bit allocation on the sub-bands for secondary         S150
              bit allocation, so as to allocate the surplus bits to the sub-bands for
                  secondary bit allocation and obtain a quantity of secondarily
               allocated bits of each sub-band of the sub-bands for secondary bit
                                  allocation of the current frame
                  Perform, according to the bits obtained when the primary bit
                   allocation is performed for the sub-bands for secondary bit
              allocation and the bits obtained when the secondary bit allocation is     S160
                 performed, a secondary information unit quantity determining
                 operation for each sub-band of the sub-bands for secondary bit
                  allocation, so as to re-obtain a quantity of information units
               corresponding to each sub-band of the sub-bands for secondary bit
                                  allocation of the current frame
                                                   FIG. 1

                                                           2/12
<removed-date>
                           200
                                                                                                     S201
                           Determine to-be-processed sub-bands and a total quantity of to-be-
                             allocated bits corresponding to the to-be-processed sub-bands
                            Implement primary bit allocation on each sub-band according to
                                                                                                     S202
<removed-apn>
                            the total quantity of to-be-allocated bits and an envelope value of
                           each sub-band of the to-be-processed sub-bands of a current frame
                               Perform a primary information unit quantity determining
                           operation for the to-be-processed sub-bands that has undergone the        S203
                                                  primary bit allocation
                                                Determine whether a sub-           S204
                                                band in m first sub-band
                                               sets meets a corresponding
                                               predetermined condition of
                                 S205a              m predetermined                   S206a
               S205b                                   conditions                                   S206b
                 Determine, as a                                  Determine, as a          Determine, as a
              target sub-band set,     Determine, as a         target sub-band set,     target sub-band set,
               a set formed by all     target sub-band         a set formed by sub-        a set formed by
                 sub-bands of at      set, a set formed          bands other than       sub-bands of the to-
               least one sub-band    by sub-bands that            sub-bands that         be-processed sub-
                 set that meets a    belong to all the m        belong to all the m       bands that do not
                 corresponding       first sub-band sets        first sub-band sets      belong to any sub-
                 predetermined                                                            band set of the m
                    condition                                                            first sub-band sets
                                                                                                     S208
                           Determine a top-priority to-be-enhanced sub-band from the target
                                                      sub-band set
                                                                                                     S209
                             Allocate surplus bits to sub-bands for secondary bit allocation
                             Perform, according to a quantity of primarily allocated bits and a
                           quantity of secondarily allocated bits of each sub-band of sub-bands      S210
                              for the secondary bit allocation, a secondary information unit
                            quantity determining operation for each sub-band of the sub-bands
                                               for secondary bit allocation
                                                           FIG. 2

                             3/12
<removed-date>             Total quantity
                      of surplus bits > a
              Yes                            No
<removed-apn>
                N=2                         N=1
                            FIG. 3
                .
                .
               k+1
                                                  k1
                k
                k-1
                 .
                 .
                            FIG. 4

                                                         4/12
<removed-date>
                             Total
                      quantity of surplus
                          bits > an 1
              Yes                                       No
<removed-apn>
                N=n                         Total
                                     quantity of surplus
                                         bits > an-2
                          Yes
                                                                   ...
                            N=n-1
                                            Yes                                     No
                                                                                Total
                                                  ...                    quantity of surplus
                                                                              bits > a1
                                                             Yes                                     No
                                                                 N=n-1                         N=1
                                                        FIG. 5

                                5/12
<removed-date>   k+(n/2)-1
                                     ...
                  .
                  .                 k4
                 k+2                k2
<removed-apn>
                 k+1                                   kn-1
                  k                             ...
                 k-1                k1
                 k-2                k3
                  .
                  .
              K-(n/2)+1             ...
                               FIG. 6
                  Rk1                          Rk2
                 Integrate allocated bits into Rkall
                    Secondary information unit
                       quantity determining
                            operation
                               FIG. 7

                                                                                           6/12
<removed-date>
                                                                                    300
              Input signal
                                          S301                                            303
                                                                       Calculate
                                                                     and quantize
                             Time-frequency
                                                                     a frequency-                                        309
                                                     Determine a
                                                                        domain                        308
                                                                       envelope
<removed-apn>
                                                                                                                                                     Output the
                                                                                                                 Quantization
                                tranform            sub-band type
                                                                                    304             Secondary
                                                                                                   information
                                                                                                                                                     bitstream
                                                                     Primary bit
                                                                                                                  operation
                                                                      allocation                       unit
                                                                                                     quantity
                                                                                                                                Encode a bitstream
                                                                               305                 determining
                                              302                                                   operation
                                                                      Primary
                                                                    information
                                                                    unit quantity
                                                                    determining
                                                                     operation
                                                                                 306
                                                                                                                                                       310
                                                                     Determine
                                                                    sub-bands for
                                                                    secondary bit
                                                                      allocation
                                                                                307
                                                                    Secondary bit
                                                                      allocation
                                                                                                Delay by
                                                                                                one frame
                                                                                          FIG. 8

                                                                           7/12
<removed-date>
                                                                                                           407
                                                                400
                                                                                                                               408
                                                                                             Inverse quantization
                                                 401                               406
                                                                                                                                     Output
                                                                                                                    Time-frequency
                                                                                                                                     signal
                                                                402           Secondary
                                                                                                  operation
                                                                             information
<removed-apn>
                                                                             unit quantity
                                                                                                                      transform
                                                       Primary bit           determining
                                                        allocation            operation
              Bitstream
                                                                  403
                                                         Primary
                          Decode the bitstream
                                                       information
                                                       unit quantity
                                                       determining
                                                        operation
                                                                       404
                                                        Determine
                                                       sub-bands for
                                                       secondary bit
                                                         allocation
                                                                     405
                                                       Secondary bit
                                                         allocation
                                                                         FIG. 9

                                      8/12
<removed-date>
                   Signal processing apparatus
                                                          500
                                                    510
              Total bit quantity determining unit
<removed-apn>
                                                    520
                  Primary bit allocation unit
                                                    530
              Primary information unit quantity
                      determining unit
                                                    540
                   Sub-band selection unit
                                                    550
                Secondary bit allocation unit
                                                    560
                 Secondary information unit
                  quantity determining unit
                                    FIG. 10

                                     9/12
<removed-date>
                   Signal processing apparatus
                                                             500
                                                       510
               Total bit quantity determining unit
<removed-apn>
                                                       520
                   Primary bit allocation unit
                                                       530
               Primary information unit quantity
                       determining unit
                                                       540
                                                 542
                  Determining subunit
                                                 546
                    Selection subunit
                                                       550
                 Secondary bit allocation unit
                                                       560
              Secondary information unit quantity
                      determining unit
                                   FIG. 11

                                     10/12
<removed-date>
                               Encoder
                                                          600
                                                    610
              Total bit quantity determining unit
<removed-apn>
                                                    620
                  Primary bit allocation unit
                                                    630
              Primary information unit quantity
                      determining unit
                                                    640
                   Sub-band selection unit
                                                    650
                Secondary bit allocation unit
                                                    660
                 Secondary information unit
                  quantity determining unit
                                                    670
                      Quantization unit
                                                    680
                        Transport unit
                                    FIG. 12

                                               11/12
<removed-date>
                                            Decoder
                                                                              700
                                                                      710
                                Total bit quantity determining
                                             unit
                                                                      720
<removed-apn>
                                  Primary bit allocation unit
                                                                      730
                                      Primary information unit
                                      quantity determining unit
                  790
                                                                        740
              Second acquiring unit         Sub-band selection unit
                                                                      750
                                 Secondary bit allocation unit
                                                                      760
                                 Secondary information unit
                                  quantity determining unit
                                                                      770
                                      Inverse quantization unit
                                                                      780
                                        First acquiring unit
                                              FIG. 13

                             12/12
<removed-date>
                                                  800
              Signal processing apparatus
                                            810
                    Memory
                                            820
<removed-apn>
                    Processor
                            FIG. 14

