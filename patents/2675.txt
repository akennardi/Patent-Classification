   [Abstract]
   An image decoding method, comprising: decoding            a   coded    signal   to
   generate quantization coefficients and pieces of management information,
   the quantization coefficients each corresponding to a corresponding one of
 5 transform units, and the pieces of the management information indicating a
   structure of the transform units; performing         inverse quantization and
   inverse transform on each of the quantization coefficients, eventually
   generating prediction error signals of the respective transform units; and
   adding at least one of the prediction error signals to a prediction signal for
10 each of coding units each including the transform units, generating decoded
   signals for each of the coding units, wherein the quantization coefficients
   and the pieces of the management information have a tree structure, each
   of the transform units corresponds to a corresponding one of leaf nodes in
   the tree structure, and the decoding includes decoding, for each of the leaf
15 nodes,   a coded    piece of the   management       information   and a coded
   quantization coefficient which are arranged in succession in the coded signal
   for the each of the leaf nodes, wherein the pieces of the management
   information include respective pieces of split information each of which
   corresponds to a corresponding one of nodes in the tree structure and
20 indicates   whether    or  not  a   transform    unit   corresponding     to  the
   corresponding one of the nodes is to be further split, wherein the pieces of
   the management information include respective first flags each of which
   corresponds to at least one of the nodes in the tree structure and indicates
   whether or not a quantization coefficient corresponding to each of the at
25 least one of the nodes exists,   wherein each of the quantization coefficients
   includes    a  luminance    quantization    coefficient   and   a   chrominance
   quantization coefficient, and the first flag includes a second flag and a third
   flag, the second flag indicating whether or not the luminance quantization
   coefficient exists, and    the third   flag  indicating   whether or     not the
30 chrominance quantization coefficient exists, in the coded signal, the second
   flag that is coded is arranged after the third flag that is coded, wherein in
   the decoding, the second flag that is coded is decoded after decoding the
   third flag that is coded, for each of the at least one of the nodes.

                     A
   E
        0)00
LL
     r-           r5
        00~
             3/49

      IMAGE CODING METHOD, IMAGE DECODING METHOD, IMAGE CODING
     APPARATUS, IMAGE DECODING APPARATUS, AND IMAGE CODING AND
                              DECODING APPARATUS
 5 [Related Application]
   [0001]
          This application is a divisional application of Australian     Patent
   Application No. <removed-apn> which in turn is a divisional application of
   Australian   application no.  <removed-apn>     which in turn   is a divisional
10 application of Australian application no. 2012353935.    The content of each
   of these applications as filed or as accepted is incorporated herein by
   reference in its entirely.
   [Technical Field]
15 [0002]
          The present invention relates to image coding methods, image
   decoding methods, image coding apparatuses, image decoding apparatuses,
   and image coding/decoding apparatuses.
20 [Background Art]
   [0003]
           In order to compress audio data and video data, various audio coding
   standards and video coding standards have been developed.       Examples of
   such video coding standards are International Telecommunication Union
25 Telecommunication Standardization Sector (ITU-T) standard called H.26x
   and     International    Organization    for   Standardization/International
   Electrotechnical Commission (ISO/IEC) standard called MPEG-x (see ISO
   IEC 14496-10 "MPEG-4 Part10 Advanced Video Coding", for example).        The
   latest video coding standard is called H.264/MPEG-4AVC.          Recently, a
30 new-generation coding standard called High Efficiency Video Coding (HEVC)
   has been examined.
   [Summary of the Invention]
   [0004]
35         In accordance with a first broad aspect of the present invention,
   there is provided an image decoding method, comprising:
                                          1

            decoding a coded signal to generate quantization coefficients and
   pieces of management information,          the quantization coefficients each
   corresponding to a corresponding one of transform units, and the pieces of
   the management information indicating a structure of the transform units;
 5          performing inverse quantization and inverse transform on each of
   the quantization coefficients, eventually generating prediction error signals
   of the respective transform units; and
            adding at least one of the prediction error signals to a prediction
   signal for each of coding units each including the transform units,
10          generating decoded signals for each of the coding units,
            wherein   the  quantization   coefficients and    the  pieces   of the
   management information have a tree structure, each of the transform units
   corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding includes decoding, for each of the leaf nodes, a coded piece of
15 the management information and a coded quantization coefficient which are
   arranged in succession in the coded signal for the each of the leaf nodes,
            wherein   the  pieces  of   the    management    information    include
   respective pieces of split information each of which corresponds to a
   corresponding one of nodes in the tree structure and indicates whether or
20 not a transform unit corresponding to the corresponding one of the nodes is
   to be further split,
            wherein   the  pieces  of   the    management    information    include
   respective first flags each of which corresponds to at least one of the nodes
   in the tree structure and indicates whether or not a quantization coefficient
25 corresponding to each of the at least one of the nodes exists,
            wherein each of the quantization coefficients includes a luminance
   quantization coefficient and a chrominance quantization coefficient, and the
   first flag includes a second flag and a third flag, the second flag indicating
   whether or not the luminance quantization coefficient exists, and the third
30 flag indicating whether or not the chrominance quantization coefficient
   exists, in the coded signal, the second flag that is coded is arranged after
   the third flag that is coded,
            wherein in the decoding, the second flag that is coded is decoded
   after decoding the third flag that is coded, for each of the at least one of the
35 nodes.
     [0005]
                                            2

            In accordance with a second broad aspect of the present invention,
   there is provided an image decoding apparatus, comprising:
            a decoding unit configured to decode a coded signal to generate
   quantization    coefficients and    pieces of management       information,   the
 5 quantization coefficients each corresponding to a corresponding one of
   transform units, and the pieces of the management information indicating a
   structure of the transform units;
            an inverse quantization/inverse transform unit configured to perform
   inverse quantization and inverse transform on each of the quantization
10 coefficients, eventually generating prediction error signals of the respective
   transform units; and
            an addition unit configured to add at least one of the prediction error
   signals to a prediction signal for each of coding units each including the
   transform units, eventually generating decoded signals for each of the
15 coding units,
            wherein   the   quantization   coefficients and   the   pieces  of the
   management information have a tree structure, each of the transform units
   corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding unit is configured to decode, for each of the leaf nodes, a
20 coded piece of the management information and a coded quantization
   coefficient which are arranged in succession in the coded signal for the each
   of the leaf nodes,
            wherein   the   pieces  of   the   management    information    include
   respective pieces of split information each of which corresponds to a
25 corresponding one of nodes in the tree structure and indicates whether or
   not a transform unit corresponding to the corresponding one of the nodes is
   to be further split,
            wherein   the   pieces  of   the   management    information    include
   respective first flags each of which corresponds to at least one of the nodes
30 in the tree structure and indicates whether or not a quantization coefficient
   corresponding to each of the at least one of the nodes exists,
            wherein each of the quantization coefficients includes a luminance
   quantization coefficient and a chrominance quantization coefficient, and the
   first flag includes a second flag and a third flag, the second flag indicating
35 whether or not the luminance quantization coefficient exists, and the third
   flag indicating whether or not the chrominance quantization coefficient
                                             3

   exists, in the coded signal, the second flag that is coded is arranged after
   the third flag that is coded,
           wherein in the decoding unit, the second flag that is coded is decoded
   after decoding the third flag that is coded, for each of the at least one of the
 5 nodes. [0006]
           In accordance with a third broad aspect of the present invention,
   there is provided a computer program configured to, when executed by a
   computing device, control the computing device to implement the image
   decoding method of the first broad aspect.        This aspect also provides a
10 computer readable medium, comprising such a computer program.
   [0007]
           These general and specific aspects may be implemented using a
   system,   a method,     an  integrated circuit, a computer      program,   or a
   computer-readable      recording   medium    such   as   a  CD-ROM,     or  any
15 combination of systems, methods, integrated circuits, computer programs,
   or computer-readable recording media.
   [Advantageous Effects of Invention]
   [0008]
20         An embodiment provides an image coding method and an image
   coding apparatus that are capable of reducing a data amount in a memory
   for temporarily holding data used in coding.
   [Brief Description of Drawings]
25 [0009]
           In order that the invention may be more clearly ascertained,
   embodiments will now be described, by way of example, with reference to
   the accompanying drawing, in which:
           FIG. 1 is a flowchart of coding according to a comparison example.
30         FIG. 2 is a block diagram of an image coding apparatus according to
   Embodiment 1.
           FIG. 3 is a block diagram of an image decoding apparatus according
   to Embodiment 1.
           FIG. 4A is a diagram showing an example of a TU according to
35 Embodiment 1.
           FIG. 4B is a diagram showing an example of a TU according to
                                           4

   Embodiment 1.
          FIG. 5 is a diagram showing an example of a tree structure according
   to Embodiment 1.
          FIG. 6 is a flowchart of coding according to Embodiment 1.
 5        FIG. 7 is a flowchart of coding a split information tree according to
   Embodiment 1.
          FIG. 8 is a flowchart of coding a transform coefficient tree according
   to Embodiment 1.
          FIG. 9 is a block diagram of an entropy decoding unit according to
10 Embodiment 1.
          FIG. 10A is a diagram showing an example of coded signals according
   to Embodiment 1.
          FIG. 10B is a diagram showing an example of coded signals according
   to Embodiment 2.
15        FIG. 11 is a flowchart of coding according to Embodiment 2.
          FIG. 12A is a flowchart of a part of coding according to Embodiment
   2.
          FIG. 12B is a flowchart of a part of coding according to Embodiment
   2.
20        FIG. 13 is a block diagram of an entropy decoding unit according to
   Embodiment 2.
          FIG.  14A is a diagram for explaining CBF coding according to
   Embodiment 2.
          FIG.  14B is a diagram for explaining CBF coding according to
25 Embodiment 2.
          FIG.  14C is a diagram for explaining CBF coding according to
   Embodiment 2.
          FIG.  14D is a diagram for explaining CBF coding according to
   Embodiment 2.
30        FIG. 15 is a flowchart of coding according to Embodiment 3.
          FIG. 16 is a flowchart of coding according to Embodiment 4.
          FIG. 17 is a flowchart of another coding according to Embodiment 4.
          FIG. 18A is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
35        FIG. 18B is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
                                          5

           FIG. 18C is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
           FIG. 19A is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
 5         FIG. 19B is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
           FIG. 20 is a flowchart of coding according to Embodiment 5.
           FIG. 21A is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
10         FIG. 21B is a diagram showing an example of an order of coding CBFs
   and transform coefficients according to Embodiment 5.
           FIG. 22A is a flowchart of coding according to Embodiment 6.
           FIG. 22B is a flowchart of coding according to Embodiment 6.
           FIG. 23 is a diagram showing an example of a syntax according to
15 Embodiment 6.
           FIG. 24A is a diagram showing an example of a syntax according to
   Embodiment 6.
           FIG. 24B is a diagram showing an example of a syntax according to
   Embodiment 6.
20         FIG. 24C is a diagram showing an example of a syntax according to
   Embodiment 6.
           FIG. 25A is a flowchart of coding according to Embodiment 7.
           FIG. 25B is a flowchart of unified transform according to Embodiment
   7.
25         FIG. 26 shows an overall configuration of a content providing system
   for implementing content distribution services.
           FIG. 27 shows an overall configuration of a digital broadcasting
   system.
           FIG.  28 shows a block diagram          illustrating an example of a
30 configuration of a television.
           FIG.  29 shows a block diagram          illustrating an example of a
   configuration of an information reproducing/recording unit that reads and
   writes information from and on a recording medium that is an optical disk.
           FIG. 30 shows an example of a configuration of a recording medium
35 that is an optical disk.
           FIG. 31A shows an example of a cellular phone.
                                            6

           FIG. 31B is a block diagram showing an example of a configuration of
   a cellular phone.
           FIG. 32 illustrates a structure of multiplexed data.
           FIG.  33 schematically shows how each stream is multiplexed in
 5 multiplexed data.
           FIG. 34 shows how a video stream is stored in a stream of PES
   packets in more detail.
           FIG. 35 shows a structure of TS packets and source packets in the
   multiplexed data.
10         FIG. 36 shows a data structure of a PMT.
           FIG. 37 shows an internal structure of multiplexed data information.
           FIG. 38 shows an internal structure of stream attribute information.
           FIG. 39 shows steps for identifying video data.
           FIG. 40 shows an example of a configuration of an integrated circuit
15 for implementing the moving picture coding method and the moving picture
   decoding method according to each of Embodiments.
           FIG.  41   shows   a configuration for switching     between   driving
   frequencies.
           FIG. 42 shows steps for identifying video data and switching between
20 driving frequencies.
           FIG. 43 shows an example of a look-up table in which video data
   standards are associated with driving frequencies,
           FIG. 44A is a diagram showing an example of a configuration for
   sharing a module of a signal processing unit.
25         FIG. 44B is a diagram showing another example of a configuration for
   sharing a module of the signal processing unit.
   [Description of Embodiments]
   [0010]
30         (Underlying Knowledge Forming Basis of the Present Invention)
           In relation to the disclosures in the       Background   section,  the
   inventors have found the following problem.
   [0011]
           The following describes a coding method and a decoding method
35 according to the disclosed comparison example.
   [0012]
                                           7

           FIG.   1 is a flowchart of the coding method according to the
   comparison example.
   [0013]
           A picture (in other words, a frame) is split into macroblocks each
 5 having the same size of 16 pixels x 16 pixels.      The plurality of macroblocks
   are coded, for example, sequentially in a raster scan order.        FIG. 1 shows
   coding of one macroblock.
   [0014]
           First, one of various orthogonal transform sizes is selected as a
10 transform size for a current macroblock to be coded.       The transform size is
   smaller than a size of the macroblock.      For example, the transform size is
   4 pixels x 4 pixels or 8 pixels x 8 pixels.  Hereinafter, the unit for transform
   is referred to as a "transform unit (TU)".     Then, information indicating the
   selected transform size is coded (S101).        A flag indicating the transform
15 size is, for example, transformsize-flag.
   [0015]
           Next, a CBF is coded (S102).      Here, a CBF refers to flag information
   indicating whether or not a transform coefficient (quantization coefficient)
   of a TU exists.
20 [0016]
           Next, a TU     is selected.    For example, a plurality of TUs are
   sequentially selected in a Z scan order, and the selected TU is applied with
   the following processing.
   [0017]
25         If the CBF is true (Yes at S104), then a transform coefficient of the
   current TU is coded (S105).      On the other hand, if the CBF is false (No at
   S104), then the transform coefficient of the current TU is not coded.        The
   series of steps S103 to S105 are performed on each of the TUs included in
   the current macroblock (S106).
30 [0018]
           Decoding is also performed in the same order as shown in FIG. 1.       In
   other words, decoding can be explained by replacing the "coding"               by
   "decoding" in the above description.
   [0019]
35         Here, in order to efficiently code a picture, flexible selection of
   transform size is important.     However, the inventors have found that a data
                                            8

   amount of information indicating a transform size is increased, as the
   flexibility in selecting a transform size is improved.
   [0020]
           According to an exemplary embodiment disclosed herein to solve the
 5 above-described problems, an image coding method, comprising: splitting
   an input image signal into a plurality of coding units, and subtracting a
   prediction signal from the input image signal for each of the coding units,
   eventually generating prediction error signals of the respective coding
   units; splitting each of the coding units into a plurality of transform units,
10 and performing orthogonal transform and quantization on a corresponding
   one of the prediction error signals for each of the transform              units,
   eventually generating quantization coefficients of the respective coding
   units; and coding pieces of management information and the quantization
   coefficients into a tree structure, the pieces of management information
15 indicating a structure of the transform units, wherein each of the transform
   units corresponds to a corresponding one of leaf nodes in the tree structure,
   and in the coding, for each of the leaf nodes, a corresponding piece of the
   management information and a corresponding one of the quantization
   coefficients are coded, eventually generating a coded signal in which the
20 coded corresponding piece of the management information and the coded
   corresponding      one    of the quantization    coefficients   are arranged   in
   succession for the each of the leaf nodes.
   [0021]
            By    the  method,    a piece   of   management     information  and   a
25 quantization coefficient of each of transform units are continuously coded.
   Therefore, each of the image coding apparatus and the image decoding
   apparatus does not need to cause a memory to hold pieces of management
   information of other transform units.          As described above, the image
   coding method can reduce a data amount of a memory for temporarily
30 storing pieces of data to be used in coding or decoding.
   [0022]
            It is possible that the pieces of the management information includes
   respective pieces of split information each of which corresponds to a
   corresponding one of nodes in the tree structure and indicates whether or
35 not a transform unit corresponding to the corresponding one of the nodes is
   to be further split.
                                              9

   [0023]
           It is also possible that the pieces of the management information
   includes respective first flags each of which corresponds to at least one of
   the nodes in the tree structure and indicates whether or not a quantization
 5 coefficient corresponding to each of the at least one of the nodes exists.
   [0024]
           It is further possible that in the coding, it is determined whether or
   not a value of the first flag of a current node at a current level can be
   uniquely identified by at least one of (a) the first flag at a level upper than
10 the current level and (b) the first flag of a different node at the current level,
   and when it is determined that the value of the first flag of the current node
   can be uniquely identified, the first flag of the current node is not coded.
   [0025]
           Therefore, the image coding method can reduce a coding amount of
15 the coded signal.
   [0026]
           It is further possible that the coding includes coding a difference
   quantization step at the each of the leaf nodes in the coded signal, the coded
   difference quantization step being arranged at a position corresponding to
20 the each of the leaf nodes in the tree structure, and the difference
   quantization step indicates, in the performing of orthogonal transform and
   quantization, a difference between a quantization step that has most
   recently been used and a quantization step that is to be used for a current
   transform unit.
25 [0027]
           By the method, the image coding method can arrange the difference
   quantization step and the transform coefficient at close positions in the
   coded signal.     As a result, the image coding method can reduce an amount
   of a memory for temporarily storing data in the image decoding apparatus.
30 [0028]
           It is further possible that the coding includes coding a difference
   quantization step at a root of the tree structure in the coded signal, the
   coded     difference   quantization    step   being   arranged    at  a  position
   corresponding to the root, and the difference quantization step indicates, in
35 the performing of orthogonal transform and quantization, a difference
   between a quantization step that has most recently been used and a
                                             10

   quantization step that is to be used for a current transform unit.
   [0029]
             By the above method, the image coding method can reduce a coding
   amount of the coded signal.
 5 [0030]
             It is further possible that each of the quantization coefficients
   includes       a   luminance   quantization    coefficient   and   a   chrominance
   quantization coefficient, and the first flag includes a second flag and a third
   flag, the second flag indicating whether or not the luminance quantization
10 coefficient exists, and       the third   flag  indicating    whether or    not the
   chrominance quantization coefficient exists, wherein in the coding, for each
   of the at least one of the nodes, the second flag is coded after coding the
   third flag, thereby generating the coded signal in which the coded second
   flag is arranged after the coded third flag.
15 [0031]
             It is further possible that each of the quantization coefficients
   includes       a   luminance   quantization    coefficient,   a  chrominance     Cb
   quantization coefficient, and a chrominance Cr quantization coefficient, the
   first flag includes a second flag, a third flag, and a fourth flag, the second
20 flag indicating whether or not the luminance quantization coefficient exists,
   the third flag indicating whether or not the chrominance Cb quantization
   coefficient exists, and the fourth flag indicating whether or not the
   chrominance Cr quantization coefficient exists, and in the coding, for each
   of the at least one of the nodes, the third flag, the fourth flag, the second
25 flag,    the     luminance   quantization    coefficient,   the  chrominance     Cb
   quantization coefficient, and the chrominance Cr quantization coefficient
   are coded in order, thereby generating the coded signal in which the coded
   third flag, the coded fourth flag, the coded second flag, the coded luminance
   quantization coefficient, the coded chrominance Cb quantization coefficient,
30 and the coded chrominance Cr quantization coefficient are arranged in
   order.
   [0032]
            According to another exemplary embodiment disclosed herein, it is
   further possible that an image decoding method, comprising: decoding a
35 coded       signal   to  generate   quantization    coefficients   and    pieces  of
   management information, the quantization coefficients each corresponding
                                              11

   to a corresponding        one of transform       units,  and  the   pieces of the
   management information indicating a structure of the transform units;
   performing inverse quantization and inverse transform on each of the
   quantization coefficients, eventually generating prediction error signals of
 5 the respective transform units; and adding at least one of the prediction
   error signals to a prediction signal for each of coding units each including
   the transform units, eventually generating decoded signals for each of the
   coding    units,   the   quantization    coefficients   and  the   pieces  of  the
   management information have a tree structure, each of the transform units
10 corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding includes decoding, for each of the leaf nodes, a coded piece of
   the management information and a coded quantization coefficient which are
   arranged in succession in the coded signal for the each of the leaf nodes.
   [0033]
15         By    the   method,   a piece     of  management      information  and   a
   quantization coefficient of each of transform units are continuously coded.
   Therefore, the image decoding apparatus does not need to cause a memory
   to hold pieces of management information of other transform units.              As
   described above, the image decoding method can reduce a data amount of
20 a memory for temporarily storing pieces of data to be used in decoding.
   [0034]
           It is possible that the pieces of the management information includes
   respective pieces of split information each of which corresponds to a
   corresponding one of nodes in the tree structure and indicates whether or
25 not a transform unit corresponding to the corresponding one of the nodes is
   to be further split.
   [0035]
           It is also possible that the pieces of the management information
   includes respective first flags each of which corresponds to at least one of
30 the nodes in the tree structure and indicates whether or not a quantization
   coefficient corresponding to each of the at least one of the nodes exists.
   [0036]
           It is further possible that in the decoding, it is determined whether or
   not a value of the first flag of a current node at a current level can be
35 identified by at least one of (a) the first flag at a level upper than the current
   level and (b) the first flag of a different node at the current level, and when
                                             12

   it is determined that the value of the first flag of the current node can be
   uniquely identified, the first flag of the current node is not generated by
   decoding.
   [0037]
 5         By this method, a coding amount of the coded signal can be reduced.
   [0038]
           It is further possible that the decoding includes decoding a difference
   quantization step at a current leaf node in the coded signal, the difference
   quantization step being arranged at a position corresponding to the current
10 leaf node in the tree structure, and the difference quantization step
   indicates, in the performing of inverse quantization and inverse orthogonal
   transform, a difference between a quantization step that has most recently
   been used and a quantization step that is to be used for a current transform
   unit.
15 [0039]
           By the method,      a difference quantization step and a transform
   coefficient are arranged close to each other in a coded signal.       As a result,
   the image decoding method can reduce an amount of a memory for
   temporarily storing data in the image decoding apparatus.
20 [0040]
           It is further possible that the decoding includes decoding a difference
   quantization step at a root of the tree structure in the coded signal, the
   difference     quantization    step  being    coded    arranged   at  a  position
   corresponding to the root, and the difference quantization step indicates, in
25 the performing of inverse quantization and inverse orthogonal transform, a
   difference between a quantization step that has most recently been used
   and a quantization step that is to be used for a current transform unit.
   [0041]
           By this method, a coding amount of the coded signal can be reduced.
30 [0042]
           It is further possible that each of the quantization coefficients
   includes     a   luminance    quantization    coefficient   and  a   chrominance
   quantization coefficient, and the first flag includes a second flag and a third
   flag, the second flag indicating whether or not the luminance quantization
35 coefficient exists, and      the third   flag  indicating   whether or   not the
   chrominance quantization coefficient exists, in the coded signal, the second
                                             13

   flag that is coded is arranged after the third flag that is coded, in the
   decoding, the second flag that is coded is decoded after decoding the third
   flag that is coded, for each of the at least one of the nodes.
   [0043]
 5          It is further possible that each of the quantization coefficients
   includes     a  luminance     quantization  coefficient, a   chrominance     Cb
   quantization coefficient, and a chrominance Cr quantization coefficient, the
   first flag includes a second flag, a third flag, and a fourth flag, the second
   flag indicating whether or not the luminance quantization coefficient exists,
10 the third flag indicating whether or not the chrominance Cb quantization
   coefficient exists, and the fourth flag indicating whether or not the
   chrominance Cr quantization coefficient exists, and the third flag that is
   coded, the fourth flag      that is coded, the second flag that is coded, the
   luminance quantization coefficient that is coded, the chrominance Cb
15 quantization coefficient that is coded, and the chrominance Cr quantization
   coefficient that is coded are arranged in order in the coded signal, and in the
   decoding, for each of the at least one of the nodes, the third flag that is
   coded, the fourth flag that is coded, the second flag that is coded, the
   luminance quantization coefficient that is coded, the chrominance Cb
20 quantization coefficient that is coded, and the chrominance Cr quantization
   coefficient that is coded are decoded in order.
   [0044]
            According to still another exemplary embodiment disclosed herein,
   an image coding apparatus including a subtraction unit configured to split
25 an input image signal into a plurality of coding units, and subtract a
   prediction signal from the input image signal for each of the coding units,
   eventually generating prediction error signals of the respective coding
   units; a transform quantization unit configured to split each of the coding
   units into a plurality of transform units, and perform orthogonal transform
30 and quantization on a corresponding one of the prediction error signals for
   each of the transform units, eventually generating quantization coefficients
   of the respective coding units; and a coding unit configured to code pieces
   of management information and the quantization coefficients into a tree
   structure, the pieces of management information indicating a structure of
35 the transform units, wherein each of the transform units corresponds to a
   corresponding one of leaf nodes in the tree structure, and the conding unit
                                            14

   is configured to code, for each of the leaf nodes, a corresponding piece of
   the management information and a corresponding one of the quantization
   coefficients, eventually generating a coded signal in which the coded
   corresponding    piece of the    management     information    and   the coded
 5 corresponding     one  of the quantization    coefficients    are  arranged    in
   succession for the each of the leaf nodes.
   [0045]
           By   the   method,  a piece   of  management       information   and    a
   quantization coefficient of each of transform units are continuously coded.
10 Therefore, each of the image coding apparatus and the image decoding
   apparatus does not need to cause a memory to hold pieces of management
   information of other transform units.       As described above, the image
   coding apparatus can reduce a data amount of a memory for temporarily
   storing pieces of data to be used in coding or decoding.
15 [0046]
           According to still another exemplary embodiment disclosed herein,
   an image decoding apparatusincluding a decoding unit configured to decode
   a coded     signal  to generate   quantization   coefficients   and   pieces of
   management information, the quantization coefficients each corresponding
20 to a corresponding      one of transform     units,  and   the   pieces  of the
   management information indicating a structure of the transform units; an
   inverse quantiztion/inverse transform unit configured to perform inverse
   quantization and inverse transform on each of the quantization coefficients,
   eventually generating prediction error signals of the respective transform
25 units; and an addition unit configured to add at least one of the prediction
   error signals to a prediction signal for each of coding units each including
   the transform units, eventually generating decoded signals for each of the
   coding   units,   the  quantization  coefficients   and   the   pieces   of  the
   management information have a tree structure, each of the transform units
30 corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding unit is configured to decode, for each of the leaf nodes, a
   coded piece of the management information and a coded quantization
   coefficient which are arranged in succession in the coded signal for the each
   of the leaf nodes.
35 [0047]
           By   the   method,  a piece   of  management       information   and    a
                                          15

   quantization coefficient of each of transform units are continuously coded.
   Therefore, the image decoding apparatus does not need to cause a memory
   to hold pieces of management information of other transform units.            As
   described above, the image decoding apparatus can reduce a data amount
 5 of a memory for temporarily storing pieces of data to be used in decoding.
   [0048]
           According to still another exemplary embodiment disclosed herein,
   an image coding/decoding apparatus includes the above-described image
   coding apparatus and the above-described image decoding apparatus.
10 [0049]
           These general and specific aspects may be implemented using a
   system,    a method,     an  integrated circuit, a computer     program,   or a
   computer-readable       recording   medium    such   as   a CD-ROM,     or  any
   combination of systems, methods, integrated circuits, computer programs,
15 or computer-readable recording media.
   [0050]
           The   following    describes   embodiments    with  reference   to   the
   drawings.
   [0051]
20         Each of the exemplary embodiments described below shows a
   general or specific example.        The numerical values, shapes, materials,
   structural elements, the arrangement and connection of the structural
   elements, steps, the processing order of the steps etc. shown in the
   following exemplary embodiments are mere examples, and therefore do not
25 limit the scope of the appended Claims and their equivalents.        Therefore,
   among the structural elements in the following exemplary embodiments,
   structural elements not recited in any one of the independent claims are
   described as arbitrary structural elements.
   [0052]
30         (Embodiment 1)
           The image coding apparatus according to Embodiment 1 splits a
   block as a unit to be coded, hierarchically into a plurality of the transform
   units.   In addition, the image coding apparatus codes, into a tree structure,
   (a)  pieces of management         information  indicating a structure of the
35 transform units, and (b) transform coefficients.        As a result, the image
   coding apparatus is capable of suppressing the increase of pieces of
                                            16

   information indicating the structure of the transform units, and also capable
   of increasing the flexibility in selecting a transform size.
   [0053]
           First,  structures of an    image coding apparatus and          an image
 5 decoding apparatus are described.
   [0054]
           FIG.   2 is a block diagram of the image coding apparatus 100
   according to the present embodiment.          The image coding apparatus 100
   codes, for example, audio data and video data at a low bit-rate.
10 [0055]
           The image coding apparatus 100 shown in FIG. 2 codes an input
   image signal 101 to generate a coded signal 191.              The image coding
   apparatus 100 includes a subtractor 110, a transforming unit 120,                a
   quantization    unit 130,   an  inverse    quantization   unit 140,    an  inverse
15 transforming unit 150, an adder 160, a memory 170, a prediction unit 180,
   and an entropy coding unit 190.
   [0056]
           Here, a picture (in other words, frame) is split into a plurality of
   Coding Units (CU)      to be coded.     Each picture is therefore coded on a
20 CU-by-CU     basis.    Each of the CUs is further split into one or more
   Transform Units (TU).
   [0057]
           The subtractor 110 splits an input image signal 101 into a plurality of
   CUs.   Then, for each of the CUs, the subtractor 110 subtracts a prediction
25 signal 181 from the input image signal 101 to generate a prediction error
   signal 111 (transform input signal), and provides the generated prediction
   error signal 111 to the transforming unit 120.
   [0058]
           The transforming unit 120 splits a CU into one or more TUs.          Then,
30 for each of the TUs, the transforming unit 120 performs frequency transform
   on a corresponding prediction error signal 111 to generate a transform
   output signal 121.     More specifically, the transforming unit 120 transforms,
   from a temporal-spatial domain to a frequency domain, the prediction error
   signal 111 or the transform input signal generated by performing certain
35 processing on the prediction error signal 111.      As a result, the transforming
   unit 120 generates the transform output signal 121 having decreased
                                            17

   correlation.
   [0059]
           The quantization unit 130 quantizes the transform output signal 121
   for each of the TUs, thereby generating a quantization coefficient 131
 5 having a small total amount of data.
   [0060]
           The entropy coding unit 190 codes the quantization coefficient 131
   by using an entropy coding algorithm, thereby generating a coded signal
   191 having further compressed redundancy.
10 [0061]
           For each of the TUs, the inverse quantization unit 140 inversely
   quantizes the quantization coefficient 131 to generate a decoded transform
   output signal 141.    For each of the TUs, the inverse transforming unit 150
   inversely transforms the decoded transform output signal 141 to generate a
15 decoded transform input signal 151.
   [0062]
           For each of the CUs, the adder 160 adds the decoded transform input
   signal 151 with a prediction signal 181 to generate a decoded signal 161.
   The memory 170 stores the decoded signal 161.
20 [0063]
           For each of the CUs, the prediction unit 180 obtains a predetermined
   signal from the memory 170 according to a prediction method such as intra
   prediction or inter prediction,     and generates a prediction signal    181
   according to a predetermined method based on the prediction method.
25 More specifically, the prediction unit 180 determines the prediction method
   to achieve a maximum coding efficiency, and generates the prediction signal
   181 according to the determined prediction method.          Furthermore, the
   entropy coding unit 190 performs entropy coding on the information
   indicating the prediction method, as needed.
30 [0064]
           Here, the inverse quantization unit 140, the inverse transforming
   unit 150, the adder 160, the memory 170, and the prediction unit 180 are
   included also in the image decoding apparatus.       The decoded signal 161
   corresponds to a reproduced image signal (decoded signal 261) generated
35 by the image decoding apparatus.
   [0065]
                                          18

           FIG. 3 is a block diagram of the image decoding apparatus.       The
   image decoding apparatus 200 shown in FIG. 3 decodes a coded signal 191
   to generate a decoded signal 261.       The image decoding apparatus 200
   includes an inverse quantization unit 240, an inverse transforming unit 250,
 5 an adder 260, a memory 270, a prediction unit 280, and an entropy
   decoding unit 290.
   [0066]
          The entropy decoding unit 290 performs entropy decoding on the
   coded signal 191 to generate a quantization coefficient 231 and a prediction
10 method 291.
   [0067]
           For each of TUs,     the inverse quantization     unit 240  inversely
   quantizes the quantization coefficient 231 to generate a decoded transform
   output signal 241.    The inverse transforming unit 250 inversely transforms
15 the decoded transform output signal 241 to generate a decoded transform
   input signal 251.
   [0068]
           For each of CUs, the adder 260 adds the decoded transform input
   signal 251 with a prediction signal 281 to generate a decoded signal 261.
20 The decoded signal 261 is a reproduced image generated by the image
   decoding apparatus 200.     The decoded signal 261 is outputted as an output
   signal of the image decoding apparatus 200, and also stored into the
   memory 270.
   [0069]
25         For each of the CUs, the prediction unit 280 obtains a predetermined
   signal from the memory 270 according to the prediction method 291, and
   generates a prediction signal 281 according to a predetermined method
   based on the prediction method 291.
   [0070]
30         Hereinafter, the quantization coefficients 131 and 231 are referred
   to also as "transform coefficients" or "block transform coefficients".
   [0071]
          According to the present embodiment, in order to flexibly select a
   transform size from among various transform sizes ranging from large to
35 small, splitting to Transform Units (TUs) is expressed in a tree structure.
   In the tree structure, in order to define nodes up to nodes at the ends (leaf
                                          19

   nodes), transform unit split information (TUS: splittransform_flag) that is
   flag information indicating whether or not TU splitting is to be performed is
   coded.
   [0072]
 5          Each of FIGS. 4A and 4B shows an example of TUs.      For example, as
   shown in FIG. 4, a single CU (TUO) can be split into four TUs that are TU1 to
   TU4.     Each of the TU1 to TU4 can be further split into four TUs.        For
   example, in the example shown in FIG. 4B, the TU1 shown in FIG. 4A is
   further split into four TUs that are TU5 to TU8.   As described above, the TU
10 splitting is hierarchically performed.
   [0073]
            FIG. 5 is a diagram showing a tree structure of the TUs shown in FIG.
   4B.    As shown in FIG. 5, a root of the tree structure is the CU (TUO).  The
   leaf nodes in the tree structure are the respective split TUs.
15 [0074]
            Each of the nodes in the tree structure has split information (TUS).
   In other words, a TUS corresponds to a corresponding one of the nodes in
   the tree structure, and indicates whether or not a TU corresponding to the
   node is to be further split.       A value "1" of a TUS means that a TU
20 corresponding to the node is to be further split.   On the other hand, a value
   "0" of a TUS means that the TU corresponding to the node is not to be split.
   [0075]
           The leaf node indicating a TUS as "0" further has a CBF indicating
   whether or not there is a transform coefficient (coeff) corresponding to the
25 leaf node.     A value "1" of a CBF means that the node has the transform
   coefficient.    On the other hand, a value "0" of a CBF means that the node
   does not have a transform coefficient.     It should be noted that a CBF may
   be included in nodes except the leaf nodes, which will be described later in
   more detail.     In other words, a CBF corresponds to at least one of nodes in
30 the tree structure, and is the first flag indicating whether there is a
   quantization coefficient 131 corresponding to the node.
   [0076]
            FIG. 6 is a flowchart of an image coding method according to the
   present embodiment.        FIG. 6 shows coding of a single CU.
35 [0077]
            First, the image coding apparatus 100 (entropy coding unit 190)
                                          20

   codes a tree structure (split information tree: transformsplit-tree) of TUSs
   as information indicating which transform size is to be performed on the CU
   (S111).    More specifically, the image coding apparatus 100 codes, in to a
   tree structure, pieces of management information (TUS and CBF) indicating
 5 a structure of a plurality of transform units.
   [0078]
           Next, the image coding apparatus 100 codes the tree structure
   (transform coefficient tree: transformcoefftree) of transform coefficients
   including transform     coefficients of respective TUs,     according   to the
10 transform sizes, the pieces of position information, and CBFs which are
   expressed in the split information tree (S112).    The above-described series
   of processes are performed on each of CUs.
   [0079]
           The use of such tree structure expression can set a size of a
15 transform size spatially or partially in a CU, so as to achieve a maximum
   coding efficiency depending on features and the like of image.      Note that a
   CBF may be coded at Step S112 not at Step S111.
   [0080]
           The following describes coding (S111) of the split information tree.
20 FIG. 7 is a flowchart of detailed steps in the coding (5111) of a split
   information tree.
   [0081]
           The coding of a split information tree is recursively defined.     The
   recursive level (hierarchy) of the tree structure is called a Transform Depth
25 (TrD).
   [0082]
           First, the image coding apparatus 100 codes a TUS of a certain TrD
   (S121).     Next, the image coding apparatus 100 switches processing to
   another according to the method of generating a prediction signal (S122).
30 For example, if inter prediction (inter-picture prediction) is adopted, a data
   amount of a transform coefficient of chrominance signal is likely to be zero.
   Therefore, in the case where inter prediction is adopted (Yes at S122), then
   the image coding apparatus 100 codes cbfchroma that is the third flag
   indicating whether or not a transform coefficient of a block of chrominance
35 signal exists (S123).
   [0083]
                                          21

           Note that TUS may be exchanged with cbfchroma in the coding
   order.    If cbfchroma is coded prior to a TUS,             the image decoding
   apparatus 200 obtains TUS information from a coded stream (coded signal
   191), so as to minimize a wait time until it is determined (S124) based on
 5 the TUS whether or not next splitting is to be performed.       Thereby, if a TUS
   is stored in a high-speed cash memory or the like, it is possible to reduce a
   memory amount and increase a processing speed.
   [0084]
           Referring back to FIG. 7, the description continues.     Next, the image
10 coding apparatus 100 determines based on the TUS whether or not a current
   TU is to be further split into pieces (S124).     If the TU is to be split (Yes at
   S124), then the image coding apparatus 100 spatially splits the TU into four
   regions, and recursively codes the split information tree for the split regions
   (S129).     In other words, the image coding apparatus 100 performs the
15 processing (S111) shown in FIG. 7 on each of the split four TUs.
   [0085]
           On the other hand, if the TU is not to be split (No at S124), then the
   image coding apparatus       100 codes cbfluma that is the second flag
   indicating whether or not a transform coefficient of luminance signal of the
20 current TU exists (S125).
   [0086]
           Next, the image coding apparatus 100 determines whether or not the
   prediction method used for the TU (CU)      is inter prediction (S126).       If the
   inter prediction is used (Yes at S126), then the image coding apparatus 100
25 terminates the coding (S111) of the split information tree for the current
   node.    On the other hand, if the inter prediction is not adopted (for example,
   intra prediction (intra-picture prediction) is adopted) (No at S126), then the
   image coding apparatus 100 codes cbfchroma (S127), and terminates the
   coding   (S111)    of the split information      tree   for the   node.     If   the
30 above-described processing is recursive processing for a lower level in the
   hierarchy, the processing shifts to another processing for an upper level of
   a recursive call (a parent node of the current node in the tree structure).
   [0087]
           Then, if transform sizes and CBFs are expressed for all of the regions
35 in the CU, the coding (S111) of the split information tree is completed.
   [0088]
                                           22

           Next, the coding (S112) of a transform coefficient tree is described.
   FIG. 8 is a flowchart of the coding (S112) of a transform coefficient tree.
   [0089]
           The coding of a split information tree is recursively defined.     The
 5 processing for coding a transform coefficient tree at a certain recursive level
   depends on whether a previously coded TUS is true or false (S131).          If a
   TUS is true (Yes at S131), then the image coding apparatus 100 splits the
   TU into four pieces, and recursively codes the transform coefficient tree for
   the split regions (S136).
10 [0090]
           On the other hand, if the TU is not to be split (No at S131), then the
   processing is changed according to whether a previously coded cbfluma is
   true or false (S132).      If cbfluma is true (Yes at S132), then the image
   coding apparatus 100 codes a transform coefficient of luminance signal of
15 the TU (S133).      On the other hand, if cbfluma is false (No at S132), then
   the image coding apparatus 100 does not code the transform coefficient of
   the luminance signal of the TU.
   [0091]
           Next, the processing is changed depending on a previously coded
20 cbfchroma (S134).        If cbfchroma is true (Yes at S134), then the image
   coding apparatus 100 codes a transform coefficient of chrominance signal of
   the current CU (S135).        On the other hand, if cbfchroma is false (No at
   S134), then the image coding apparatus 100 does not code the transform
   coefficient of the chrominance signal of the current TU.
25 [0092]
           As described above, the processing for a certain leaf node is
   completed.     If the above-described processing is recursive processing for a
   lower level, the processing shifts to another processing for an upper level of
   a recursive call (a parent node of the current node in the tree structure).
30 [0093]
           Then, when traverse (search or circuit) of the TUS tree structure is
   completed for all of the regions in the current CU and therefore transform
   coefficients of TUs each having a CBF that is true have been coded, the
   coding (S112) of a transform coefficient tree is completed.
35 [0094]
           Note that, in the flow described with reference to FIGS. 6, 7, and 8,
                                           23

   if "coding" is replaced by "decoding", a flow of decoding performed by the
   image    decoding apparatus 200      (entropy   decoding   unit 290)    can  be
   obtained.
   [0095]
 5         Note also that the above-described        procedure is not only the
   procedure for coding or decoding, but also the order of arranging data of the
   coded signal 191.      More specifically, in the coded signal 191, pieces of
   coded data (TUS, CBF, and transform coefficient) are arranged in the same
   order   as the    above-described   procedure.      The  same   goes   for the
10 subsequent embodiments.
   [0096]
           FIG. 9 is a block diagram of an entropy decoding unit 290A that is an
   example of the entropy decoding unit 290 included in the image decoding
   apparatus 200.     The entropy decoding unit 290A includes a branching unit
15 311, a split information tree decoding unit 312, a TUS memory 313, a CBF
   memory     314,   a transform coefficient tree decoding     unit 315,    and  a
   transform coefficient decoding unit 316.
   [0097]
           The branching unit 311 (DeMux unit) selectively outputs a signal
20 according to a type of the coded signal 191.            More specifically, the
   branching unit 311 provides the split information tree decoding unit 312
   with coded management information 321 included in the coded signal 191.
   The coded management information 321 includes a coded TUS and a coded
   CBF.
25 [0098]
           The split information tree decoding unit 312 decodes the coded
   management information 321 to obtain the TUS and the CBF.           The TUS is
   stored in the TUS memory 313 that is a temporary memory.        In other words,
   all of TUSs in a current CU are temporarily stored in the TUS memory 313.
30 In addition, the CBF is stored into the CBF memory 314 that is a temporary
   memory.     In other words, all CBFs in a current CU are temporarily stored in
   the CBF memory 314.
   [0099]
           After a TUS and a CBF have been decoded, the branching unit 311
35 provides the transform coefficient tree decoding unit 315 with the coded
   transform coefficient 322 included in the coded signal 191.
                                          24

   [0100]
          The transform coefficient tree decoding unit 315 reads a TUS from
   the TUS memory 313, and searches the tree structure for a node according
   to the TUS.   Then, the transform coefficient tree decoding unit 315 reads a
 5 CBF of the corresponding node from the CBF memory 314, and associates
   the coded transform coefficient with a transform unit having a CBF that is
   true.
   [0101]
          The transform     coefficient decoding unit 316 performs        entropy
10 decoding on the coded transform coefficient 322 for each TU, thereby
   generating a transform coefficient (quantization coefficient 231).
   [0102]
          As described above, each of the image coding apparatus 100 and the
   image decoding apparatus 200 according to the present embodiment uses
15 the management information having the tree structure, thereby reducing an
   overhead of the management information.          In other words, each of the
   image coding apparatus 100 and the image decoding apparatus 200 can
   suppress increase of information indicating a structure of transform units,
   and also increase a flexibility in selecting a transform size.
20 [0103]
           Furthermore, each of the image coding apparatus 100 and the image
   decoding apparatus 200 uses two tree structures that are a split information
   tree and a transform coefficient tree.    As described above, it is possible to
   independently perform processing speed optimization and the like for each
25 of the tree structures.
   [0104]
           (Embodiment 2)
           In Embodiment 1, the two tree structures are used.     In Embodiment
   2, however, one tree structure is used to code management information and
30 transform coefficients.
   [0105]
          The     following     describes     a     difference    between      the
   previously-described Embodiment 1 and Embodiment 2, with reference to
   FIGS. 10A and 10B.      FIG. 10A is a diagram showing an arrangement of
35 coded management information and coded transform coefficients which are
   included in a coded signal 191 according to Embodiment 1         FIG. 10B is a
                                          25

   diagram showing an arrangement of coded management information and
   coded transform coefficients which are included in a coded signal 191
   according to Embodiment 2.           The data shown in each of FIGS. 10A and 10B
   corresponds to the tree structure shown in FIG. 5.
 5 [0106]
           As shown in FIG.           10A,  according to Embodiment          1, pieces of
   management        information      included   in a division information tree are
   arranged in succession, and transform coefficients included in a transform
   coefficient    tree    are   arranged     in  another    group.    In    other  words,
10 management information and a transform coefficient of the same TU are
   arranged in separated positions.           Therefore, it is necessary to temporarily
   store, into the memory, management information which is decoded prior to
   a transform coefficient.
   [0107]
15         According to Embodiment 2,              on the other hand,       a single tree
   structure is used to arrange both management information and a transform
   coefficient are arranged in succession for each of leaf nodes in the tree
   structure.      Therefore,     it is possible to reduce a data amount to be
   temporarily stored in the memory.
20 [0108]
           The following describes a coding method according to the present
   embodiment.           In   the    following     description,   the   difference   from
   Embodiment 1 is mainly described and the overlapping explanation is not
   given.    Furthermore, the same reference numerals are assigned to the
25 identical elements and steps in the drawings.
   [0109]
           FIG. 11 is a flowchart of coding performed by the image coding
   apparatus 100 according to the present embodiment.                 The image coding
   apparatus 100 codes management information                   (TUS   and CBF)     and a
30 transform coefficient by using a single transform unified tree.
   [0110]
           First, the image coding apparatus 100 codes a TUS of a certain TrD
   (S121).    Next, the processing is changed to another according to the TUS
   (S131).    If the TUS is true (Yes at S131), then the image coding apparatus
35 100 spatially splits the TU into four regions, and recursively codes a
   transform unified tree for the split regions (S141).
                                                26

   [0111]
           On the other hand, if the TUS is false (No at S131), then the image
   coding apparatus 100 does not split the TU.       In other words, the node is a
   leaf node.      Here, the processing is changed to another according to
 5 whether cbfluma coded in the transform           unified tree is true or false
   (S132).
   [0112]
           If cbfluma is true (Yes at S132), then the image coding apparatus
   100 codes a transform coefficient of luminance signal of the current TU
10 (S133).    On the other hand, if cbfluma is false (No at S132), then the
   image coding apparatus 100 does not code the transform coefficient of the
   luminance signal of the TU.
   [0113]
           Next, the processing is changed according to whether cbfchroma is
15 true or false (S134).    If cbfchroma is true (Yes at S134), then the image
   coding apparatus 100 codes a transform coefficient of chrominance signal of
   the current CU (S135).        On the other hand, if cbfchroma is false (No at
   S134), then the image coding apparatus 100 does not code the transform
   coefficient of the chrominance signal of the current TU.
20 [0114]
           As described above, the processing for a certain leaf node is
   completed.     If the above-described processing is recursive processing for a
   lower level in the hierarchy, the processing shifts to processing for an upper
   level of a recursive call (a parent node of the current node in the tree
25 structure).
   [0115]
           Then, if transform sizes, CBFs, and the like of all of the regions in the
   current CU and the transform coefficients are coded, the coding of the
   transform unified tree is completed.
30 [0116]
           Embodiment 2 differs from Embodiment 1 in that the tree structure
   includes pieces of management information and transform coefficients at
   the leaf nodes.     Embodiment 1 needs two processes for the tree structures,
   which are coding of the two tree structures (split information tree and
35 transform    coefficient    tree)   and  traverse    of the    tree  structures.
   Embodiment 2, on the other hand, needs one process for the tree structure
                                           27

   in the coding method.    Therefore, Embodiment 2 can reduce steps included
   in the image coding apparatus, the image decoding apparatus, the image
   coding method, and the image decoding method.
   [0117]
 5         As described above, according to the present embodiment, the
   image coding apparatus 100 codes, into a single tree structure, pieces of
   management information and quantization coefficients 131 which indicate a
   structure of a plurality of TUs.   Here, each of the TUs corresponds to a
   corresponding one of the leaf nodes in the tree structure.     In addition, the
10 image coding apparatus 100 codes, for each of the leaf nodes, management
   information and a quantization coefficient 131 which correspond to the leaf
   node, and generates a coded signal 191 in which the coded management
   information   and   the  coded   quantization   coefficient are   arranged    in
   succession.
15 [0118]
           Moreover, the image decoding apparatus 200 decodes the coded
   signal 191 to obtain respective quantization coefficients 231 of the TUs and
   pieces of management information (TUS and CBF) indicating the structure
   of the TUs.      Here,  the pieces of management         information and    the
20 quantization coefficients 231 form a single tree structure.      Here, each of
   the TUs corresponds to a corresponding one of the leaf nodes in the tree
   structure.   Then, for the coded signal 191, the image decoding apparatus
   200 decodes, for each of the leaf nodes, a coded management information
   and a coded quantization coefficients which are arranged in succession for
25 the leaf node.
   [0119]
           Each of FIGS. 12A and 12B is a flowchart of processing performed on
   a CBF and a transform coefficient of chrominance signal.       The processing
   shown in each of FIGS. 12A and 12B is included in the flowchart of FIG. 11.
30 [0120]
           The image coding apparatus 100 codes cbfchroma at a certain stage
   in the transform unified tree (S123).    If cbfchroma is true (Yes at S134),
   then the image coding apparatus 100 codes a transform coefficient of
   chrominance signal of the current CU (S135).
35 [0121]
           For the sake of simplicity in the description,         Cb  and   Cr of
                                         28

   chrominance are not distinguished from each other in FIG. 12A.       In practice,
   Cb is distinguished from Cr as shown in FIG. 12B.
   [0122]
           As shown in FIG. 12B, at a certain stage in the transform unified tree,
 5 the image coding apparatus 100 codes cbfcb that is the third flag indicating
   whether there is a transform coefficient of chrominance Cb (S123A).           In
   addition, at a certain stage in the transform unified tree, the image coding
   apparatus 100 codes cbfcr that is the fourth flag indicating whether or not
   there is a transform coefficient of chrominance Cr (S123B).        After that, if
10 cbfcb is true (Yes at S134A), then the image coding apparatus 100 codes
   the transform coefficient of the chrominance Cb of the current CU (S135A).
   On the other hand, if cbfcr is true (Yes at S134B), then the image coding
   apparatus 100 codes the transform coefficient of the chrominance Cr of the
   current TU (S135B).
15 [0123]
           FIG. 13 is a block diagram of an entropy decoding unit 290B that is
   an example of the entropy decoding unit 290 included in the image decoding
   apparatus 200 according to Embodiment 2.           The entropy decoding unit
   290B includes a transform unified tree decoding unit 317 and a transform
20 coefficient decoding unit 316.
   [0124]
           From   among the coded signal 191,        the coded TUS,      CBF,  and
   transform coefficient, namely, the coded signals included in the transform
   unified tree, are provided to the transform unified tree decoding unit 317.
25 The transform unified tree decoding unit 317 decodes a TU transform unit
   size and a position according to the TUS tree structure.       In addition, the
   transform unified tree decoding unit 317 decodes a CBF as needed, and
   outputs a coded transform coefficient of a TU if the CBF is true.
   [0125]
30         The transform    coefficient decoding   unit 316     performs entropy
   decoding on the coded transform coefficient provided from the transform
   unified tree decoding unit 317, thereby generating a transform coefficient
   (quantization coefficient 231).
   [0126]
35         The entropy decoding unit 290B shown in FIG. 13 differs from the
   entropy decoding unit 290A shown in FIG. 9 in that the TUS memory 313 and
                                          29

   the CBF memory 314 are not required.             As described above, the image
   decoding apparatus 200 according to the present embodiment can reduce a
   memory size.
   [0127]
 5          Note that the image coding apparatus 100 can eliminate coding of
   flags such as cbfchroma, cbfluma, cbfcb, and cbfcr under certain
   conditions.    It is thereby possible to reduce a data amount of the coded
   signal 191.    The following describes the processing with reference to FIGS.
   14A to 14D.
10 [0128]
            FIG. 14A is a diagram for explaining a normal case where a CBF flag
   is coded for each of four split regions.          FIG. 14B is a diagram of one
   example where coding is eliminated.          Here, it is known that any of these
   four blocks has a transform coefficient.        In this case, if CBFs of blocks at
15 the upper left, at the upper right, and at the lower left are all "0", then a CBF
   of a block at the lower right should be "1".            This is apparent without
   reference to a CBF flag of the block at the lower right.      Therefore, coding of
   the CBF flag of the block at the lower right can be eliminated.
   [0129]
20          FIG. 14C is a diagram of another example, showing four blocks at a
   certain TrD = d and a block TrD = d - 1 at a level that is upper than the level
   of the four blocks.     If a CBF is "1" for the upper-level block TrD = d - 1, at
   least one of the blocks TrD          = d that are generated       by splitting the
   upper-hierarchy block and are at a lower level has a transform coefficient.
25 In other words, in this case, one of the blocks at the lower level TrD = d has
   a CBF = 1.    In this case, like the above case, if CBFs of blocks at the upper
   left, at the upper right, and at the lower left are all "0", then a CBF of a block
   at the lower right should be "1".      Therefore, coding of the CBF of the block
   at the lower right can be eliminated.
30 [0130]
            Likewise,   FIG.   14D   is a diagram      showing   an  example    where
   cbfchroma is first coded to cause cbfluma to depend on the coded
   cbfchroma.       For cbfluma of the four blocks at TrD = d, if pieces of
   cbfluma of all blocks at the upper left, at the upper right, and at the lower
35 left are "0" and pieces of cbfchroma (cbfcb and cbf-cr) of two blocks at an
   upper level are "0", it is sure that cbfluma of the last block is "1".
                                             30

   Therefore, coding of cbfluma of the block can be eliminated.
   [0131]
           As described above, there is a case where a CBF flag can be
   eliminated.     In  the  present embodiment,      it is possible to combine
 5 eliminations under such conditions in coding or decoding a CBF flag.
   [0132]
           As described above, the image coding apparatus 100 determines
   whether or not a value of a CBF flag of a current node at a current level can
   be uniquely identified by at least one of (a) a CBF flag at an upper level and
10 (b) CBF flags of different nodes at the current level.  If the value of the CBF
   flag of the current node can be uniquely identified, the CBF flag of the
   current node is not coded.      Furthermore, the image decoding apparatus
   200 determines whether or not a value of a CBF of a current node at a
   current level can be uniquely identified by at least one of (a) a CBF flag at
15 an upper level and (b) CBF flags of different nodes at the current level.     If
   the value of the CBF of the current node can be uniquely identified, the CBF
   flag of the current node is not decoded.
   [0133]
           Thus, the image coding apparatus 100 according to the present
20 embodiment codes (a)        management information indicating a size of a
   transform unit, a position, and the like and (b) a transform coefficient into
   a single tree structure.     The image coding apparatus 100 and the image
   decoding apparatus 200 can thereby reduce a data amount in a used
   memory and reduce steps in processing.
25 [0134]
           Note that, in the flow described with reference to FIGS. 11, 12A, and
   12B, if "coding" is replaced by "decoding", a flow of decoding performed by
   the image decoding apparatus 200 (entropy decoding unit 290B) can be
   obtained.
30 [0135]
           (Embodiment 3)
           Embodiment 3 is a variation of the above-described Embodiment 2.
   [0136]
          FIG. 15 is a flowchart of coding according to the present embodiment.
35 The same reference numerals in FIG. 11 are assigned to the identical steps
   in FIG.   15, and therefore differences between FIG. 11 and FIG. 15 are
                                          31

   mainly described.
   [0137]
           After Step S121,      the image coding apparatus         100 determines
   processing according to a method of generating a prediction signal (S122).
 5 More specifically, if inter prediction is adopted (Yes at S122), then the
   image coding apparatus 100 codes cbfchroma (S123).
   [0138]
           Next, the image coding apparatus 100 determines based on a TUS
   whether or not a current TU is to be further split into pieces (S124).       If the
10 TU is to be split (Yes at S124), then the image coding apparatus 100
   spatially split the TU into four regions, and recursively codes a transform
   unified tree for the split regions (S141).
   [0139]
           On the other hand, if the TU is not to be split (No at S124), then the
15 image coding apparatus 100 codes cbf luma (S125).                Next, the image
   coding apparatus 100 determines whether or not the prediction method
   used for the TU (CU)    is inter prediction (S126).     If inter prediction is not
   used (for example, if intra prediction is adopted) (No at S126), then the
   image coding apparatus 100 codes cbfchroma (S127).                The processing
20 from Step S132 is the same as the processing in FIG. 11.
   [0140]
           As described above, in the image coding method according to the
   present embodiment, if inter prediction is adopted for a current CU, then
   cbfchroma at the highest level of hierarchy is coded, and if the intra
25 prediction is adopted, cbfchroma at a leaf node is coded.
   [0141]
           Here, inter prediction is unlikely to cause a transform coefficient.     In
   particular, inter prediction is unlikely to cause a transform coefficient of
   chrominance signal.     Therefore, if inter prediction is adopted, coding of
30 cbfchroma prior to TU splitting is more efficient than coding of cbfchroma
   after TU splitting.   On the other hand, intra prediction is likely to cause a
   transform coefficient. Therefore, coding prior to TU splitting produces little
   improvement      of a coding     efficiency.    Therefore,    the  image   coding
   apparatus 100 codes cbfchroma at leaf nodes after TU splitting.
35 [0142]
           Thus, the image coding apparatus 100 according to the present
                                            32

   embodiment can reduce a data amount of CBFs.
   [0143]
            Note that, in the flow described with reference to FIG. 15, if "coding"
   is replaced by "decoding", a flow of decoding performed by the image
 5 decoding apparatus 200 can be obtained.
   [0144]
            (Embodiment 4)
            Embodiment 4 is a variation of the above-described Embodiment 3.
   [0145]
10         FIG. 16 is a flowchart of coding according to the present embodiment.
   The same reference numerals in FIG. 15 are assigned to the identical steps
   in FIG.    16, and therefore differences between FIG. 15 and FIG. 16 are
   mainly described.
   [0146]
15         As described in Embodiment 3, a tendency of having a transform
   coefficient and the like heavily depends on whether a prediction method is
   inter prediction or non-inter prediction (intra prediction).    In particular, if
   intra   prediction is adopted,     a great number of intra predictions and
   transforms are necessary for small blocks.          In order to address this,
20 decrease of steps in intra prediction is particularly important.     Therefore,
   according to the present embodiment, processing is selected at an upper
   level of hierarchy based on whether a prediction method is inter prediction
   or intra prediction (non-inter prediction).   As a result, the processing in the
   case of inter prediction is separated from the processing in the case of intra
25 prediction.    Thereby, it is easy to optimize implementation.
   [0147]
            More specifically, as shown in FIG. 16, at the leaf nodes, cbfluma is
   coded after the determination (S126) as to whether the prediction method
   is inter prediction or non-inter prediction.        More specifically, if inter
30 prediction is not adopted (No at S126), then the image coding apparatus
   100 codes cbfluma (S125B), and codes cbfchroma (S127).             On the other
   hand, if inter prediction is adopted (Yes at S127), then the image coding
   apparatus 100 codes cbf luma (S125A).        The processing from Step S132 is
   the same as the processing in FIG. 11.
35 [0148]
           The processing for CBF is likely to be complicated with the case
                                           33

   where flags are eliminated.      On the other hand, if processing for CBF is
   switched depending on whether a prediction method is inter prediction or
   intra prediction as described above, the same effects as described above
   can be produced.
 5 [0149]
          As shown in FIG. 17, it is also possible that, if intra prediction is
   adopted    (No   at S126),   then the image coding apparatus        100 codes
   cbfchroma (S127), and then codes cbfluma (S125B).            Thereby, an order
   of coding cbf-chroma and cbfluma is the same between the case using
10 inter prediction (S123, S125A) and the case using inter prediction (S127
   and S125B).     As described above, communalizing the processing order can
   reduce a data amount of a processing program.
   [0150]
           Note that, in the flow described with reference to FIGS. 16 and 17, if
15 "coding" is replaced by "decoding", a flow of decoding performed by the
   image decoding apparatus 200 can be obtained.
   [0151]
           (Embodiment 5)
           In Embodiment 5, an order of coding CBFs and transform coefficients
20 is described.
   [0152]
           Each of FIGS.    18A to 18C shows an order of coding CBFs and
   transform coefficients (BlockCoeff).    In other words, each of FIGS. 18A to
   18C shows an arrangement of CBFs and transform coefficients in a coded
25 signal 191.    In FIGS. 18A to 18C, each numeral value indicates a coding
   order.   In each of FIGS. 18A to 18C, the number of transform blocks of luma
   (luminance signal) is equal to the number of transform blocks of chroma
   (chrominance signal).
   [0153]
30        The coding order shown in FIG. 18A is, for instance, one example of
   the coding order according to Embodiment 1.      In FIG. 18A, cbfluma (Blk =
   0), cbf cb (Blk = 0), and cbfcr (Blk = 0) are coded in order, and then
   cbfluma (Blk = 1), cbf-cb (Blk = 1), cbf cr (Blk = 1), cbf luma (Blk = 2),
   cbfcb (Blk = 2), cbf cr (Blk = 2), cbf-luma (Blk = 3), cbf cb (Blk = 3),
35 cbfcr (Blk = 3) are coded in order.    Here, each Blk value indicates a spatial
   position of a corresponding block in a Z order.    Blk = 0 indicates a block at
                                          34

   the upper left, Blk = 1 indicates a block at the upper right, Blk = 2 indicates
   a block at the lower left, and Blk = 3 indicates a block at the lower right.
   [0154]
           Subsequent to coding all of the CBFs, BlockCoeff (luma, Blk = 0),
 5 BlockCoeff (cb, Blk = 0), and BlockCoeff (cr, Blk = 0) are coded in order.
   Next, BlockCoeff (luma, Blk = 1), BlockCoeff (cb, Blk = 1), and BlockCoeff
   (cr, Blk = 1) are coded in order.
   [0155]
           The coding order shown in FIG. 18B is, for instance, one example of
10 the coding order according to Embodiments 2 to 4.          CBFs and transform
   coefficients are coded in the same tree structure.      Therefore, a transform
   coefficient at a certain position is coded relatively immediately after coding
   a corresponding CBF.
   [0156]
15         For example, first, cbfluma (blk = 0), cbf cb (blk = 0), and cbfcr
   (blk = 0) are coded in order, and after that, BlockCoeff (luma, Blk = 0),
   BlockCoeff (cb, Blk = 0), and BlockCoeff (cr, Blk = 0), which correspond to
   the above CBFs respectively, are coded in order.           Thereby, the image
   decoding apparatus 200 can reduce a memory size for temporarily storing
20 the CBF flags.    In the image coding apparatus 100, BlockCoeff cannot be
   stored in a stream until CBFs of all blocks are determined.    Therefore, there
   is a problem that a memory size is large enough to store all BlockCoeff of
   blocks prior to a current block in the block order. This problem is reduced
   by using the processing order shown in FIG. 18B.
25 [0157]
           In FIG. 18C, immediately after coding a CBF flag, a corresponding
   transform coefficient is coded.      In this example, a size of a memory for
   temporarily storing CBFs and transform coefficients is further reduced in
   comparison to the case shown in FIG. 18B.       More specifically, cbf luma (blk
30 = 0), BlockCoeff (luma, Blk = 0), cbfcb (blk = 0), BlockCoeff (cb, Blk = 0),
   cbfcr (blk = 0), BlockCoeff (cr, Blk = 0), ... are coded in order.
   [0158]
           Next, the description is given for a coding order in the case where the
   number of transform blocks of chrominance signal is less than the number
35 of transform blocks of luminance signal.      Each of FIGS. 19A and 19B shows
   an example of the coding order in the above case.
                                           35

   [0159]
            For example, at a 4:2:0 format, the number of pixels of chrominance
   signal is a half of the number of pixels of luminance signal, in a view of a
   horizontal or vertical line of pixels.      For the transform size or an inverse
 5 transform size, a minimum size (MinTrafoSize) is defined.        More specifically,
   in the minimum size (Transform Size = MinTrafoSize), there is a case where
   four TUs can be used for luminance signal, but only one TU is allowed for
   chrominance signal.
   [0160]
10          In FIG.   19A, a transform coefficient is coded immediately after
   coding a CBF.     Blocks are sequentially coded in an order of having a smaller
   BlkIdx.    The coding order has advantages of reducing a size of a temporary
   memory because a CBF and a corresponding transform coefficient are close
   to each other in the coding order.
15 [0161]
            In FIG.   19B, first, CBFs and transform coefficients of luminance
   signal are coded, and then CBFs and transform coefficients of chrominance
   signal are coded.         This coding method has advantages of minimizing
   processes between luminance signal and chrominance signal and also
20 minimizing switch processes of a data input/output pointer.             Prediction
   processing     and   data    storing  destination  are   sometimes   considerably
   different between luminance signal and chrominance signal.           Therefore, it
   is desirable to continuously perform processes for blocks of luminance
   signal, and then continuously perform processes for blocks of chrominance
25 signal.    Here, the blocks of chrominance signal are coded after coding all of
   the blocks of luminance signal.        However, the same effects can be produced
   also when the blocks of chrominance signal are coded before coding all of
   the blocks of luminance signal.
   [0162]
30          In FIG. 19B, cbf luma (upper left), BlockCoeffluma (upper left),
   cbfluma (upper right), BlockCoeffluma (upper right), cbfluma (lower
   left),     BlockCoeffluma         (lower    left),   cbf_luma    (lower    right),
   BlockCoeffluma         (lower    right),  cbf-cb,   BlockCoeffcb,    cbfcr,    and
   BlockCoeffcr are coded in order.
35 [0163]
           FIG. 20 is a flowchart of coding according to the present embodiment.
                                              36

   FIG. 20 shows only the processing for CBFs and transform coefficients which
   is a part of the coding.        Here, four split blocks are associated with
   respective BlkIdx in a Z order.
   [0164]
 5         The series of Steps S125 to S152 in FIG. 20 are processing for coding
   CBF.    The series of Steps S125 to S123B are performed on each of the four
   split blocks.
   [0165]
           For a certain block, the image coding apparatus 100 codes cbfluma
10 (S125).    Next, the image coding apparatus 100 determines whether or not
   the number of blocks of luminance signal is equal to the number of blocks of
   chrominance      signal.    In addition,   the image    coding  apparatus    100
   determines whether or not Blkidx = 3 (S151).             In other words, it is
   determined whether or not a current TU is a last TU of the four split TUs in
15 the coding order.     If the number of blocks of luminance signal is equal to
   the number of blocks of chrominance signal, or if Blkidx = 3 (Yes at S151),
   then the image coding apparatus 100 codes cbfcb and cbf-cr (S123A and
   S123B).    For example, if TrafoSize that is a size of luminance signal block
   at a current TrD does not reach the minimum size MinTrafoSize (TrafoSize >
20 MinTrafoSize), then it is determined that the number of blocks of luminance
   signal is equal to the number of blocks of chrominance signal.         It is also
   possible that the image coding apparatus 100 uses a different method to
   determine whether or not the number of blocks of luminance signal is equal
   to the number of blocks of chrominance signal.
25 [0166]
           Even if blocks of luminance signal is less than blocks of chrominance
   signal, the image coding apparatus 100 codes cbfchroma after coding all of
   cbfluma.      In other words, in the case of splitting to four blocks, coding of
   cbfluma of the four blocks have been completed               when Blkidx = 3.
30 Therefore, the image coding apparatus 100 determines that cbfchroma is
   to be performed when Blkidx = 3.
   [0167]
           In summary, the image coding apparatus 100 codes cbfchroma
   after coding cbfluma when (Trafosize > MinTrafoSize) || (Blkidx == 3).
35 [0168]
           On the other hand, if Blkidx is not 3 (No at S152), then a next block
                                            37

   is selected to perform the processing from Step S125.
   [0169]
          The series of Steps S132 to S154 in FIG. 20 are processing for coding
   a transform coefficient.     The series of Steps S132 to 5135B are performed
 5 on each of four split blocks in the same manner as the CBF coding.
   [0170]
          The    image   coding     apparatus  100 determines      whether   or not
   cbfluma is true (S132).       If cbfluma is true (Yes at S132), then the image
   coding apparatus 100 codes a transform coefficient of luminance signal of a
10 current TU (S133).      Next, the image coding apparatus 100 performs the
   same determination as Step S151 (S153).
   [0171]
           If the determination is made as true (Yes at S153), then the image
   coding apparatus 100 determines whether cbfcb is true (S134A).                  If
15 cbfcb is true (Yes at S134A), then the image coding apparatus 100 codes
   a transform coefficient of chrominance Cb (S135A).            The image coding
   apparatus 100 determines whether or not cbfcr is true (5134B).          If cbfcr
   is true (Yes at 5134B), then the image coding apparatus 100 codes a
   transform coefficient of chrominance Cr (5135B).
20 [0172]
           Note that, in the flow described with reference to FIG. 20, if "coding"
   is replaced by "decoding", a flow of decoding performed by the image
   decoding apparatus 200 can be obtained.            Furthermore, in the coding
   orders described with reference to FIG. 18A to 18C, FIG. 19A and 19B, if
25 "coding" is replaced by "decoding", a decoding order of decoding coded
   pieces of data can be obtained.
   [0173]
           Each of FIGS. 21A and 21B shows an example where CBFs and
   transform coefficients of chrominance signal are coded prior to CBFs and
30 transform coefficients of luminance signal.       As described above, in inter
   prediction, cbfchroma is sometimes coded before cbfluma.             Therefore, if
   blocks of chrominance signal are coded earlier, it is possible to cause an
   order of processing cbf chroma and cbfluma to be the same between inter
   prediction and intra prediction.      As a result, it is possible to simplify the
35 flows of the processing performed by the image coding apparatus 100 and
   the image decoding apparatus 200.
                                            38

   [0174]
           (Embodiment 6)
           Embodiment 6 is a variation of the above-described Embodiment 3.
   In the image coding method according to the present embodiment, a
 5 difference quantization parameter (AQP) is coded.          AQP is information
   indicating   a   difference    between    a    quantization    step    used   in
   immediately-prior quantization and a quantization step used in quantization
   of a current transform unit.
   [0175]
10         Each of FIGS. 22A and 22B is a flowchart of coding according to the
   present embodiment.      The following describes mainly differences from FIG.
   15.
   [0176]
           AQP is coded after coding all CBFs.      More specifically, the image
15 coding apparatus 100 codes AQP after coding cbfchroma (S123 or S127)
   and coding cbf luma (S125), and before coding a transform coefficient
   (S133 and S135) (S161).
   [0177]
           As described above, the image coding apparatus 100 codes AQP at a
20 current leaf node in a tree structure, and arranges the coded AQP at a
   position corresponding to the current leaf node of the coded signal 191.
   Furthermore, at the leaf node, the image decoding apparatus 200 decodes
   the coded AQP which is arranged at the position corresponding to the leaf
   node in the tree structure of the coded signal 191.
25 [0178]
           Here, the image decoding apparatus 200 may decode a transform
   coefficient, and immediately at the same perform inverse quantization
   immediately, by using pipeline parallel processing.    In this case, the coding
   of AQP in the above-described coding order to determine a quantization
30 parameter does not occur unnecessary delay or memory increase.
   [0179]
           In a certain coding unit CU, AQP is coded only once in a TU where
   cbfluma and cbfchroma are first true.        If AQP is updated more often, a
   coding amount is increased too much.
35 [0180]
           FIG. 22B is a flowchart of a coding method in the case where AQP is
                                          39

   coded at a root of the tree structure of TUs.      As shown in FIG. 22B, the
   image coding apparatus 100 codes the root of the tree structure of TUs
   (S161).
   [0181]
 5         As described above, the image coding apparatus 100 codes AQP at a
   root of the tree structure, and arranges the coded difference quantization
   step at a position corresponding to the root of the coded signal 191.       In
   addition, the image decoding apparatus 200 decodes, at the root, the coded
   difference quantization step that is arranged at the position at the root of
10 the tree structure of the coded signal 191.
   [0182]
           In this case, the image decoding apparatus 200 can determine, at an
   earlier stage, a quantization parameter required by the inverse quantization
   unit 240.     Therefore, the image decoding apparatus 200 can perform
15 activation of the inverse quantization unit 240 early.      The image coding
   apparatus 100 does not code AQP always.             AQP is coded only when
   noreisidualdata is true for each coding unit CU.          As a result, a data
   amount can be reduced.       noresidualdata is a flag indicating that there is
   no transform coefficient in a current CU.     This noresidualdata is coded
20 prior to the first TUS in a current CU.
   [0183]
           Note that, in the flow described with reference to FIGS. 22A and 22B,
   if "coding" is replaced by "decoding", a flow of decoding performed by the
   image decoding apparatus 200 can be obtained.
25 [0184]
           Each of FIGS. 23 and 24A to 24C shows an example of syntax of HEVC
   corresponding to Embodiment 6.
   [0185]
           (Embodiment 7)
30         Embodiment 7 is a variation of the above-described Embodiment 3.
   [0186]
           Each of FIGS. 25A and 25B is a flowchart of coding performed by the
   image coding apparatus 100 according to the present embodiment.
   [0187]
35         In the coding in FIGS. 25A and 25B, the coding of a transform
   coefficient shown in FIG.      15 (S132   to S135)    is extracted as unified
                                          40

   transform (transformunifiedunit) (S171) that is one of subroutines.            In
   the same manner as described in the previous embodiments, the present
   embodiment also produces effects of reducing an amount of a memory for
   temporarily storing information of CBFs and TUSs, simplifying steps in the
 5 processing, and decreasing the number of traverses.          It is also possible
   that the series of Steps S125 to S127 are included in the unified transform.
   In this case, the subroutine corresponds to the processing for a leaf node in
   the tree structure of TUs.    Furthermore, AQP may be coded in the unified
   transform.    In addition to the substantially same effects, the provision of
10 the subroutine can produce further effects of power saving in design by
   separating the steps and test reduction.
   [0188]
           Although only some exemplary embodiments of the image coding
   apparatus and the image decoding apparatus according to the present
15 invention have been described in detail above, the present invention is not
   limited to these embodiments.
   [0189]
           Note also that processing units in each of the image coding apparatus
   and the image decoding apparatus according to the above embodiments are
20 typically implemented into a Large Scale Integration (LSI)           which is an
   integrated circuit.   These may be integrated separately, or a part or all of
   them may be integrated into a single chip.
   [0190]
           Note also that the technique of integrated circuit is not limited to the
25 LSI, and it may be implemented as a dedicated circuit or a general-purpose
   processor.    It is also possible to use a Field Programmable Gate Array
   (FPGA)    that can   be  programmed     after manufacturing      the LSI,   or a
   reconfigurable processor in which connection and setting of circuit cells
   inside the LSI can be reconfigured.
30 [0191]
           Note also that each of the structural         elements     in the above
   embodiments      may    be  implemented     by  a    dedicated    hardware,    or
   implemented by executing a software program suitable for the structural
   element.    Each of the structural elements may be implemented when a
35 program execution unit such as a CPU or a processor reads a software
   program    recorded   on a recording medium such as a hard disk or a
                                          41

   semiconductor memory and executes the readout software program.
   [0192]
           Furthermore, the prevent invention may be software program, or
   may be a non-transitory computer-readable recording medium on which the
 5 program is recorded.       Of course, the above-described program may be
   distributed via a transmission medium such as the Internet.
   [0193]
           Furthermore, the numerals in the above description are examples for
   explaining the present invention in more detail.        The present discloser is
10 not limited to the example numerals.
   [0194]
           Moreover, the splitting of the functional blocks in the block diagrams
   are examples.     It is also possible that a plurality of functional blocks are
   implemented as one functional block, that one functional block is split into
15 a plurality of pieces, or that shifts a partial function to other functional
   blocks.    In addition, the functions of the plurality of functional blocks
   having similar functions may be performed in parallel or in time sharing by
   a common single hardware or software.
   [0195]
20         The   order    of  executing  the   steps   included   in each    of  the
   above-described image coding method and the above-described image
   decoding method is the example of explaining the present invention in more
   detail.  Therefore, different orders except the above-described order may
   be used.    A part of the steps may be executed at the same time (in parallel)
25 with other steps.
   [0196]
           Thus, although only some exemplary embodiments of the image
   coding apparatus and the image decoding apparatus according to the
   present invention      have been    described in detail    above, the    present
30 invention is not limited to these embodiments.       Those skilled in the art will
   be   readily  appreciated    that  various   modifications   of the exemplary
   embodiments and combinations of the structural elements of the different
   embodiments are possible without materially departing from the novel
   teachings and advantages of the present invention.         Accordingly, all such
35 modifications and combinations are intended to be included within the scope
   of the present invention.
                                           42

   [0197]
          (Embodiment 8)
          The processing described in each of Embodiments can be simply
   implemented    in an independent computer system,       by recording,  in a
 5 recording medium, a program for implementing the configurations of the
   moving picture coding method (image coding method) and the moving
   picture decoding method (image decoding method) described in each of
   Embodiments.     The recording media may be any recording media as long as
   the program can be recorded, such as a magnetic disk, an optical disk, a
10 magnetic optical disk, an IC card, and a semiconductor memory.
   [0198]
          Hereinafter, the applications to the moving picture coding method
   (image coding method) and the moving picture decoding method (image
   decoding method) described in each of Embodiments and systems using
15 thereof will be described.   The system has a feature of having an image
   coding and decoding apparatus that includes an image encoding apparatus
   using the image encoding method and an image decoding apparatus using
   the image decoding method.      Other configurations in the system can be
   changed as appropriate depending on the cases.
20 [0199]
          FIG. 26 illustrates an overall configuration of a content providing
   system ex100 for implementing content distribution services.   The area for
   providing communication services is divided into cells of desired size, and
   base stations ex106, ex107, ex108, ex109, and ex110 which are fixed
25 wireless stations are placed in each of the cells.
   [0200]
          The content providing system ex100 is connected to devices, such as
   a computer ex111, a personal digital assistant (PDA)      ex112, a camera
   ex113, a cellular phone ex114 and a game machine ex115, via the Internet
30 ex101, an Internet service provider ex102, a telephone network ex104, as
   well as the base stations ex106 to ex110, respectively.
   [0201]
          However, the configuration of the content providing system ex100 is
   not limited to the configuration shown in FIG. 26, and a combination in
35 which any of the elements are connected is acceptable.    In addition, each
   device may be directly connected to the telephone network ex104, rather
                                        43

   than via the base stations ex106 to ex110 which are the fixed wireless
   stations.   Furthermore, the devices may be interconnected to each other
   via a short distance wireless communication and others.
   [0202]
 5         The camera ex113, such as a digital video camera, is capable of
   capturing video.    A camera ex116, such as a digital video camera,           is
   capable of capturing both still images and video.    Furthermore, the cellular
   phone ex114 may be the one that meets any of the standards such as Global
   System for Mobile Communications (GSM), Code Division Multiple Access
10 (CDMA),    Wideband-Code Division Multiple Access (W-CDMA),         Long Term
   Evolution (LTE), and High Speed Packet Access (HSPA).        Alternatively, the
   cellular phone ex114 may be a Personal Handyphone System (PHS).
   [0203]
           In the content providing system ex100, a streaming server ex103 is
15 connected to the camera ex113 and others via the telephone network ex104
   and the base station ex109, which enables distribution of images of a live
   show and others.    In such a distribution, a content (for example, video of a
   music live show) captured by the user using the camera ex113 is coded as
   described above in each of Embodiments (i.e., the camera functions as the
20 image coding apparatus of the present invention), and the coded content is
   transmitted to the streaming server ex103.          On the other hand, the
   streaming server ex103 carries out stream distribution of the transmitted
   content data to the clients upon their requests.      The clients include the
   computer ex111, the PDA ex112, the camera ex113, the cellular phone
25 ex114, and the game machine ex115 that are capable of decoding the
   above-mentioned coded data.       Each of the devices that have received the
   distributed data decodes and reproduces the coded data (i.e., the devices
   each function as the image decoding apparatus of the present invention).
   [0204]
30         The captured data may be coded by the camera ex113 or the
   streaming server ex103 that transmits the data, or the coding processes
   may be shared between the camera ex113 and the streaming server ex103.
   Similarly, the distributed data may be decoded by the clients or the
   streaming server ex103, or the decoding processes may be shared between
35 the clients and the streaming server ex103.      Furthermore, the data of the
   still images and video captured by not only the camera ex113 but also the
                                          44

   camera ex116 may be transmitted to the streaming server ex103 through
   the computer ex111.      The coding processes may be performed by the
   camera ex116, the computer ex111, or the streaming server ex103, or
   shared among them.
 5 [0205]
          Furthermore, the coding and decoding processes may be performed
   by an LSI ex500 generally included in each of the computer ex111 and the
   devices.   The LSI ex500 may be configured of a single chip or a plurality of
   chips.   Software for coding and decoding video may be integrated into
10 some type of a recording medium (such as a CD-ROM, a flexible disk, and a
   hard disk) that is readable by the computer ex111 and others, and the
   coding and decoding processes may be performed using the software.
   Furthermore, when the cellular phone ex114 is equipped with a camera, the
   image data obtained by the camera may be transmitted.       The video data is
15 data coded by the LSI ex500 included in the cellular phone ex114.
   [0206]
          Furthermore,   the streaming server ex103 may be composed of
   servers and    computers,   and   may decentralize data    and  process the
   decentralized data, record, or distribute data.
20 [0207]
          As described above, the clients may receive and reproduce the coded
   data in the content providing system ex100.      In other words, the clients
   can receive and decode information transmitted by the user, and reproduce
   the decoded data in real time in the content providing system ex100, so that
25 the user who does not have any particular right and equipment can
   implement personal broadcasting.
   [0208]
          Aside from the example of the content providing system ex100, at
   least one of the moving picture coding apparatus (image coding apparatus)
30 and the moving picture decoding apparatus (image decoding apparatus)
   described in each of Embodiments         may be implemented     in a digital
   broadcasting system ex200 illustrated in FIG. 27.        More specifically, a
   broadcast station ex201 communicates or transmits, via radio waves to a
   broadcast satellite ex202, multiplexed data obtained by multiplexing audio
35 data and others onto video data.      The video data is data coded by the
   moving picture coding method described in each of Embodiments (i.e., data
                                         45

   coded by the image coding apparatus of the present invention).                Upon
   receipt of the multiplexed data, the broadcast satellite ex202 transmits
   radio waves for broadcasting.        Then, a home-use antenna ex204 with a
   satellite broadcast reception function receives the radio waves.            Next, a
 5 device such as a television (receiver) ex300 and a set top box (STB) ex217
   decodes the received multiplexed data, and reproduces the decoded data
   (i.e., the device functions as the image coding apparatus of the present
   invention).
   [0209]
10          Furthermore, a reader/recorder ex218 (i) reads and decodes the
   multiplexed data recorded on a recording media ex215, such as a DVD and
   a BD, or (i) codes video signals in the recording medium ex215, and in some
   cases, writes data obtained by multiplexing an audio signal on the coded
   data.    The reader/recorder ex218 can include the moving picture decoding
15 apparatus or the moving picture coding apparatus as shown in each of
   Embodiments.        In this case, the reproduced video signals are displayed on
   the monitor ex219, and can be reproduced by another device or system
   using the recording medium ex215 on which the multiplexed data is
   recorded.     It is also possible to implement the moving picture decoding
20 apparatus in the set top box ex217 connected to the cable ex203 for a cable
   television    or to    the   antenna    ex204    for satellite  and/or   terrestrial
   broadcasting, so as to display the video signals on the monitor ex219 of the
   television    ex300.      The  moving     picture   decoding   apparatus   may    be
   implemented not in the set top box but in the television ex300.
25 [0210]
            FIG.   28 illustrates the television (receiver) ex300 that uses the
   moving picture coding method and the moving picture decoding method
   described in each of Embodiments.          The television ex300 includes: a tuner
   ex301 that obtains or provides multiplexed data obtained by multiplexing
30 audio data onto video data, through the antenna ex204 or the cable ex203,
   etc. that receives a broadcast; a modulation/demodulation unit ex302 that
   demodulates       the   received   multiplexed    data  or   modulates   data   into
   multiplexed data to be supplied outside; and a multiplexing/demultiplexing
   unit ex303 that demultiplexes the modulated multiplexed data into video
35 data and audio data, or multiplexes video data and audio data coded by a
   signal processing unit ex306 into data.
                                              46

   [0211]
           The television ex300 further includes: a signal processing unit ex306
   including an audio signal processing         unit ex304 and a video signal
   processing unit ex305 that decode audio data and video data and code audio
 5 data and video data, (which function as the image coding apparatus and the
   image    decoding apparatus),    respectively;    and   an output unit ex309
   including a speaker ex307 that provides the decoded audio signal, and a
   display unit ex308 that displays the decoded video signal, such as a display.
   Furthermore,     the  television ex300    includes   an   interface  unit ex317
10 including an operation input unit ex312 that receives an input of a user
   operation.    Furthermore, the television ex300 includes a control unit ex310
   that controls overall each constituent element of the television ex300, and
   a power supply circuit unit ex311 that supplies power to each of the
   elements.     Other than the operation input unit ex312, the interface unit
15 ex317 may include: a bridge ex313 that is connected to an external device,
   such as the      reader/recorder  ex218; a slot unit ex314 for enabling
   attachment of the recording medium ex216, such as an SD card; a driver
   ex315 to be connected to an external recording medium, such as a hard
   disk; and a modem ex316 to be connected to a telephone network.             Here,
20 the recording medium ex216 can electrically record information using a
   non-volatile/volatile semiconductor memory element for storage.              The
   constituent elements of the television ex300 are connected to each other
   through a synchronous bus.
   [0212]
25         First, the configuration in which the television ex300 decodes
   multiplexed data obtained from outside through the antenna ex204 and
   others and reproduces the decoded data will be described.                 In the
   television ex300, upon a user operation through a remote controller ex220
   and others, the multiplexing/demultiplexing unit ex303 demultiplexes the
30 multiplexed data demodulated by the modulation/demodulation unit ex302,
   under control of the control unit ex310 including a CPU.        Furthermore, the
   audio signal processing unit ex304 decodes the demultiplexed audio data,
   and the video signal processing unit ex305 decodes the demultiplexed video
   data, using the decoding method described in each of Embodiments, in the
35 television ex300.    The output unit ex309 provides the decoded video signal
   and audio signal outside, respectively.         When    the output unit ex309
                                          47

   provides the video signal and the audio signal,         the signals may be
   temporarily stored in buffers ex318 and ex319, and others so that the
   signals are reproduced in synchronization with each other.      Furthermore,
   the television ex300 may read multiplexed data not through a broadcast and
 5 others but from the recording media ex215 and ex216, such as a magnetic
   disk, an optical disk, and a SD card.     Next, a configuration in which the
   television ex300 codes an audio signal and a video signal, and transmits the
   data outside or writes the data on a recording medium will be described.   In
   the television ex300, upon a user operation through the remote controller
10 ex220 and others, the audio signal processing unit ex304 codes an audio
   signal, and the video signal processing unit ex305 codes a video signal,
   under control of the control unit ex310 using the coding method described
   in each of Embodiments.        The multiplexing/demultiplexing unit ex303
   multiplexes the coded video signal and audio signal, and provides the
15 resulting signal outside.  When the multiplexing/demultiplexing unit ex303
   multiplexes the video signal and the audio signal, the signals may be
   temporarily stored in the buffers ex320 and ex321, and others so that the
   signals are reproduced in synchronization with each other.          Here, the
   buffers ex318, ex319, ex320, and ex321 may be plural as illustrated, or at
20 least one buffer may be shared in the television ex300.    Furthermore, data
   may be stored in a buffer so that the system overflow and underflow may be
   avoided    between   the   modulation/demodulation    unit   ex302   and  the
   multiplexing/demultiplexing unit ex303, for example.
   [0213]
25         Furthermore, the television ex300 may include a configuration for
   receiving an AV input from a microphone or a camera other than the
   configuration for obtaining audio and video data from a broadcast or a
   recording   medium,    and  may code the obtained      data.    Although the
   television ex300 can code, multiplex, and provide outside data in the
30 description, it may be capable of only receiving, decoding, and providing
   outside data but not the coding, multiplexing, and providing outside data.
   [0214]
           Furthermore,   when the    reader/recorder  ex218 reads or writes
   multiplexed data from or on a recording medium, one of the television
35 ex300 and the reader/recorder ex218 may decode or code the multiplexed
   data, and the television ex300 and the reader/recorder ex218 may share
                                          48

   the decoding or coding.
   [0215]
           As an example, FIG. 29 illustrates a configuration of an information
   reproducing/recording unit ex400 when data is read or written from or on an
 5 optical disk.   The information reproducing/recording unit ex400 includes
   constituent elements ex401, ex402, ex403, ex404, ex405, ex406, and
   ex407 to be described hereinafter.      The optical head ex401 irradiates a
   laser spot in a recording surface of the recording medium ex215 that is an
   optical disk to write information, and detects reflected light from the
10 recording surface of the recording medium ex215 to read the information.
   The modulation recording unit ex402 electrically drives a semiconductor
   laser included in the optical head ex401, and modulates the laser light
   according to recorded data.      The reproduction demodulating unit ex403
   amplifies a reproduction     signal obtained   by electrically detecting the
15 reflected light from the recording surface using a photo detector included in
   the optical   head ex401, and demodulates the reproduction signal by
   separating a signal component recorded on the recording medium ex215 to
   reproduce the necessary information.      The buffer ex404 temporarily holds
   the information to be recorded on the recording medium ex215 and the
20 information reproduced from the recording medium ex215.        The disk motor
   ex405 rotates the recording medium ex215.       The servo control unit ex406
   moves the optical head ex401 to a predetermined information track while
   controlling the rotation drive of the disk motor ex405 so as to follow the
   laser spot.   The system control unit ex407 controls overall the information
25 reproducing/recording unit ex400.     The reading and writing processes can
   be implemented by the system control unit ex407 using various information
   stored in the buffer ex404 and generating and adding new information as
   necessary, and by the modulation recording unit ex402, the reproduction
   demodulating unit ex403, and the servo control unit ex406 that record and
30 reproduce information through the optical head ex401 while being operated
   in a coordinated manner.      The system control unit ex407 includes, for
   example, a microprocessor, and executes processing by causing a computer
   to execute a program for read and write.
   [0216]
35         Although the optical head ex401 irradiates a laser spot in the
   description, it may perform high-density recording using near field light.
                                         49

   [0217]
           FIG. 30 illustrates the recording medium ex215 that is the optical
   disk.   On the recording surface of the recording medium ex215, guide
   grooves are spirally formed, and an information track ex230 records, in
 5 advance, address information indicating an absolute position on the disk
   according to change in a shape of the guide grooves.               The address
   information includes information for determining positions of recording
   blocks ex231 that are a unit for recording            data.    Reproducing    the
   information track ex230 and        reading the      address information    in an
10 apparatus that records and reproduces data can lead to determination of the
   positions of the recording blocks.       Furthermore, the recording medium
   ex215 includes a data recording area ex233, an inner circumference area
   ex232, and an outer circumference area ex234.           The data recording area
   ex233    is an   area  for use in    recording    the user   data.    The   inner
15 circumference area ex232 and the outer circumference area ex234 that are
   inside and outside of the data recording area ex233, respectively are for
   specific   use except for    recording    the   user  data.    The   information
   reproducing/recording unit 400 reads and writes coded audio, coded video
   data, or multiplexed data obtained by multiplexing the coded audio and
20 video data, from and on the data recording area ex233 of the recording
   medium ex215.
   [0218]
           Although an optical disk having a layer, such as a DVD and a BD is
   described as an example in the description, the optical disk is not limited to
25 such, and may be an optical disk having a multilayer structure and capable
   of being recorded on a part other than the surface.           Furthermore, the
   optical     disk    may    have     a      structure     for   multidimensional
   recording/reproduction, such as recording of information using light of
   colors with different wavelengths in the same portion of the optical disk and
30 for recording information having different layers from various angles.
   [0219]
           Furthermore, a car ex210 having an antenna ex205 can receive data
   from the satellite ex202 and others, and reproduce video on a display device
   such as a car navigation system ex211 set in the car ex210, in the digital
35 broadcasting system ex200.      Here, a configuration of the car navigation
   system ex211 will be a configuration, for example, including a GPS receiving
                                           50

   unit from the configuration illustrated in FIG. 28.   The same will be true for
   the configuration of the computer ex111, the cellular phone ex114, and
   others.
   [0220]
 5         FIG. 31A illustrates the cellular phone ex114 that uses the moving
   picture coding method and the moving picture decoding method described
   in Embodiments.      The cellular phone ex114 includes: an antenna ex350 for
   transmitting and receiving radio waves through the base station ex110; a
   camera unit ex365 capable of capturing moving and still images; and a
10 display unit ex358 such as a liquid crystal display for displaying the data
   such as decoded video captured by the camera unit ex365 or received by the
   antenna ex350.      The cellular phone ex114 further includes: a main body
   unit including an operation key unit ex366; an audio output unit ex357 such
   as a speaker for output of audio; an audio input unit ex356 such as a
15 microphone for input of audio; a memory unit ex367 for storing captured
   video or still pictures, recorded audio, coded or decoded data of the
   received video, the still pictures, e-mails, or others; and a slot unit ex364
   that is an interface unit for a recording medium that stores data in the same
   manner as the memory unit ex367.
20 [0221]
           Next, an example of a configuration of the cellular phone ex114 will
   be described with reference to FIG. 31B.       In the cellular phone ex114, a
   main control unit ex360 designed to control overall each unit of the main
   body including the display unit ex358 as well as the operation key unit
25 ex366 is connected mutually, via a synchronous bus ex370, to a power
   supply circuit unit ex361, an operation input control unit ex362, a video
   signal processing unit ex355, a camera interface unit ex363, a liquid crystal
   display (LCD) control unit ex359, a modulation/demodulation unit ex352, a
   multiplexing/demultiplexing unit ex353, an audio signal processing unit
30 ex354, the slot unit ex364, and the memory unit ex367.
   [0222]
           When a call-end key or a power key is turned ON by a user's
   operation, the power supply circuit unit ex361 supplies the respective units
   with power from a battery pack so as to activate the cell phone ex114.
35 [0223]
           In the cellular phone ex114, the audio signal processing unit ex354
                                           51

   converts the audio signals collected by the audio input unit ex356 in voice
   conversation mode into digital audio signals under the control of the main
   control   unit  ex360   including  a  CPU,    ROM,   and   RAM.     Then,   the
   modulation/demodulation unit ex352 performs spread spectrum processing
 5 on the digital audio signals, and the transmitting and receiving unit ex351
   performs digital-to-analog conversion and frequency conversion on the data,
   so as to transmit the resulting data via the antenna ex350.        Also, in the
   cellular phone ex114, the transmitting and receiving unit ex351 amplifies
   the data received by the antenna ex350 in voice conversation mode and
10 performs frequency conversion and the analog-to-digital conversion on the
   data.    Then, the modulation/demodulation unit ex352 performs inverse
   spread spectrum processing on the data, and the audio signal processing
   unit ex354 converts it into analog audio signals, so as to output them via the
   audio output unit ex357.
15 [0224]
           Furthermore,   when    an e-mail   in data communication      mode    is
   transmitted, text data of the e-mail inputted by operating the operation key
   unit ex366 and others of the main body is sent out to the main control unit
   ex360 via the operation input control unit ex362.       The main control unit
20 ex360 causes the modulation/demodulation unit ex352 to perform spread
   spectrum processing on the text data, and the transmitting and receiving
   unit ex351 performs the digital-to-analog conversion and the frequency
   conversion on the resulting data to transmit the data to the base station
   ex110 via the antenna ex350.      When an e-mail is received, processing that
25 is approximately inverse to the processing for transmitting an e-mail is
   performed on the received data, and the resulting data is provided to the
   display unit ex358.
   [0225]
           When video, still images, or video and audio in data communication
30 mode is or are transmitted,       the video signal    processing   unit ex355
   compresses and codes video signals supplied from the camera unit ex365
   using the moving picture coding method shown in each of Embodiments (i.e.,
   functions as the image coding apparatus of the present invention), and
   transmits the coded video data to the multiplexing/demultiplexing unit
35 ex353.    In contrast, during when the camera unit ex365 captures video,
   still images, and others, the audio signal processing unit ex354 codes audio
                                          52

   signals collected by the audio input unit ex356, and transmits the coded
   audio data to the multiplexing/demultiplexing unit ex353.
   [0226]
            The multiplexing/demultiplexing unit ex353 multiplexes the coded
 5 video data supplied from the video signal processing unit ex355 and the
   coded audio data supplied from the audio signal processing unit ex354,
   using a predetermined method.        Then, the modulation/demodulation unit
   (modulation/demodulation circuit unit) ex352 performs spread spectrum
   processing on the multiplexed data, and the transmitting and receiving unit
10 ex351 performs digital-to-analog conversion and frequency conversion on
   the data so as to transmit the resulting data via the antenna ex350.
   [0227]
            When receiving data of a video file which is linked to a Web page and
   others in data communication mode or when receiving an e-mail with video
15 and/or audio attached, in order to decode the multiplexed data received via
   the       antenna   ex350,   the    multiplexing/demultiplexing     unit  ex353
   demultiplexes the multiplexed data into a video data bit stream and an
   audio data bit stream, and supplies the video signal processing unit ex355
   with the coded video data and the audio signal processing unit ex354 with
20 the coded audio data, through the synchronous bus ex370.              The video
   signal processing unit ex355 decodes the video signal using a moving
   picture decoding method corresponding to the moving picture coding
   method shown in each of Embodiments             (i.e.,  functions as the image
   decoding apparatus of the present invention), and then the display unit
25 ex358 displays, for instance, the video and still images included in the video
   file linked to the Web page via the LCD control unit ex359.        Furthermore,
   the audio signal processing unit ex354 decodes the audio signal, and the
   audio output unit ex357 provides the audio.
   [0228]
30          Furthermore, similarly to the television ex300, a terminal such as the
   cellular    phone   ex114   probably     have   3    types    of implementation
   configurations including not only (i) a transmitting and receiving terminal
   including both a coding apparatus and a decoding apparatus, but also (ii) a
   transmitting terminal including only a coding apparatus and (iii) a receiving
35 terminal    including only a decoding apparatus.           Although  the digital
   broadcasting system ex200 receives and transmits the multiplexed data
                                           53

   obtained by multiplexing audio data onto video data in the description, the
   multiplexed data may be data obtained by multiplexing not audio data but
   character data related to video onto video data, and may be not multiplexed
   data but video data itself.
 5 [0229]
           As such, the moving picture coding method and the moving picture
   decoding method in each of Embodiments can be used in any of the devices
   and systems described.        Thus, the advantages described in each of
   Embodiments can be obtained.
10 [0230]
           Furthermore, the present invention is not limited to Embodiments,
   and various modifications and revisions are possible without departing from
   the scope of the present invention.
   [0231]
15         (Embodiment 9)
           Video data can be generated by switching, as necessary, between (i)
   the moving picture coding method or the moving picture coding apparatus
   shown in each of Embodiments and (ii) a moving picture coding method or
   a moving picture coding apparatus in conformity with a different standard,
20 such as MPEG-2, MPEG4-AVC, and VC-1.
   [0232]
           Here, when a plurality of video data that conforms to the different
   standards is generated and is then decoded, the decoding methods need to
   be selected to conform to the different standards.   However, since to which
25 standard each of the plurality of the video data to be decoded conform
   cannot be detected, there is a problem that an appropriate decoding method
   cannot be selected.
   [0233]
           In order to solve the problem,      multiplexed data    obtained  by
30 multiplexing audio data and others onto video data has a structure including
   identification information indicating to which standard the video data
   conforms.     The specific structure of the multiplexed data including the
   video data generated in the moving picture coding method and by the
   moving picture coding apparatus shown in each of Embodiments will be
35 hereinafter described.    The multiplexed data is a digital stream in the
   MPEG2-Transport Stream format.
                                         54

   [0234]
           FIG. 32 illustrates a structure of the multiplexed data.    As illustrated
   in FIG. 32, the multiplexed data can be obtained by multiplexing at least one
   of a video stream, an audio stream, a presentation graphics stream (PG),
 5 and an interactive graphics stream.       The video stream represents primary
   video and secondary video of a movie, the audio stream (IG) represents a
   primary audio part and a secondary audio part to be mixed with the primary
   audio part, and the presentation graphics stream represents subtitles of the
   movie.    Here, the primary video is normal video to be displayed on a screen,
10 and the secondary video is video to be displayed on a smaller window in the
   primary video.     Furthermore, the interactive graphics stream represents an
   interactive screen to be generated by arranging the GUI components on a
   screen.   The video stream is coded in the moving picture coding method or
   by the moving picture coding apparatus shown in each of Embodiments, or
15 in a moving picture coding method or by a moving picture coding apparatus
   in conformity with a conventional standard, such as MPEG-2, MPEG4-AVC,
   and VC-1.    The audio stream is coded in accordance with a standard, such
   as Dolby-AC-3, Dolby Digital Plus, MLP, DTS, DTS-HD, and linear PCM.
   [0235]
20         Each stream included in the multiplexed data is identified by PID.
   For example, Ox1011 is allocated to the video stream to be used for video of
   a movie, Ox1100 to Ox111F are allocated to the audio streams, Ox1200 to
   Ox121F are allocated to the presentation graphics streams, Ox1400 to
   Ox141F are allocated to the interactive graphics streams, Ox1BOO to Ox1B1F
25 are allocated to the video streams to be used for secondary video of the
   movie, and Ox1AO0 to Ox1A1F are allocated to the audio streams to be used
   for the secondary video to be mixed with the primary audio.
   [0236]
           FIG. 33 schematically illustrates how data is multiplexed.         First, a
30 video stream ex235 composed of video frames and an audio stream ex238
   composed of audio frames are transformed into a stream of PES packets
   ex236 and a stream of PES packets ex239, and further into TS packets
   ex237    and   TS   packets   ex240,    respectively.    Similarly,   data    of  a
   presentation graphics stream ex241 and data of an interactive graphics
35 stream ex244 are transformed into a stream of PES packets ex242 and a
   stream of PES packets ex245, and further into TS packets ex243 and TS
                                            55

   packets ex246, respectively.       These TS packets are multiplexed into a
   stream to obtain multiplexed data ex247.
   [0237]
           FIG. 34 illustrates how a video stream is stored in a stream of PES
 5 packets in more detail.    The first bar in FIG. 34 shows a video frame stream
   in a video stream.     The second bar shows the stream of PES packets.       As
   indicated by arrows denoted as yyl, yy2, yy3, and yy4 in FIG. 34, the video
   stream is divided into pictures as I pictures, B pictures, and P pictures each
   of which is a video presentation unit, and the pictures are stored in a
10 payload of each of the PES packets.        Each of the PES packets has a PES
   header, and the PES header stores a Presentation Time-Stamp (PTS)
   indicating a display time of the picture, and a Decoding Time-Stamp (DTS)
   indicating a decoding time of the picture.
   [0238]
15         FIG. 35 illustrates a format of TS packets to be finally written on the
   multiplexed data.    Each of the TS packets is a 188-byte fixed length packet
   including a 4-byte TS      header having information,      such as a PID for
   identifying a stream and a 184-byte TS payload for storing data.       The PES
   packets are divided, and stored in the TS payloads, respectively.       When a
20 BD ROM is used, each of the TS packets is given a 4-byte TPExtraHeader,
   thus resulting in 192-byte source packets.       The source packets are written
   on the multiplexed data.     The TPExtraHeader stores information such as
   an ArrivalTimeStamp (ATS).           The ATS shows a transfer start time at
   which each of the TS packets is to be transferred to a PID filter. The source
25 packets are arranged in the multiplexed data as shown at the bottom of FIG.
   35.   The numbers incrementing from the head of the multiplexed data are
   called source packet numbers (SPNs).
   [0239]
           Each of the TS packets included in the multiplexed data includes not
30 only streams of audio, video, subtitles and others, but also a Program
   Association Table (PAT), a Program Map Table (PMT), and a Program Clock
   Reference (PCR).       The PAT shows what a PID in a PMT used in the
   multiplexed data indicates, and a PID of the PAT itself is registered as zero.
   The PMT stores PIDs of the streams of video, audio, subtitles and others
35 included in the multiplexed data, and attribute information of the streams
   corresponding to the PIDs.      The PMT also has various descriptors relating
                                           56

   to the multiplexed data.      The descriptors have information such as copy
   control information showing whether copying of the multiplexed data is
   permitted or not.      The PCR stores STC time information corresponding to
   an ATS showing when the PCR packet is transferred to a decoder, in order to
 5 achieve synchronization between an Arrival Time Clock (ATC) that is a time
   axis of ATSs, and an System Time Clock (STC) that is a time axis of PTSs and
   DTSs.
   [0240]
           FIG. 36 illustrates the data structure of the PMT in detail.       A PMT
10 header is disposed at the top of the PMT.        The PMT header describes the
   length of data included in the PMT and others.         A plurality of descriptors
   relating  to the     multiplexed   data   is disposed after the PMT      header.
   Information such as the copy control information is described in the
   descriptors.      After the descriptors,     a plurality of pieces    of stream
15 information relating to the streams included in the multiplexed data is
   disposed.     Each piece of stream information includes stream descriptors
   each describing      information, such as a stream type for identifying a
   compression codec of a stream,          a stream    PID,  and stream    attribute
   information (such as a frame         rate or an aspect ratio).       The stream
20 descriptors are equal in number to the number of streams in the multiplexed
   data.
   [0241]
           When the multiplexed data is recorded on a recording medium and
   others, it is recorded together with multiplexed data information files.
25 [0242]
           Each of the multiplexed data information files is management
   information of the multiplexed data as shown in FIG. 37.         The multiplexed
   data information files are in one to one correspondence with the multiplexed
   data, and each of the files includes multiplexed data information, stream
30 attribute information, and an entry map.
   [0243]
           As illustrated in FIG. 37, the multiplexed data includes a system rate,
   a reproduction start time, and a reproduction end time.         The system rate
   indicates the maximum transfer rate at which a system target decoder to be
35 described later transfers the multiplexed data to a PID filter. The intervals
   of the ATSs included in the multiplexed data are set to not higher than a
                                            57

   system rate.    The reproduction start time indicates a PTS in a video frame
   at the head of the multiplexed data.     An interval of one frame is added to a
   PTS in a video frame at the end of the multiplexed data, and the PTS is set
   to the reproduction end time.
 5 [0244]
           As shown in FIG. 38, a piece of attribute information is registered in
   the stream attribute information, for each PID of each stream included in
   the multiplexed data.      Each piece of attribute information has different
   information depending on whether the corresponding stream is a video
10 stream, an audio stream, a presentation graphics stream, or an interactive
   graphics stream.     Each piece of video stream attribute information carries
   information    including  what   kind   of compression     codec   is   used   for
   compressing the video stream, and the resolution, aspect ratio and frame
   rate of the pieces of picture data that is included in the video stream.     Each
15 piece of audio stream attribute information carries information including
   what kind of compression codec is used for compressing the audio stream,
   how many channels are included in the audio stream, which language the
   audio stream supports, and how high the sampling frequency is.          The video
   stream attribute information and the audio stream attribute information are
20 used for initialization of a decoder before the player plays back the
   information.
   [0245]
           In the present embodiment, the multiplexed data to be used is of a
   stream type included in the PMT.     Furthermore, when the multiplexed data
25 is recorded on a recording medium, the video stream attribute information
   included in the multiplexed data information is used.      More specifically, the
   moving picture coding method or the moving picture coding apparatus
   described in each of Embodiments includes a step or a unit for allocating
   unique information indicating video data generated by the moving picture
30 coding    method   or the   moving    picture coding apparatus       in  each of
   Embodiments, to the stream type included in the PMT or the video stream
   attribute information.    With the configuration, the video data generated by
   the moving picture coding method or the moving picture coding apparatus
   described in each of Embodiments can be distinguished from video data that
35 conforms to another standard.
   [0246]
                                           58

           Furthermore,   FIG.  39   illustrates steps of the     moving   picture
   decoding method according to the present embodiment.          In Step exS100,
   the stream    type included in the PMT or the video stream            attribute
   information is obtained from the multiplexed data.      Next, in Step exS101,
 5 it is determined whether or not the stream type or the video stream
   attribute information indicates that the multiplexed data is generated by the
   moving picture coding method or the moving picture coding apparatus in
   each of Embodiments.      When it is determined that the stream type or the
   video stream attribute information indicates that the multiplexed data is
10 generated by the moving picture coding method or the moving picture
   coding apparatus in each of Embodiments, in Step exS102, decoding is
   performed by the moving picture decoding method in each of Embodiments.
   Furthermore,     when  the  stream     type  or the  video  stream    attribute
   information indicates conformance to the conventional standards, such as
15 MPEG-2, MPEG4-AVC, and VC-1, in Step exS103, decoding is performed by
   a moving picture decoding method in conformity with the conventional
   standards.
   [0247]
           As such, allocating a new unique value to the stream type or the
20 video stream attribute information enables determination whether or not
   the moving picture decoding method or the moving picture decoding
   apparatus that is described in each of Embodiments can perform decoding.
   Even when multiplexed data that conforms to a different standard, an
   appropriate decoding method or apparatus can be selected.             Thus, it
25 becomes possible to decode information without any error.        Furthermore,
   the moving picture coding method or apparatus, or the moving picture
   decoding method or apparatus in the present embodiment can be used in
   the devices and systems described above.
   [0248]
30         (Embodiment 10)
           Each of the moving picture coding method, the moving picture coding
   apparatus, the moving picture decoding method, and the moving picture
   decoding apparatus in each of Embodiments is typically achieved in the form
   of an integrated circuit or a Large Scale Integrated (LSI) circuit.      As an
35 example of the LSI, FIG. 40 illustrates a configuration of the LSI ex500 that
   is made into one chip.     The LSI ex500 includes elements ex501, ex502,
                                            59

   ex503, ex504, ex505, ex506, ex507, ex508, and ex509 to be described
   below, and the elements are connected to each other through a bus ex510.
   The power supply circuit unit ex505 is activated by supplying each of the
   elements with power when the power supply circuit unit ex505 is turned on.
 5 [0249]
           For example, when coding is performed, the LSI ex500 receives an
   AV signal from a microphone exl17, a camera exl13, and others through an
   AV IO ex509 under control of a control unit ex501 including a CPU ex502, a
   memory     controller ex503,   a stream    controller ex504,   and a driving
10 frequency control unit ex512.    The received AV signal is temporarily stored
   in an external memory ex511, such as an SDRAM.           Under control of the
   control  unit ex501, the stored data is segmented         into data   portions
   according to the processing amount and speed to be transmitted to a signal
   processing unit ex507.     Then, the signal processing unit ex507 codes an
15 audio signal and/or a video signal.    Here, the coding of the video signal is
   the coding described in each of Embodiments.         Furthermore, the signal
   processing unit ex507 sometimes multiplexes the coded audio data and the
   coded video data, and a stream IO ex506 provides the multiplexed data
   outside.    The provided multiplexed data is transmitted to the base station
20 ex107, or written on the recording media ex215.          When data sets are
   multiplexed, the data should be temporarily stored in the buffer ex508 so
   that the data sets are synchronized with each other.
   [0250]
           Although the memory ex511 is an element outside the LSI ex500, it
25 may be included in the LSI ex500.      The buffer ex508 is not limited to one
   buffer, but may be composed of buffers.      Furthermore, the LSI ex500 may
   be made into one chip or a plurality of chips.
   [0251]
           Furthermore,   although the control unit ex501 includes the CPU
30 ex502, the memory controller ex503, the stream controller ex504, the
   driving frequency control unit ex512, the configuration of the control unit
   ex501 is not limited to such.  For example, the signal processing unit ex507
   may further include a CPU.         Inclusion of another CPU     in the signal
   processing unit ex507 can improve the processing speed.       Furthermore, as
35 another example, the CPU ex502 may serve as or be a part of the signal
   processing unit ex507, and, for example, may include an audio signal
                                          60

   processing unit.     In such a case, the control unit ex501 includes the signal
   processing unit ex507 or the CPU ex502 including a part of the signal
   processing unit ex507.
   [0252]
 5         The name used here is LSI, but it may also be called IC, system LSI,
   super LSI, or ultra LSI depending on the degree of integration.
   [0253]
            Moreover, ways to achieve integration are not limited to the LSI, and
   a special circuit or a general purpose processor and so forth can also achieve
10 the integration.       Field Programmable Gate Array (FPGA)        that can be
   programmed after manufacturing LSIs or a reconfigurable processor that
   allows re-configuration of the connection or configuration of an LSI can be
   used for the same purpose.
   [0254]
15          In the future, with advancement in semiconductor technology, a
   brand-new technology may replace LSI.            The functional blocks can be
   integrated using such a technology.        The possibility is that the present
   invention is applied to biotechnology.
   [0255]
20          (Embodiment 11)
            When video data generated in the moving picture coding method or
   by the moving picture coding apparatus described in each of Embodiments
   is decoded, compared to when video data that conforms to a conventional
   standard,    such as      MPEG-2,  MPEG4-AVC,     and  VC-1   is decoded,    the
25 processing amount probably increases.         Thus, the LSI ex500 needs to be
   set to a driving frequency higher than that of the CPU ex502 to be used
   when video data in conformity with the conventional standard is decoded.
   However, when the driving frequency is set higher, there is a problem that
   the power consumption increases.
30 [0256]
            In order to solve the       problem,   the moving    picture decoding
   apparatus, such as the television ex300 and the LSI ex500 is configured to
   determine to which standard the video data conforms, and switch between
   the driving frequencies according to the determined standard.           FIG. 41
35 illustrates a configuration ex800 in the present embodiment.          A driving
   frequency switching unit ex803 sets a driving frequency to a higher driving
                                           61

   frequency when video data is generated by the moving picture coding
   method or the moving picture coding apparatus described in each of
   Embodiments.     Then, the driving frequency switching unit ex803 instructs
   a decoding processing       unit ex801 that executes the moving          picture
 5 decoding method described in each of Embodiments to decode the video
   data.   When the video data conforms to the conventional standard, the
   driving frequency switching unit ex803 sets a driving frequency to a lower
   driving frequency than that of the video data generated by the moving
   picture coding method or the moving picture coding apparatus described in
10 each of Embodiments.       Then, the driving frequency switching unit ex803
   instructs the decoding       processing   unit ex802 that     conforms   to the
   conventional standard to decode the video data.
   [0257]
           More   specifically, the   driving frequency    switching   unit  ex803
15 includes the CPU ex502 and the driving frequency control unit ex512 in FIG.
   40.   Here, each of the decoding processing unit ex801 that executes the
   moving picture decoding method described in each of Embodiments and the
   decoding processing unit ex802 that conforms to the conventional standard
   corresponds to the signal processing unit ex507 in FIG. 40.      The CPU ex502
20 determines to which standard the video data conforms.         Then, the driving
   frequency control unit ex512 determines a driving frequency based on a
   signal from the CPU ex502.      Furthermore, the signal processing unit ex507
   decodes the video data based on the signal from the CPU ex502.               For
   example, the identification information described in Embodiment 9 is
25 probably used for identifying the video data.    The identification information
   is not limited to the one described in Embodiment 9 but may be any
   information as long as the information indicates to which standard the video
   data conforms.    For example, when which standard video data conforms to
   can be determined based on an external signal for determining that the
30 video data is used for a television or a disk, etc., the determination may be
   made based on such an external signal.          Furthermore, the CPU ex502
   selects a driving frequency based on, for example, a look-up table in which
   the standards of the video data are associated with the driving frequencies
   as shown in FIG. 43.    The driving frequency can be selected by storing the
35 look-up table in the buffer ex508 and in an internal memory of an LSI, and
   with reference to the look-up table by the CPU ex502.
                                            62

   [0258]
           FIG.  42 illustrates steps for executing a method in the present
   embodiment.      First, in Step exS200, the signal processing unit ex507
   obtains identification information from the multiplexed data.    Next, in Step
 5 exS201, the CPU ex502 determines whether or not the video data is
   generated by the coding method and the coding apparatus described in each
   of Embodiments, based on the identification information.       When the video
   data is generated by the moving picture coding method and the moving
   picture coding apparatus described in each of Embodiments, in Step exS202,
10 the CPU ex502 transmits a signal for setting the driving frequency to a
   higher driving frequency to the driving frequency control unit ex512.    Then,
   the driving frequency control unit ex512 sets the driving frequency to the
   higher driving frequency.      On the other hand, when the identification
   information indicates that the video data conforms to the conventional
15 standard, such as MPEG-2, MPEG4-AVC, and VC-1, in Step exS203, the CPU
   ex502 transmits a signal for setting the driving frequency to a lower driving
   frequency to the driving frequency control unit ex512.       Then, the driving
   frequency control unit ex512 sets the driving frequency to the lower driving
   frequency than that in the case where the video data is generated by the
20 moving picture coding method and the moving picture coding apparatus
   described in each of Embodiment.
   [0259]
           Furthermore, along with the switching of the driving frequencies, the
   power conservation effect can be improved by changing the voltage to be
25 applied to the LSI ex500 or an apparatus including the LSI ex500.          For
   example, when the driving frequency is set lower, the voltage to be applied
   to the LSI ex500 or the apparatus including the LSI ex500 is probably set to
   a voltage lower than that in the case where the driving frequency is set
   higher.
30 [0260]
           Furthermore, when the processing amount for decoding is larger, the
   driving frequency may be set higher, and when the processing amount for
   decoding is smaller, the driving frequency may be set lower as the method
   for setting the driving frequency.  Thus, the setting method is not limited to
35 the ones described above.     For example, when the processing amount for
   decoding video data in conformity with MPEG 4 -AVC         is larger than the
                                         63

   processing amount for decoding video data generated by the moving picture
   coding method and the moving picture coding apparatus described in each
   of Embodiments, the driving frequency is probably set in reverse order to
   the setting described above.
 5 [0261]
           Furthermore, the method for setting the driving frequency is not
   limited to the method for setting the driving frequency lower.    For example,
   when   the   identification information    indicates that the video data      is
   generated by the moving picture coding method and the moving picture
10 coding apparatus described in each of Embodiments, the voltage to be
   applied to the LSI ex500 or the apparatus including the LSI ex500 is
   probably set higher.     When the identification information indicates that the
   video data conforms to the conventional standard,           such as MPEG-2,
   MPEG4-AVC, and VC-1, the voltage to be applied to the LSI ex500 or the
15 apparatus including the LSI ex500 is probably set lower.           As another
   example, when the identification information indicates that the video data is
   generated by the moving picture coding method and the moving picture
   coding apparatus described in each of Embodiments, the driving of the CPU
   ex502 does not probably have to be suspended.          When the identification
20 information indicates that the video data conforms to the conventional
   standard, such as MPEG-2, MPEG4-AVC, and VC-1, the driving of the CPU
   ex502 is probably suspended at a given time because the CPU ex502 has
   extra  processing capacity.      Even when the identification information
   indicates that the video data is generated by the moving picture coding
25 method and the moving picture coding apparatus described in each of
   Embodiments, in the case where the CPU ex502 has extra processing
   capacity, the driving of the CPU ex502 is probably suspended at a given time.
   In such a case, the suspending time is probably set shorter than that in the
   case where when the identification information indicates that the video data
30 conforms to the conventional standard, such as MPEG-2, MPEG4-AVC, and
   VC-1.
   [0262]
          Accordingly, the power conservation effect can be improved by
   switching between the driving frequencies in accordance with the standard
35 to which the video data conforms.     Furthermore, when the LSI ex500 or the
   apparatus including the LSI ex500 is driven using a battery, the battery life
                                          64

   can be extended with the power conservation effect.
   [0263]
            (Embodiment 12)
            There are cases where a plurality of video data that conforms to
 5 different standards, is provided to the devices and systems, such as a
   television and a mobile phone.       In order to enable decoding the plurality of
   video data that conforms to the different standards, the signal processing
   unit ex507 of the LSI ex500 needs to conform to the different standards.
   However, the problems of increase in the scale of the circuit of the LSI ex500
10 and increase in the cost arise with the individual use of the signal processing
   units ex507 that conform to the respective standards.
   [0264]
            In order to solve the problem, what is conceived is a configuration in
   which the decoding processing unit for implementing the moving picture
15 decoding method described in each of Embodiments and the decoding
   processing unit that conforms to the conventional standard, such as MPEG-2,
   MPEG4-AVC,      and VC-1 are partly shared.       Ex900 in FIG. 44A shows an
   example of the configuration.       For example, the moving picture decoding
   method described in each of Embodiments and the moving picture decoding
20 method that conforms to MPEG4-AVC have, partly in common, the details of
   processing,    such as entropy coding,        inverse quantization,    deblocking
   filtering, and motion compensated prediction.        The details of processing to
   be shared probably include use of a decoding processing unit ex902 that
   conforms to MPEG4-AVC.          In contrast, a dedicated decoding processing
25 unit ex901 is probably used for other processing unique to the present
   invention.     Since the     present   invention is characterized    by entropy
   decoding processing in particular, for example, the dedicated decoding
   processing unit ex901 is used for entropy decoding processing.        Otherwise,
   the decoding      processing   unit is probably     shared for one     of inverse
30 quantization, deblocking filtering, and motion compensation, or all of the
   processing.    The decoding processing unit for implementing the moving
   picture decoding method described in each of Embodiments may be shared
   for the processing to be shared, and a dedicated decoding processing unit
   may be used for processing unique to that of MPEG4-AVC.
35 [0265]
            Furthermore, ex1000 in FIG. 44B shows another example in that
                                             65

   processing is partly shared.   This example uses a configuration including a
   dedicated decoding processing unit ex1001 that supports the processing
   unique to the present invention, a dedicated decoding processing unit
   ex1002 that supports the processing         unique to another conventional
 5 standard, and a decoding processing unit ex1003 that supports processing
   to be shared between the moving picture decoding method in the present
   invention and the conventional moving picture decoding method.      Here, the
   dedicated decoding processing units ex1001 and ex1002 are not necessarily
   specialized for the processing of the present invention and the processing of
10 the conventional standard, respectively, and may be the ones capable of
   implementing general processing.       Furthermore, the configuration of the
   present embodiment can be implemented by the LSI ex500.
   [0266]
           As such, reducing the scale of the circuit of an LSI and reducing the
15 cost are possible by sharing the decoding processing unit for the processing
   to be shared between the moving picture decoding method in the present
   invention and the moving picture decoding method in conformity with the
   conventional standard.
20 [Industrial Applicability]
   [0267]
           The present invention can be applied to image coding methods,
   image decoding methods, image coding apparatuses, and image decoding
   apparatuses.    The present invention is also applicable to high-resolution
25 information display apparatuses or imaging apparatuses such as television
   sets,  digital video   recorders,  in-vehicle navigation systems,    portable
   phones, digital cameras, and digital camcorders, each of which includes an
   image coding apparatus.
30 [Reference Signs List]
   [0268]
   100            image coding apparatus
   101            input image signal
   110            subtractor
35 111            prediction error signal
   120            transform unit
                                          66

   130            quantization unit
   131, 231       quantization coefficient
   140, 240       inverse quantization unit
   141, 241       decoded transform output signal
 5 150, 250       inverse transform unit
   151, 251       decoded transform input signal
   160, 260       adder
   161, 261       decoded signal
   170, 270       memory
10 180, 280       prediction unit
   181, 281       prediction signal
   190            entropy coding unit
   191            coded signal
   200            image decoding apparatus
15 290, 290A, 290B         entropy decoding unit
   291            coded signal
   311            branching unit
   312            split information tree decoding unit
   313            TUS memory
20 314            CBF memory
   315            transform coefficient tree decoding unit
   316            transform coefficient decoding unit
   317            transform unified tree decoding unit
   321            coded management information
25 322            coded transform coefficient
   [0269]
           Modifications within the scope of the invention may be readily
   effected by those skilled in the art.   It is to be understood, therefore, that
30 this invention is not limited to the particular embodiments described by way
   of example hereinabove.
   [0270]
           In the claims that follow and in the preceding description of the
   invention, except where the context requires otherwise owing to express
35 language or necessary implication, the word "comprise" or variations such
   as "comprises" or "comprising" is used in an inclusive sense, that is, to
                                          67

  specify the presence of the stated features but not to preclude the presence
  or addition of further features in various embodiments of the invention.
  [0271]
         Further, any reference herein to prior art is not intended to imply that
5 such prior art forms or formed a part of the common general knowledge in
  any country.
                                        68

   THE CLAIMS DEFINING THE INVENTION ARE AS FOLLOWS:
   1.       An image decoding method, comprising:
            decoding a coded signal to generate quantization coefficients and
 5 pieces of management information,          the quantization coefficients each
   corresponding to a corresponding one of transform units, and the pieces of
   the management information indicating a structure of the transform units;
            performing inverse quantization and inverse transform on each of
   the quantization coefficients, eventually generating prediction error signals
10 of the respective transform units; and
            adding at least one of the prediction error signals to a prediction
   signal for each of coding units each including the transform units,
            generating decoded signals for each of the coding units,
            wherein   the  quantization   coefficients and    the  pieces of the
15 management information have a tree structure, each of the transform units
   corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding includes decoding, for each of the leaf nodes, a coded piece of
   the management information and a coded quantization coefficient which are
   arranged in succession in the coded signal for the each of the leaf nodes,
20          wherein   the  pieces  of   the    management    information  include
   respective pieces of split information each of which corresponds to a
   corresponding one of nodes in the tree structure and indicates whether or
   not a transform unit corresponding to the corresponding one of the nodes is
   to be further split,
25          wherein   the  pieces  of   the    management    information  include
   respective first flags each of which corresponds to at least one of the nodes
   in the tree structure and indicates whether or not a quantization coefficient
   corresponding to each of the at least one of the nodes exists,
            wherein each of the quantization coefficients includes a luminance
30 quantization coefficient and a chrominance quantization coefficient, and the
   first flag includes a second flag and a third flag, the second flag indicating
   whether or not the luminance quantization coefficient exists, and the third
   flag indicating whether or not the chrominance quantization coefficient
   exists, in the coded signal, the second flag that is coded is arranged after
35 the third flag that is coded,
            wherein in the decoding, the second flag that is coded is decoded
                                           69

   after decoding the third flag that is coded, for each of the at least one of the
   nodes.
   2.      The image decoding method according to claim 1,
 5          wherein each of the quantization coefficients includes a luminance
   quantization coefficient, a chrominance Cb quantization coefficient, and a
   chrominance Cr quantization coefficient, the first flag includes a second flag,
   a third flag, and a fourth flag, the second flag indicating whether or not the
   luminance quantization coefficient exists, the third flag indicating whether
10 or not the chrominance Cb quantization coefficient exists, and the fourth
   flag indicating whether or not the chrominance Cr quantization coefficient
   exists, and the third flag that is coded, the fourth flag that is coded, the
   second flag that is coded, the luminance quantization coefficient that is
   coded, the chrominance Cb quantization coefficient that is coded, and the
15 chrominance Cr quantization coefficient that is coded are arranged in order
   in the coded signal, and
            wherein in the decoding, for each of the at least one of the nodes, the
   third flag that is coded, the fourth flag that is coded, the second flag that is
   coded,     the  luminance    quantization   coefficient   that   is coded,   the
20 chrominance Cb quantization coefficient that is coded, and the chrominance
   Cr quantization coefficient that is coded are decoded in order.
   3.        An image decoding apparatus, comprising:
            a decoding unit configured to decode a coded signal to generate
25 quantization    coefficients and   pieces of management        information,  the
   quantization coefficients each corresponding to a corresponding one of
   transform units, and the pieces of the management information indicating a
   structure of the transform units;
            an inverse quantization/inverse transform unit configured to perform
30 inverse quantization and inverse transform on each of the quantization
   coefficients, eventually generating prediction error signals of the respective
   transform units; and
            an addition unit configured to add at least one of the prediction error
   signals to a prediction signal for each of coding units each including the
35 transform units, eventually generating decoded signals for each of the
   coding units,
                                           70

            wherein   the  quantization   coefficients  and   the   pieces  of the
   management information have a tree structure, each of the transform units
   corresponds to a corresponding one of leaf nodes in the tree structure, and
   the decoding unit is configured to decode, for each of the leaf nodes, a
 5 coded piece of the management information and a coded quantization
   coefficient which are arranged in succession in the coded signal for the each
   of the leaf nodes,
            wherein   the  pieces  of   the   management     information    include
   respective pieces of split information each of which corresponds to a
10 corresponding one of nodes in the tree structure and indicates whether or
   not a transform unit corresponding to the corresponding one of the nodes is
   to be further split,
            wherein   the  pieces  of   the   management     information    include
   respective first flags each of which corresponds to at least one of the nodes
15 in the tree structure and indicates whether or not a quantization coefficient
   corresponding to each of the at least one of the nodes exists,
            wherein each of the quantization coefficients includes a luminance
   quantization coefficient and a chrominance quantization coefficient, and the
   first flag includes a second flag and a third flag, the second flag indicating
20 whether or not the luminance quantization coefficient exists, and the third
   flag indicating whether or not the chrominance quantization coefficient
   exists, in the coded signal, the second flag that is coded is arranged after
   the third flag that is coded,
            wherein in the decoding unit, the second flag that is coded is decoded
25 after decoding the third flag that is coded, for each of the at least one of the
   nodes.
   4.        A computer program configured to, when executed by a computing
   device, control the computing device to implement the image decoding
30 method of claim 1 or 2.
   5.        A computer readable medium, comprising the computer program of
   claim 4.
                                           71

<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
