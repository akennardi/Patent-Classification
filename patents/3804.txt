                                                           ABSTRACT
            Described embodiments include                              a system for updating a mesh,
  which       includes           a    plurality            of   vertices,            representing               a  surface
5 of    a heart.              The      system        includes         an     electrical             interface         and   a
  processor.              The processor                is   configured to define a plurality of
  sample        points          on     the     mesh,        such      that       a    density          of     the    sample
  points        is      greater         than       a    density        of     the      vertices,            to    receive,
  via      the      electrical             interface,            a     plurality             of     signals         from    a
0 catheter,            the     signals          indicating           an    electrical            property          of  each
  of    a    plurality            of    locations            on   the      surface,           and       to    update     the
  mesh in accordance with the electrical property, by, for each of
  the       locations,              identifying               a    closest            sample          point        to    the
  location,           subsequently, identifying,                           in a portion of                  the mesh in
5 which       the       closest         sample         point      is     located,           a    closest          point   to
  the     location,             and,      subsequently,               associating             the       closest       point
  with the electrical property of the location.

                            3/3
45%
              SAMPLE MESH WITH DENSITY GREATER        46
                   THAN DENSITY OF VERTICES
 48\   RECEIVE ECG SIGNALS FROM LOCATIONS ON SURFACE
   49-   IDENTIFY PROPERTY OF EACH OF THE LOCATIONS
                      SELECT NEXT LOCATION    \50
                IDENTIFY CLOSEST SAMPLE POINT     %52
                   IDENTIFY PORTION OF MESH
                                                      4
               CONTAINING CLOSEST SAMPLE POINT
                    IDENTIFY CLOSEST POINT IN
                                                   56
                  IDENTIFIED PORTION OF MESH
           ADD VERTEX AT CLOSEST POINT AND RETILE        58
                  ASSOCIATE NEW VERTEX WITH       60
                      PROPERTY OF LOCATION
                                     62
                                ANY  6
                 YES
                        MORE LOCATIONS?
                                  NO
                            REOLOR MESH M64
     FIG. 3

                                UPDATING AN ELECTROANATOMICAL MAP
                                            FIELD OF THE INVENTION
             The   present         invention           relates        to     computer       models       of    three
   dimensional             surfaces,           such        as      anatomical          surfaces,           and      the
 5 visualization thereof.
                                                      BACKGROUND
             Three-dimensional                   surfaces            are        often        represented             in
   computer         memory        by      a   contiguous            collection         of     tiles,        such     as
   triangular tiles.                   Such a representation may be referred to as a
 0 "tesselation" or a "mesh."
             A "local        activation          time"         (LAT)     of a particular              area     of the
   heart        is     the        time        at     which          the      wavefront          of      electrical
   propagation passes                  through the            area.        A   local activation time                 is
   typically         measured           from     a    particular           reference        time,       such      as   a
 5 particular          point        in     time     in     the      QRS     complex      of     a    body-surface
   electrocardiogram                 (ECG) recording.
                                         SUMMARY OF THE INVENTION
             There     is     provided,          in     accordance            with    some      embodiments          of
   the      present         invention,           a      system        for      updating        a     mesh,       which
20 includes             a        plurality               of         vertices,            representing                an
   electroanatomical                  map     of     a     surface         of    a   heart.           The      system
   includes        an electrical interface and a processor.                                       The processor
   is     configured           to     define        a    plurality           of    sample       points        on    the
   mesh, such that               a density of the                 sample points is greater than a
25 density        of      the     vertices,            and      to    receive,        via      the      electrical
   interface,          a    plurality           of      signals        from      an   intrabody          catheter,
   the       signals        indicating           an      electrical            property         of     each      of    a
   plurality          of       locations           on      the      surface        of    the       heart.           The
   processor is            further configured to update                           the mesh in           accordance
30 with       the   electrical            property,           by,     for     each    particular           location
   of     the      locations,             identifying             a    closest        one      of     the      sample
                                                                1

   points,        which    corresponds          to    a    location          that       is    closest          to    the
   particular           location,       relative            to       other        ones        of      the       sample
   points,        subsequently,        identifying,               in    a    portion          of     the     mesh      in
   which the closest            one of the           sample points                is   located,          a    closest
 5 point,        which    corresponds         to     a    location          that       is     closest          to    the
   particular         location,      relative          to     other       points         in    the portion             of
   the     mesh,     and,    subsequently,            associating              the    closest          point      with
   the electrical property of the particular location.
             In   some    embodiments,          the     processor           is      configured           to     define
 0 the sample points by uniformly sampling the mesh.
             In   some    embodiments,          the     processor           is      configured           to     define
   the sample points by sampling the entire mesh.
             In some embodiments,              the processor               is     further configured to
   organize          the     sample        points           in       a     space-partitioning                     data
 5 structure,          and    the    processor             is       configured             to     identify           the
   closest         one     of   the      sample          points         by       querying             the       space
   partitioning data structure.
             In   some   embodiments,          the     portion          of the        mesh       consists         of     a
   tile        in   which     the    closest           sample          point         is     located,            and      a
 0 plurality         of   neighboring         tiles        that       surround          the     tile       in    which
   the closest sample point is                     located.
             In    some    embodiments,            the      neighboring              tiles         include        each
   tile      in   the    mesh  that      shares        at     least       one      vertex       with       the    tile
   in which the closest sample point is                              located.
25           In   some    embodiments,          the     processor           is      configured           to     update
   the      mesh     by    dividing       a     tile       of     the      mesh        that        contains          the
   closest        point     into    a    plurality             of     tiles        that      share        a    vertex
   located at the closest point.
             In   some    embodiments,          the     processor           is      configured           to     update
30 the       mesh     by     recoloring           the       mesh        in       accordance             with         the
   electrical property.
             In   some    embodiments,          the     processor           is      configured           to     update
   the mesh without changing a topology of the mesh.
                                                          2

             In     some        embodiments,              the      processor             is      configured        to
   identify the closest point by calculating a distance between the
   particular location                 and each plane               corresponding to a                    respective
   tile in the portion of the mesh.
 5          There         is      further          provided,             in     accordance               with    some
   embodiments            of    the    present          invention,          a    method         for      updating     a
   mesh,      which        includes        a    plurality           of    vertices,            representing        an
   electroanatomical                 map     of     a     surface         of    a     heart.            The   method
   includes,           using       a   processor,             defining         a     plurality            of  sample
 0 points       on the mesh,            such      that      a   density        of    the      sample       points  is
   greater          than       a     density         of      the       vertices,            and       receiving       a
   plurality           of     signals       from        an    intrabody          catheter,             the   signals
   indicating            an    electrical           property           of    each       of     a    plurality      of
   locations           on     the     surface         of     the      heart.           The      method       further
 5 includes         updating          the     mesh       in     accordance           with        the     electrical
   property,           by,     for     each      particular             location         of      the      locations,
   identifying              a     closest          one        of       the      sample           points,        which
   corresponds            to     a    location          that      is     closest         to      the     particular
   location,            relative          to       other        ones        of       the       sample        points,
 0 subsequently, identifying, in a portion of                                       the mesh in which the
   closest        one     of     the    sample        points        is    located,          a    closest      point,
   which        corresponds             to      a      location          that        is       closest        to   the
   particular           location,        relative           to   other      points         in    the portion       of
   the     mesh,      and,      subsequently,             associating           the      closest         point   with
25 the electrical property of the particular location.
            The     present         invention          will      be     more      fully        understood        from
   the     following detailed description                           of embodiments                thereof,      taken
   together with the drawings, in which:
                                BRIEF DESCRIPTION OF THE DRAWINGS
30          Fig.      1 is     a schematic illustration of a                            system for updating
   a    mesh     that      represents          an     electroanatomical                 map,       in     accordance
   with some embodiments of the present invention;
                                                              3

             Figs.         2A-C        collectively                show     a  method        for    updating          a   mesh,
   in    accordance                 with       some       embodiments             of     the    present         invention;
   and
             Fig.        3    is     a   flow      diagram           for    a   method       for updating             a   mesh,
 5 in accordance with some embodiments of the present invention.
                                    DETAILED DESCRIPTION OF EMBODIMENTS
                                                                OVERVIEW
              In    some         embodiments,               an     electroanatomical                map     of    a   surface
   of    a      subject's              heart       is      constructed.                As    implied        by      the    word
 0 "electroanatomical,"                          such       a    map      combines        anatomical          information
   relating to the                     structure of the heart with information relating
   to     the        electrical                activity             of     the      heart.            Such       a    map    is
   typically                represented                  in      a      computer           memory         by      a     three
   dimensional                mesh        that        is      colored,          or    otherwise           annotated,         in
 5 accordance              with        a    measured            electrical           property         of    the      surface.
   For example,                 the mesh may be colored in accordance with measured
   LATs         or      electrical                potentials.                  Such        a   mesh        is     typically
   constructed                   from        a      plurality               of     points         that        correspond,
   respectively,                   to    the     locations             at   which       the    electrical           property
 0 was      measured,               each       of      these        points        being       associated           with     the
   value          of       the       electrical               property          that       was     measured            at   the
   corresponding location.                               These points              constitute the vertices                   of
   the     tiles         of the          mesh,        and      are hence          referred        to     hereinbelow         as
   "vertices."
25            In      some            cases,           it       may        be      necessary           to      update        an
   electroanatomical                       map       with         newly-acquired              measurements.                 For
   example,           following             an     ablation            procedure,          a  physician          may use        a
   catheter          to       measure          a   plurality             of   LATs      at various          locations        in
   the       region            of      the       ablated           tissue.            The      mesh       must       then    be
30 recolored              in      this       region,           in     order       to     accurately          reflect        the
   updated           LAT          values.               In      order        to     perform         such      an      update,
   however,           it       is     necessary           to      project        each      of   the      locations         onto
   the     mesh.             In     other words,                for     each     given       location        at which        an
                                                                       4

   updated         measurement              was     acquired,             it     is      necessary           to     find        the
   point on the mesh that                      corresponds to a location that                                   is     closest
   to    the      given       location,           such       that        this        point        may    be     associated
   with      the      updated        measurement.                   (For       simplicity,             this       point        may
 5 referred to as the closest point to the given location.)
            One        hypothetical              solution             is      to        find,        for       each       given
   location,           the     closest        point         on     each        of      the      mesh     tiles,         and      to
   then        project         the       given        location             onto         the        closest        of       these
   closest         points.          However,           this       technique,               although accurate,                    is
 0 computationally                 intensive            and         slow.              Another           option          is      to
   project          the      location           onto         the       closest            vertex         in      the      mesh.
   However,           this       technique,             although             fast,           is     not      sufficiently
   accurate.             Moreover,           some      tiles         may      be      relatively            large        (i.e.,
   some       vertices          may      be     relatively               widely           spaced),          such       that         a
 5 projection             onto      a     vertex          does        not        necessarily               constitute               a
   helpful            "initial"             projection.                      In       other          words,           even          a
   subsequent,            more accurate projection                            to the closest point                      in the
   vicinity            of     the        closest           vertex            would           not      necessarily                be
   sufficiently             accurate,            since        the       overall            closest        point         on      the
 0 mesh would            not     necessarily             be      contained             in     the    vicinity           of     the
   closest vertex.
            Embodiments             of      the     present           invention               therefore          provide            a
   superior          solution          that      is     both        fast        and      accurate.              First,          the
   mesh        is      sampled,          typically             uniformly,                 such       as      to      yield          a
25 collection            of    sample        points         that       is     denser           than     the     collection
   of    vertices.            Next,        the     closest          sample          point       to    the      location          is
   found, thus            obtaining a rough, initial projection                                         onto      the mesh.
   This      step      is   relatively fast,                  especially if                   a space-partitioning
   data       structure,           such       as     a     k-d      tree,          is     used       to     organize            the
30 sample           points.                Subsequently,                   a       refined,            more          accurate
   projection            is    performed,             by      finding           the        closest        point        in       the
   vicinity of             the    closest          sample point.                    Since        this     more       accurate
   projection            does     not       operate         on     the       entire          mesh,      but      only       on      a
                                                                  5

   limited             portion            thereof,            the         projection                may       be     quickly
   performed.
                                                   SYSTEM DESCRIPTION
              Reference is              initially made to Fig.                         1, which is             a schematic
 5 illustration                of   a    system        20    for updating                a    mesh     that      represents
   an electroanatomical                       map,      in    accordance            with        some     embodiments        of
   the        present            invention.                  One        commercial               product           embodying
   elements            of      system 20           is    the       CARTO® 3             System,         available        from
   Biosense            Webster,           Inc.         This        system        may       be     modified         by   those
 0 skilled           in       the     art       to     embody          the      principles              of     embodiments
   described herein.
              Fig.       1    shows       a    physician           27    holding           an     intrabody         catheter
   29,      a   distal          end 31        of which         is     disposed within                  the     heart    23  of
   a    subject           25.       As    physician           27     moves       distal          end     31    of   catheter
 5 29     along         a    surface          (e.g.,       the      inner        or      epicardial            surface)     of
   heart         23,        one     or      more       electrodes             at     the        distal         end    of   the
   catheter            record        intracardiac              electrocardiographic                         (ECG)    signals
   from       a   plurality            of      locations           on    the      surface           of    the     heart.      A
   processor              (PROC)      28     receives         these ECG           signals           from the        catheter
 0 via an electrical interface                              35,     which may comprise,                       for example,
   a    port        or     other       connector.                The      signals           indicate          one    or  more
   electrical                properties,              of     the       locations,               that        processor       28
   identifies by analyzing the ECG signals.                                               For example, processor
   28      may       identify            electrical             potentials               indicated            by    the    ECG
25 signals,          and/or may compute LATs from the ECG signals.
              During          the    procedure,             and/or         thereafter,               processor        28   may
   retrieve             a      three-dimensional                    mesh        30,         which        represents         an
   electroanatomical                    map       of    the       subject's            heart,         from      a   computer
   memory          (MEM)        24,    and      render        mesh       30     on     a    display         26.      Mesh   30
30 comprises               a     tesselation              of       tiles        32,         which        are       typically
   triangular                in    shape.             Mesh       30     is      colored,             and/or        otherwise
   annotated, in accordance with an electrical property measured at
                                                                    6

   the    vertices       of   the     tiles.          (Interpolation             may be       used to         color
   the areas of the mesh lying between the vertices.)
            As   described         in   detail       below,         as    the     processor          identifies
   the     heart's       electrical           properties             from     the     ECG       signals,         the
 5 processor         updates        mesh     30,      in     accordance           with     the       identified
   properties.
            In    general,         processor           28     may      be    embodied           as     a     single
   processor,         or   as    a    cooperatively            networked          or    clustered           set    of
   processors.            Processor            28    is      typically          a   programmed            digital
 0 computing         device       comprising            a    central        processing           unit        (CPU),
   random       access memory          (RAM),       non-volatile            secondary          storage,         such
   as    a    hard     drive     or     CD     ROM     drive,         network       interfaces,              and/or
   peripheral         devices.         Program code,                including        software          programs,
   and/or data are            loaded into           the RAM for execution and processing
 5 by    the      CPU    and      results         are      generated           for     display,           output,
   transmittal,          or    storage,         as    is     known      in    the    art.         The     program
   code        and/or     data        may       be     downloaded            to     the       processor            in
   electronic          form,        over      a    network,           for      example,          or      it     may,
   alternatively or additionally, be provided and/or stored on                                                  non
 0 transitory           tangible         media,          such        as     magnetic,           optical,           or
   electronic memory.                 Such program code                and/or data, when provided
   to   the processor,           produce         a machine          or   special-purpose               computer,
   configured to perform the tasks described herein.
            Reference       is      now    made       to     Figs.       2A-C,      which        collectively
25 show     a   method,     performed           by processor            28,    for    updating          mesh     30,
   in accordance with some embodiments of the present invention.
            Fig.     2A    depicts         a     scenario           in    which       the      catheter          has
   acquired       ECG    signals       at     three       locations         35a,     35b,      and      35c     on   a
   surface        34    of     a    heart.           As      described           above,        processor           28
30 receives         these       signals,          and       then       ascertains           at       least       one
   property, such as             an electrical property                      (e.g., an LAT),              of each
   of     these       locations.               Processor            then      updates         mesh        30,      in
   accordance         with     the     property.             First,        the    processor           defines        a
   plurality          of    sample        points          36      on     the      mesh,        typically           by
                                                           7

   uniformly               sampling            the       mesh.            Next,         for          each        particular
   location,             the processor identifies                       the closest               one of         the sample
   points,          which         corresponds            to     a   location         that        is    closest           to    the
   particular              location,           relative           to   the      other         sample         points.             In
 5 other        words,          the     processor           projects         each      of      the       locations           onto
   the       closest          one      of     the      sample        points.            For        example,            Fig.      2A
   shows        location           35a     projected            onto     a    sample        point          37a,       location
   35b        projected             onto        a     sample         point         37b,         and        location            35c
   projected onto a sample point 37c.
 0            To     illustrate             the      concept         of    a    closest            sample         point,         it
   will be assumed that                       location 35c has                 coordinates                (3, 4,        5),    and
   sample         point          37c      corresponds              to    a     location             with       coordinates
    (3.1,        3.9,        4.95).             (It      is     noted       that,         since         the      mesh        only
   approximates                 the      surface,            each      point         on      the       mesh         does       not
 5 necessarily               correspond            to     a    location         that       is       on     the      surface.)
   In this          case,        the distance between location                             35c and sample point
   37c       is      0.15         ( V(3.1-3)2+            (3.9-4)2+(4.95-5)2                   =      0.15).               (Since
   sample        point         37c     exists        only as         a  virtual         object          that       is     stored
   in     computer memory and displayed on-screen, this                                               distance may be
 0 more       precisely            stated        as     the      distance        between            location           35c     and
   the      "real-world"               location          that      corresponds            to      sample        point        37c.
   For      simplicity,             however,           the     present        description               refers         to    this
   distance             as     the     distance           between        the      location             and     the        sample
   point.)              Sample       point       37c      is     thus    closer         to     location            35c      than,
25 for      example,             another        sample         point       corresponding                 to     a     location
   with       coordinates               (3.1,      3.8,       4.9).        Sample         point        37c      is     in    fact
   closest          to      location          35c,      assuming         no     other         sample         point         has      a
   distance to location 35c that is                                  smaller than 0.15.
              Since,        typically,            the processor              receives          ECG signals                from a
30 large        number of locations                     spread over a              large portion of surface
   34,      the processor typically samples                                the entire mesh, in order to
   facilitate projecting any given                                  location onto               any portion of                 the
   mesh.              In     some        embodiments,               however,          if       the        locations            are
   restricted             to a      particular            portion        of the        surface,            the processor
                                                                   8

   may sample only a portion of the mesh that generally corresponds
   to the portion of the surface.
              Typically,             the       processor            organizes               the      sample          points         in      a
   space-partitioning                     data       structure,              such        as     a    k-dimensional                  (k-d)
 5 tree.           The       processor           may      then        quickly           identify             the       closest         one
   of     the      sample        points          for      each        location,              by     querying             the     space
   partitioning data structure.
              Fig.        2B    illustrates                one      way       in       which         the       initial,            rough
   projection               of     Fig.        2A    may        be     subsequently                   refined.                In     this
 0 refinement,               the     processor              identifies               a    respective               point         on    the
   mesh         that        is    closest           to       each       location.                   This         refinement               is
   illustrated               for     location            35c,       whereby            location             35c     is     projected
   onto        a   closest          point        38,       following             its       initial           projection              onto
   closest sample point 37c.
 5            First,          the     processor              identifies              a    portion             of     the      mesh        in
   which          the       closest          sample          point         is      located.                  Typically,              this
   portion           consists           of     the     tile        in    which          the       closest           sample         point
   is     located,            and     a   plurality              of     neighboring                 tiles         that       surround
   the       tile        in    which         the      closest           sample           point           is     located.               For
 0 example,            the neighboring tiles may include each tile                                                     in the mesh
   that         shares         at     least         one       vertex          with         the        tile        in      which        the
   closest           sample         point        is      located.                Fig.         2B      illustrates               such        a
   case, by            shading-in, with diagonal                              lines,          the identified portion
   of     the mesh in which closest                               sample point                  37c       is    located.             This
25 portion           includes          a    tile      40,       which        contains             closest           sample         point
   37c,         along        with       each        of      the       tiles          that        shares           at      least        one
   vertex with tile 40.
              Next,         the     processor             identifies,                in      the       identified              portion
   of the mesh, the closest point                                    38    that         corresponds to a location
30 that       is     closest        to location                35c,      relative             to other points                    in    the
   identified               portion         of    the       mesh.           In      other        words,           the      processor
   performs            a     more      accurate            projection               of      location             35c,       onto       the
   closest point in                    the identified portion of the mesh.                                               Typically,
   to       perform            this         projection,                 the          processor                calculates               the
                                                                      9

   distance           between          location          35c      and     each       of     the      (planar)        tiles        in
   the        identified                portion           of       the        mesh,          using          any       suitable
   techniques              known in the art                   for computing the distance between a
   point        and        a    plane.             (Since         the      tiles         exist         only       as    virtual
 5 objects           that        are     stored         in      computer           memory          and      displayed            on
   screen,            it      may      be     said,         more        precisely,              that       the      processor
   calculates               the      distance          between           location            35c       and      each       "real
   world"          plane          that       corresponds                to     a     respective              tile       in       the
   identified              portion          of     the      mesh.           For      simplicity,              however,           the
 0 present           description               refers          to      this       distance            as      the    distance
   between            the       location           and        the      tile.)               In     calculating               these
   distances,               the      processor            considers             every        point        in      each       tile,
   such       that           the      processor            finds         the       point          that       is,      overall,
   closest to location 35c.
 5           Thus,          for      example,          assuming            again         that       location           35c       has
   coordinates                 (3,     4,    5),       closest          point         38     may       correspond            to     a
   location           with       coordinates               (3,     4,    5.05),         such       that       the    distance
   between            location            35c        and       closest           point          38       is     only         0.05.
   Alternatively,                   for      example,             closest          point          38     may       correspond
 0 exactly to location 35c.
             If       the        processor             were         to       perform            the       more        accurate
   projection                of     Fig.        2B     without           first         performing              the      initial
   projection               of     Fig.      2A,       the      processor             might         need        to    consider
   every       tile         in    the     mesh       for      each      location.               Since,        however,           the
25 initial          projection             of Fig.          2A reduces             the      "area       of     interest"          to
   a   smaller          number of            tiles,         the     more       accurate projection of                         Fig.
   2B    may      be       performed           relatively              quickly.             Moreover,            as    long       as
   the      sampling            of     the      mesh       is     dense        enough,          the       closest         sample
   point       will         be    relatively            close         to    the      overall          closest        point        on
30 the     mesh,        such        that     it     is    generally             sufficient,             when       performing
   the      more        accurate           projection,                to     consider           a     relatively             small
   number of tiles                   in the vicinity of the closest sample point.
             Subsequently,                 as     shown        in      Fig.       2C,     the       processor           updates
   the     mesh,          in    accordance            with       the     property            that       was     measured          at
                                                                   10

   location            35c.           Typically,             in      updating            the     mesh,        the      processor
   divides            the      tile         41       that       contains            closest            point         38      into       a
   plurality             of   tiles         that        share       a    vertex         located         at     closest          point
   38,     and further associates                           closest point 38 with the property.
 5           For        example,           by      way      of      illustration,                it      will        be      assumed
   that      tile        41    has       a   first        vertex          42a     having        coordinates                (xO,     yO,
   zO),      a     second        vertex          42b      having         coordinates              (xl,      yl,      zl),       and     a
   third         vertex          42c        having          coordinates                 (x2,      y2,       z2),         and      that
   closest            point        38      has       coordinates                (x3,       y3,      z3).           It      will      be
 0 further           assumed          that       first       vertex          42a     is     associated             with       an LAT
   value        of     TO,     second           vertex        42b       is     associated            with       an     LAT      value
   of    Ti,        and    third          vertex         42c    is      associated              with      an    LAT       value      of
   T2,     such that             tile       41 may be defined by the following collection
   of    data         points:           { (xO,       yO,     zO,       TO),        (xl,      yl,     zl,      Ti),        (x2,      y2,
 5 z2,     T2)}.
             The          processor,                 upon           identifying                 closest             point           38,
   associates               closest           point         38      with        an      LAT      value,           measured           at
   location            35c, of T3,               and retiles               the mesh to incorporate closest
   point        38,       such       that       tile       41    is      replaced           by   the       following            three
 0 new tiles:
              (i) New tile 44a:                      { (xO, yO,           zO,     TO),       (xl, yl,          zl,     Ti),        (x3,
   y3,     z3,       T3)}
              (ii)       New      tile        44b:        { (xi,       yl,      zl,       Ti),       (x2,       y2,      z2,      T2),
    (x3, y3,           z3,    T3)}
25            (iii)        New      tile        44c:       { (xO,        yO,      zO,      TO),       (x2,      y2,       z2,     T2),
    (x3, y3,           z3,    T3)}
             In updating the mesh, the processor typically also                                                           recolors
   the mesh in accordance with the measured property.                                                             For example,
   referring again to the particular                                        illustration shown in Fig.                              2C,
30 it    is      possible            that       TO     =   Ti     =    T2,      such       that      tile       41,      prior       to
   the      updating           of      the      mesh,       was        colored          uniformly,             in     accordance
   with       the       value         of     these        LATs.            Assuming,            however,            that        T3   is
   different             from TO,           Ti,      and     T2,       each of          new tiles           44a-c         would be
                                                                      11

   colored         non-uniformly,                 in       accordance             with       the      LAT       gradient
   across       the    tile.             The    new       coloring          of     the     mesh      would        thus    be
   different from the previous coloring of the mesh.
             Typically,             the       processor            also         displays          a    marker          over
 5 closest       point        38,        the    marker         indicating             to    the    physician           that
   data      were     acquired             for   closest          point        38.        (This      marker         may   be
   identical         to    other         markers        displayed            over      other     vertices           of   the
   mesh.)         Subsequently,                by    clicking          on      the     marker,        the      physician
   may view the data that were acquired.
 0           It  is    noted          that     the     updating          of      the     mesh,      as    illustrated
   in    Figs.      2A-C,        does       not    change         the     topology          of   the     mesh,        since
   the       locations           at       which        the      measurements               were       acquired           are
   projected          onto         the       mesh.            Even       the       retiling          of      the      mesh,
   illustrated           in       Fig.       2C,     does        not     change          the    topology           of    the
 5 mesh,       since      each         of    new    tiles        44a-c        is     coplanar         with       original
   tile 41.
             Reference          is     now     made       to    Fig.       3,     which      is    a   flow        diagram
   for     a   method        45      for     updating          mesh      30,      in     accordance           with     some
   embodiments of the present invention.                                        Method 45         is   performed by
 0 processor 28,             generally as described above.
             First,      at       a     sampling         step       46,       the     processor         samples          the
   mesh, such that                the density of the                   sample points              is greater than
   the       density         of       the      vertices.                Next,         the      processor,             at    a
   receiving          step         48,       receives          ECG       signals          from       the       intrabody
25 catheter,         acquired            from various             locations            on   the     surface         of   the
   heart.         (Receiving              step    48     and     property-identifying                    step       49   may
   be     performed          prior          to   sampling           step        46.)         By    processing            the
   signals,        the processor identifies a property                                     (such as an LAT)               of
   each      of  the     locations,             at a       property-identifying                    step       49.      At a
30 selecting          step          50,       the     processor             then         selects        one        of    the
   locations,          and          identifies             the      closest            sample        point         to    the
   selected         location,               at   a     closest-sample-point-identifying                                step
   52.       As   described             above,      this       constitutes             a   rough projection               of
   the selected location onto the mesh.
                                                                12

            Next,        at    a   mesh-portion-identifying                       step       54,     the     processor
   identifies             a   portion          of    the      mesh,        such      as     a   neighborhood              of
   several           tiles,           that         contains           the       closest            sample          point.
   Subsequently,                 at     a      closest-point-identifying                          step        56,        the
 5 processor             identifies            the     closest          point        on      the      mesh       to      the
   selected          location;          as     described           above,       this       constitutes             a   more
   accurate         projection            onto      the mesh.              Subsequently,             at    a   retiling
   step      58,       the     processor           adds      a    new      vertex        to    the      mesh      at     the
   closest         point,         and     retiles         the      mesh      accordingly,               as    shown       in
 0 Fig.      2C.         Next,       or    in      conjunction            with     retiling           step      58,      the
   processor associates                    the new vertex with the                        identified property
   of the selected location, at an associating step                                             60.
            Subsequently,               at     a   checking          step     62,      the     processor           checks
   if    any     more       locations          await      projection           onto       the     mesh.         If     yes,
 5 the     processor           returns         to    selecting           step     50,      and     then      processes
   the     next       selected         location          at    described          above.           Otherwise,            the
   processor            recolors        the      mesh,       in     accordance           with      the     properties
   of the newly-added vertices.
            In     some        embodiments,              selecting           step        50,      closest-sample
 0 point-identifying                  step      52,    mesh-portion-identifying                        step      54,     and
   closest-point-identifying                          step       56     are    performed            in     real-time,
   during        the      acquisition             of   ECG      signals        from       the     surface         of     the
   heart.         In other words,                 these steps may be performed in parallel
   with      receiving            step      48     and    property-identifying                      step      49,       such
25 that     the      processor          may project              a   first      group        of    locations           onto
   the mesh, while continuing to receive                                    and process             signals        from a
   subsequent group of locations.
            In     some        embodiments,              the       processor           uses       the      projection
   techniques            described          herein        to     accurately           place       a    marker,          such
30 as an      icon, over the mesh, without necessarily updating the mesh
   itself.               For      example,           given        an      electrode           at      a    particular
   location          on      the     surface         of     the      heart,       the       processor           may,      as
   described             herein,        project           the       particular            location           onto        the
   closest point on the mesh, and then display an icon representing
                                                               13

   the       electrode           over      this      closest         point.              Alternatively             or
   additionally,              using     the    projection         techniques             described          herein,
   the processor may display an                         icon representing catheter                        29    (Fig.
   1)      over       the      portion        of    the      mesh       that        is      closest         to    the
 5 catheter's            location.           Accurately          placing          such       icons       over     the
   mesh may help guide                  the physician           in acquiring ECG readings                        from
   the proper locations.
            Although            the      present          description               relates          mainly        to
   electroanatomical                 maps,        it      is     noted           that        the      projection
 0 techniques             described         herein        may      be       used        for      any      suitable
   application            in which a mesh model                 of a       three-dimensional surface
   is    updated         in     accordance        with      newly-acquired               information            about
   the     surface,          and/or     in    which      markers        are      displayed         over       such   a
   mesh to mark particular locations on the surface.
 5           It    will      be   appreciated          by   persons         skilled         in    the     art    that
   the       present           invention         is      not     limited            to      what        has      been
   particularly shown and described hereinabove.                                         Rather, the            scope
   of       embodiments             of      the       present          invention               includes          both
   combinations               and      subcombinations               of       the        various          features
 0 described            hereinabove,         as    well      as   variations             and     modifications
   thereof         that       are   not     in    the     prior       art,       which       would       occur     to
   persons           skilled         in      the      art       upon         reading           the       foregoing
   description.               Documents        incorporated by reference                        in the present
   patent        application         are     to be      considered           an    integral        part       of the
25 application            except      that     to    the     extent        any    terms        are   defined       in
   these incorporated documents                        in a manner that conflicts with the
   definitions              made     explicitly            or     implicitly              in      the       present
   specification,              only the definitions                in      the present           specification
   should be considered.
30
                                                           14

                                                       CLAIMS
   1.        A system for updating a mesh, which includes a plurality of
   vertices,        representing            an    electroanatomical                 map      of   a    surface         of
   a heart, the system comprising:
 5           an electrical interface;                   and
             a processor, configured:
                   to     define       a   plurality            of     sample      points         on     the      mesh,
             such  that      a   density        of    the     sample       points        is    greater          than      a
             density of the vertices;
 0                 to     receive,        via     the     electrical           interface,           a     plurality
             of   signals          from        an       intrabody            catheter,            the         signals
             indicating an electrical property of each of a plurality of
             locations on the surface of the heart;                               and
                   to     update      the     mesh       in     accordance           with      the      electrical
 5           property,          by,      for        each        particular              location             of       the
             locations:
                            identifying            a    closest          one    of    the      sample         points,
                   which corresponds to a                      location that              is   closest to             the
                   particular            location,           relative         to      other       ones         of     the
 0                 sample points,
                            subsequently,               identifying,             in     a     portion          of     the
                   mesh      in   which      the      closest         one    of    the      sample points              is
                   located,          a     closest          point,         which        corresponds               to      a
                   location         that      is     closest          to   the     particular             location,
25                 relative         to    other       points         in   the     portion         of     the      mesh,
                   and
                            subsequently,              associating            the     closest          point        with
                   the electrical property of the particular location.
   2.        The  system        according         to     claim        1,   wherein          the   processor            is
30 configured to define the                    sample points by uniformly sampling                                    the
   mesh.
   3.        The  system        according         to     claim        1,   wherein          the   processor            is
   configured         to    define        the     sample        points       by      sampling          the      entire
   mesh.
                                                           15

   4.        The     system       according            to    claim      1,     wherein          the    processor        is
   further         configured            to      organize         the      sample          points       in      a   space
   partitioning               data        structure,             and      wherein            the      processor         is
   configured            to   identify           the     closest        one      of      the    sample        points    by
 5 querying the space-partitioning data structure.
   5.        The     system according to claim 1, wherein the portion of the
   mesh       consists         of     a    tile      in     which      the       closest         sample         point   is
   located,          and    a   plurality           of     neighboring             tiles      that     surround        the
   tile in which the closest sample point is                                         located.
 0 6.        The      system       according            to    claim       5,     wherein           the    neighboring
   tiles        include        each       tile      in     the     mesh       that        shares      at      least    one
   vertex        with       the       tile        in    which        the       closest          sample         point    is
   located.
   7.        The     system       according            to    claim      1,     wherein          the    processor        is
 5 configured            to    update          the    mesh       by   dividing             a  tile      of      the   mesh
   that      contains         the      closest         point       into      a    plurality          of    tiles      that
   share a vertex located at the closest point.
   8.        The     system       according            to    claim      1,     wherein          the    processor        is
   configured             to     update           the      mesh       by       recoloring             the       mesh    in
 0 accordance with the electrical property.
   9.        The     system       according            to    claim      1,     wherein          the    processor        is
   configured to update the mesh without changing a topology of                                                        the
   mesh.
   10.       The     system       according            to    claim      1,     wherein          the    processor        is
25 configured             to     identify            the      closest          point         by      calculating           a
   distance            between           the       particular              location            and       each        plane
   corresponding to a respective tile in the portion of the mesh.
   11.       A method for updating a mesh, which includes a plurality of
   vertices,           representing             an    electroanatomical                   map     of   a   surface      of
30 a heart, the method comprising:
             using a processor,                   defining a plurality of                        sample points          on
   the     mesh,        such     that        a   density         of   the      sample        points        is      greater
   than a density of the vertices;
                                                               16

             receiving          a      plurality           of     signals          from     an      intrabody
   catheter,        the     signals        indicating          an   electrical         property        of  each
   of a plurality of locations on the surface of the heart;                                          and
             updating         the       mesh       in     accordance           with     the       electrical
 5 property, by, for each particular location of the locations:
                   identifying            a   closest        one    of    the    sample     points,       which
             corresponds to a             location that            is    closest to       the particular
             location, relative to other ones of the sample points,
                   subsequently,             identifying,            in   a portion       of    the mesh in
 0           which    the      closest       one      of    the    sample       points     is     located,     a
             closest      point,         which       corresponds           to     a   location        that   is
             closest       to      the      particular           location,          relative        to    other
             points in the portion of the mesh, and
                   subsequently,              associating           the     closest      point       with   the
 5           electrical property of the particular location.
   12.       The   method         according          to     claim       11,    wherein        defining      the
   sample      points       comprises         defining         the     sample      points     by    uniformly
   sampling the mesh.
   13.       The   method         according          to     claim       11,    wherein        defining      the
 0 sample       points       comprises         defining         the     sample      points      by   sampling
   the entire mesh.
   14.       The   method           according          to     claim        11,      further       comprising
   organizing          the        sample        points        in      a    space-partitioning              data
   structure,         wherein           identifying          the     closest        one   of     the     sample
25 points        comprises          identifying            the     closest         one   of      the     sample
   points by querying the space-partitioning data structure.
   15.       The  method         according          to    claim     11,     wherein      the     portion     of
   the mesh consists of a tile                        in which the closest sample point                      is
   located,       and     a   plurality          of    neighboring          tiles     that     surround the
30 tile in which the closest sample point is                                 located.
                                                           17

  16.   The   method     according            to     claim      15,     wherein   the   neighboring
  tiles   include     each      tile       in     the     mesh      that   shares    at   least    one
  vertex    with   the       tile       in     which        the      closest    sample     point    is
  located.
5 17.   The method according to                    claim 11,         wherein updating the mesh
  comprises    dividing       a    tile      of     the mesh        that   contains    the     closest
  point   into  a   plurality           of    tiles       that     share    a  vertex    located    at
  the closest point.
  18.   The method according to                    claim 11,         wherein updating the mesh
0 comprises updating the mesh by recoloring the mesh in                                  accordance
  with the electrical property.
  19.   The method according to                    claim 11,         wherein updating the mesh
  comprises    updating       the       mesh      without        changing     a  topology       of the
  mesh.
5 20.   The   method     according           to     claim      11,    wherein   the   processor     is
  configured     to     identify           the        closest        point    by    calculating        a
  distance     between         the       particular              location       and    each      plane
  corresponding to a respective tile in the portion of the mesh.
                                                       18

                                                               <U+2704><U+260E><U+2706><U+271D><U+271E><U+271F><U+260E><U+2720><U+260E><U+2721><U+261B> <U+261E><U+270C><U+260E><U+260E><U+261B>
                  <U+2719>                                                              <U+2701><U+2702>
<removed-date>
              <U+270D>
                                                                    <U+271A>            <U+2727>
                                                                <U+270D>                <U+270D>
                                       <U+2714>
                                   <U+270D>
                                                                        <U+2718>             <U+2605>
                                                                        <U+2717>             <U+2729>
                                                                        <U+2716>             <U+2605>
                                                                        <U+2715>
<removed-apn>
                                                                            <U+271C><U+271B>
                                                                                          <U+270D>
                                                                                          <U+270E>
                               <U+2713>
                           <U+270D>
                                                           <U+2712>
                                                           <U+270D>
                                                                                              <U+272A><U+271B>
                                               <U+2711>
                                           <U+270D>
                                                   <U+270F>
                                                   <U+270E>
                                                       <U+270E>
                                                       <U+270D>
                      <U+2726>
                      <U+2725>
                      <U+2724><U+2723>
                      <U+2722>

                                   <U+2704><U+260E><U+2706><U+271D><U+271E><U+271F><U+260E><U+2720><U+260E><U+2721><U+261B> <U+261E><U+270C><U+260E><U+260E><U+261B>
                                              <U+2701><U+2702>
                                  <U+271A><U+2725>
<removed-date>
                                       <U+271A><U+2722><U+2718>                                            <U+271A><U+2723>
                <U+271A><U+2714>
                      <U+271A><U+2726><U+2716>
                            <U+271A><U+2722><U+2716>
<removed-apn>
              <U+271A><U+2726><U+2718>
                <U+271A><U+2726><U+2717>
                                              <U+271A><U+2722><U+2717>                                    <U+270D><U+270E><U+270F><U+2711> <U+2712><U+2724>
                                                                                      <U+271A><U+2723>
                                                                                 <U+271A><U+271B>
                                                                                 <U+271A><U+2722><U+2717>
                                                                                <U+2714><U+2723>
                                                                                     <U+270D><U+270E><U+270F><U+2711> <U+2712><U+271C>
                                                   <U+271A><U+271B>
                                                                          <U+2714><U+2715><U+2718>
                                                              <U+2714><U+2714><U+2716>
                                                                           <U+2714><U+2719>
                                                                           <U+2714><U+2714><U+2718>
                                        <U+2714><U+2715><U+2716>             <U+2714><U+2714><U+2717>         <U+2714><U+2715><U+2717>              <U+270D><U+270E><U+270F><U+2711> <U+2712><U+2713>

                                            <U+2704><U+260E><U+2706><U+271D><U+271E><U+271F><U+260E><U+2720><U+260E><U+2721><U+261B> <U+261E><U+270C><U+260E><U+260E><U+261B>
                                                            <U+2702><U+2701><U+2702>
              <U+270C><U+270F>
<removed-date>
                                                                    <U+2701> <U+2702> <U+2701> <U+2704><U+260E>                                           <U+270C><U+261E>
                                                       <U+2702>            <U+2701> <U+2704> <U+2706><U+271D> <U+271E> <U+2701>
                                    <U+261E><U+271E><U+2720><U+2706><U+271D><U+260E> <U+2720><U+260E><U+261E><U+270C>                     <U+261B><U+270C>       <U+260E><U+2721><U+261E> <U+261B>             <U+2704><U+260E><U+271E><U+261B><U+260E><U+2704>
                                             <U+261B><U+270C><U+271E><U+2721>          <U+260E><U+2721><U+261E> <U+261B>                     <U+260E><U+2704><U+261B> <U+271F><U+260E><U+261E>
               <U+270C><U+2711>       <U+2704><U+260E><U+271F><U+260E>   <U+2701><U+271E>  <U+260E> <U+260E><U+271F>     <U+260E> <U+2701><U+260E>
                                              <U+261E>    <U+2721><U+271E><U+271D><U+261E>         <U+271D><U+2706> <U+2706><U+2704>   <U+2720> <U+271D>      <U+271F><U+271E><U+261B>      <U+2701><U+2706> <U+2706> <U+271F> <U+271D>
                                                                                               <U+2721><U+261E>       <U+2721> <U+261E>       <U+2704>    <U+271E><U+271F><U+260E>
<removed-apn>
                   <U+270C><U+2712>     <U+2701><U+2702>
                           <U+260E><U+2721><U+261B>      <U+2701><U+271D><U+2704> <U+2706>   <U+2706><U+2704>    <U+2706><U+260E><U+2704><U+261B>      <U+2704> <U+2706><U+271D>        <U+260E><U+271E><U+271F><U+270C>         <U+2706><U+271D>   <U+261B><U+270C><U+260E> <U+271D>     <U+2706>   <U+271F><U+271E><U+261B>       <U+2701><U+2706>  <U+2721><U+261E>
                                                  <U+261E><U+260E><U+271D><U+260E><U+271F><U+261B> <U+2721><U+260E>             <U+2720> <U+2706>
                                                                        <U+261B> <U+271D>      <U+271F><U+271E><U+261B>      <U+2701><U+2706>
                                                                                           <U+2721>             <U+270F><U+270E>
                                        <U+2701><U+2702>  <U+260E><U+2721><U+261B>   <U+2701><U+271D><U+2704> <U+2706>    <U+271F><U+271D>   <U+261E><U+260E><U+261E><U+261B> <U+261E><U+271E><U+2720><U+2706><U+271D><U+260E> <U+2706>                  <U+2706><U+2701>   <U+2721><U+261B>            <U+270F><U+270D>
                                             <U+2701><U+2702>     <U+2701><U+271D><U+2704> <U+2706> <U+2701><U+2706> <U+2706><U+271D>                                                        <U+270F><U+270C>
                                        <U+2706>         <U+2701><U+2701><U+260E> <U+2706>                                             <U+2706><U+2701>
                                                  <U+260E><U+2721><U+261B>           <U+2706>    <U+2704><U+261B>      <U+2721>            <U+2720><U+260E><U+261E><U+270C>
                                    <U+271F>     <U+2721><U+261B><U+271E> <U+2721> <U+2721>           <U+271F><U+271D>       <U+261E><U+260E><U+261E><U+261B> <U+261E><U+271E><U+2720><U+2706><U+271D><U+260E> <U+2706>                      <U+2721><U+261B>
                                             <U+2701><U+2702> <U+2701><U+271D><U+2704> <U+2706>     <U+2706><U+2701> <U+2701>                                                <U+270F><U+261E>
                                            <U+2701><U+2702> <U+2701><U+271D><U+2701> <U+2702> <U+2706> <U+2701><U+2706> <U+2706><U+271D>
                                                  <U+260E><U+2721><U+261B>           <U+271F><U+271D>      <U+261E><U+260E><U+261E><U+261B> <U+2706>            <U+2721><U+261B> <U+2721>
                                              <U+260E><U+2721><U+261B>          <U+260E>    <U+2706>       <U+2704><U+261B>       <U+2721>        <U+2720><U+260E><U+261E><U+270C>
                               <U+271E>   <U+2702><U+2702> <U+271E> <U+260E><U+2704><U+261B><U+260E>       <U+2720>   <U+271E><U+261B> <U+271F><U+271D>    <U+2706>    <U+261E><U+260E><U+261E><U+261B> <U+2706>      <U+2706><U+2701>   <U+2721><U+261B> <U+271E><U+2721>        <U+2702>   <U+2704><U+260E><U+261B> <U+271D><U+260E> <U+2701>             <U+270F><U+2711>
                                                  <U+2706><U+2701>          <U+271E> <U+2720> <U+2701>                                          <U+261E><U+270E>
                                                   <U+2706>      <U+2704> <U+2706><U+271D> <U+2706> <U+2701><U+2706>
                                            <U+271E><U+261E><U+261E>    <U+271F> <U+271E><U+261B><U+260E> <U+2721><U+260E>                  <U+260E><U+2704><U+261B><U+260E>                  <U+261B><U+270C>
                                                 <U+2706><U+2704>     <U+2706><U+260E><U+2704><U+261B>                 <U+271D>   <U+271F><U+271E><U+261B>           <U+2721>
                                                                <U+261E><U+270D>
                                        <U+2704>                    <U+2704>
                                                        <U+2706> <U+2706> <U+2701><U+2706> <U+2721>
                                                                    <U+271E><U+2721>
                                             <U+260E><U+261E>
                                                       <U+2720>   <U+2704><U+260E> <U+271D>         <U+271F><U+271E><U+261B>          <U+2721><U+261E>
                                                                         <U+2721>   <U+2706>
                                                        <U+2704><U+260E><U+271F>     <U+2706><U+2706>  <U+271D>   <U+2704> <U+2720><U+260E><U+261E><U+270C>                 <U+261E><U+270C>
                        <U+270D><U+270E><U+270F><U+2711>   <U+261B>

