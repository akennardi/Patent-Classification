                                        ABSTRACT
        Among other things, embodiments of the present disclosure allow multiple virtual
private network connections to be created without the need for administrative privileges, and
allow network traffic to be routed using a single virtual adapter instead of a dedicated virtual
adapter for each virtual network connection.

      WO 2016/126313                                                                                         PCT/US2015/063783
                                                                  12/14
                                       -                                                                           I     I
       -                       -                    I                    ---                                       I     I
                                               -- I------------                                                          I
       -4              1                     -                                            -.                       I     I
       0             -                   I          I                              '          '
       2                                                                               %                           I     I
       a.                                                                                                          I     I
       >       /         $~
                                  /
                                       I
                                                    I                         a
                                                                                                '.                 I
                                                                                                                   I
                                                                                                                         I
                                                                                                                         I
                                f                                             N                                    I     I
                 ri~v:                                                                                                   I
                I1flO?4 NdA I                    ____________________                                              I     I
                             I                      I                                                              I     I
                                                              'NJ                                          itj           I
                       F1                                                                                       Ij       I
                       I~I                                                                                      I;
-I
N          I>          j~I                        4
                                                                                        I
                                                                                         p             6
                                                                                                       ci
                                                                                                                Ig       I
                                                                                                                         I
                                                                                                                         I
                                                                                                   ~4.         I;        I
                                                                                                   ~                     I
                ~~
                                                                 o.    ~             I;            5:'I                  I
                            0.
                                                                 &                                      0g
                                                                                                                   I     I     r
                                                    II
       ~       ~
                                                                                                       N
                                                                                                       -
                                                                                                                   I     I     a.C)
                                                                              , ill         I                      I     I
      ___________
       P
       -                             S
                                    'I
                                      UI   -        tEf~y                     ~It
                                                                               'hi
                                                                                            I                      I
                                                                                                                   I
                                                                                                                         I
                                                                                                                         I
                                      P
       0
        .4
       a.
       a-
                                                                                       SI
                                                                                        V       --s,-      0~
      ________                                                                                                     I
       2
                                                 ________
                                                                                                                   I     I
                                                                                                                   I     I
       a.                                                                                                                i
       0.
                                                                                                                   I     I
   I.                                                                                                              I
        3?iVMiJOS H3Vds-~A3sfl                            ~VMi~OS            VdSflN8~)4

WO 2016/126313                                                               PCT/US2015/063783
                  MULTI-TUNNELING VIRTUAL NETWORK ADAPTER
                   CROSS-REFERENCES TO RELATED APPLICATIONS
[0001]    This application claims priority to U.S. Pat. App. Ser. No. 14/630,550, filed
February    24,     2015   and   entitled   "MULTI-TUNNELING          VIRTUAL       NETWORK
ADAPTER," and to U.S. Prov. Pat. App. No. 62/112,457, filed February 5 , 2015 and
entitled "MULTI-TUNNELING VIRTUAL NETWORK ADAPTER," the disclosures of
which are incorporated herein by reference.
[0002]    This application is related to U.S. Patent Application No. 14/578,140, filed
December 19, 2014 and entitled "SYSTEMS AND METHODS FOR PROTECTING
NETWORK DEVICES," the disclosure of which is incorporated herein by reference.
                                         BACKGROUND
[0003]    In a client-server network model, companies or service providers typically offer
services and/or applications to client computers and to other services over a computer
network. Servers and associated services may include, for example, mail servers, file servers,
Customer Relationship Management or CRM services, Enterprise Resource Planning or ERP
services, document management services, and the like.
[0004]    On the one hand, security needs to be guaranteed by restricting the access to these
services to trusted users and clients only. On the other hand, trusted users need access to the
services in an easy and straightforward manner. Preferably, the services can be reached from
anywhere at any time. With the "Bring your own device" (or "BYOD") policy finding more
and more acceptance in companies, services should also be reachable from "anything", i.e.,
from any device owned by a trusted user such as for example a tablet computer, a laptop
computer, his computer at home or a smartphone.
[0005]    Various conventional approaches exist to attempt to prevent unauthorized access to
such application servers or to the services or applications served by these application servers.
                                                1

WO 2016/126313                                                                PCT/US2015/063783
For example, placing application servers within a private network is itself a security measure
as it isolates the companies network, Local Area Network (or "LAN") from the Interne and
other external public networks. Devices, and thus services, inside the private network are not
visible from the public network. The content of the traffic in the private network, and the
manner the traffic can traverse the company's network boundaries, can be regulated and
monitored by using Network Address Translation (NAT), firewall rules and proxies in the
gateway devices separating the WAN from the company's private network. Private networks
may further be subdivided physically or virtually by for example Virtual LAN's in order to
further separate applications servers from potential unauthorized access by clients within the
company's private network.
[0006]      Network level security may be enforced on a user by user or a client by client basis,
such as by configuring a client's firewall to (by default) only have access to an authentication
server. When the client is authorized, the client's firewall is opened and all network devices
are configured to let pass the client's network traffic to application servers it has been granted
access to.
[0007]      Network level security on a client or user level may also be attempted by a
controller generating access rights for users based on identity profiles and health profiles.
The controller then configures a protection device thereby providing network access to a set
of servers.
[0008]       The enforcement of network level security in an accepting host may be attempted
by configuring the host by a controller. When an initiating host is authorized access to an
accepting host, the controller configures the accepting host to accept network connections
from the initiating host.
[0009]       Security within a private network may further be enforced by application level
security where user or clients can only access the services on the servers after authentication.
                                                 2

WO 2016/126313                                                                 PCT/US2015/063783
In such case a client may find the application server within the network, for example by its IP
network address and may find the service running on the application server by its TCP or
UDP port number, but the service or application itself may deny the client or user based on
authentication credentials. Such authentication may be locally managed by the individual
services or centrally by an authentication server. The services then check the authentication
credentials against such an authentication server before granting a user and/or client access to
a certain service.
[0010]     Access to a company's private network may by established by a VPN or the Virtual
Private Network where a secured networking tunnel is setup between a client device and the
private network. The setup of such a tunnel is only granted by authentication with a VPN
server. Different authorization schemes exist to ensure that only trusted users and/or clients
can join a VPN.
[0011]     Another solution for providing access to services in a company's private network is
by opening up outside access to some services. For example, an email server may allow
connections from outside so that users can check their email when they are not in the
company. These services are sometimes restricted by only providing access through a
specific interface such as for example through the company's website so that the client does
not have physical network access to the server running the service but only to a web server
providing a subset of the services.
[0012]      In risk based authentication, access to services is not only granted based on
identification of the user and/or client by authentication credentials, but also based on further
metrics in order to derive a level of trust appropriate to the risk level. Such metrics are for
example: the location of the user, the type of client, the operating system, if all security
patches have been installed, the logon history of the user etc. This way a user logging on by
VPN may be restricted from services he would not be restricted from when logging on from
                                                  3

 WO 2016/126313                                                              PCT/US2015/063783
within the private network. Or a user logging on from within the private network with his
own device may be denied some services.
[0013]     Virtual network adapters are used when setting up VPN connections whereby the
operating system routes packets destined to the VPN through the virtual adapter. Virtual
adapters run in the kernel space of an operating system. The VPN software, i.e., the
dedicated software application running in user-space, then encrypts the complete packet and
sends it to its destination (VPN service at the other side where the inverse process occurs).
In conventional systems, however, administrative privileges are needed in order to create a
virtual adapter, as the adapter resides in kernel space. Additionally, for every VPN
connection that is made, a new virtual adapter is needed. Embodiments of the present
disclosure address these and other issues.
                                           SUMMARY
[0014]     Among other things, embodiments of the present disclosure allow multiple virtual
private network connections to be created without the need for administrative privileges, and
allow network traffic to be routed using a single virtual adapter instead of a dedicated virtual
adapter for each virtual network connection.
[0015]     A computer-implemented method according to one embodiment of the present
disclosure includes: receiving a data packet over a network by a routing component of a
virtual private network (VPN) client, the VPN client residing in a user space portion of an
operating system running on a computer system; identifying, by the routing component, a
destination for the data packet on the network; creating, by the VPN client, a connection to a
gateway corresponding to the destination for the data packet; and transmitting the data packet
to the destination via the gateway.
                                                 4

 WO 2016/126313                                                               PCT/US2015/063783
[0016]    The present disclosure includes various methods, apparatuses (including computer
systems) that perform such methods, and computer readable media containing instructions
that, when executed by computing systems, cause the computing systems to perform such
methods.
[0017]    Other features will be apparent from the accompanying drawings and from the
detailed description which follows.
                             BRIEF DESCRIPTION OF DRAWINGS
[0018]    Fig. 1 is an exemplary system for protecting network devices from network access
by untrusted client devices according to various aspects of the disclosure.
[0019]    Fig. 2 is an exemplary process executed by a client device to gain network access to
protected network devices according to various aspects of the disclosure.
[0020]    Fig. 3 is an exemplary process executed by an authentication server for providing a
client access and tunnel list to a client device allowing this client network access to protecting
network devices according to various aspects of the disclosure.
[0021]    Fig. 4 is an exemplary process executed by a gateway to provide a client access to
protected network devices behind a firewall in this gateway according to various aspects of
the disclosure.
[0022]    Fig. 5 is an exemplary process executed by client device to gain network access to a
second selection of network devices behind a firewall of a gateway after having gained
access to a first selection of these network devices according to various aspects of the
disclosure.
                                                  5

 WO 2016/126313                                                             PCT/US2015/063783
[0023]    Fig. 6 illustrates an exemplary exchange of a keep alive message between a client
device and a gateway in order to maintain a networking tunnel between the client and the
client device according to various aspects of the disclosure.
[0024]    Fig. 7 illustrates an exemplary system for protecting network devices from network
access by untrusted client devices according to various aspects of the disclosure.
[0025]    Fig. 8 illustrates an exemplary system for protecting network devices from network
access by untrusted client devices according to various aspects of the disclosure.
[0026]    Fig. 9 illustrates an exemplary system for protecting network devices from network
access by untrusted client devices where the networking load of a gateway is balanced by a
second gateway according to various aspects of the disclosure.
[0027]    Fig. 10 illustrates an exemplary computing system according to various aspects of
the disclosure.
[0028]    Fig. 11 illustrates an exemplary system showing conventional methods for creating
VPN connections and routing packets.
[0029]    Fig. 12 illustrates an exemplary system utilizing a multi-tunneling virtual network
adapter according to various aspects of the present disclosure.
[0030]    Fig. 13 illustrates another exemplary system utilizing a multi-tunneling virtual
network adapter according to various aspects of the present disclosure.
[0031]    Fig. 14 is an exemplary process according to various aspects of the present
disclosure.
                                   DETAILED DESCRIPTION
[0032]    Subject matter will now be described more fully hereinafter with reference to the
accompanying drawings, which form a part hereof, and which show, by way of illustration,
specific example embodiments. Subject matter may, however, be embodied in a variety of
                                                6

 WO 2016/126313                                                                PCT/US2015/063783
different forms and, therefore, covered or claimed subject matter is intended to be construed
as not being limited to any example embodiments set forth herein; example embodiments
are provided merely to be illustrative. Likewise, a reasonably broad scope for claimed or
covered subject matter is intended. Among other things, for example, subject matter may be
embodied as methods, devices, components, or systems. Accordingly, embodiments may,
for example, take the form of hardware, software, firmware or any combination thereof
(other than software per se). The following detailed description is, therefore, not intended to
be taken in a limiting sense.
[0033]     In the accompanying drawings, some features may be exaggerated to show details
of particular components (and any size, material and similar details shown in the figures are
intended to be illustrative and not restrictive). Therefore, specific structural and functional
details disclosed herein are not to be interpreted as limiting, but merely as a representative
basis for teaching one skilled in the art to variously employ the disclosed embodiments.
[0034]     Reference in this specification to "one embodiment" or "an embodiment" means
that a particular feature, structure, or characteristic described in connection with the
embodiment is included in at least one embodiment of the disclosure. The appearances of
the phrase "in one embodiment" in various places in the specification are not necessarily all
referring to the same embodiment, nor are separate or alternative embodiments mutually
exclusive of other embodiments. Moreover, various features are described which may be
exhibited by some embodiments and not by others. Similarly, various requirements are
described which may be requirements for some embodiments but not other embodiments.
[0035]     Any combination and/or subset of the elements of the methods depicted herein
may be combined with each other, selectively performed or not performed based on various
conditions, repeated any desired number of times, and practiced in any suitable order and in
conjunction with any suitable system, device, and/or process. The methods described and
                                                   7

 WO 2016/126313                                                              PCT/US2015/063783
depicted herein can be implemented in any suitable manner, such as through software
operating on one or more computer systems. The software may comprise computer-readable
instructions stored in a tangible computer-readable medium (such as the memory of a
computer system) and can be executed by one or more processors to perform the methods of
various embodiments.
[0036]     Fig. 1 illustrates an exemplary system for the protection of network devices from
unwanted network access according to various aspects of the present disclosure. In this
example, three network devices (application servers 141, 142 and 143) are part of a private
network 140. Access to the servers 141-143 is obtained from within the private network 140
via a private network address. In this context, the term "private" refers to the fact that the
application servers 141-143 are not globally routable. In other words, the application
servers 141-143 cannot be addressed by their private network address from outside the
private network 140.
[0037]     The private network 140 and other components in Fig. 1 may utilize any number
and type of communication protocols, also referred to as the Internet Protocol ("IP"), or as
the Transmission Control Protocol/Internet Protocol ("TCP/IP"). For example, the private
network 140 may have address ranges as set by RFC 1918 for Internet Protocol Version 4 or
IPv4 and RFC 4193 for Internet Protocol Version 6 or IPv6.
[0038]     Application servers 141-143 provide services over the network 140 to other
computing devices. Any number and type of application servers and associated services may
be used in conjunction with embodiments of the present disclosure, such as mail servers, file
servers, Customer Relationship Management or CRM services, Enterprise Resource Planning
or ERP services, and/or document management services.
[0039]     A data connection may be established with any of application servers 141-143 by
opening a communication socket with the respective application server on a port (or port
                                                8

 WO 2016/126313                                                                PCT/US2015/063783
range) associated with the service. Application servers 141-143 may correspond to physical
devices with a physical networking interface associated with a private network address.
Alternatively, application servers 141-143 may also correspond to virtual server instances
running on one or more physical servers. Virtual server instances may each have a virtual
network interface with an associated private network address. Virtual server instances may
include, as well as operate in conjunction with, one or more user space instances (also known
as software containers, virtual engines, virtual private servers, and/or jails). Such user space
instances may be implemented in any suitable manner, including via the DOCKER software
tool.
[0040]     In the example shown in Fig. 1, the private network 140 is separated from the
external network 180 by a gateway 100, thereby allowing networking traffic between the
external network 180 and the private network 140 in a controlled way. The system of Fig. 1
can identify clients 121, 122 as "trusted clients" having access rights to one or more of the
application servers 141-143 within the private network 140 in order to use the services
running thereon. The clients 121, 122 may be, or include, physical hardware and/or virtual
components. For example, a client 121, 122 may include a virtual operating system running
on a physical device, such as a mobile device. The system can also grant network access to a
selection of the application servers 141-143 which the clients 121, 122 are allowed to access,
and deny network access to any application server the clients 121, 122 are not allowed to
access.
[0041]     To control access by the clients 121, 122 to the application servers 141-143, the
gateway 100 includes a tunnel module 101 for establishing networking tunnels upon request
by the clients 121, 122 in the external network 180. In the example shown in Fig. 1,
networking tunnels 181, 182 are established between the tunnel module 101 and the clients
 121, 122 respectively, thereby extending the private network 140 to the clients 121, 122. In
                                                 9

 WO 2016/126313                                                               PCT/US2015/063783
some embodiments, a virtual private network (or "VPN") is established through tunnels 181,
 182. In this manner, a client 121, 122, although within network 180, is provided a private
network address in the range of the private network 140, and thus can potentially access all
application servers 141-143 by their respective private network address (provided access is
allowed, as is discussed in more detail below).
[0042]     A tunnel is established upon request of a client 121, 122, thereby providing tunnel
authentication information to the tunnel module 101. Any amount and type of authentication
information may be used in conjunction with embodiments of the present disclosure, such as
a username and password. The tunnel authentication information may also (or alternatively)
include biometrics, two-factor authentication, and/or other cryptographic methods. The data
travelling in the tunnels 181, 182 may further be protected by encryption, such as according
to the Internet Protocol Security (or "IPsec protocol,") Transport Layer Security (or "TLS")
and/or Datagram Transport Layer Security (or "DTLS"). The tunnel authentication module
 105 verifies the tunnel authentication information and, if the authentication is successful, the
networking tunnel is established with the respective client.
[0043]     The gateway 100 in Fig. 1 includes a firewall 102 for controlling the network traffic
between the clients 121, 122 and the application servers 141-143 after the respective tunnels
 181, 182 have been established. The firewall 102 may control such traffic according to
firewall rules provided by the firewall configuration module 103 or from another source. In
some embodiments, the firewall configuration module 103 obtains the firewall rules from
client access lists received from the respective clients 121, 122 which, in turn, receive the
client access list from the authentication server 160.
[0044]     Among other things, the firewall rules allow a client 121, 122 to establish and
maintain network connections with the application servers 141, 142 and 143. The selection of
which application servers 141-143 the client 121, 122 can access to can be determined from
                                                10

 WO 2016/126313                                                                PCT/US2015/063783
the client access list from which the firewall rules are also obtained. The firewall rules may
include any desired information.      In some embodiments, for example, the firewall rules
include entitlement tokens that define the information clients may have access to.           Such
entitlement tokens may be used to configure a firewall to not only grant/deny network traffic
access, but also access to various files (e.g., that are classified (contain metadata) as highly
confidential).
[0045]     The firewall 102 may be, or include, any number and type of system, device,
hardware component, and/or software component. For example, firewall 102 may be
implemented as a distributed firewall that includes multiple hardware and/or software
components. In some embodiments, the firewall 102 blocks all traffic from clients 121, 122
over the secure tunnels 180, 181 by default, but may be configured to allow traffic in
response to a firewall rule. For example, if a client access list indicates that client 121 may
access application server 141, the firewall configuration module 103 obtains the
corresponding rule and activates it in the firewall 102. After activation of the rule, the
firewall 102 no longer blocks network traffic on the private network 140 between the client
 121 and the application server 141.
[0046]     The system of Fig. 1 includes an authentication server 160, which in turn includes
an authentication module 162 for authenticating clients 121, 122 and generating client
information. In the example shown in Fig. 1, in order for a client 121, 122 to get access to an
application server 141-143 in the private network 140, it first needs to authenticate itself with
authentication server 160.
[0047]     The authentication server 160 may be implemented using any desired combination
of hardware and software components, and may communicate with other hardware and
software components in any desired manner. In the exemplary system shown in Fig. 1, the
authentication server 160 is not part of the private network 140, but is accessible by the
                                                 11

 WO 2016/126313                                                                PCT/US2015/063783
clients 121, 122 over the network 180. The authentication information provided by the
clients 121, 122 uniquely identifies the client or the user of the client, such as by providing a
username and password (which can be verified by the authentication module 162).
[0048]     Clients 121, 122 may be authenticated using any number and type of different
authentication methods. For example, in addition (or as an alternative) to password
authentication, the authentication may utilize an authentication based on the hardware of the
client 121, 122, such the use history of the client hardware and hardware attributes of the
client. In one embodiment, such information may be stored in a record on the client device,
whereby detection of the movement of the record to a different machine results in an
authentication failure. The record can be encrypted and/or key-signed to provide additional
integrity. Authentication may also be based on a time window, such that authentication is
denied (or further authentication required) if a client 121, 122 attempts authentication outside
a predetermined time window.
[0049]     Authentication may be performed based on location-based information, such as
based on the Internet protocol (IP) address of the client 121, 122 or global positioning
information associated with the client 121, 122. For example, the physical location of the
client 121, 122 may be determined from global positioning information, a specific IP address,
or even the country code of the IP address of a client, and used to determine whether the
client 121, 122 is a bona fide client or a third party (such as a hacker) attempting to pose as
the client. IP addresses (individual or ranges based on country code, etc.) may be blacklisted
or whitelisted based on previous history (i.e., hacking attempts, authentication failures, etc.).
Likewise, location-based information used for authentication may also be derived from the
physical network(s) used by the client 121,122 in attempting a connection.
[0050]     The authentication module 162 may also receive context or status information
directly from the clients 121, 122. When such information is received directly from the
                                                  12

 WO 2016/126313                                                                PCT/US2015/063783
client, and thus cannot be verified by the authentication server, it may be treated as untrusted
"client context information." The client context information which may be included in the
client information may include information such as: a hostname which may be in the form of
a fully qualified domain name (or "FQDN"), for example "host.domain.com"; a family and a
version number of the operating system running on the host; a patch level indicative for
which patches have been applied to the operating system; a status of anti-virus software
installed on the client; and/or how long the user of the client device has been logged onto the
client.
[0051]      The authentication module 162 may also add "trusted client information" to the
client information, which may include information such as user membership information
indicative for user groups and departments the user belongs to. The trusted client information
may be provided by user directory systems using lightweight directory access protocol
("LDAP") or Active Directory ("AD") services. Trusted client information may also include
information such as history information on previous sessions of the client with the
authentication server 160 (e.g., a last login timestamp and an amount of failed login
attempts).
[0052]      In the example shown in Fig. 1, the authentication module 162 comprises a client
list engine 163 and a tunnel list engine 165. Upon successful authentication by the
authentication module 162, the tunnel list engine 165 generates a client tunnel list and the
client list engine 163 generates a client access list based on the client information provided by
the authentication module.
[0053]      The client tunnel list may include all information for an authenticated client 121,
 122 to establish the respective tunnel 181, 182. The client tunnel list may include, for
example, network address information (such as the destination IP address and/or destination
port number of the gateway 100) in order for the client 121, 122 to initiate the establishment
                                                  13

 WO 2016/126313                                                                 PCT/US2015/063783
of the respective tunnel 181, 182 by requesting the setup of a tunnel at the IP address and port
number specified in the client tunnel list. The client tunnel list may also include the tunnel
authentication information in order to authenticate the client 121, 122 with the authentication
module 105 in the gateway 100. The client tunnel list may include, for example, virtual
private network (VPN) tokens that contain the information necessary to connect the client to
various gateways.
[0054]     The tunnel authentication information generated by the tunnel list engine 165 may
be dynamic (i.e., not known by the gateway's 100 authentication module 105 beforehand). In
such cases, the authentication server may forward the tunnel authentication information to the
gateway 100 by a communication link 168 between the authentication server 160 and the
gateway 100. The communication link 168 thus provides a channel between the gateway
 100 and authentication server 160 that allows configuration updates to be exchanged and
allowing access by a user or session to be revoked if the user and/or session is deleted in the
authentication server 160. There are a variety of reasons why a user or session may be
removed, such as: 1) the service database changes and the administrator wants to enforce the
change on all users; 2) a user changes his or her authentication method; or 3) a user or client
is banned from the system. The communication link 168 may be implemented in any desired
manner, such as via a hypertext transfer protocol secure (HTTPS) channel that only allows
communication between the authentication server 160 and one or more from one or
gateways.
[0055]     The client access list identifies a selection of the application servers 141-143 to
which a client is granted access. In some embodiments, the client list engine 163 generates
the firewall rules for the firewall 102 and includes these rules in the client access list. The
firewall rules are then extracted from the client access list by the firewall configuration
module 103 in the gateway 100 and applied to the firewall 102. The client access list may
                                                   14

WO 2016/126313                                                                PCT/US2015/063783
further add conditions to the addressing information of the application servers 141-143. An
illustrative example of a client access list is show in the table below.
Table 1: Client access list with conditional application servers
IP Address                                         Condition
10.0.0.1                                           Timelnterval(09.00-17.00)
10.0.0.11                                          Domain("domain.com")
10.0.0.3                                           StringPrefix(username, "adm")
[0056]     The first column of Table 1 specifies the IP address of the application server to
which the client is granted network access to. The second column further specifies a
condition that needs to be fulfilled in order to have the access. The first condition specifies a
specific time interval during which the client is granted access to the application server
10.0.0.1. The second condition specifies a specific domain from which the request should
originate (i.e., it specifies the domain from which the client may access the application). The
second condition may be used, for example, by a company to only allow access from its own
domain (i.e., from within the company's network). The third condition could be used to
identify a specific user or group, (such as a company's administrators), which are the only
ones that should be able to access a given application server or other network device.
[0057]     In the exemplary system shown in Fig. 1, the authentication server 160 includes a
signature module 164 for creating digitally-signed lists, such as a signed client access list and
signed client tunnel list. The digital signatures generated by the signature module 164 can be
verified by the signature verification module 104 in the gateway 100 upon reception of the
client access and tunnel list. The signature may be generated and verified by a signature key
shared between the gateway and the authentication server 160 such that the client access list
and client tunnel list is not alterable by the clients 121, 122 without the gateway 100
                                                  15

 WO 2016/126313                                                                PCT/US2015/063783
notifying the authentication server 160. In one exemplary embodiment, X.509 certificates
using a private/public key mechanism are employed to verify the certificate.
[0058]     In some embodiments, if the gateway 100, while attempting to verify the signature,
determines that the client access list or client tunnel list was changed, the gateway 100 may
notify the authentication server 160 of the changes and/or break the network tunnel with the
client. The authentication server 160 may use such notifications as part of the "trusted client
information" associated with the client in future interactions with the client. In some
embodiments, the gateway 100 can break an established networking tunnel 181, 182 on its
own volition (e.g., in response to detecting a change in the client access list or client tunnel
list as described above). Additionally or alternatively, the authentication server 160 may be
adapted to cause the gateway 100 to break established networking tunnels 181, 182 by
sending a message to the gateway 100 over the communication link 168 instructing the tunnel
module 101 to break a networking tunnel and to remove the firewall rules from the firewall
allowing the respective client access to the application servers.
[0059]     Figs. 2, 3 and 4 show exemplary processes that may be executed by various
components operating in conjunction with embodiments of the present disclosure, including
the components of the exemplary system shown in Fig. 1, namely the client 121, 122,
authentication server 160 and gateway 100, respectively. The processes described herein
may be performed (in whole or in part) by any other combination of different hardware
and/or software components.
[0060]     The processes in Figs. 2, 3, and 4 may be implemented in a variety of contexts and
situations, such as where the application servers 141, 142 and 143 all belong to a company
which aim it is to provide the services of the application servers in a secure way to the trusted
clients 121, 122. In such cases, a "trusted client" is a client device of which the user or the
device itself is known to the company and may be provided access to one or more of the
                                                  16

WO 2016/126313                                                                  PCT/US2015/063783
application servers. Each client 121, 122 may be implemented as any combination of
computer hardware and/or software that can access and use a service made available by the
application servers 141-143. A client may, for example, be (or include) a desktop computer,
a laptop computer, a smartphone and/or a tablet computer. The client could also be (or
include) a server that, for example, uses a certificate to authenticate itself. The processes in
Figs. 2, 3, and 4 help prevent clients 121, 122 from accessing the private network directly,
instead only providing access through a gateway, (such as gateway 100 in Fig. 1). Such
restrictions may also be enforced with regards to clients operating within the company's
private network. For an example of such as scenario, referring again to Fig. 1, both network
180 and network 140 could be separate "private networks," but network communication
between the clients 121, 122 and application servers 141-143 is still controlled the gateway
100.
[0061]     Fig. 2 shows an exemplary process that may be executed by any of the clients 121,
122 to access one or more services on the application servers 141-143. The process in Fig. 2
may be implemented in any suitable manner, such as via a software application on the client
device that runs automatically in the background when the client is active. The software
application may run automatically at start-up time of the client, or it may be manually
initiated by the user or another process operating on the client. The client 121, 122 monitors
(201) the network access of the client devices to one of the applications servers 141-143. The
network address of the application servers 141-143 may be a configuration option in client
applications using the services of the application servers. For example, the application server
may be (or include): a mail server with the network address and ports configured in the mail
client application; a file server configured with its network address as a network share; a
CRM service and the client has a dedicated client application installed for accessing the CRM
                                                 17

 WO 2016/126313                                                                 PCT/US2015/063783
service; and/or a web service and the user specifies the address in the address bar of a
browser application.
[0062]     The client may detect (202) that a client application tries to access application
servers within the private network 140 based on the destination network address. The client
retrieves (203) authentication information to send to the authentication server 160. Retrieval
of the authentication information may be performed automatically such as by using the
authentication credentials a user submitted previously to log on. Alternatively, retrieval of
the authentication information may include requesting the user to provide authentication
credentials, such as a username and a password. Alternatively to steps 201-203 of Fig. 2, the
client may directly authenticate itself with the authentication server 160 without waiting for a
network access attempt to one of the application servers 141-143. For example, the client
may authenticate with the authentication server 160 when the user of the client logs on to the
client or when the client boots.
[0063]     Authentication of the client may be performed in any desired manner, such as by
using stored authentication credentials, the user's logon credentials, and/or separate
authentication credentials that are requested from the user. Any number and type of identity
provider may be also used in conjunction with embodiments of this disclosure, including
RSA, Oauth, certificates, Radius, SAML, and the like. The authentication credentials are
used to authenticate (204) the client 121, 122 with the authentication server 160. In response,
the client receives (205) the client tunnel list and the client access list from the authentication
server 160.
[0064]     The client 121, 122 establishes (206) the network tunnel 181, 182 with the gateway
 100 by, for example, retrieving the network address of the gateway 100 from the client tunnel
list and sending a request to the gateway 100 to establish the tunnel. Upon establishing (206)
the tunnel, the client may provide the client tunnel list to the gateway as an authentication.
                                                  18

 WO 2016/126313                                                                PCT/US2015/063783
The client tunnel list bears the signature of the authentication server 160, from which the
gateway 100 may verify the client is trusted and establish the tunnel without further exchange
of authentication credentials. After the network tunnel is established, the private network 140
extends to the client through the tunnel, but the client may still not be able to access any of
the application servers 141-143, as network access to the servers may be blocked by the
firewall 102 of the gateway 100.
[0065]     The client sends (207) the client access list received from the authentication server
 160 to the gateway 100 and records (211) which application servers the client can access
from the client access list. The client may also signal or display the accessible application
servers or services to the user of the client device. Assuming successful authentication, the
gateway 100 provides the client network access to all application servers or services on the
application servers which are listed in the client access list.
[0066]     Fig. 3 is an exemplary process for providing client access and tunnel lists to clients
that may be executed by an authentication server, such as the authentication server 160 in
Fig. 1. In this exemplary process, the authentication server receives a request from a
respective client (301). In the request, the client provides authentication information for
identification with the authentication server such as in step 204 of Fig. 2. The authentication
server attempts to identify (302) the client. If the client is not known to the authentication
server and is thus untrusted, the server stops the flow (303). If the client is known, the
authentication server retrieves (304) trusted client information and adds it to the client
information. Client context information received with the authentication information in step
301 may also be added to the client information.
[0067]     The authentication module identifies (310) a selection of application servers the
client is allowed to access. The selection of application servers, together with the client
information, may then be forwarded to the client list engine 163 and tunnel list engine 165 of
                                                 19

 WO 2016/126313                                                                 PCT/US2015/063783
the authentication server 160. The tunnel list engine 165 generates (305) the tunnel list based
on the client information by, for example, providing the IP address of the gateway 100
together with authentication credentials for setting up the networking tunnel with the gateway
 100. The client tunnel list is signed (306) by the signature engine 164. The authentication
server generates (307) the client access list based on the selection of servers the client is
allowed to access. Based on the client information, further conditional restrictions may be
added to the client access list. Then, also the client access list is signed 308. The
authentication server then sends 309 the client access and tunnel list to the client.
[0068]     Fig. 4 shows an exemplary process for providing network access to a client that
may be executed by a gateway operating in conjunction with embodiments of the present
disclosure, such as gateway 100 in Fig. 1. In this exemplary process, the gateway 101
receives (401) a request from a client 121 or 122 to setup the networking tunnel (e.g., a VPN
connection) with that client. In response, the gateway requests (402) authentication
credentials from the client and receives (403) the authentication credentials in the form of the
client tunnel list. In order to authenticate the client, the gateway 100 verifies (404) the
signature in the client tunnel list using a signature key shared with the authentication server
 160. If the signature is correct and the client tunnel list was not modified by the client, the
gateway 100 establishes (405) the networking tunnel with the client, thus extending the
private network 140 to the client over the tunnel. The firewall of the gateway is further
configured to block all network access from the client by default. The gateway receives
(406) the client access list from the client that was generated by the authentication server and
verifies (407) the signature in this client access list. From the client access list, the gateway
obtains (408) the firewall rules for allowing network access to the application servers listed in
the client access list (and the conditions for such access, which are also provided in the client
                                                  20

 WO 2016/126313                                                                PCT/US2015/063783
access list). The gateway activates (409) the firewall rules, thereby allowing the client to
access the selection of application servers listed in the client access list.
[0069]     In some embodiments, the authentication server 160 may add enhanced
authentication requirements to the client access list together with a second selection of
application servers that may be accessed upon fulfilling these enhanced authentication
requirements. These enhanced requirements may relate to the authentication mechanism itself
and may, for example, state that a more secure authentication mechanism (relative to the first
selection of application servers) must be used. For example, instead of supplying a
user/password combination (which may satisfy the authentication requirements for the first
set of application servers), the enhanced requirements may specify that two factor
authentication is required to gain access to the second set of application servers. The
requirements may also relate to the context or status information of the client itself. Any
desired requirements may be used, such as a requirement: that all patches need to be applied
to the clients operating system in order to access a certain application server; that a virus
scanner must be running and be up to date to access a certain application server; and/or that
an application server may not be accessed from a public wireless network.
[0070]     Upon authentication with the authentication server, the authentication server 160
(e.g., via client list engine 163) provides a signed client access list comprising the enhanced
authentication requirements together with a second selection of application servers requiring
such enhanced authentication. When the client authenticates and fulfils the enhanced
authentication requirements, the authentication server may issue an updated client access list
to the client where the second selection of application servers is listed among the application
servers that the client is allowed to access. Multiple levels of enhanced authentication
requirements (and corresponding sets of application servers) may be listed in a client access
list.
                                                 21

 WO 2016/126313                                                                 PCT/US2015/063783
[0071]     Fig. 5 shows an exemplary process that may be executed by a client in order to gain
network access to application servers with enhanced authentication requirements. In this
exemplary process, the client establishes network access (501) to a first selection of
application servers in the private network 140 listed in a first client access list, also referred
to herein as the "base client access list." Step 501 may be further implemented according to
the flow outlined in Fig. 2 with the difference that the base client access list further comprises
a second selection of application servers and enhanced authentication requirements in order
to gain network access to this second selection.
[0072]     The client monitors (502) applications running on the client device and the network
access of such applications to the private network 140. If a client application tries to connect
to an application server which is not part of the first selection, the client checks (503) if the
application server is part of the second selection. If not, the client cannot gain access to this
application server and a user of the client or the application may be notified of the denied
access (504). If the application server is part of the second selection, the client starts the
enhanced authentication process with the authentication server (505), which may include
requesting that the user provide enhanced authentication credentials such as a fingerprint
scan, an iris scan, further biometric information about the user, and/or a key generated by an
external key generator. The client may also request that the user update the context and/or
state of the client device itself. For example the user may be requested to: connect the client
to a wired network; not connect the client through a public wireless network; install the latest
patches of the client's operating system; install a virus scanner; and/or update the virus
scanner's database.
[0073]     Upon the user successfully fulfilling the enhanced authentication requirements
(506) the client receives (507) a second or updated client access list from the authentication
server 160. If the enhanced authentication was not successful, the user or software
                                                 22

 WO 2016/126313                                                                PCT/US2015/063783
application requesting network access is signalled or alerted (504) that network access was
denied. The updated client access list lists both the first selection and second selection of
application servers that the client can access, and is sent (508) to the gateway 100, which
configures its firewall 102 accordingly. The client may then signal (509) to the client
applications and user which applications or services are allowed.
[0074]     Fig. 6 depicts an exemplary system according to various aspects of the present
disclosure. In this exemplary system, the gateway 600 includes a keep alive module 605.
The gateway 600 is connected over the established networking tunnel 182 with the client 621,
and the keep alive module is configured to check that keep alive message are received at
regular intervals from the client 621. If the keep alive message is not received in time, the
keep alive module instructs the firewall configuration module 103 to clear the firewall rules
for the client 621 from the firewall 102, and instructs the tunnel module 101 to break the
networking tunnel 182. The keep alive module 605 may further be configured to check
whether certain predefined state or context information about the client 621 is present in the
keep alive message and fulfils certain predefined requirements. Such requirements may
include, for example, that the client's virus scanner and/or firewall must be active.
[0075]     The client 621 may execute the process illustrated by steps 601-604 in order to send
the keep alive messages to the gateway 600. In the first step 601, a networking tunnel 182 to
the gateway 600 is established. The networking tunnel 182 may be established in any desired
manner, including using the process (or portions thereof) illustrated in Figs. 2 and 5. The
client collects (602) the required context and state information and formats it into a keep alive
message. The keep alive message is sent (603) over the networking tunnel 182 to the keep
alive module 605 of the gateway 600. When the message is sent, a timer is activated (604) to
count down from a predefined time interval. When the timer expires, a new cycle of the steps
602-604 is performed in order to send the next keep alive message.
                                                 23

WO 2016/126313                                                                 PCT/US2015/063783
[0076]     Fig. 7 illustrates an exemplary system for protecting application servers 741 to 746
from unauthorized access according to various aspects of the present disclosure. In this
example, the application servers 741-746 are part of private networks 750, 751 and 752
protected by the gateways 700, 701 and 702, respectively. A client 721 may authenticate
with the authentication server 760 and thereby obtain a client tunnel list and client access list.
The client tunnel list comprises information needed to establish a networking tunnel with
each of the gateways 700-702 in order to extend all private networks 740-744 to the client
721. The client tunnel list may be in any suitable format, such as a single data object, a file
with a single signature identifying all gateways, separate signed data objects, and/or files
each identifying one of the gateways 700-702. Upon reception of the client tunnel list, the
client 721 establishes a networking tunnel 781, 782 and 783 with each of the gateways 700
702.
[0077]     The client access list includes a selection of the application servers 741-747 the
client may connect to via the networking tunnels 781, 782 and 783. The client 721 sends the
client access list to the gateways which, in turn, configure their firewall according to the
received client access list, thereby allowing the client 721 access to the selection of
application servers.
[0078]     In some embodiments, the authentication server 760 may access other servers for
authentication of the client 721 or for retrieving information about the client 721. This is also
illustrated by Fig. 7, where the authentication server 760 may access the radius server 762
serving as an authentication backend for the authentication server 760. The authentication
module 162 in the authentication server 760 then serves as an authentication interface to the
client 721 while the server 762 performs the actual authentication. The authentication server
760 may also connect to the server 761 providing an Active Directory service the
                                                 24

 WO 2016/126313                                                               PCT/US2015/063783
authentication server 760 to retrieve further profile information about the user of the client
721.
[0079]     Fig. 8 illustrates yet another exemplary system where the radius server 846 and the
Active Directory server 847 correspond to application servers within the private network 744
behind the gateway 702, thereby helping to protect servers 846-847 from unauthorized
access. To access the servers 846-847, the authorization server 760 may include permanent
networking tunnel 884 with the gateway 702 protecting the servers 846 and 847.
Alternatively, the authorization server 760 may utilize another mechanism to provide access
to the servers 846-847, such as LDAP over JSON in order to leverage standard HTTPS traffic
instead of using a network tunnel. The firewall rules allowing the authentication server 760
access to the servers may then be configured in the gateway 702 beforehand so that no client
tunnel list or client access list is needed to establish the network connection between the
authentication server 760 and the servers 846-847.
[0080]     Fig. 9 illustrates an example where multiple gateways 900, 901 are used to protect
application servers 941-944 within a same private network 940. This topology may be used to
balance the network traffic load between the multiple gateways 900, 901. The authentication
server 960 provides client tunnel lists specifying a different gateway to the clients 921 and
922. In particular, client 921 establishes a networking tunnel 981 with gateway 900 and
client 922 establishes a networking tunnel 982 with gateway 901.
[0081]     The exemplary embodiments herein illustrate embodiments of the disclosure
protecting application servers from unauthorized access. Apart from application servers, any
other type of network device that provides a service and is addressable over a network may
be protected by the embodiments of this disclosure. Likewise, network devices that may be
protected by embodiments of the disclosure include networking equipment providing an
administrator interface to routers and network level switches.
                                                   25

 WO 2016/126313                                                              PCT/US2015/063783
[0082]     Fig. 10 illustrates an exemplary computing system 1000 that may be utilized in
conjunction with the embodiments disclosed herein. Computing system 1000 may be used as
a client device, gateway, authentication server, and/or any other suitable system. Computing
system 1000 comprises a bus 1010, a processor 1002, a local memory 1004, one or more
optional input interfaces 1014, one or more optional output interfaces 1016, a communication
interface 1012, a storage element interface 1006 and one or more storage elements 1008.
[0083]     Bus 1010 may comprise one or more conductors that permit communication among
the components of the computing system 1000. Processor 1002 may include any type of
processor that interprets and executes programming instructions. Local memory 1004 may
include a random access memory (RAM) or another type of dynamic storage device that
stores information and instructions for execution by processor 1002 and/or a read only
memory (ROM) or another type of static storage device that stores static information and
instructions for use by processor 1002. Input interface 1014 may comprise one or more
conventional mechanisms that permit an operator to input information to the computing
device 1000, such as a keyboard 1020, a mouse 1030, a pen, voice recognition and/or
biometric mechanisms, etc.
[0084]     Output interface 1016 may comprise one or more conventional mechanisms that
output information to the operator, such as a display 1040, a printer 1050, a speaker, etc.
Communication interface 1012 may comprise any transceiver-like mechanism such as for
example one or more Ethernet interfaces that enables computing system 1000 to
communicate with other devices and/or systems 1100. The communication interface 1012 of
computing system 1000 may be connected to such another computing system by means of a
local area network (LAN) or a wide area network (WAN) such as for example the internet.
Storage element interface 1006 may comprise a storage interface such as for example a Serial
Advanced Technology Attachment (SATA) interface or a Small Computer System Interface
                                               26

 WO 2016/126313                                                             PCT/US2015/063783
(SCSI) for connecting bus 1010 to one or more storage elements 1008, such as one or more
local disks, for example SATA disk drives, and control the reading and writing of data to
and/or from these storage elements 1008. Although the storage elements 1008 above is
described as a local disk, in general any other suitable computer-readable media such as a
removable magnetic disk, optical storage media such as a CD or DVD, -ROM disk, solid
state drives, flash memory cards, ... could be used. The system 1000 described above can
also run as a virtual machine above the physical hardware.
[0085]     The methods illustrated herein can be implemented via programming instructions
stored in local memory 1004 of the computing system 1000 for execution by its processor
 1002. Alternatively the instructions can be stored on the storage element 1008 or be
accessible from another computing system through the communication interface 1012.
[0086]     The system 1000 may correspond to the client 121, 122, 621, 721, 921, 922 of the
embodiments illustrated by Fig. 1, 6, 7, 8 and 9 respectively. In such cases, the system 1000
may be connected to the gateway and authorization server by the communication interface
 1012. Steps of the methods illustrated in Fig. 2, 5 and 6 may be performed as instructions on
the processor 1002 during execution and may be stored in memory storage 1004 or 1008.
[0087]     The system 1000 may correspond to the gateway 100, 600, 700, 701, 702, 900 and
901 of the embodiments illustrated by Fig. 1, 6, 7, 8 and 9 respectively. In such cases, the
system may comprise two communication interfaces 1012, one communication interface for
connecting to the private network and one for connecting to the other network by which it
connects to the clients. Steps of the method illustrated in Fig. 4 may be performed as
instructions on the processor 1002 during execution and may be stored in memory storage
 1004 or 1008.
[0088]     The system 1000 may correspond to the authentication server 160, 760 and 960 of
the embodiments illustrated by Fig. 1, 6, 7, 8 and 9. In such cases, the communication
                                                27

 WO 2016/126313                                                               PCT/US2015/063783
interface 1012 may be used to connect the system 1000 to the clients and gateways. Steps of
the method illustrated in Fig. 3 may then be performed as instructions on the processor 1002
during execution and may be stored in memory storage 1004 or 1008.
[0089]     Methods performed by the authentication server and gateway may further run on a
same computer system, on separate computer systems, or as separate virtual computer
systems on the same or different physical computer systems.
MULTI-TUNNELING VIRTUAL NETWORK ADAPTER
[0090]     Within an operating system of a client, a virtual adapter is a software-implemented
component that operates along with other network adapters or network interfaces, whether
implemented in hardware, software, or a combination of the two. When packets of data are
sent by software programs (running within an operating system) for transmission to a virtual
adapter, the packets are not sent over a physical communication interface. Instead, the
packets are rerouted to a dedicated software application that runs in the user-space portion of
the operating system, in contrast to the kernel-space where the virtual adapter and all tasks of
the operating system run. In addition to receiving such packets from the virtual adapter, the
dedicated software application also passes packets to the virtual adapter to effect
communication in the other direction. In this case the virtual adapter delivers (or "injects")
these packets to the operating-system network stack, thus emulating their reception from an
external source.
[0091]     Virtual network adapters are also referred to as TUN/TAP interfaces named after
the two existing types. A TUN interface (namely network TUNnel) simulates a network
layer device and it operates with layer 3 packets like IP packets. A TAP interface (namely
network tap) simulates a link layer device and it operates with layer 2 packets like Ethernet
frames.
                                                28

 WO 2016/126313                                                               PCT/US2015/063783
[0092]     A virtual network interface controller (NIC) is a TUN/TAP device is that resides in
kernel space. The NIC passes the virtual interface packets of data, which include IP and
protocol headers (in the case of TUN) or Ethernet headers (in the case of TAP) so the data
packet can be handled as a complete package in user space. The NIC thus allows users to
encapsulate the traffic into a new packet to tunnel it to a remote destination, typically used in
a virtual private network. Setting up multiple tunnels would require multiple TUN/TAP
interfaces, one for each tunnel.
[0093]     In conventional systems, if the amount of tunnels needed is not known in advance
(which it typically is not), setting up a new tunnel requires administrative privileges on the
operating system to create an additional virtual TUN/TAP device in the kernel space of the
operating system. Moreover, a separate virtual TUN/TAP device must be created for each
virtual connection.
[0094]     An example of a conventional system is depicted in Fig. 11. In this example, two
virtual network adapters are installed in kernel-space (VIRT NIC 1 and VIRT NIC 2). A first
user-space application (APPLICATION 1) sends a data packet (DATA 1) to a network
destination in a first VPN. In the TCP/IP stack of the operating system (OS), the packet is
prepended with the destination address in the first VPN (TCP/IP 1). The operating system
then routes the packet to the network adapter that should handle packets that are addressed to
the first VPN, i.e., VIRT NIC 1. As this is a virtual adapter, the packet is rerouted to a first
VPN application (VPN CLIENT 1) where the packet is encrypted (DATA 1' and TCP/IP 1')
and embedded in a new packet by the OS (TCP/IP 11) with as destination address the VPN
server at the other end of the VPN tunnel. The OS then routes this packet to the physical
network interface NIC 1.
[0095]     A similar flow occurs when a second application (APPLICATION 2) sends a data
packet (DATA 2) to a destination in a second VPN. This packet is then routed to the second
                                                 29

 WO 2016/126313                                                                PCT/US2015/063783
virtual interface (VIRT NIC 2) where it is forwarded to a second VPN application (VPN
CLIENT 2). This second VPN application then encrypts the packet and sends it to a second
VPN server (TCP/IP 21).
[0096]     There are at least two significant issues with the conventional system in Fig. 11.
To create a virtual adapter, administrative privileges are needed as the adapter resides in
kernel space. Second, every VPN connection that is made requires a new virtual adapter to
be created. An exemplary system according to various aspects of the present disclosure is
illustrated in Fig. 12. The system in Fig. 12 overcomes both of the issues in Fig. 11 by
allowing different VPN's to be created with a single virtual adapter (and without the need for
administrative privileges to the kernel space of the operating system) by adding a routing
component in the user-space application that establishes the VPN.
[0097]     In the exemplary system 1200 shown in Fig. 12, both DATA 1 and DATA 2 are
routed by the operating system to the same virtual adapter 1230. This is achieved by
updating the operating system (OS) routing table to direct network traffic to the two VPN's
(1251 and 1252) to the same virtual adapter (VIRT NIC 1 1230). The VPN CLIENT 1 1210,
not only encrypts the data and embeds it in a new packet, but also determines to which VPN
the packets are destined using the VPN ROUTING TABLE 1260. Using the routing table
 1260, packets for VPN 1 1251 are sent to the VPN 1 encryption module and packets for the
VPN 2 1252 are sent to the VPN 2 encryption module. Packets for VPN 1 and 2 are then sent
to different destinations, i.e., to different VPN servers are the end of the tunnel.
[0098]     Fig. 13 illustrates another example of a system utilizing a multi-tunneling virtual
adapter in accordance with various aspects of the present disclosure. In this example, there
are 2 different networks 192.168.0.0/24 1310 and 10.0.0.0/24 1320 . Both networks are
routed towards the tunO interface 1330, which is the TUN/TAP interface. When packets are
                                                 30

 WO 2016/126313                                                                 PCT/US2015/063783
routed towards the tunO interface 1330, the CZ VPN client 1340 is able to read the full
packet.
[0099]     In a conventional VPN client, the packet would immediately be captured (and
possibly encrypted) and encapsulated into a TCP or UDP connection that would contain the
source IP of ethO and the destination IP of the desired gateway that would unpack the packet.
The system in Fig. 13, by contrast, implements a routing module that identifies the
destination IP address of the original packet and identifies which tunnel (and corresponding
encryption) should be used. In the example shown in Fig. 13, packets having a destination IP
within the 192.168.0.0/24 network will be sent to the encryptor/encapsulator for gateway A
 1350, while packets that will match the 10.0.0.0/24 route will be encrypted and encapsulated
to gateway B 1360.
[00100] Once the packet has been picked up by the CZ VPN client 1340, it will create a new
connection (which could be TCP or UDP) towards the corresponding gateway and will
contain an encrypted version of the original packet that was received from the TUN/TAP
adapter. That packet will be handled by the normal OS routing table again in order to reach
the corresponding gateway.
[00101] Because the routing component resides in the user space portion of the operating
system, it can dynamically add more or less tunnels without the need for administrator
privileges. Another benefit of the system in Fig. 13 is that it uses the same client IP for
different tunnels, thus a single virtual interface can handle all private traffic. A single virtual
adapter can thus service any number of virtual gateways, in contrast to conventional systems
that require a single adapter for each gateway. Embodiments of the present disclosure thus
avoid the need to have administrative privileges to access the kernel space of each client,
which can be extremely problematic for conventional systems, particularly with large
numbers of individual clients. Moreover, many mobile device operating systems only support
                                                  31

 WO 2016/126313                                                              PCT/US2015/063783
one virtual adapter. Embodiments of the present disclosure may also be used to loadbalance
traffic or create a redundant tunnel to two or more independent gateways that protect the
same private network, using a single virtual adaptor.
[00102] Fig. 14 illustrates an exemplary process according to various aspects of the present
disclosure. Process 1400 may be implemented in conjunction with any desired system,
including the system shown in Fig. 13, as well as with any other method (in whole or in part),
including those described herein.
[00103] In this example, process 1400 includes receiving one or more data packets over a
network by a routing component of a virtual private network (VPN) client (1410), identifying
by the routing component, a destination for the one or more data packets (1420), creating by
the VPN client, one or more connections corresponding to the destination(s) for the one or
more data packets (1430), transmitting the one or more data packets to their respective
destination(s) (1440), and removing one or more gateway connections (1450).
[00104] As described in more detail above, any number of data packets may be received and
transmitted by embodiments of the present disclosure. In various embodiments, the one or
more data packets may be received (1410) via a virtual adapter operating in the kernel space
portion of the operating system running the VPN client. Additionally, identifying a
destination for a data packet (1420) may include identifying a gateway corresponding to the
destination for the data packet, and creating a connection to the gateway (1430) may include
creating a user datagram protocol (UDP) connection. Gateway connections may be removed
(1450) in any suitable manner. Removal of a gateway connection may include, for example,
hiding the connection, preventing further use of the connection, disconnection, etc. In some
embodiments, for example, once the VPN is established, the gateway connection stays up
until the client is disconnected or the system decides the connection is no longer valid
(revoked access, expired connection, etc.).
                                                32

 WO 2016/126313                                                                PCT/US2015/063783
[00105] In cases where a plurality of data packets are being processed, the data packets can
be routed through a single virtual adapter operating in the kernel space of the operating
system. The routing component may be of any size, type, and configuration, and may
include, for example, a routing table. The routing table may, in turn, include any suitable
information for processing one or more data packets, including one or more destination
addresses for the one or more data packets.
[00106] Communication among systems, devices, and components operating in conjunction
with embodiments of the present disclosure may be performed using any suitable
communication method, such as, for example, a telephone network, an extranet, an intranet,
the Internet, point of interaction device (point of sale device, personal digital assistant (e.g.,
iPhone@, Palm Pilot@, Blackberry@), cellular phone, kiosk, etc.), online communications,
satellite communications, off-line communications, wireless communications, transponder
communications, local area network (LAN), wide area network (WAN), virtual private
network (VPN), networked or linked devices, keyboard, mouse and/or any suitable
communication or data input modality. Systems and devices of the present disclosure may
utilize TCP/IP communications protocols as well as IPX, Appletalk, IP-6, NetBIOS, OSI, any
tunneling protocol (e.g. IPsec, SSH), or any number of existing or future protocols.
[00107] While some embodiments can be implemented in fully functioning computers and
computer systems, various embodiments are capable of being distributed as a computing
product in a variety of forms and are capable of being applied regardless of the particular
type of machine or computer-readable media used to actually effect the distribution.
[00108] A machine readable medium can be used to store software and data which when
executed by a data processing system causes the system to perform various methods. The
executable software and data may be stored in various places including for example ROM,
volatile RAM, non-volatile memory and/or cache. Portions of this software and/or data may
                                                 33

 WO 2016/126313                                                              PCT/US2015/063783
be stored in any one of these storage devices. Further, the data and instructions can be
obtained from centralized servers or peer to peer networks. Different portions of the data and
instructions can be obtained from different centralized servers and/or peer to peer networks at
different times and in different communication sessions or in a same communication session.
The data and instructions can be obtained in entirety prior to the execution of the
applications. Alternatively, portions of the data and instructions can be obtained
dynamically, just in time, when needed for execution. Thus, it is not required that the data
and instructions be on a machine readable medium in entirety at a particular instance of time.
[00109] Examples of computer-readable media include but are not limited to recordable and
non-recordable type media such as volatile and non-volatile memory devices, read only
memory (ROM), random access memory (RAM), flash memory devices, floppy and other
removable disks, magnetic disk storage media, optical storage media (e.g., Compact Disk
Read-Only Memory (CD ROMS), Digital Versatile Disks (DVDs), etc.), among others. The
computer-readable media may store the instructions.
[00110] In various embodiments, hardwired circuitry may be used in combination with
software instructions to implement the techniques. Thus, the techniques are neither limited to
any specific combination of hardware circuitry and software nor to any particular source for
the instructions executed by the data processing system.
[00111] Although some of the drawings illustrate a number of operations in a particular
order, operations which are not order dependent may be reordered and other operations may
be combined or broken out. While some reordering or other groupings are specifically
mentioned, others will be apparent to those of ordinary skill in the art and so do not present
an exhaustive list of alternatives. Moreover, it should be recognized that the stages could be
implemented in hardware, firmware, software or any combination thereof.
                                               34

WO 2016/126313                                                               PCT/US2015/063783
[00112] For the sake of brevity, conventional data networking, application development and
other functional aspects of the systems (and components of the individual operating
components of the systems) may not be described in detail herein. Furthermore, the
connecting lines shown in the various figures contained herein are intended to represent
exemplary functional relationships and/or physical couplings between the various elements.
It should be noted that many alternative or additional functional relationships or physical
connections may be present in a practical system.
[00113] The various system components discussed herein may include one or more of the
following: a host server or other computing systems including a processor for processing
digital data; a memory coupled to the processor for storing digital data; an input digitizer
coupled to the processor for inputting digital data; an application program stored in the
memory and accessible by the processor for directing processing of digital data by the
processor; a display device coupled to the processor and memory for displaying information
derived from digital data processed by the processor; and a plurality of databases. Various
databases used herein may include: shipping data, package data, and/or any data useful in the
operation of the system.
[00114] Various functionality may be performed via a web browser and/or application
interfacing utilizing a web browser. Such browser applications may comprise Internet
browsing software installed within a computing unit or a system to perform various
functions. These computing units or systems may take the form of a computer or set of
computers, and any type of computing device or systems may be used, including laptops,
notebooks, tablets, hand held computers, personal digital assistants, set-top boxes,
workstations, computer-servers, main frame computers, mini-computers, PC servers, network
sets of computers, personal computers and tablet computers, such as iPads, iMACs, and
MacBooks, kiosks, terminals, point of sale (POS) devices and/or terminals, televisions, or
                                                35

 WO 2016/126313                                                              PCT/US2015/063783
any other device capable of receiving data over a network. Various embodiments may utilize
Microsoft Internet Explorer, Mozilla Firefox, Google Chrome, Apple Safari, Opera, or any
other of the myriad software packages available for browsing the internet.
[00115] Various embodiments may operate in conjunction with any suitable operating
system (e.g., Windows NT, 95/98/2000/CE/Mobile/, Windows 7/8, OS2, UNIX, Linux,
Solaris, MacOS, PalmOS, etc.) as well as various conventional support software and drivers
typically associated with computers. Various embodiments may include any suitable
personal computer, network computer, workstation, personal digital assistant, cellular phone,
smart phone, minicomputer, mainframe or the like. Embodiments may implement security
protocols, such as Secure Sockets Layer (SSL), Transport Layer Security (TLS), and Secure
Shell (SSH). Embodiments may implement any desired application layer protocol, including
http, https, ftp, and sftp.
[00116] The various system components may be independently, separately or collectively
suitably coupled to a network via data links which includes, for example, a connection to an
Internet Service Provider (ISP) over the local loop as is typically used in connection with
standard modem communication, cable modem, satellite networks, ISDN, Digital Subscriber
Line (DSL), or various wireless communication methods. It is noted that embodiments of the
present disclosure may operate in conjunction with any suitable type of network, such as an
interactive television (ITV) network.
[00117] The system may be partially or fully implemented using cloud computing. "Cloud"
or "Cloud computing" includes a model for enabling convenient, on-demand network access
to a shared pool of configurable computing resources (e.g., networks, servers, storage,
applications, and services) that can be rapidly provisioned and released with minimal
management effort or service provider interaction. Cloud computing may include location
                                                36

WO 2016/126313                                                                   PCT/US2015/063783
independent computing, whereby shared servers provide resources, software, and data to
computers and other devices on demand.
[00118] Various embodiments may be used in conjunction with web services, utility
computing, pervasive and individualized computing, security and identity solutions,
autonomic computing, cloud computing, commodity computing, mobility and wireless
solutions, open source, biometrics, grid computing and/or mesh computing.
[00119] Any databases discussed herein may include relational, hierarchical, graphical, or
object-oriented structure and/or any other database configurations. Moreover, the databases
may be organized in any suitable manner, for example, as data tables or lookup tables. Each
record may be a single file, a series of files, a linked series of data fields or any other data
structure. Association of certain data may be accomplished through any desired data
association technique such as those known or practiced in the art. For example, the
association may be accomplished either manually or automatically.
[00120] Any databases, systems, devices, servers or other components of the system may be
located at a single location or at multiple locations, wherein each database or system includes
any of various suitable security features, such as firewalls, access codes, encryption,
decryption, compression, decompression, and/or the like.
[00121] Encryption may be performed by way of any of the techniques now available in the
art or which may become available-e.g., Twofish, RSA, El Gamal, Schorr signature, DSA,
PGP, PKI, and symmetric and asymmetric cryptosystems.
[00122] Embodiments may connect to the Internet or an intranet using standard dial-up,
cable, DSL or any other Internet protocol known in the art. Transactions may pass through a
firewall in order to prevent unauthorized access from users of other networks.
[00123] The computers discussed herein may provide a suitable website or other Internet
based graphical user interface which is accessible by users. For example, the Microsoft
                                                  37

 WO 2016/126313                                                                   PCT/US2015/063783
Internet Information Server (IIS), Microsoft Transaction Server (MTS), and Microsoft SQL
Server, may be used in conjunction with the Microsoft operating system, Microsoft NT web
server software, a Microsoft SQL Server database system, and a Microsoft Commerce Server.
Additionally, components such as Access or Microsoft SQL Server, Oracle, Sybase, Informix
MySQL, Interbase, etc., may be used to provide an Active Data Object (ADO) compliant
database management system. In another example, an Apache web server can be used in
conjunction with a Linux operating system, a MySQL database, and the Perl, PHP, and/or
Python programming languages.
[00124] Any of the communications, inputs, storage, databases or displays discussed herein
may be facilitated through a website having web pages. The term "web page" as it is used
herein is not meant to limit the type of documents and applications that might be used to
interact with the user. For example, a typical website might include, in addition to standard
HTML documents, various forms, Java applets, JavaScript, active server pages (ASP),
common gateway interface scripts (CGI), extensible markup language (XML), dynamic
HTML, cascading style sheets (CSS), AJAX (Asynchronous Javascript And XML), helper
applications, plug-ins, and the like. A server may include a web service that receives a
request from a web server, the request including a URL and an IP address. The web server
retrieves the appropriate web pages and sends the data or applications for the web pages to
the IP address. Web services are applications that are capable of interacting with other
applications over a communications means, such as the Internet.
[00125] Various embodiments may employ any desired number of methods for displaying
data within a browser-based document. For example, data may be represented as standard
text or within a fixed list, scrollable list, drop-down list, editable text field, fixed text field,
pop-up window, and the like. Likewise, embodiments may utilize any desired number of
                                                   38

 WO 2016/126313                                                               PCT/US2015/063783
methods for modifying data in a web page such as, for example, free text entry using a
keyboard, selection of menu items, check boxes, option boxes, and the like.
[00126] The exemplary systems and methods illustrated herein may be described in terms of
functional block components, screen shots, optional selections and various processing steps.
It should be appreciated that such functional blocks may be realized by any number of
hardware and/or software components configured to perform the specified functions. For
example, the system may employ various integrated circuit components, e.g., memory
elements, processing elements, logic elements, look-up tables, and the like, which may carry
out a variety of functions under the control of one or more microprocessors or other control
devices. Similarly, the software elements of the system may be implemented with any
programming or scripting language such as C, C++, C#, Java, JavaScript, VBScript,
Macromedia Cold Fusion, COBOL, Microsoft Active Server Pages, assembly, PERL, PHP,
AWK, Python, Visual Basic, SQL Stored Procedures, PL/SQL, any UNIX shell script, and
extensible markup language (XML) with the various algorithms being implemented with any
combination of data structures, objects, processes, routines or other programming elements.
Further, it should be noted that the system may employ any number of conventional
techniques for data transmission, signaling, data processing, network control, and the like.
Still further, the system could be used to detect or prevent security issues with a client-side
scripting language, such as JavaScript, VBScript or the like.
[00127] The systems and methods of the present disclosure may be embodied as a
customization of an existing system, an add-on product, a processing apparatus executing
upgraded software, a stand alone system, a distributed system, a method, a data processing
system, a device for data processing, and/or a computer program product. Accordingly, any
portion of the system or a module may take the form of a processing apparatus executing
code, an internet based embodiment, an entirely hardware embodiment, or an embodiment
                                                39

 WO 2016/126313                                                              PCT/US2015/063783
combining aspects of the internet, software and hardware. Furthermore, the system may take
the form of a computer program product on a computer-readable storage medium having
computer-readable program code means embodied in the storage medium. Any suitable
computer-readable storage medium may be utilized, including hard disks, CD-ROM, optical
storage devices, magnetic storage devices, and/or the like.
[00128] The system and method is described herein with reference to screen shots, block
diagrams and flowchart illustrations of methods, apparatus (e.g., systems), and computer
program products according to various embodiments. It will be understood that each
functional block of the block diagrams and the flowchart illustrations, and combinations of
functional blocks in the block diagrams and flowchart illustrations, respectively, can be
implemented by computer program instructions.
[00129] These computer program instructions may be loaded onto a general purpose
computer, special purpose computer, or other programmable data processing apparatus to
produce a machine, such that the instructions that execute on the computer or other
programmable data processing apparatus create means for implementing the functions
specified in the flowchart block or blocks. These computer program instructions may also be
stored in a computer-readable memory that can direct a computer or other programmable data
processing apparatus to function in a particular manner, such that the instructions stored in
the computer-readable memory produce an article of manufacture including instruction
means which implement the function specified in the flowchart block or blocks. The
computer program instructions may also be loaded onto a computer or other programmable
data processing apparatus to cause a series of operational steps to be performed on the
computer or other programmable apparatus to produce a computer-implemented process such
that the instructions which execute on the computer or other programmable apparatus provide
steps for implementing the functions specified in the flowchart block or blocks.
                                               40

 WO 2016/126313                                                             PCT/US2015/063783
[00130] Accordingly, functional blocks of the block diagrams and flowchart illustrations
support combinations of means for performing the specified functions, combinations of steps
for performing the specified functions, and program instruction means for performing the
specified functions. It will also be understood that each functional block of the block
diagrams and flowchart illustrations, and combinations of functional blocks in the block
diagrams and flowchart illustrations, can be implemented by either special purpose hardware
based computer systems which perform the specified functions or steps, or suitable
combinations of special purpose hardware and computer instructions. Further, illustrations of
the process flows and the descriptions thereof may make reference to user windows,
webpages, websites, web forms, prompts, etc. Practitioners will appreciate that the illustrated
steps described herein may comprise in any number of configurations including the use of
windows, webpages, web forms, popup windows, prompts and the like. It should be further
appreciated that the multiple steps as illustrated and described may be combined into single
webpages and/or windows but have been expanded for the sake of simplicity. In other cases,
steps illustrated and described as single process steps may be separated into multiple
webpages and/or windows but have been combined for simplicity.
[00131] The term "non-transitory" is to be understood to remove only propagating
transitory signals per se from the claim scope and does not relinquish rights to all standard
computer-readable media that are not only propagating transitory signals per se. Stated
another way, the meaning of the term "non-transitory computer-readable medium" should be
construed to exclude only those types of transitory computer-readable media which were
found in In Re Nuijten to fall outside the scope of patentable subject matter under 35 U.S.C. 
 101.
[00132] Benefits, other advantages, and solutions to problems have been described herein
with regard to specific embodiments. However, the benefits, advantages, solutions to
                                                 41

 WO 2016/126313                                                              PCT/US2015/063783
problems, and any elements that may cause any benefit, advantage, or solution to occur or
become more pronounced are not to be construed as critical, required, or essential features or
elements of the disclosure.
[00133] Although the disclosure includes a method, it is contemplated that it may be
embodied as computer program instructions on a tangible computer-readable carrier, such as
a magnetic or optical memory or a magnetic or optical disk. All structural, chemical, and
functional equivalents to the elements of the above-described exemplary embodiments that
are known to those of ordinary skill in the art are expressly incorporated herein by reference
and are intended to be encompassed by the present claims. Moreover, it is not necessary for a
device or method to address each and every problem sought to be solved by the present
disclosure, for it to be encompassed by the present claims. Furthermore, no element,
component, or method step in the present disclosure is intended to be dedicated to the public
regardless of whether the element, component, or method step is explicitly recited in the
claims. No claim element herein is to be construed under the provisions of 35 U.S.C. 112,
sixth paragraph, unless the element is expressly recited using the phrase "means for." As
used herein, the terms "comprises", "comprising", or any other variation thereof, are intended
to cover a non-exclusive inclusion, such that a process, method, article, or apparatus that
comprises a list of elements does not include only those elements but may include other
elements not expressly listed or inherent to such process, method, article, or apparatus.
[00134] Where a phrase similar to "at least one of A, B, or C," "at least one of A, B, and C,"
"one or more A, B, or C," or "one or more of A, B, and C" is used, it is intended that the
phrase be interpreted to mean that A alone may be present in an embodiment, B alone may be
present in an embodiment, C alone may be present in an embodiment, or that any
combination of the elements A, B and C may be present in a single embodiment; for
example, A and B, A and C, B and C, or A and B and C.
                                                42

WO 2016/126313                                                              PCT/US2015/063783
[00135] Changes and modifications may be made to the disclosed embodiments without
departing from the scope of the present disclosure. These and other changes or modifications
are intended to be included within the scope of the present disclosure, as expressed in the
following claims.
                                               43

What is claimed is:
1.      A computer-implemented method comprising:
        receiving a data packet over a network by a routing component of a virtual private
network (VPN) client, the VPN client residing in a user space portion of an operating system
running on a computer system;
        identifying, by the routing component, a destination for the data packet on the
network;
        creating, by the VPN client, a connection to a gateway corresponding to the
destination for the data packet; and
        transmitting the data packet to the destination via the gateway.
2.      The method of claim 1, wherein the data packet is received via a virtual adapter
operating in a kernel space portion of the operating system.
3.      The method of claim 1, wherein identifying the destination for the data packet
includes identifying the gateway corresponding to the destination for the data packet.
4.      The method of claim 1, wherein creating the connection to the gateway includes
creating a transmission control protocol connection.
5.      The method of claim 1, wherein creating the connection to the gateway includes
creating a user datagram protocol connection.
6.      The method of claim 1, further comprising removing the gateway connection.
                                               44

7.      The method of claim 1, further comprising:
        receiving, by the routing component, a plurality of data packets;
        identifying a respective destination on the network for each respective data packet
from the plurality of data packets;
        creating a respective connection to a gateway corresponding to a respective
destination for each respective data packet in the plurality of data packets; and
        transmitting each respective data packet to its respective destination via its respective
gateway connection.
8.      The method of claim 7, further comprising removing one or more of the plurality of
gateway connections.
9.      The method of claim 1, wherein the plurality of data packets are each routed through
a single virtual adapter operating in a kernel space of the operating system.
10.     The method of claim 1, wherein the routing component comprises a routing table.
11.     The method of claim 10, wherein the routing table identifies a destination address for
a data packet.
12.     A non-transitory, computer-readable medium storing instructions that, when executed,
cause a computer system to:

        receive a data packet over a network by a routing component of a virtual private
network (VPN) client, the VPN client residing in a user space portion of an operating system
running on the computer system;
        identify, by the routing component, a destination for the data packet on the network;
        create, by the VPN client, a connection to a gateway corresponding to the destination
for the data packet; and
        transmit the data packet to the destination via the gateway.
13.     A computer system comprising:
        a processor; and
        memory in communication with the processor and storing instructions that, when
executed by the processor, cause the computer system to:
        receive a data packet over a network by a routing component of a virtual private
network (VPN) client, the VPN client residing in a user space portion of an operating system
running on the computer system;
        identify, by the routing component, a destination for the data packet on the network;
        create, by the VPN client, a connection to a gateway corresponding to the destination
for the data packet; and
        transmit the data packet to the destination via the gateway.
                                                14 ,

<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
