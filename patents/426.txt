                                          ABSTRACT
The application relates to audio encoder and decoder systems. An embodiment of the encoder
system comprises a downmix stage for generating a downmix signal and a residual signal
based on a stereo signal. In addition, the encoder system comprises a parameter determining
stage for determining parametric stereo parameters such as an inter-channel intensity
difference  and an     inter-channel   cross-correlation. Preferably,  the parametric    stereo
parameters are time- and frequency-variant. Moreover, the encoder system comprises a
transform stage. The transform stage generates a pseudo left/right stereo signal by performing
a transform based on the downmix signal and the residual signal. The pseudo stereo signal is
processed by a perceptual stereo encoder. For stereo encoding, left/right encoding or mid/side
encoding is selectable. Preferably, the selection between left/right stereo encoding and
mid/side stereo encoding is time- and frequency-variant

                                              -1
         Advanced stereo coding based on a combination of adaptively selectable
            left/right or mid/side stereo coding and of parametric stereo coding
    Related Applications
 5  The present application is a divisional application of Australian patent Application No.
    2015246158, itself a divisional of Australian patent application No. 2013206557, itself
    a divisional application of Australian patent application No. 2010225051; the entire
    contents of all applications are incorporated herein by reference.
    Technical Field
10 The application relates to audio coding, in particular to stereo audio coding combining
   parametric and waveform based coding techniques.
   Background of the Invention
   Joint coding of the left (L) and right (R) channels of a stereo signal enables more
   efficient coding compared to independent coding of L and R. A common approach for
15 joint stereo coding is mid/side (M/S) coding. Here, a mid (M) signal is formed by
   adding the L and R signals, e.g. the M signal may have the form
                                        M = 1/2(L + R) .
   Also, a side (S) signal is formed by subtracting the two channels L and R, e.g. the S
   signal may have the form
20                                       S = 1/2(L - R).
   In case of M/S coding, the M and S signals are coded instead of the L and R signals.
   In the MPEG (Moving Picture Experts Group) AAC (Advanced Audio Coding)
   standard (see standard document ISO/IEC 13818-7), L/R stereo coding and M/S stereo
   coding can be chosen in a time-variant and frequency-variant manner. Thus, the stereo
25 encoder can apply L/R coding for some frequency bands of the stereo signal, whereas
   M/S coding is used for encoding other frequency bands of

   the stereo signal (frequency variant). Moreover, the encoder can switch over time
   between L/R and M/S coding (time-variant). In MPEG AAC, the stereo encoding
   is carried out in the frequency domain, more particularly in the MDCT (modified
   discrete cosine transform) domain. This allows to adaptive choose either L/R or
 5 M/S coding in a frequency and also time variant manner. The decision between
   L/R and M/S stereo encoding may be based by evaluating the side signal: when
   the energy of the side signal is low, M/S stereo encoding is more efficient and
   should be used. Alternatively, for deciding between both stereo coding schemes,
   both coding schemes may be tried out and the selection may be based on the re
10 suiting quantization. efforts, i.e., the observed perceptual entropy.
   An alternative approach to joint stereo coding is parametric stereo (PS) coding.
   Here, the stereo signal is conveyed as a mono downmix signal after encoding the
    downmix signal with a conventional audio encoder such as an AAC encoder. The
15  downmix signal is a superposition of the L and R channels. The mono downmix
    signal is conveyed in combination with additional time-variant and frequency
   variant PS parameters, such as the inter-channel (i.e. between L and R) intensity
    difference (lID) and the inter-channel cross-correlation (ICC). In the decoder,
    based on the decoded downmix signal and the parametric stereo parameters a ste
20  reo signal is reconstructed that approximates the perceptual stereo image of the.
                                                                              downmix
    original stereo signal. For reconstructing, a decorrelated version of the
    signal is generated by a decorrelator. Such decorrelator may be realized by an
    appropriate all-pass filter. PS encoding and decoding is described in the paper
                                                                                        Of
    "Low Complexity Parametric Stereo Coding in MPEG-4", H, Purmhagen, Proc.
                                                                    Naples, Italy, Octo
25  the th Int. Conference on Digital Audio Effects (DAFx'04),
         7
    ber 5-8, 2004, pages 163-168. The disclosure of this document is hereby incorpo
    rated by reference.
                                                                                    of the
     The MPEG Surround standard (see document ISO/IEC 23 003-1) makes use
30   concept of PS coding. In an MPEG Surround decoder a plurality of output chan
     nels is created based on fewer input channels and control parameters. MPEG Sur-

                                               -3
   round decoders and encoders are constructed by cascading parametric stereo
   modules, which in MPEG Surround are referred to as OTT modules (One-To-Two
   modules) for the decoder and R-OTT modules (Reverse-One-To-Two modules)
   for the encoder. An OTT module determines two output channels by means of a
 5 single input channel (downmix signal) accompanied by PS parameters. An OTT
   module corresponds to a PS decoder and an R-OTT module corresponds to a.PS
   encoder, Parametric stereo can be realized by using MPEG Surround with a single
   OTT module at the decoder side and a single R-OTT module at the encoder side;
   this is also referred to as "MPEG Surround 2-1-2" mode. The bitstream syntax
10 may differ, but the underlying theory and signal processing are the same. There
                                                                                  2-1
   fore, in the following all the references to PS also include "MPEG Surround
   2" or MPEG Surround based parametric stereo.
   In a PS encoder (e.g. in a MPEG Surround PS encoder) a residual signal (RES)
15 may be determined and transmitted in addition to the downmix signal. Such resi
   dual signal indicates the error associated with representing original channels by
   their downnix and PS parameters, In the decoder the residual signal may be used
   instead of the decorrelated version of the downmix signal. This allows to better
   reconstruct the waveforms of the original channels L and R. The use of an addi
20 tional residual signal is e.g. described in the MPEG Surround standard (see docu
   ment ISO/IEC 23003-1) and in the paper "MPEG Surround - The ISO/MPEG
    Standard for Efficient and Compatible Multi-Channel Audio Coding, J. Herre et
    al., Audio Engineering Convention Paper 7084, 1 2 2 "dConvention, May 5-8,
   2007. The disclosure of both documents, in particular the remarks to the residual
25  signal therein, is herewith incorporated by reference,
    PS coding with residual is a moi-e general approach to joint stereo coding than
    M/S coding: M/S coding performs a signal rotation when transforming L/R sig
    nals into MIS signals. Also, PS coding with residual performs a signal rotation
30  when transfonning the L/R signals into downmix and residual signals. However,
    in the latter case the signal rotation is variable and depends on the PS parameters.

                                              -4
    Due to the more general approach of PS coding with residual, PS coding with
    residual allows a more efficient coding of certain types of signals like a paned
    mono signal than M/S coding. Thus, the proposed coder allows to efficiently
    combine parametric stereo coding techniques with wavefom based stereo coding
  5 techniques.
    Often, perceptual stereo encoders, such as an MPEG AAC perceptual stereo en
    coder, can decide between L/R stereo encoding and M/S stereo encoding, where
    in the latter case a mid/side signal is generated based on the stereo signal. Such
                                                                                     en
10  selection may be frequency-variant, i.e. for some frequency bands L/R stereo
    coding may be used, whereas for other frequency bands M/S stereo encoding may
    be used,
    In a situation where the L and R channels are basically independent signals, such
                                                                               since in
15  perceptual stereo encoder would typically not use M/S stereo encoding
    this situation such encoding scheme does not offer any coding gain in comparison
    to L/R stereo encoding, The encoder would fall back to plain L/R stereo encoding,
    basically processing L and R independently.
20  In the same situation, a PS encoder system would create a downmix signal that
     contains both the L and R channels, which prevents independent processing of the
                                                                                   effi
    L and R channels, Fox PS coding with a residual signal, this can imply less
     cient coding compared to stereo encoding, where L/R stereo encoding or M/S
     stereo encoding is adaptively selectable.
25
                                                                             stereo coder
     Thus, there are situations where a PS coder outperforms a perceptual
     with adaptive selection between L/R stereo encoding and M/S stereo encoding,
     whereas in other situations the latter coder outperforms the PS coder.
 30

                                              -5
    Summariy of the invention
                                                                       an encoding me
    The present application describes an audio encoder system and
    thod that are based on the idea of combing PS coding using a residual with adap
                                                                                     coding
 5  tive L/R or M/S perceptual stereo coding (e.g. AAC perceptual joint stereo
                                                                                    L/R or
    in the MDCT domain). This allows to combine the advantages of adaptive
    M/S stereo. coding (e.g. used in MPEG AAC) and the advantages of PS coding
                                                                         the application
    with a-residual signal (e.g. used in MPEG Surround). Moreover,
                                                                         method.
    describes a corresponding audio decoder system and a decoding
10
    A first aspect of the application relates to an encoder system for encoding a stereo
                                                                 of the encoder system,
     signal to a bitstream signal. According to an embodiment
    the encoder system comprises a downmix stage for generating a downmix signal
                                                                     signal may cover all
     and a residual signal based on the stereo signal. The residual
15   or only a part of the used audio frequency range. In addition, the encoder system
                                                                 PS parameters such as
     comprises a parameter determining stage for determining
                                                                                      Pre
     an inter-channel intensity difference and an inter-channel cross-correlation.
                                                               downmix stage and the
     ferably, the PS parameters are frequency-variant. Such
                                                      of a PS encoder,
     parameter determining stage are typically part
20
                                                                        means down
     In addition, the encoder system comprises perceptual encoding
                                                                       are selectable:
      stream of the downmix stage, wherein two encoding schemes
           -  encoding based on a sum of the downmix signal and the residual signal
                                                                          residual signal or
               and based on a difference of the downmix signal and the
 25        -   encoding based on the downmix signal and based on the residual signal.
                                                                downmix signal and the
      It should be noted that in case encoding is based on the
                                                                   may be encoded or
      residual signal, the downmix signal and the residual signal
                                                        case encoding is based on a sum
       signals proportional thereto may be encoded. In
 30    and on a difference, the sum and difference may be encoded or signals propor
      tional thereto may be encoded.

                                            -6
   The selection may be frequency-variant (and time-variant), i.e. for a first frequen
   cy band it may be selected that the encoding is based on a sum signal and a differ
   ence signal, whereas for a second frequency band it may be selected that the en
 5 coding is based on the downmix signal and based on the residual signal.
   Such encoder system has the advantage that is allows to switch between L/R ste
   reo coding and PS coding with residual (preferably in a frequency-variant man
   ner): If the perceptual encoding means select (for a particular band or for the
10 whole used frequency range) encoding based on downmix and residual signals,
   the encoding system behaves like a system using standard PS coding with resi
   dual, However, if the perceptual encoding means select (for a particular band or
   for the whole used frequency range) encoding based on a sum signal of the
   downmix signal and the residual signal and based on a difference signal of the
15 downmix signal and the residual signal, under certain circumstances the sum and
   difference operations essentially compensate the prior downmix operation (except
   for a possibly different gain factor) such that the overall system can actually per
   form L/R encoding of the overall stereo signal or for a frequency band thereof.
   E.g. such circumstances occur when the L and R channels of the stereo signal are
20 independent and have the same level as will be explained in detail later on.
   Preferably, the adaption of the encoding scheme is time and frequency dependent.
   Thus, preferably some frequency bands of the stereo signal are encoded by a L/R
   encoding scheme, whereas other frequency bands of the stereo signal are encoded
25 by a PS coding scheme with residual.
   It should be noted that in case the encoding is based on the downmix signal and
   based on the residual signal as discussed above, the actual signal which is input to
   the core encoder may be formed by two serial operations on the downmix signal
30 and residual signal which are inverse (except for a possibly different gain factor).
   Eg. a downmix signal and a residual signal are fed to anM/S to L/R transform

                                               7
   stage and then the output of the transform stage is fed to a L/R to M/S transform
   stage. The resulting signal (which is then used for encoding) corresponds to the
   downmix signal and the residual signal (expect for a possibly different gain fac
   tor).
 5
   The following embodiment makes use of this idea, Acoording to an embodiment
   of the encoder system, the encoder system comprises a dowumix stage and a pa
   rameter determining stage as discussed above. Moreover,
   the encoder system comprises a transform stage (e.g. as part of the encoding
10 means discussed above). The transform stage generates a pseudo L/R stereo signal
   by performing a transform of the downmix signal and the residual signal. The
   transform stage preferably performs a sum and difference transform, where the
   downmix signal and the residual signals are summed to generate one channel of
   the pseudo stereo signal (possibly, the sum is also multiplied by a factor) and sub
15 tracted from each other to generate the other channel of the pseudo stereo signal
   (possibly, the difference is also multiplied by a factor). Preferably, a first channel
   (e.g. the pseudo left channel) of the pseudo stereo signal is proportional to the sum
   of the downmix and residual signals, where a second channel (e.g. the pseudo
   right channel) is proportional to the difference of the downmix and residual sig
20 nals, Thus, the downmix signal DMX and residual signal RES from the PS encod
   er may be converted into a pseudo stereo signal Lp, Ry according to the following
   equations:
                                    L, = g(DMX+,RES)
                                    R, = g(DMX -RES)
25 In the above equations the gain normalization factor g has e.g. a value of
     g     1/2.
    The pseudo stereo signal is preferably processed by a perceptual stereo encoder
                                                                                 or M/S
    (e.g. as part of the encoding means). For encoding, L/R stereo encoding
30  stereo encoding is selectable, The adaptive L/R or M/S perceptual stereo encoder

   may be an AAC based encoder. Preferably, the selection between L/R stereo en
   coding and M/S stereo encoding is frequency-variant; thus, the selection may vary
   for different frequency bands as discussed above. Also, the selection between L/R
   encoding and MIS encoding is preferably time-variant. The decision between L/R
 5 encoding and MIS encoding is preferably made by the perceptual stereo encoder.
   Such perceptual encoder having the option for M/S encoding can internally com
   pute (pseudo) M and S signals (in the time domain or in selected frequency bands)
   based on the pseudo stereo L/R signal. Such pseudo M and S signals correspond
10 to the downmix and residual signals (except for a possibly different gain factor).
   Hence, if the perceptual stereo encoder selects M/S encoding, it actually encodes
   the downnix and residual signals (which correspond to the pseudo M and S sig
   nals) as it would be done in a system using standard PS coding with residual.
15 Moreover, under special circumstances the transform stage essentially compen
   sates the prior downmix operation (except for a possibly different gain factor)
   such that the overall encoder system can actually perform L/R encoding of the
   overall stereo signal or for a frequency band thereof (if L/R encQding is selected
   in the perceptual encoder), This is e.g. the case when the L and R channels of the
20 stereo signal are independent and have the same level as will be explained in de
   tail later on. Thus, for a given frequency band the pseudo stereo signal essentially
   corresponds or is proportional to the stereo signal, if- for the frequency band - the
   left and right channels of the stereo signal are essentially independent and have
   essentially the saime level,
25
   Thus, the encoder system actually allows to switch between L/R stereo coding and
   PS coding with residual, in order to be able to adapt to the properties of the given
   stereo input signal. Preferably, the adaption of the encoding scheme is time and
   frequency dependent. Thus, preferably some frequency bands of the stereo signal
30  are encoded by a L/R encoding scheme, whereas other frequency bands of the
   stereo signal are encoded by a PS coding scheme with residual. It should be noted

                                           -.9
   that M/S coding is basically a special case of PS coding with residual (since the
   L/R to M/S transform is a special case of the PS downmix operation) and thus the
   encoder system may also perform overall M/S coding.
 5 Said embodiment having the transform stage downstream ofthe PS encoder and
   upstream of the L/R or M/S perceptual stereo encoder has the advantage that a
   conventional PS encoder and a conventional perceptual encoder can be used.
   Nevertheless, the PS encoder or the perceptual encoder may be adapted due to the
   special use here,
10
   The new concept improves the performance of stereo coding by enabling an effi
   cient combination of PS 'coding and joint stereo coding.
   According to an alternative embodiment, the encoding means as discussed above
15 comprise a transform stage for performing a sum and difference transform based
   on the downmix signal and the residual signal for one or more frequency bands
   (e.g. for the whole used frequency range or only for one frequency range). The
   transform may be performed in a frequency domain or in a time domain. The
   transform stage generates a pseudo left/right stereo signal for the one or more fre
                                                                               sun
20 quency bands, One channel of the pseudo stereo signal corresponds to the
   and the other channel corresponds to the difference.
   Thus, in case encoding is based on the sum and difference signals the output of
   the transform stage may be used for encoding, whereas in case encoding is based
25 on the downmix signal and the residual signal the signals upstream of the encod
   ing stage may be used for encoding. Thus, this embodiment does not use two seri
   al sum and difference transforms on the downmix signal and residual signal, re
   sulting in the downmix signal and residual signal (except for a possibly different
    gain factor).
30

                                             - 10
    When selecting encoding based on the dowumix signal and residual signal, para
    metric stereo encoding of the stereo signal is selected. When selecting encoding
    based on the sum and difference (i.e. encoding based on the pseudo stereo signal)
    L/R encoding of the stereo signal is selected.
 5
    The transform stage may be a L/R to MIS transform stage as part of a perceptual
    encoder with adaptive selection between L/R and MIS stereo encoding (possibly
                                                                   L/R to MIS transform
    the gain factor is different in comparison to a conventional
                                                                                  encoding
    stage). It should be noted that the decision between L/R and M/S stereo
                                                                               residual
10  should be inverted. Thus, encoding based on the downmix signal and
    signal is selected (i.e. the encoded signal did not pass the transform stage) when
                                                                           based on the
    the decision means decide M/S perceptual decoding, and encoding
                                                          stage is selected (i.e. the en
    pseudo stereo signal as generated by the transform
                                                                                    L/R
    coded signal passed the transform stage) when the decision nieans decide
15  perceptual decoding.
     The encoder system according to any of the enbodiments discussed above may
                                                                encoder. SBR is a form of
     comprise an additional SBR (spectral band replication)
                                                                  determines side infor
     HFR (High Frequency Reconstruction). An SBR encoder
                                                                           audio signal in
20   mation for the reconstruction of the higher frequency range of the
                                                                                     encod
     the decoder. Only the lower frequency range is encoded by the perceptual
                                                                                     up
     er, thereby reducing the bitrate. Preferably, the SBR encoder is connected
                                                                         stereo domain and
     stream of the PS encoder. Thus, the SBR encoder may be in the
                                                           will be discussed in detail in
      generates SBR parameters for a stereo signal. This
 25   connection with the drawings.
      Preferably, the PS encoder (i.e. the downmix stage and the parameter determining
                                                                   the PS decoder as dis
      stage) operates in an oversampled frequency domain (also
                                                                                    For time
      cussed below preferably operates in an oversampled frequency domain).
 30   to-frequency transform e.g. a complex valued hybrid filter bank having a QMF
                                                              used upstream of the PS en-
      (quadrature mirror filter) and aNyquist filter may be

                                             -11.
   coder as described in MPEG Surrond standard (see document ISO/IEC 23003-1).
   This allows for time and frequency adaptive signal processing without audible
   aliasing artifacts, The adaptive L/R or M/S encoding, on the other hand, is prefer
   ably carried out in the critically sampled MDCT domain (e.g. as described in
 5 AAC) in order to ensure an efficient quantized signal representation,
   The conversion between downmix and residual signals and the pseudo L/R stereo
   signal may be carried out in the time domain since the PS encoder and the percep
   tual stereo encoder are typically connected in the time domain anyway, Thus, the
10 transform stage for generating the pseudo L/R signal may operate in the time do
   main.
   In other embodiments as discussed in connection with the drawings, the transform
   stage operates in an oversampled frequency domain or in a critically sampled
15 MDCT domain.
   A second aspect of the application relates to a decoder system for decoding a bit
   stream signal as generated by the encoder system discussed above.
20 According to an embodiment of the decoder system, the decoder system compris
   es perceptual decoding means for decoding based on the bitstream signal. The
   decoding means are configured to generate by decoding an (internal) first signal
   and an (internal) second signal and to output a downmix signal and a residual sig
   nal. The downmix signal and the residual signal is selectively
25          -      based on the sum of the first signal and of the second signal and
                   based on the difference of the first signal and of the second signal
                    or
                   based on the first signal and based on the second signal.
30 As discussed above in connection with the encoder system, also here the selection
   may be frequency-variant or frequency-invariant.

                                             ~-12
                                                                                  signal
    Moreover, the system comprises an upmix stage for generating the stereo
                                                                                         of
    based on the downmix signal and the residual signal, with the upmtix operation
    the upmix stage being dependent on the one or more parametric stereo parameters.
                                                                                   switch
    Analogously to the encoder system, the decoder system allows to actually
                                                                                     and
    between L/R decoding and PS decoding with residual, preferably in a time
    frequency variant manner,
10
    According to another embodiment, the decoder system comprises a perceptual
    stereo decoder (e.g. as part of the decoding means) for decoding the bitstream
                                                                  The perceptual decoder
    signal, with the decoder generating a pseudo stereo signal.
    may be an AAC based decoder. For the perceptual stereo decoder, L/R perceptual
                                                                                  or fre
15  decoding or M/S perceptual decoding is selectable in a frequency-variant
                                                                   controlled by the deci
     quency-invariant manner (the actual selection is preferably
                                                                                       The
     sion in the encoder which is conveyed as side-information in the bitstream).
                                                                                  for en
     decoder selects the decoding scheme based on the encoding scheme used
     coding. The used encoding scheme may be indicated to the decoder by inforrna
20  tion contained in the received bitstream.
                                                                                   and a
     Moreover, a transform stage is provided for generating a downmix signal
                                                                               In other
     residual signal by performing a transform of the pseudo stereo signal.
                                                                                   is con
     words: The pseudo stereo signal as obtained from the perceptual decoder
                                                                                     and
25   verted back to the downmix and residual signals. Such transform is a sum
                                                                                    sum of a
     difference transform: The resulting downmix signal is proportional to the
                                                                                    residual
     left channel and a right channel of the pseudo stereo signal. The resulting
                                                                  and the right channel of
     signal is proportional to the difference of the left channel
                                                                       was carried out.
     the pseudo stereo signal. Thus, quasi an L/R to M/S transform
                                                                                   to the
 30  The pseudo stereo signal with the two channels Lp, Rp may be converted
      downmix and residual signals according to the following equations:

                                             -13
                                               1
                                    -DMX=-(L,+ R,)
                                              2g
                                     RESK=-(LP -lR,)
                                             2g
   In the above equations the gain normalization factor g may have e.g. a value of
    g =1i/2 .The residual signal RES used in the decoder may cover the whole used
 5 audio frequency range or only a part of the used audio frequency range.
   The downmix and residual signals are then processed by an upmix stage of a PS
   decoder to obtain the final stereo output signal. The upmixing of the downmix and
   residual signals to the stereo signal is dependent on the received PS parameters.
10
   According to ala alternative embodiment, the perceptual decoding means may
   comprise a sum and difference transform stage for performing a transform based
   on the first signal and the second signal for one or more frequency bands (e.g. for
15 the whole used frequency range). Thus, the transform stage generates the down
   mix signal and the residual signal for the case that the downmix signal and the
   residual signal are based on the sum of the first signal and of the second signal
   and based on the difference of the first signal and of the second signal. The trans
   form stage may operate in the time domain or in a frequency domain.
20
   As similarly discussed in connection with the encoder system, the transform stage
   may be a M/S to L/R transform stage as part of a perceptual decoder with adaptive
   selection between L/R and M/S stereo decoding (possibly the gain factor is differ
   ent in comparison to a conventional M/S to L/R transform stage). It should be
25 noted that the selection between L/R and MIS stereo decoding should be inverted.
   The decoder system according to any of the preceding embodiments may com
   prise an additional SBR decoder for decoding the side information from the SBR
   encoder and generating a high frequency component of the audio signal. Prefera-

                                              -14
   bly, the SBR decoder is located downstream of the PS decoder. This will be
   discussed in detail in connection with drawings.
   Preferably, the upmix stage operates in an oversampled frequency domain, e.g. a
   hybrid filter bank as discussed above may be used upstream of the PS decoder.
 5 The L/R to M/S transform may be carried out in the time domain since the
   perceptual decoder and the PS decoder (including the upnix stage) are typically
   connected in the time domain.
   In other embodiments as discussed in connection with the drawings, the L/R to M/S
   transform is carried out in ati oversampled frequency domain (e.g., QMF), or in a
10 critically sampled frequency domain (e.g., MDCT).
   A third aspect of the application relates to a method for encoding a stereo signal to a
   bitstream signal. The method operates analogously to the encoder system discussed
   above. Thus, the above remarks related to the encoder system are basically also
   applicable to encoding method.
15 A fourth aspect of the invention relates to a method for decoding a bitstream signal
   including PS parameters to generate a stereo signal. The method operates in the same
                                                                                    to the
   way as the decoder system discussed above, Thus, the above remarks related
   decoder system are basically also applicable to decoding method.
   A fifth aspect of the invention relates to an encoder system configured for encoding a
20 stereo signal to a bitstream signal, the encoder system comprising: a downmixing
   means configured for generating a downmix signal and a residual signal based on the
   stereo signal; a parameter determining means configured for determining one or
   more parametric stereo parameters; and perceptual encoding means downstream of
   the downmixing means, wherein the perceptual encoding means are configured for
25  encoding the downmix signal and the residual signal, and wherein the perceptual
    encoding means are configured for selecting left/right perceptual encoding, or
    mid/side perceptual encoding.
    A sixth aspect of the invention relates to a decoder system configured for decoding a
    bitstream signal including one or more parametric stereo parameters to a stereo
30  signal, the decoder system comprising: perceptual decoding means configured for
    decoding based on the bitstream signal, wherein the decoding means are configured
                                                                                        are
    to generate a downmix signal and a residual signal, wherein the decoding means

                                           .15
   configured to selectively perform left/right perceptual decoding or mid/side
   perceptual decoding; and upmixing means configured for performing an upmix
   operation for generating the stereo signal based on the downmix signal and the
   residual signal, with the upmix operation of the upmixing means being dependent on
 5 the one or more parametric stereo parameters.
   A seventh aspect of the invention relates to a method for encoding a stereo signal to
   a bitstream signal, the method comprising: generating a downnix signal and a
   residual signal based on the stereo signal; determining one or more parametric stereo
                                                                                     and
   parameters; perceptual encoding downstream of generating the downmix signal
10 the residual signal, wherein left/right perceptual encoding, or mid/side perceptual
   encoding is selectable.
   An eighth aspect of the invention relates to a method for decoding a bitstream signal
   including parametric stereo parameters to a stereo signal, the method comprising:
   perceptual decoding based on the bitstream signal, wherein perceptual decoding
15 comprises generating a downmix signal and a residual signal by selectively
   performing left/right perceptual decoding or mid/side perceptual decoding; and
   generating the stereo signal based on the downmix signal and the residual signal by
   an upmix operation, with the upmix operation being dependent on the parametric
   stereo parameters.
20 The invention is explained below by way of illustrative examples with reference to
   the accompanying drawings, wherein
   Fig. 1 illustrates an embodiment of an encoder system, where optionally the PS
   parameters assist the psycho-acoustic control in the perceptual stereo encoder;
   Fig. 2 illustrates an embodiment of the PS encoder;
25 Fig. 3 illustrates an embodiment of a decoder system;
   Fig. 4 illustrates a further embodiment of the PS encoder including a detector to
    deactivate PS encoding if L/R encoding is beneficial;
   Fig. 5 illustrates an embodiment of a conventional PS encoder system having an
    additional SBR encoder for the downmix;
30  Fig. 6 illustrates an embodiment of an encoder system having an additional SBR
    encoder for the downmix signal;

                                             -16
   Fig. 7 illustrates an embodiment of an encoder system having an additional SBR
   encoder in the stereo domain;
   Figs, 8a-8d illustrate various time-fiequency representations of one of the two output
   channels at the decoder output;
 5 Fig. 9a illustrates an embodiment of the core encoder;
   Fig. 9b illustrates an embodiment of an encoder that permits switching between
   coding in a linear predictive domain (typically for mono signals only) and coding in
   a transform domain (typically for both mono and stereo signals);
   Fig. 10 illustrates an embodiment of an encoder system;
10 Fig. 11la illustrates a part of an embodiment of an encoder system;
   Fig. 11lb illustrates an exemplary implementation of the embodiment in Fig,11a;
   Fig. 11c illustrates an alternative to the embodiment in Fig. 11a;
   Fig. 12 illustrates an embodiment of an encoder system;
   Fig. 13 illustrates an embodiment of the stereo coder as part of the encoder system of
15 Fig. 12;
   Fig. 14 illustrates an embodiment of a decoder system for decoding the bitstream
   signal as generated by the encoder system of Fig. 6;
   Fig. 15 illustrates an embodiment of a decoder system for decoding the bitstream
   signal as generated by the encoder system of Fig. 7;
20 Fig. 16a illustrates a part of an embodiment of a decoder system;
   Fig. 16b illustrates an exemplary implementation of the embodiment in Fig. 16a;
   Fig. 16c illustrates an alternative to the embodiment in Fig. 16a;
   Fig. 17 illustrates an embodiment of an encoder system; and
   Fig. 18 illustrates an embodiment of a decoder system.
25
   Fig. 1 shows an embodiment of an encoder system which combines PS encoding
   using a residual with adaptive L/R or M/S perceptual stereo encoding. This embo-

                                             -17
   diment is merely illustrative for the principles of the present application. It is un
   derstood that modifications and variations of the embodiment will be apparent to
   others skilled in the art, The encoder system comprises a PS encoder 1 receiving a
   stereo signal L, R. The PS encoder 1 has a downmix stage for generating down
 5 mix DMX and residual RES signs based on the stereo signal L, R, This opera
   tion can be described by means of a 2-2 downmix matrix H-1 that converts the L
   and R signals to the downmix signal DMX and residual signal RES:
                                     DMX              (L)
                                      R ES              R
   Typically, the matrix H' is frequency-variant and time-variant, i.e. the elements
10 of the matrix H~1vary over frequency and vary from time slot to time slot, The
   matrix H- may be updated every frame (e.g, every 21 or 42 ms) and may have a
   frequency resolution of a plurality of bands, e.g, 28, 20, or 10 bands (named "pa
   rameter bands") on a perceptually oriented (Bark-like) frequency scale.
15 The elements of the matrix H- depend on the time- and frequency-variant PS
                                                                                       lev
   parameters IID (inter-channel intensity difference; also called CLD - channel
   el difference) and ICC (inter-channel cross-correlation). For determining PS pa
   rameters 5, eg. IID and ICC, the PS encoder 1 comprises a parameter determining
   stage, An example for computing the matrix elements of the inverse matrix His
20 given by the following and described in the MPEG Surround specification docu
   ment ISO/IEC 23003-1, subolause 6,5.3.2 which is hereby incorporated by refer
   ence:
                                  [CCos(a+8)        c, sinx(a+P)
                                LC2 cos(-a+,)      C2 si(-a+p)
   where
                                    FCLD
                                    10 10
25                           c          CLD,   and c2 =        c  >
                                   1+1010                 1+10 1
    and where

                                              - 18
                         p= arctan tan(a)         ,c and  a= arcos(p),
     and where p=ICC.
                                                                                      the
     Moreover, the encoder system comprises a transform stage 2 that converts
 5   dowmnix signal DMX and residual signal RES from the PS encoder 1 into a
                                                   to the following equations:
     pseudo stereo signal Lp, Rp, e.g. according
                                      L, = g(DMX + RES)
                                      R, = g(DMX - RES)
                                                                    e.g. a value of
     In the above equations the gain normalization factor g has
                                                         pseudo stereo signal L,, Rp can be
10    g =1/2 .For g = / , the two equations for
     rewritten as:
                                  L/2                      '1D2fMXl
                                  RP       1/2RES)
                                                        perceptual stereo encoder 3, which
      The pseudo stereo signal Lp, Rp is then fed to a
                                                                     encoding is a form of
 15   adaptively selects either L/R or M/S stereo encoding. M/S
                                                               onjoint encoding aspects,
     joint stereo coding. L/R encoding may be also based
                                                        R channels from a common bit
      e.g. bits may be allocated jointly for the L and
      reservoir.
 20   The selection between L/R or MIS stereo encoding is preferably frequency
                                                                                   frequency
      variant, i.e. some frequency bands may be L/R encoded, whereas other
                                                                           the selection be
       bands may be M/S encoded. An embodiment for implementing
                                                                document "Sum-Difference
       tween LIR or M/S stereo encoding is described in the
                                                                 International Confe'ence
       Stereo Transform Coding", J. D. Johnston et al., IEEE
                                                                   1992, pages 569-572. The
  25   on Acoustics; Speech, and Signal Processing (ICASSP)
                                                                 encoding therein, in partic
        discussion of the selection between L/R or MIS stereo
       ular sections 5.1 and 5.2, is hereby incorporated by reference,

                                              -19
     Based on the pseudo stereo signal L,, Rv, the perceptual encoder 3 can internally
     compute (pseudo) mid/side signals Mp, Sp. Such signals basically corespond to
     the downmix signal DMX and residual signal RES (except for a possibly different
     gain factor). Hence, if the perceptual encoder 3 selects M/S encoding for a fre
 5   quency band, the perceptual encoder 3 basically encodes the downmix signal
     DMX and residual signal RES for that frequency band (except for a possibly dif
     ferent gain factor) as it also would be done in a conventional perceptual encoder
     system using conventional PS coding with residual. The PS parameters 5 and the
     output bitstream 4 of the perceptual encoder 3 are multiplexed into a single bit
10   stream 6 by a multiplexer 7.
     In addition to PS encoding of the stereo signal, the encoder system in Fig, 1 al
     lows L/R coding of the stereo signal as will be explained in the following: As dis
     cussed above, the elements of the downmix matrix H- of the encoder (and also of
15   the upmix matrix Hused in the decoder) depend on the time- and frequency
     variant PS parameters IID (inter-channel intensity difference; also called CLD
     channel level difference) and ICC (inter-channel cross-correlation). An example
     for computing the matrix elements of the upmix matrix His described above. In
     case of using residual coding, the right column of the 2-2 upmix matrix H is given
20   as
     However, preferably, the right column of the 2.2 matrixH should instead be mod
     ified to
25(1/2
     The left column is preferably computed as given in the MPEG Surround specifica
     tion.

                                            -20
   Modifying the right column of the upnix matrix H ensures that for IID = 0 dB
   and ICC =0 (i.e. the case where for the respective band the stereo channels L and
   R are independent and have the same level) the following upmnix matrix H is ob
 5 tained for the band:
                                       S(1/2          /2
                                                                             1
   Please note that the uprnix matrix H and also the downmix matrix H are typi
10 cally frequency-variant and time-variant. Thus, the values of the matrices are dif
   ferent for different time/frequency tiles (a tile corresponds to the intersection of a
   particular frequency band and a particular time.period). In the above case the
   downmix matrix H-'is identical to the upmix matrix H . Thus, for the band the
   pseudo stereo signal Lp, R, can computed by the following equation:
15
                        r
              rL)=       iI2    V/2    DMX2               1/2     -2H/ 1
                 Rp
                  )                     RES, )=        /2     f-,2R
                           l/~(1/
                             /2            l2~LH1 0 rLrL~
                                                   R)     0 1) R)YR)
                                                                                        1
   Hence, in this case the PS encoding with residual using the downmix matrix H
   followed by the generation of the pseudo L/R signal in the transform stage 2 cor
20 responds to the unity matrix and does not change the stereo signal for the respec
   tive frequency band at all, i.e.
                                           R, =1R
25  In other words: the transform stage 2 compensates the downmix matrix H~'such
    that the pseudo stereo signal Lp, R, corresponds to the input stereo signal L, R.

                                            -21
   This allows to encode the original input stereo signal L, Rby the perceptual en
   coder 3 for the particular band; When L/R encoding is selected by the perceptual
   encoder 3 for encoding the particular band, the encoder system behaves like a L/R
   perceptual encoder for encoding the band of the stereo input signal L, R.
 5
   The encoder system in Fig. 1 allows seamless and adaptive switching between
   L/R coding and PS coding with residual in a frequency- and time-variant manner.
   The encoder system avoids discontinuities in the waveform when switching the
   coding scheme. This prevents artifacts. In order to achieve smooth transitions,
10 linear interpolation may be applied to the elements of the matrix H1in the encod
   er and the matrix H in the decoder for samples between two stereo parameter -up
   dates.
                                                                                        a
   Fig, 2 shows an embodiment of the PS encoder 1. The PS encoder 1 comprises
15 downmix stage 8 which generates the downmix signal DMX and residual signal
   RES based on the stereo signal L, R. Further, the PS encoder 1 comprises a para
   meter estimating stage 9 for estimating the PS parameters 5 based on the stereo
   signal L, R.
20 Fig. 3 illustrates an embodiment of a corresponding decoder system configured to
   decode the bitstream 6 as generated by the encoder system of Fig. 1. This embo
   diment is merely illustrative for the principles of the present application. It is un
   derstood that modifications and variations of the embodiment will be apparent to
   others skilled in theart. The decoder system comprises a demultiplexer 10 for
25 separating the PS parameters 5 and the audio bitstream 4 as generated by the per
   ceptual encoder 3.The audio bitstream 4 is fed to a perceptual stereo decoder 11,
   which can selectively decode an L/R encoded bitstream or an M/S encoded audio
   bitstream. The operation of the decoder 11 is inverse to the operation of the en
   coder 3. Analogously to the perceptual encoder 3, the perceptual decoder 11 pre
30 ferably allows for a frequency-variant and time-variant decoding scheme. Some
   frequency bands which are L/R encoded by the encoder 3 are L/R decoded by the

                                             -22
     decoder 11, whereas other frequency bands which are MIS encoded by the encod
     er 3 are MIS decoded by the decoder 11. The decoder 11 outputs the pseudo stereo
     signal Lp, R, which was input to the perceptual encoder 3 before. The pseudo ste
    reo signal Lp, R, as obtained from the perceptual decoder 11 is converted back to
 5  the downmix signal DMX and residual signal RES by a L/R to M/S transform
     stage 12. The operation of the L/R to M/S transform stage 12 at the decoder side
    is inverse to the operation of the transform stage 2 at the encoder side, Preferably,
    the transform stage 12 determines the downmix signalDMX and residual signal
    RES according to the following equations:
10                                   DAMX      I=(Lp+ R,)
                                             2g
                                              1
                                      RPES=-(LP R,)
                                             2g
    In the above equations, the gain normalization factor g is identical to the gain
    normalization factor g at the encoder side and has e.g. a value of g       /2.
15  The downmix signal DMX and residual signal RES are then processed by the PS
    decoder 13 to obtain the final L and R output signals, The upmix step in the de
    coding process for PS coding with a residual can be described by means of the 2-2
    upmix matrix H that converts the downmix signal DMX and residual signal RES
    back to the L and R channels:
20)                                        =H.          .
                                       R          R ES
    The computation of the elements of the upmix matrix H was already discussed
    above.
    The PS encoding and PS decoding process in the PS encoder 1 and the PS decoder
25   13 is preferably carried out in an oversampled frequency domain. For timeto
    frequency transform e.g. a complex valued hybrid filter bank having a QMF (qua
    drature mirror filter) and a Nyquist filter may be used upstream of the PS encoder,
    such as the filter bank described in MPEG Surround standard (see document

                                            - 23
   ISO/IEC 23003-1). The complex QMF representation of the signal is oversampled
   with factor 2 since it is complex-valued and not real-valued. This allows for time
   and frequency adaptive signal processing without audible aliasing artifacts. Such
   hybrid filter bank typically provides high frequency resolution (narrow band) at
 5 low frequencies, while at high frequency, several QMF bands are grouped into a
   wider band, The paper "Low Complexity Parametric Stereo Coding in MPEG-4",
   H. Pumhagen, Proc. of the 7t" Int, Conference on Digital Audio Effects
   (DAFx'04), Naples, Italy, October 5-8, 2004, pages 163-168 describes an embo
   diment of a hybrid filter bank (see section 3.2 and Fig. 4). This disclosure is here
to by incorporated by reference. In this document a 48 kflz sampling rate is as
   sumed, with the (nominal) bandwidth of a band from a 64 band QMF bank being
   375 Hz. The perceptual Bark frequency scale however asks for a bandwidth of
   approximately 100 Hz for frequencies below 500 Hz. Hence, the. ftrst 3 QMF
   bands may be split into further more narrow subbands by means of a Nyquist filter
15 bank The first QMF band may be split into 4 bands (plus two more for negative
                                                                                 each.
   frequencies), and the 2nd and 3rd QMF bands may be split into two bands
   Preferably, the adaptive L/R or M/S encoding, on the other hand, is carried out in
   the critically sampled MDCT domain (e.g. as described in AAC) in order to en
20 sure an efficient quatitized signal representation. The conversion of the downmix
   signal DMX and residual signal RES to the pseudo stereo signal Lp, Rp in the
   transform stage 2 may be carried out in the time domain since the PS encoder 1
    and the perceptual encoder 3 may be connected in the time domain anyway. Also
   in the decoding system, the perceptual stereo decoder 11 and the PS decoder 13
25  are preferably connected in the time domain. Thus, the conversion of the pseudo
    stereo signal Lp, Rp to the downtix signal DMX and residual signal RES in the
    transform stage 12 may be also carried out in the time domain.
    An adaptive L/R or M/S stereo coder such as shown as the encoder 3 in Fig. 1 is
30  typically a'perceptual audio coder that incorporates a psychoacoustic model to
    enable high coding efficiency at low bitrates. An example for such encoder is an

                                            - 24
   AAC encoder, which employs transform coding in a critically sampled MDCT
   domain in combination with time- and frequency-variant quantization controlled
   by using a psycho-acoustic model, Also, the time- and frequency-variant decision
   between L/R and M/S coding is typically controlled with help of perceptual entro
 5 py measures that are calculated using a psycho-acoustic model.
                                                                                  a
   The perceptual stereo encoder (such as the encoder 3 in Fig. 1) operates on
                                                                                efficien
   pseudo L/R stereo signal (see L,, Rp in Fig, 1). For optimizing the coding
                                                                                    L/R
   cy of the stereo encoder (in particular for making the right decision between
10 encoding and M/S encoding) it is advantageous to modify the psycho-acoustic
   control mechanism (including the control mechanism which decides between L/R
   and M/S stereo encoding and the control mechanism which controls the time- and
   frequency-variant quantization) in the pefceptual stereo encoder in order to ac
   count for the signal modifications (pseudo L/R to DMX and RES conversion, fol
15 lowed by PS decoding) that are applied in the decoder when generating the final
   stereo output signal L, R. These signal modifications can affect binaural masking
   phenomena that are exploited in the psycho-acoustic control mechanisms. There
                                                                                     ac
   fore, these psycho-acoustic control mechanisms should preferably be'adapted
   cordingly. For this, it can be beneficial if the psycho-acoustic control mechanisms
20 do not have access only to the pseudo L/R signal (see Lp, Rp in Fig, 1)but also to
   the PS parameters (see 5 in Fig. 1) and/or to the original stereo signal L, R. The
   access of the psycho-acoustic control mechanisms to the P8 parameters and to the
   stereo signalL, R is indicated in Fig. 1 by the dashed lines. Based on this informa
   tion, e.g. the masking threshold(s) may be adapted.
25
   An alternative approach to optimize psycho-acoustic control is to augment the
    encoder system with a detector forming a deactivation stage that is able to effec
   tively deactivate PS encoding when appropriate, preferably in a time- and fre
                                                                            when L/R
    quency-variant manner, Deactivating PS encoding is e.g, appropriate
30  stereo coding is expected to be beneficial or when the psycho-acoustic control
   would have problems to encode the pseudo L/R signal efficiently. PS encoding

                                             - 25.
   may be effectively deactivated by setting the downmix matrix H in such a way
   that the downmix matrix H-1 followed by the transform (see stage 2 in Fig. 1)
   corresponds to the unity matrix (i.e. to an identity operation) or to the unity matrix
                                                                                       PS
   times a factor, Eg, PS encoding may be effectively deactivated by forcing the
                                                                          the pseudo
 5 parameters IID and/or ICC to IID = 0 dB and ICC= 0, In this case
   stereo signal Lp, R, corresponds to the stereo signal L, R as discussed above.
   Such detector controlling a PS parameter modification is shown in Fig. 4. Here,
   the detector 20 receives the PS parameters 5 determined by the parameter estinat
10 ing stage 9. When the detector does not deactivate the PS encoding, the detector
   20 passes the PS parameters through to the downmix stage 8 and to the multiplex
                                                                                  5' fed to
   er 7, i.e. in this case the PS parameters 5 correspond to the PS parameters
   the downmix stage 8. In case the detector detects that PS encoding is disadvanta
   geous and PS encoding should be deactivated (for one or more frequency bands),
15 the detector modifies the affected PS parameters 5 (e.g. set the PS parameters IID
   and/or ICC to IID =0 dB and ICC= 0) and feeds the modified PS parameters 5'
   to downmix stage 8. The detector can optionally also consider the left and right
    signals L, R for deciding on a PS parameter modification (see dashed lines in Fig.
   4).
20
   In the following figures, the termQMF (quadrature mitror filter or filter bank)
    also includes a QMF subband filter bank in combination with a Nyquist filter
    bank, ,e, a hybrid filter bank structure. Furthermore, all values in the description
    below may be frequency dependent, e.g. different downmix and upmix matrices
25  may be extracted for different frequency ranges. Furthermore, the residual coding
                                                                                signal is
    may only cover part of the used audio frequency range (i.e. the residual
                                                                             downmix as
    only coded for a part of the used audio fequency range). Aspects of
    will be outlined below may for some frequency ranges occur in the QMF domain
                                                                     only e.g. phase as
    (e.g. according to prior art), while for other fr-equency ranges
                                                                      amplitude trans
30  pects will be dealt with in the complex QMF domain, whereas
    formation is dealt with in the real-valued MDCT domain.

                                            -26
    In Fig. 5,a conventional PS encoder system is depicted. Each of the stereo chan
   nels L, R, is at first analyzed by a complex QMF 30 with M subbands, e.g. a QMF
    with M= 64 subbands. The subband signals are used to estimate PS parameters 5
 5  and a downmix signal DMX in a PS encoder 31. The downnix signal DMX is
   used to estimate SBR (Spectral Bandwidth Replication) parameters 33 in an SBR
    encoder 32. The SBR encoder 32 extracts the SBRjparameters 33 representing the
    spectral envelope of the original high band signal, possibly in combination with
   noise and tonality measures. As opposed to the PS encoder 31, the SBR encoder
10 32 does not affect the signal passed on to the core coder 34. The downmix signal
   DMfX of the PS encoder 31 is synthesized using an inverse QMF 35 with N sub
   bands. E.g. a complex QMF with N=32 may be used, where only the 32lowest
   subbands of the 64 subbands used by the PS encoder 31 and the SBR encoder 32
   are synthesized. Thus, by using half the number of subbands for the same frame
15 size, a time domain signal of half the bandwidth compared to the input is ob
   tained, and passed into the core coder 34. Due to the reduced bandwidth the san
   pling rate can be reduced to the half (not shown). The core encoder 34 performs
   perceptual encoding of the mono input signal to generate a bitstream 36. The PS
   parameters 5 are embedded in the bitstream 36 by a multiplexer (not shown).
20
   Fig. 6 shows a further embodiment of an encoder system which combines PS cod
   ing using a residual with a stereo core coder 48, with the stereo core coder 48 be
   ing capable of adaptive L/R or M/S perceptual stereo coding. This embodiment is
   merely illustrative for the principles of the present application. It is understood
25 that modifications and variations of the embodiment will be apparent to others
    skilled in the art. The input channels L, R representing the left and right original
    channels are analyzed by a complex QMF 30, in a similar way as discussed in
    connection with Fig. 5. In contrast to the PS encoder 31 in Fig. 5,the PS encoder
    41 in Fig. 6 does not only output a downmix signal.DMX but also outputs a resi
30  dual signal RES. The downmix signal DMX is used by an SBR encoder 32 to de
   termine SBR parameters 33 of the dowmnix signal DMX. A fixed DMX/RES to

                                             -27
    pseudo L/R transform (i.e. an MIS to L/R transform) is applied to the downmix
    DMX and the residual RES signals in a transform stage 2. The transform stage 2
    in Fig. 6 corresponds to the transform stage 2 in Fig. 1. The transform stage 2
    creates a "pseudo" left and right channel signal Lp, Rp for the core encoder 48 to
  5 operate on. In this embodiment, the inverse L/R to M/S transform is applied inthe
    QMF domain, prior to the subband synthesis by filter banks 35. Preferably, the
    number N (e.g. N=32) of subbands for the synthesis corresponds to half the'
    number M (e.g. M= 64) of subbands used for the analysis and the core coder 48
                                                                                         t6
    operates at half the sampling rate, It should be noted that there is no restriction
10  use 64 subband channels for the QMF analysis in the encoder, and 32 subbands
    for the synthesis, other values are possible as well, depending-ot which sampling
    rate is desired for the signal received by the core code 48. The core stereo encod
    er 48 performs perceptual encoding of the signal of the filter banks 35 to generate
    a bitstream signal 46. The PS parameters 5 are embedded in the bitstream signal
15  46 by a multiplexer (not shown). Optionally, the PS parameters and/or the original
    L/R input signal may be used by the core encoder 48. Such information indicates
    to the core encoder 48 how the PS encoder 41 rotated the stereo space. The infor
    mation may guide the core encoder 48 how to control quantization in a percep
    tually optimal way. This is indicated in Fig. 6 by the dashed lines,
20
                                                                                       to
    Fig. 7 illustrates a further embodiment of an encoder system which is similar
    the embodiment in Fig. 6. In comparison to the embodiment of Fig. 6, in Fig. 7
    the SBR encoder 42 is connected upstream of the PS encoder 41. In Fig. 7 the
    SBR encoder 42 has been moved prior to the PS encoder 41, thus operating on the
25  left and right channels (here: in the QMF domain), instead of operating on the
    downmix signal DMX as in Fig. 6.
    Due to the re-arrangement of the SBR encoder 42, the PS encoder 41 may be con
                                                                                      on the
    figured to operate not on the full bandwidth of the input signal but e.g. only
 30 frequency range below the SBR crossover frequency. In Fig. 7, the SBR parame
    ters 43 are in stereo for the SBR range, and the output from the corresponding PS

                                            -28
    decoder as will be discussed later on in connection with Fig. 15 produces a stereo
    source frequency range for the SBR decoder to operate on. This modification, i.e.
    connecting the SBR encoder module 42 upstream of the PS encodar-module 41 in
   the encoder system and correspondingly placing the SBR decoder module after
 5 the PS decoder module in the decoder system (see Fig. 15), has the benefit that the
   use of a decorrelated signal for generating the stereo output can be reduced. Please
   note that in case no residual signal exists at all or for a particular frequency band,
   a decorrelated version of the downmix signal DMX is used instead in the PS de
   coder. However, a reconstruction based on a decorrelated signal reduces the audio
10 quality. Thus, reducing the use of the decorrelated signal increases the audio qual
   ity.
   This advantage of the embodiment in Fig. 7 in comparison to the embodiment in
   Fig. 6 will be now explained more in detail with reference to Figs. 8a to 8d.
15
   In Fig. 8a, a time frequency representation of one of the two output channels L, R
   (at the decoder side) is visualized. In case of Fig, 8a, an encoder is used where the
   PS encoding module is placed in front of the SBR encoding module such as the
   encoder in Fig. 5 or Fig. 6 (in the decoder the PS decoder is placed after the SBR
20 decoder, see Fig. 14). Moreover, the residual is coded only in a low bandwidth
   frequency range 50, which is smaller than the frequency range 51 of the core cod
   er. As evident from the spectrogram visualization in Fig. 8a, the frequency range
   52 where a decorrelated signal is to be used by the PS decoder covers all of the
   frequency range apart from the lower frequency range 50 covered by the use of
25 the residual signal. Moreover, the SBR covers a frequency range 53 starting sig
   nificantly higher than that of the decorrelated signal. Thus, the entire frequency
   range separates in the following frequency ranges: in the lower frequency range
   (see range 50 in Fig. 8a), waveform coding is used; in the middle frequency range
   (see intersection of frequency ranges 51 and 52), waveform coding in combination
30 with a decorrelated signal is used; and in the higher frequency range (see frequen
   cy range 53), a SBR regenerated signal which is regenerated from the lower fre-

                                             - 29
                                                                   produced by the PS
    quencies is used in combination with the decorrelated signal
    decoder,
    In Fig. 8b, a time frequency representation of one of the two output channels L, R
                                                                    encoder is connected
 5  (at the decoder side) is visualized for the case when the SBR
                                                                  SBR decoder is located
    upstream of the PS encoder in the encoder system (and the
                                                                           scenario is
    after the PS decoder in the decoder system). In Fig. 8b a low bitrate
    illustrated, with the residual signal bandwidth 60 (where residual coding is per
                                                                               SBR de
    formed) being lower than the bandwidth of the core coder 61. Since the
10  coding process operates on the decoder side after the PS decoder (see Fig. 15), the
                                                                                      of
    residual signal used for the low frequencies is also used for the reconstruction
    at least a part (see frequency range 64) of the higher frequencies in the SBR range
    63,
                                                                                     bi
15  The advantage becomes even more apparent when operating on intermediate
                                                                                     coder
    trates where the residual signal bandwidth approaches or is equal to the core
                                                                            (where the
    bandwidth. In this case, the time frequency representation of Fig. 8a
                                                                           results in the
     order of PS encoding and SBR encoding as shown in Fig. 6 is used)
                                                                               signal es
    time frequency representation shown in Fig, 8c. In Fig. 8c, the residual
                                                                                  fre
20   sentially covers the entire lowband range 51 of the core coder; in the SBR
                                                                             Fig. 8d, the
     quency range 53 the decorrelated signal is used by the PS decoder, In
     time frequency representation in case of the preferred order of the encod
                                                                       signal before PS
     ing/decoding modules (i.e. SBR encoding operating on a stereo
     encoding, as shown in Fig. 7) is visualized, Here, the PS decoding module oper
25   ates prior to the SBR decoding module in the decoder, as shown in Fig. 15. Thus,
     the residual signal is part of the low band used for high frequency reconstruction.
     When the    residual signal bandwidth equals that of the mono downmix signal
                                                                                 the out
     bandwidth, no decorrelated signal information will be needed to decoder
      put signal (see the full frequency range being hatched in Fig. 8d).
 30

                                            -30
   In Fig. 9a, an embodiment of the stereo core encoder 48 with adaptively selectable
   L/R or MIS stereo encoding in the MDCT transform domain is illustrated. Such
   stereo encoder 48 may be used in Figs, 6 and 7. Amono core encoder 34 as
   shown in Fig. 5 can be considered as a special case of the stereo core encoder 48
 5 in Fig. 9a, where only a single mono input channel is processed (i.e. where the
   second input channel, shown as dashed line in Fig. 9a, is not present).
   In Fig, 9b, an embodiment of a more generalized encoder is illustrated. For mono
   signals, encoding can be switched between coding in a linear predictive domain
10 (see block 71) and coding in a transform domain (see block 48), Such type of core
   coder introduces several coding methods which can adaptively be used dependent
   upon the characteristics of the ingut signal. Here, the coder can choose to code the
   signal using either an AAC style transform coder 48 (available for mono and ste
   reo signals, with adaptively selectable L/R or MIS coding in case of stereo sig
15 nals) or an AMR-WB+ (Adaptive Multi Rate - WideBand Plus) style core coder
   71 (only available for mono signals). The AMR-WB+ core coder 71 evaluates the
   residual of a linear predictor 72, and in turn also chooses between a transform
   coding approach of the linear prediction residual or a classic speech coder ACELP
   (Algebraic Code Excited Linear Prediction) approach for coding the linear predic
20 tion residual. For deciding between AAC style transform coder 48 and the AMR
   WB+ style core coder 71, a mode decision stage 73 is used which decides based
   on the input signal between both coders 48 and 71.
   The encoder 48 is a stereo AAC style MDCT based coder. When the mode deci
25 sion 73 steers the input signal to use MDCT based coding, the mono input signal
   or the stereo input signals are coded by the AAC based MDCT coder 48. The
   MDCT coder 48 does an MDCT analysis of the one or two signals in MDCT
   stages 74. In case of a stereo signal, further, an M/S or L/R decision on a frequen
   cy band basis is performed in a stage 75 prior to quantization and coding. L/R
30 stereo encoding or MIS stereo encoding is selectable in a frequency-variant man
   ner, The stage 75 also performs a L/R to MIS transform. If M/S encoding is de-

                                              -31
                                                                             signal for this
    cided for a particular frequency band, the stage 75^Outputs an M/S
                                                                      for this frequency
    frequency band. Otherwise, the stage 75 outputs a L/R signal
    band.
 5  Hence, when the transform coding mode is used, the full efficiency of the stereo
                                                                           stereo,
     coding functionality of the underlying core coder can be used for
                                                                 linear predictive domain
     When the mode decision 73 steers the mono signal to the
                                                                          linear predictive
     coder 71, the mono signal is subsequently analyzed by means of
                                                                             to code the LP
10   analysis in block 72. Subsequently, a decision is made on whether
                                                                        a TCX style coder
     residual by means of a time-domain ACELP style coder 76 or
                                                                              The linear pre
     77 (Transform Coded eXcitation) operating in the MDCT domain.
     dictive domain coder 71 does not have any inherent stereo coding capability.
                                                                            domain coder
     Hence, to allow coding of stereo signal with the linear predictive
                                                                     can be used. In this
15   71, an encoder configuration similar to that shown in Fig. 5
                                                                                          sig
      configuration, a PS encoder generates PS parameters 5 and a mono downmix
                                                                            coder.
     nal DMX, which is then encoded by the linear predictive domain
                                                              system, wherein parts of
      Fig. 10 illustrates a further embodiment of an encoder
                                                                            to pseudo L/R
20    Fig. 7 and Fig. 9 are combined in a new fashion. The DMX/RES
                                                                   style downrix coder 70
      block 2, as outlined in Fig. 7, is arranged within the AAC
                                                                 has the advantage that the
      prior to the stereo MDCT analysis 74. This embodiment
                                                                          stereo MDCT core
      DMX/RES to pseudo L/R transform 2 is applied only when the
      coder is used. Hecice, when the transform coding mode is used, the full efficiency
                                                                         can be used for
 25   of the stereo coding functionality of the underlying core coder
      stereo coding of the frequency range covered by the residual signal.
                                                                       mono input signal or
       While the mode decision 73 in Fig. 9b operates either on the
                                                                                 on the
       on the input stereo signal, the mode decision 73' in Fig. 10 operates
                                                                                          sig-
 30    dowmnix signal DMX and the residual signal RES, In case of a mono input

                                                -32
     nal, the mono signal can directly be used as the DMX signal, the RES signal is set
     to zero, and the PS parameters can default to IID = 0 dB and ICC=1.
     When the mode decision 73' steers the downmix signal DMX to the linear predic
  5  tive domain coder 71, the downmix signal DMX is subsequently analyzed by
     means of linear predictive analysis in block 72, Subsequently, a decision is made
     on whether to code the LP residual by means of a time-domain ACELP style cod
     er 76 or a TCX style coder 77 (Transfonn Coded eXcitation) operating in the
    MDCT domain, The linear predictive domain coder 71 does not have any inherent
 10  stereo coding capability that can be used for coding the residual signalin addition
     to the downmix signal DMX, Hence, a dedicated residual coder 78 is employed
    for encoding the residual signal RES when the downmix signal DMX is encoded
    by the predictive domain coder 71. E.g. such coder 78 may be a mono AAC cod
    er,
15
    It should be noted that the coder 71 and 78 in Fig. 10 may be omitted (in this case
    the mode decision stage 73' is not necessary anymore).
    Fig. 11 a illustrates a detail of an alternative further embodiment of an encoder
20  system which achieves the same advantage as the embodiment in Fig, 10. In con
    trast to the embodiment of Fig.10, in Fig. 11a the DMX/RES to pseudo L/R trans
    forM 2 is placed after the MDCT analysis 74 of the core coder 70, i.e.'the trans
    form operates in the MDCT domain. The transform in block 2 is linear and time
    invariant and thus can be placed after the MDCT analysis 74. The remaining
25  blocks of Fig. 10 which are not shown in Fig. 11 can be optionally added in the
    same way in Fig. 1la. The MDCT analysis blocks 74 may be also alternatively
    placed after the transform block 2.,
    Fig. 1lb illustrates an implementation of the embodiment in Fig. 11a. In Fig. 1lb,
30  an exemplary implementation of the stage 75 for selecting between M/S or L/R
    encoding is show. The stage 75 comprises a sum and difference transform stage

                                            -33
    98 (more precisely a L/R to M/S transform stage) which receives the pseudo ste
    reo signal L,,, Rp. The transfonn stage 98 generates a pseudo mid/side signal Mp,
    Sp by performing an L/R to M/S transform. Except for a possible gain factor, the
    following applies: Mp = DMX and S,= RES.
 5
   The stage 75 decides between L/R or M/S encoding. Based on the decision, either
   the pseudo stereo signal Lp, Rp or the pseudo mid/side signal Mp, Sp are selected
    (see selection switch) and encoded in AAC block 97. It should be noted that also
   two AAC blocks 97 may be used (not shown in Fig. lb), with the first AAC
10 block 97 assigned to the pseudo stereo signal Lp, Rp and the second AAC block 97
    assigned to the pseudo mid/side signal Mp, Sp, In this case, the L/R or M/S selec
   tion is performed by selecting either the output of the first AAC block 97 or the
    output of the second AAC block 97.
15 Fig, 11c shows an alternative to the embodiment in Fig. 11a. Here, no explicit
   transform stage 2 is used. Rather, the transform stage 2 and the stage 75 is com
   bined in a single stage 75'. The downmix signal DMX and the residual signal
   RES are fed to a sum and difference transform stage 99 (mpre precisely a
   DMX/RES to pseudo L/R transform stage) as part of stage 75'. The transform
20 stage 99 generates a pseudo stereo signal Lp,, Rp. The DMX/RES to pseudo L/R
   transform stage 99 in Fig. 11lc is similar to the L/R to M/S transform stage 98 in
   Fig. 1lb (expect for a possibly different gain factor). Nevertheless, in Fig. 1le the
   selection between MIS and L/R decoding needs to be inverted in comparison to
   Fig. f1b. Note that in both Fig. 11b and Fig. 11e, the position of the switch for the
25 L/R or M/S selection is shown in Lp/Rp position, which is the upper one in Fig.
    1lb and the lower one in Fig. 11e. This visualizes the notion of the inverted mean
   ing of the L/R or M/S selection,
   It should be noted that the switch in Figs. 1lb and 11e preferably exists indivi
30  dually for each frequency band in the MDCT domain such that the selection be
   tween L/R and M/S can be both time- and frequency-variant. In other words: the

                                            -34
   position of the switch is preferably frequency-variant. The transform stages 98
   and 99 may transform the whole used frequency range or may only transform a
   single frequency band,
 5 Moreover, it should be noted that all blocks 2, 98 and 99 can be called "sum and
   difference transform blocks" since all blocks implement a transform matrix in the
   form of
10
   Merely, the gain factor c may be different in the blocks 2, 98, 99.
   In Fig. 12, a further embodiment of an encoder system is outlined. It uses an ex
   tended set of PS parameters which, in addition to IID an ICC (described above),
15 includes two further parameters IPD (inter channel phase difference, see yipd be
   low) and OPD (overall phase difference, see p below) that allow to characterize
   the phase relationship between the two channels L and R of a stereo signal, An
   example for these phase parameters is given in ISO/IEC 14496.3 subelause
   8,6,4.6.3 which is hereby incorporated by reference. When phase paranieters are
20 used, the resulting upmix matrix HcowpLr (and its inverse H S%    ,P ) becomes
   complex-valued, according to:
                                    HcoMpLx,= H      H,
   where
                                     (Oexp0
                                           fP&)
                                                      0
                                                 expUj?2)
25 and where
                                            9
                                       A1     pd

                                            -35
   The stage 80 of the PS encoder which operates in the complex QMF domain only
   takes care of phase dependencies between the channels L, R. The downmix rota
   tion (i.e. the transformation from the L/R domain to the DMX/RES domain which
   was described by the matrix H- above) is taken care of in the MDCT domain as
                                                                              the two
 5 part of the stereo core coder 81. Hence, the phase dependencies between
   channels are extracted in the complex QMF domain, while other, real-valued,
   waveform dependencies are extracted in the real-valued critically sampled MDCT
   domain as part of the stereo coding mechanism of the core coder used, This has
   the advantage that the extraction of linear dependencies between the channels can
10 be tightly integrated in the stereo coding of the core code (though, to prevent
   aliasing in the critical sampled MDCT domain, only for the frequency range that
   is covered by residual coding, possibly minus a "guard band" on the frequency
   axis).
15 The phase adjustment stage 80 of the PS encoder in Fig. 12 extracts phase related
                                                                                  OPD
   PS parameters, e.g. the parameters IPD (inter channel phase difference) and
    (overall phase difference). Hence, the phase adjustment matrix HIf that it pro
    duces may be according to the following:
                              Hi = xp( .fg0i)0
                                           0       exp(-fp 2 ))
20 As discussed before, the downmix rotation part of the PS module is dealt with in
   the stereo coding module 81 of the core coder in Fig. 12. The stereo coding mod
    ule 81 operates in the MDCT domain and is shown in Fig, 13. The stereo coding
    module 81 receives the phase adjusted stereo signal L, , R, in the MDCT domain,
    This signal is downmixed in a downmix stage 82 by a downmix-rotation matrix
25   H- which is the real-valued part of a complex downmix matrix H         i     as
    discussed above, thereby generating the downmix signalDMX and residual signal
    RES, The downmix operation is followed by the inverse L/R to M/S transform
    according to the present application (see transform stage 2), thereby generating a
    pseudo stereo signal Lp, Rp. The pseudo stereo signal L,, Rp is processed by the

                                              -36
    stereo coding algorithm (see adaptive M/S or L/R stereo encoder 83)3 in this par
    ticular embodiment a stereo coding mechanism that depending on perceptual en
                                                                            representa
    tropy criteria decides to code either an L/R representation or an MIS
    tion. of the signal. This decision is preferably time- and frequency-variant.
 5
                                                                                      de
    In Fig. 14 an embodiment of a decoder system is shown which is suitable to
    code a bitstream 46 as generated by the encoder system shown in Fig. 6, This em
                                                                                        is
    bodiment is merely illustrative for the principles of the present application. It
    understood that modifications and variations of the embodiment will be apparent
10  to others skilled in the att A core decoder 90 decodes the bitstream 46 into pseu
                                                                                  filter
    do left and right channels, which are transformed in the QMF domain by
                                                                                     result
    banks 91, Subsequently, a fixed pseudo L/R to DMX/RES transform of the
    ing pseudo stereo signal Lp, R, is performed in transform stage 12, thus creating a
    downmix signal DMX and a residual signal RES. When using SBR coding, these
15  signals are low band signals, e.g. the downmix signal DMX and residual signal
    RES may only contain audio information for the low frequency band-up to ap
                                                                                     93 to
    proximately 8 kHz. The downmix signal DMX is used by an SBR decoder
    reconstruct the high frequency band based on received SBR parameters (not
     shown). Both the output signal (including the low and reconstructed high flrequen
                                                                              the residual
20  cy bands of the downinix signal DMX) from the SBR decoder 93 and
                                                                       domain (in particu
     signal RES are input to a PS decoder 94 operating in the QMF
     lar in the hybrid QMF+Nyquist filter domain). The downmix signal DMX at the
     input of the PS decoder 94 also contains audio information in the high frequency
                                                                                        PS
     band (e.g, up to 20 kHz), whereas the residual signal RES at the input of the
                                                                                 high fre
25   decoder 94 is a low band signal (e.g. limited up to 8 kIlz). Thus, forthe
                                                                      decoder 94 uses a
     quency band (e.g, for the band from 8 kHz to 20 kHz), the PS
                                                                                       li
     decorrelated 'version of the downmix signal DMX instead of using the band
                                                                                           94
     mited residual signal RES. The decoded signals at the output of the PS decoder
     are therefore based on a residual signal only up to 8 kHz, After PS decoding, the
 30  two output channels of the PS decoder 94 are transformed in the time domain by
     filter banks 95, thereby generating the output stereo signal L, R,

                                            - 37
   In Fig. 15 an embodiment of a decoder system is shown.which is suitable to de
   code the bitstream 46 as generated by the encoder system shown in Fig. 7. This
   embodiment is merely illustrative for the principles of the present application. It is
 5 understood that modifications and variations of the embodiment will be apparent
   to others skilled in the art,the principle operation of the embodiment in Fig. 15 is
   similar to that of the decoder system outlined in.Fig. 14, In contrast to Fig. 14, the
   SER decoder 96 in Fig. 15 is located at the output of the PS decoder 94. Moreo
   ver, the SBR decoder makes use of SBR parameters (not shown) forming stereo
10 envelope data in contrast to the mono SBR parameters in Fig. 14. The downmix
   and residual signal at the input of the PS decoder 94 are typically low band sig
   nals, e.g. the downmix signal DMX and residual signal RBS may contain audio
   information only for the low frequency-band, e.g. up to approximately 8 kz.
   Based on the low band downmix signal DMX and residual signal RES, the PS
15 encoder 94 determines a low band stereo signal, e.g. up to approximately 8 kTlz.
   Based on the low band stereo signal and stereo SBR parameters, the SBR decoder
   96 reconstructs the high frequency part of the stereo signal. In comparison to the
   embodiment in Fig.14, the embodiment in Fig. 15 offers the advantage that no
   decorrelated signal is needed (see also Fig. 8d) and thus an enhanced audio quality
20 is achieved, whereas in Fig. 14 for the high frequency part a decorrelated signal is
   needed (see also Fig. 8c), thereby reducing the audio quality.
   Fig. 16a shows an embodiment of a decoding system which is inverse to the en
    coding system shown in Fig. 11a. The incoming bitstream signal is fed to a de
25  coder block 100, which generates a first decoded signal 102 and a second decoded
    signal 103. At the encoder either M/S coding or L/R coding was selected. This is
   indicated in the received bitstream. Based on this information, either M/S or L/R
   is selected in the selection stage 101. In case M/S was selected in the encoder, the
   first 102 and second 103 signals are converted into a (pseudo) L/R signal. In case
30 L/R was selected in the encoder, the first 102 and second 103 signals may pass the
    stage 101 without transformation. The pseudo L/R signal Lp, R, at the output of

                                            - 38
    stage 101 is converted into an DMX/RBS signal by the transform stage 12 (this
    stage quasi performs a L/R to M/S transform). Preferably, the stages 100, 101 aid
    12 in Fig. 16a operate in the MDCT domain. For transfonning the downmix sig
    nal DMX and residual signals RES into the time domain, conversion blocks 104
 5 may be used, Thereafter, the resulting signal is fed to a PS decoder (not shown)
    and optionally to an SBR decoder as shown in Figs, 14 and 15, The blocks 104
   may be also alternatively placed before block 12.
   Fig. 16b illustrates an implementation of the embodiment in Fig. 16a. In Fig. 16b,
10 an exemplary implementation of the stage 101 for selecting between M/S or L/R
   decoding is shown. The stage 101 comprises a sum and difference transform stage
   105 (M/S to L/R transform) which receives the first 102 and second 103 signals.
   Based on the encoding information given in the bitstream, the stage 101 selects
15 either L/R or M/S decoding. When L/R decoding is selected, the output signal of
   the decoding block 100 is fed to the transform stage 12.
   Fig. 16c shows an alternative to the embodiment in Fig. 16a. Here, no explicit
   transform stage 12 is used. Rather, the transform stage 12 and the stage 101 are
20 merged in a single stage 101', The first 102 and second 103 signals are fed to a
   sum and difference transform stage 105' (more precisely a pseudo L/R to
   DMX/RES transform stage) as part of stage 101'. The transform stage 105' gene
   rates a DMX/RES signal. The transform stage 105' in Fig. 16c is similar or iden
   tical to the transform stage 105 in Fig. 16b (expect for a possibly different gain
25 factor). In Fig, 16c the selection between M/S and L/R decoding needs to be in
   verted in comparison to Fig. 16b. In Fig. 16c the switch is in the lower position,
   whereas in Fig, 16b the switch is in the upper position. This visualizes the inver
   sion of the L/R or M/S selection (the selection signal may be simply inverted by
    an inverter).
30

                                            - 39
    It should be noted that the switch in Figs. 16b and 16c preferably exists indivi
    dually for each frequency band in the MDCT domain such that the selection be
   tween L/R and M/S can be both time- and frequency-variant. The transform stages
    105 and 105' may transform the whole used frequency range or may only trans
 5 form a single frequency band.
   Fig. 17 shows a further embodiment of an encoding system for coding a stereo
   signal L, R into a bitstream signal. The encoding system comprises a-downmix
   stage 8 for generating a downmix signal DMX and a residual signal RES based on
10 the stereo signal. Further, the encoding system comprises a parameter determining
   stage 9 for determining one or more parametric stereo parameters 5. Further, the
   encoding system comprises ineans 110 for perceptual encoding downstream of the
   downmix stage 8. The encoding is selectable:
        -   encoding based on a sum signal of the downmix signal DMX and the resi
15          dual signal RES and based on a difference signal of the downmix signal
            DMX and the residual signal RES, or
        -   encoding based on the downmix signal DMX and the residual signal RES.
   Preferably, the selection is time- and frequency-variant,
20
   The encoding means 110 comprises a sum and difference tiansfoim stage 111
   which generates the sum and difference signals. Further, the encoding means 110
   comprise a selection block 112 for selecting encoding based on the sum and dif
   ference signals or based on the downmix signal DMX and the residual signal
25 RES. Furthermore, an encoding block 113 is provided. Alternatively, two encod
   ing blocks 113 may be used, with the first encoding block 113 encoding the DMX
   and RES signals and the second encoding block 113 encoding the sum and differ
   ence signals, In this case the selection 112 is downstream of the two encoding
   blocks 113.
30
   The sum and difference transfon in block 111 is of the form

                                             - 40
   The transform block 111 may correspond to transform block 99 in Fig. 11Ic.
 5
   The output of the perceptual encoder 110 is combined with the parametric stereo
   parameters 5 in the multiplexer 7 to form the resulting bitstream 6.
   In contrast to the structure in Fig. 17, encoding based on the downmix signal
10 DMX and residual signal RES may be realized when encoding a resulting signal
   which is generated by transforming the downmix signal DMX and residual signal
   RES by two serial sum and difference transfonns as shown in Fig. 11lb (see the
   two transform blocks 2 and 98). The resulting signal aftdr two sum and difference
   transforms corresponds to the downmix signal DMX and residual signal RES (ex
15 cept for a possible different gain factor).
   Fig. 18 shows an embodiment of a decoder system which is inverse to the encoder
    system in Fig. 17. The decoder system comprises means 120 for perceptual decod
   ing based on bitstream signal. Before decoding, the PS parameters are separated
20 from the bitstream signal 6 in denultiplexer 10. The decoding means 120 com
   prise a core decoder 121 which generates a first signal 122 and a second signal
                                                                               and a
    123.(by decoding). The decoding means output a downmix signal DMX
    residual signal RES.
25  The downmix signal DMX and the residual signal RES are selectively
          - based on the sum of the first signal 122 and of the second
                                                                        signal 123 and
            based on the difference of the first signal122 and of the second signal 123
            or
          - based on the first signal122 ahd based on the second signal 121.
30

                                            -41
   Preferably, the selection is time- and frequency-variant. The selection is per
   formed in the selection stage 125.
   The decoding means 120 comprise a sum and difference transform stage 124
 5 which generates sum and difference signals,
   The sum and difference transform in block 124 is of the form
10
    The transform block 124 may correspond to transform block 105' in Fig. 16c.
   After selection, the DMX and RES signals are fed to an upmix stage 126 for gene
   rating the stereo signal L, R based on the downmix signal DMX and the residual
15 signalRES. The upmix operation is dependent on the PS parameters 5.
   Preferably, in Figs. 17 and 18 the selection is frequency-variant. In Fig. 17, e.g. a
   time to frequency transform (e.g. by a MDCT or analysis filter bank) may be per
   formed as first step in the perceptual encoding means 110. In Fig. 18, e.g. a fre
20 quency to time transform (e.g. by an inverse MDCT or synthesis filter bank) may
   be performed as the last step in the perceptual decoding means 120.
   It should be noted that in the above-described embodiments, the signals, parame
   ters and matrices may be frequency-variant or frequency-invariant and/or time
25 variant or time-invariant. The described computing steps may be carried. out fre
    quency-wise or for the complete audio band.
   Moreover, it should be noted that the various sum and difference transforms, i.e.
   the DMX/RES to pseudo L/R transform, the pseudo L/R to DMX/RES transform,
30  the L/R to M/S transform and the M/S to L/R transform, are all of the form

                                               - 42
                                                                                  of these
    Merely, the gain factor c may be different, Therefore, in principle, each
                                                                                      If the
 5  transforms may be exchanged by a different transform of these transforms.
                                                                       compensated in the
    gain is not correct during the encoding processing, this may be
                                                                               of the sum
    decoding process. Moreover, when placing two same or two different
    and difference transforms is series, the resulting transform corresponds to the
    identity matrix (possibly, multiplied by a gain factor).
10
                                                                                   different
    In an encoder system comprising both a PS encoder and a SBR encoder,
    PS/SBR configurations are possible. In a first configuration, shown in Fig. 6, the
                                                                            a second con
    SBR encoder 32 is connected downstream of the PS encoder 41. In
                                                                     upstream of the PS
    figuration, shown in Fig. 7, the SBR encoder 42 is connected
                                                                                    of the
15   encoder 41, Depending upon e.g. the desired target bitrate, the properties
     core encoder, and/or one or more various other factors, one of the configurations
     can be preferred over the other in order to provide best performance. Typically,
                                                                                      bi
     for lower bitrates, the first configuration can be preferred, while for higher
                                                                                 if an en
     trates, the second configuration can be preferred, Hence, it is desirable
20   coder system supports both different configurations to be able to choose a pre
                                                                                     or more
     ferred configuration depending upon e.g. desired target bitrate and/or one
     other criteria.
     Also in a decoder system comprising both a PS decoder and a SBR decoder, dif
25   ferent PS/SBR configurations are possible. In a first configuration, shownin
                                                                       decoder 94, In a
     Fig. 14, the SBR decoder 93 is connected upstream of the PS
                                                                                      down
      second configuration, shown in Fig. 15, the SBR decoder 96 is connected
      stream of the PS decoder 94. In order to achieve correct operation, the configura
                                                                                the encoder
      tion of the decoder system has to match that of the encoder system. If
 30   is configured according to Fig. 6, then the decoder is correspondingly configured

                                            - 43
   according to Fig. 14. If the encoder is configured according to Fig. 7, then the
   decoder is correspondingly configured according to Fig. 15. In order fo ensure
   correct operation, the encoder preferably signals to the decoder which PS/SBR
   configuration was chosen for encoding (and thus which PS/SBR configuration is
 5 to be chosen for decoding). Based on this information, the decoder selects the
   appropriate decoder configuration.
   As discussed above, in order to ensure correct decoder operation, there is prefera
   bly a mechanism to signal from the encoder to the decoder which configuration is
10 to be used in the decoder. This can be done explicitly (e.g. by means of an dedi
   cated bit or field in the configuration header of the bitstream as discussed below)
   or implicitly (e.g. by checking whether the SBR data is mono or stereo in case of
   PS data being present).
15 As discussed above, to signal the chosen PS/SBR configuration, a dedicated ele
   ment in the bitstream header of the bitstream conveyed from the encoder to the
   decoder may be used, Such a bitstream header carries necessary configuration
   information that is needed to enable the decoder to correctly decode the data in the
   bitstream. The dedicated element in the bitstream header may be e.g. a one bit
20 flag, a field, or it may be an index pointing to a specific entry in a table that speci
   fies different decoder configurations.
   Instead of including in the bitstream header an additional dedicated element for
    signaling the PS/SBR configuration, information already present inthe bitstream
25 may be evaluated at the decoding system for selecting the correct PS/SBR confi
    guration, E g. the chosen PS/SBR configuration may be derived from bitstream
    header configuration information for the PS decoder and SBR decoder, This con
    figuration information typically indicates whether the SBR decoder is to be confi
    gured for mono operation or stereo operation. If, for example, a PS decoder is
30  enabled and the SBR decoder is configured for mono operation (as indicated in
    the configuration information), the PS/SBR configuration according to Fig. 14 can

                                                     -44
      be selected. If a PS decoder is enabled and the SBR decoder is configured for stereo
      operation, the PS/SBR configuration according to Fig, 15 can be selected,
     The above-described embodiments are merely illustrative for the principles of the present
      application. It is understood that modifications and variations of the arrangements and the
  5  details described herein will be apparent to others skilled in the art, It is the intent, therefore,
     that the scope of the application is not limited by the specific details presented by way of
     description and explanation of the embodiments herein.
     The systems and methods disclosed in the application may be implemented as software,
     firmware, hardware or a combination thereof. Certain.components or all components may be
 10  implemented as software running on a digital signal processor or microprocessor, or
     implemented as hardware and or as application specific integrated circuits,
     Typical devices making use of the disclosed systems and methods are portable audioplayers,
     mobile communication devices, set-top-boxes, TV-sets, AVRs (audio-video receiver),
     personal computers etc.
15   The above references to and descriptions of prior proposals or products are not intended to
    be, and are not to be construed as, statements or admissions of common general knowledge in
    the art. In particular, the above prior art discussion does not relate to what is commonly or
    well mown by the person skilled in the art, but assists in the understanding of the inventive
    step of the present invention of which the identification of pertinent prior art proposals is but
20  one part.
    Throughout the specification and claims the word "comprise" and its derivatives are intended
    to have an inclusive rather than exclusive meaning unless the contrary is expressly stated or
    the context requires otherwise, That is, the word "comprise" and its derivatives will be taken
    to indicate the inclusion of not only the listed components, steps or features that it directly
25  references, but also other components, steps or features not specifically listed, unless the
    contrary is expressly stated or the context requires otherwise.

                                                   45
   1. An encoder system encoding a stereo signal to a bitstream signal, the encoder system
   comprising:
       a downmix stage generating a downmix signal and a residual signal based on the stereo
       signal;
 5     a mono SBR encoding stage generating an SBR encoded downmix signal and mono SBR
       parameters in response to the downmix signal;
       a parameter determining stage coupled to the downmix stage and determining one or more
       parametric stereo parameters;
       a perceptual encoder coupled downstream to the downmix stage, wherein the perceptual
10     encoder selects
               encoding based on a sum of the SBR encoded downmix signal and the residual
               signal and based on a difference of the SBR encoded downmix signal and the
               residual signal, or
               encoding based on the downmix signal and based on the residual signal
15     in a frequency-variant or frequency-invariant manner.
   2. The encoder system of claim 1, wherein the perceptual encoder comprises:
       a transformation stage performing a transform based on the SBR encoded downmix signal
       and the residual signal, thereby generating a pseudo left/right stereo signal; and
20     an encoder encoding the pseudo left/right stereo signal, wherein the encoder selects
               left/right perceptual encoding or
               mid/side perceptual encoding
       in a frequency-variant or frequency-invariant manner.
25 3. The encoder system of claim 2, wherein the encoder decides between
               left/right encoding or
               mid/side encoding

                                                     46
           in a frequency-variant or frequency-invariant manner based on the pseudo stereo signal.
   4. The encoder system of claim 2, wherein the encoder performs a left/right to mid/side
   transform based on the pseudo stereo signal.
 5
   5. The encoder system of claim 1, wherein the perceptual encoder comprises a transformation
   stage performing a sum and difference transform based on the downmix signal and the residual
   signal to generate a pseudo left/right stereo signal for one or more or all used frequency bands.
10 6. The encoder system of claim 5, wherein
       the perceptual encoder comprises a processor deciding between L/R perceptual encoding
       and M/S perceptual encoding in a frequency-variant or frequency-invariant manner;
       encoding based on the downmix signal and residual signal is selected when the processor
       decides M/S perceptual decoding, and
15     encoding based on the sum and difference is selected when the processor decides L/R
       perceptual decoding.
   7. A decoder system decoding a bitstream signal including mono SBR parameters and one or
   more parametric stereo parameters to a stereo signal, the decoder system comprising:
20     a perceptual decoder decoding based on the bitstream signal, wherein the perceptual
       decoder generating by decoding a first signal and a second signal and and outputting a
       downmix signal and a residual signal, wherein the perceptual decoder selects the downmix
       signal and the residual signal
               based on a sum of the first signal and of the second signal and based on a difference
25             of the first signal and of the second signal or
               based on the first signal and based on the second signal
           in a frequency-variant or frequency-invariant manner;

                                                     47
          a mono SBR decoder generating an SBR decoded downmix signal in response to the
          downmix signal and the mono SBR parameters; and
          an upmixer coupled to the perceptual decoder, and generating the stereo signal based on
          the SBR decoded downmix signal and the residual signal, with the upmix operation of
 5       upmixer being dependent on the one or more parametric stereo parameters.
   8. The decoder system of claim 7, wherein the perceptual decoder comprises:
        -       a stereo decoder decoding based on the bitstream signal, the stereo decoder
                generating a pseudo stereo signal, wherein the stereo decoder selectively performs
10              -       left/right perceptual decoding or
                -       mid/side perceptual decoding
        in a frequency-variant or frequency-invariant manner; and
        -       a transform stage performing a transform based on the pseudo stereo signal, thereby
                generating the downmix signal and the residual signal.
15
   9. The decoder system of claim 8, wherein the perceptual decoder performs a mid/side to
   left/right transform based on a decoded pseudo mid/side signal.
   10. The decoder system of claim 7, wherein the perceptual decoder comprises a transformation
20 stage performing a sum and difference transform based on the first signal and the second signal
   for one or more or all used frequency bands.
   11. The decoder system of claim 7, wherein
        the perceptual decoder comprises a selector selecting between L/R perceptual decoding and
25      M/S perceptual decoding in a frequency-variant or frequency-invariant manner;
        the downmix signal and the residual signal is selected to be based on the sum of the first
        signal and of the second signal and based on the difference of the first signal and of the
        second signal when the selector selects L/R perceptual decoding, and

                                                      48
       the downmix signal and the residual signal is selected to be based on the first signal and
       based on the second signal when the selector selects M/S perceptual decoding.
   12. The decoder system of claim 7, wherein the parametric stereo parameters comprise
 5     a frequency-variant or a frequency-invariant parameter indicating an inter-channel intensity
       difference, and
       a frequency-variant or a frequency-invariant parameter indicating an inter-channel cross
       correlation.
10 13. A method for encoding a stereo signal to a bitstream signal, the method comprising:
       generating a downmix signal and a residual signal based on the stereo signal;
       determining one or more parametric stereo parameters;
       perceptual encoding downstream of generating the downmix signal and the residual signal,
       wherein
15              encoding based on a sum of the downmix signal and the residual signal and based
                on a difference of the downmix signal and the residual signal or
                encoding based on the downmix signal and based on the residual signal
       is selectable in a frequency-variant or frequency-invariant manner;
       wherein the method is performed by one or more microprocessor-based components.
20
   14. A method for decoding a bitstream signal including mono SBR parameters and one or more
   parametric stereo parameters to a stereo signal, the method comprising:
   perceptual decoding based on the bitstream signal, wherein a first signal and a second signal is
    generated by decoding and a downmix signal and a residual signal is output after perceptual
25  decoding, the downmix signal and the residual signal being selectively
                based on the sum of the first signal and of the second signal and based on the
                difference of the first signal and of the second signal or

                                                   49
               based on the first signal and based on the second signal
                   in a frequency-variant or frequency-invariant manner;
        generating an SBR decoded downmix signal in response to the downmix signal and the
        mono SBR parameters; and
 5     generating the stereo signal based on the SBR decoded downmix signal and the residual
       signal by an upmix operation, with the upmix operation being dependent on the one or
       more parametric stereo parameters;
       wherein the method is performed by one or more microprocessor-based components.
10 15. A non-transitory computer readable storage medium comprising a sequence of instructions,
   wherein, when executed by an audio signal processing device, the sequence of instructions
   causes the audio signal processing device to perform the method of claim 13 or claim 14.

<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
<removed-apn> <removed-date>
