                                     ABSTRACT
      Embodiments of the present invention provide an encoding method and
apparatus, which relate to the communications field and can perform proper
quantization bit allocation for spectral coefficients of an audio signal, thereby
improving quality of a signal obtained by a decoder by means of decoding. The
method includes: after splitting spectral coefficients of a current data frame into
subbands, acquiring quantized frequency envelope values of the subbands; modifying
quantized frequency envelope values of subbands of a first quantity in the subbands;
allocating quantization bits to the subbands according to modified quantized
frequency envelope values of the subbands of the first quantity; quantizing a spectral
coefficient of a subband to which a quantization bit is allocated in the subbands; and
writing the quantized spectral coefficient of the subband to which a quantization bit is
allocated into a bitstream.

                                     1/6
  After an encoder splits spectral coefficients of a current data       Si101
    frame into subbands, the encoder acquires quantization
           frequency envelope values of the subbands
The encoder modifies quantization frequency envelope values of          S102
          subbands ofnirst
                        a     quantity in the subbands
    The encoder allocates quantization bits to the subbands        -    S0
 according to modified quantization frequency envelope values        &S0
               of the subbands of the first quantity
  The encoder quantizes a spectral coefficient of a subband
                                                               to ,--S104
      which a quantization bit is allocated in the subbands
  The encoder writes the quantized spectral coefficient of the
subband to which a quantization bit is allocated into a bitstream       S105
                                   FIG. 1

                  ENCODING METHOD AND APPARATUS
                                    TECHNICAL FIELD
   [0001]       The present invention relates to the communications         field, and in
   particular, to an encoding method and apparatus.
 5                                    BACKGROUND
   [0002]       An audio compressing technology is a core of multimedia application
   technologies such as digital audio broadcasting, and music dissemination and audio
   communication on the Internet. Transform coding is a commonly used method in the
   audio compressing technology. During transform coding, audio data is transformed
10 from a data domain to another data domain, so that a large amount of information in
   the audio data can be represented by using less data, which helps quantize the audio
   data to achieve an objective of efficient compression coding.
   [0003]       According to an existing transform coding algorithm, an encoder
   transforms    an audio    signal  from    a time    domain    to  a frequency   domain
15 (time-frequency transformation) to obtain spectral coefficients of the audio signal,
   splits the spectral coefficients into subbands, calculates and quantizes frequency
   envelopes of the subbands to obtain index values of quantized frequency envelopes of
   the subbands and values of the quantized frequency envelopes of the subbands, then,
   separately performs bit allocation for spectral coefficients of the subbands according
20 to the values of the quantized frequency envelopes of the subbands and a quantity of
   available bits, quantizes the spectral coefficients of the subbands according to the
   values of the quantized frequency envelopes of the subbands and quantities of bits
   allocated to the spectral coefficients of the subbands, and finally, writes the index
   values of the quantized frequency envelopes of the subbands and the quantized
25 spectral coefficients of the subbands into a bitstream and transmits the bitstream to a
   decoder.
   [0004]       However, when bit allocation is performed for the spectral coefficients of
   the subbands in the prior art, quantization bit allocation is performed for the spectral

   coefficients of the subbands according to the values of the quantized frequency
   envelopes of the subbands, which may cause improper quantization bit allocation for
   spectral coefficients of some subbands, and cause low quality of a signal obtained by
   the decoder by means of decoding.
 5                                          SUMMARY
   [0005]       Embodiments of the present invention provide an encoding method and
   apparatus, which can perform proper quantization bit allocation for spectral
   coefficients of an audio signal, thereby improving quality of a signal obtained by a
   decoder by means of decoding.
10 [0006]       To achieve the foregoing objective, the following technical solutions are
   used in the embodiments of the present invention:
   [0007]       According to a first aspect, an embodiment of the present invention
   provides an encoding method, including:
                splitting spectral coefficients of a current data frame into subbands;
15              acquiring quantized frequency envelope values of the split subbands;
                modifying quantized frequency envelope values of subbands of a first
   quantity in the split subbands;
                allocating quantization bits to the split subbands according to modified
   quantized frequency envelope values of the subbands of the first quantity;
20              quantizing a spectral coefficient of a subband to which a quantization bit is
   allocated in the split subbands; and
                writing the quantized spectral coefficient of the subband to which a
   quantization bit is allocated into a bitstream.
   [0008]       In a first possible implementation manner of the first aspect, the modifying
25 quantized frequency envelope values of subbands of a first quantity in the subbands
   includes:
                acquiring modification factors of the subbands of the first quantity; and
                modifying the quantized frequency envelope values of the subbands of the
   first quantity by using the acquired modification factors.
30 [0009]       With reference to the first possible implementation manner of the first
   aspect, in a second possible implementation manner, the acquiring modification
   factors of the subbands of the first quantity includes:
                                                  2

                acquiring signal types of the subbands of the first quantity; and
                determining the modification factors of the subbands of the first quantity
   according to the acquired signal types.
   [0010]       With reference to the second possible implementation manner of the first
 5 aspect, in a third possible implementation manner, where:
                a modification factor of the first subband is greater than 1 when a signal
   type of a first subband in the subbands of the first quantity is harmonic; or
                a modification factor of the first subband is less than or equal to 1 when a
   signal type of a first subband in the subbands of the first quantity is non-harmonic.
10 [0011]       With reference to the second possible implementation manner or the third
   possible    implementation     manner    of the    first aspect,   in  a fourth   possible
   implementation manner, before the determining the modification factors of the
   subbands of the first quantity according to the signal types of the subbands of the first
   quantity, the method further includes:
15              acquiring stored reference information of subbands of a second quantity in
   a previous data frame of the current data frame, where the second quantity is less than
   or equal to the first quantity; and
                the determining the modification factors of the subbands of the first
   quantity according to the signal types of the subbands of the first quantity specifically
20 includes:
                determining the modification factors of the subbands of the first quantity
   according to the acquired signal types and the acquired reference information.
   [0012]       With reference to the fourth possible implementation manner of the first
   aspect, in a fifth possible implementation manner, the method of determining the
25 modification factors of the subbands of the first quantity according to the signal types
   of the subbands of the first quantity and the reference information of the subbands of
   the second quantity includes:
                determining a first modification factor of the first subband according to the
   signal type of the first subband in the subbands of the first quantity;
30              determining a second modification factor of the first subband according to
   reference information of a second subband, corresponding to the first subband, in the
   subbands of the second quantity; and
                using a product of the first modification factor and the second modification
   factor as the modification factor of the first subband.
                                                 3

   [00131       With reference to the fifth possible implementation manner of the first
   aspect, in a sixth possible implementation manner, where:
                a value of the second modification factor is a value of a third modification
   factor when the reference information of the second subband includes a quantization
 5 bit allocation status of the second subband; or
                a value of the second modification factor is a value of a fourth
   modification factor when the reference information of the second subband includes a
   signal type of the second subband; or
                a value of the second modification factor is a product of a value of a third
10 modification factor and a value of a fourth modification factor when the reference
   information of the second subband includes a quantization bit allocation status of the
   second subband and a signal type of the second subband.
   [0014]       With reference to the sixth possible implementation manner of the first
   aspect, in a seventh possible implementation manner,
15              when the quantization bit allocation status of the second subband indicates
   that no spectral coefficient is encoded, it is determined that the third modification
   factor is less than 1, or when the quantization bit allocation status of the second
   subband indicates that a spectral coefficient is encoded, it is determined that the third
   modification factor is greater than 1; and
20              when the signal type of the second subband is harmonic, it is determined
   that the fourth modification factor is greater than 1, or when the signal type of the
   second subband is non-harmonic, it is determined that the fourth modification factor
   is less than or equal to 1.
   [0015]       With reference to the sixth possible implementation manner or the seventh
25 possible implementation       manner    of the first   aspect, in an eighth possible
   implementation manner, the second modification factor of the first subband is
   determined according to a ratio of any two values of a frequency envelope value of
   the second subband, an average frequency envelope value of the subbands of the
   second quantity, a bandwidth value of the subbands of the second quantity, a
30 maximum value of frequency envelope values of the subbands of the second quantity,
   and a frequency envelope variance value of the subbands of the second quantity.
   [0016]       With reference to any one of the fifth possible implementation manner to
   the seventh possible implementation manner of the first aspect, in a ninth possible
   implementation manner, the first modification          factor of the first subband is
                                                4

   determined according to a ratio of any two values of a frequency envelope value of
   the first subband, an average frequency envelope value of the subbands of the first
   quantity, a bandwidth value of the subbands of the first quantity, a maximum value of
   frequency envelope values of the subbands of the first quantity, and a frequency
 5 envelope variance value of the subbands of the first quantity.
   [0017]       With reference to the first possible implementation manner of the first
   aspect, in a tenth possible implementation manner, the acquiring modification factors
   of the subbands of the first quantity includes:
                acquiring stored reference information of subbands of a first quantity in a
10 previous data frame of the current data frame; and
                determining the modification factors of the subbands of the first quantity
   in the current data frame according to the reference information of the subbands of the
   first quantity in the previous data frame.
   [0018]       With reference to the tenth possible implementation manner of the first
15 aspect, in an eleventh possible implementation manner, before the determining the
   modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame, the method further includes:
                acquiring signal types of subbands of a third quantity in the subbands in
20 the current data frame, where the third quantity is less than or equal to the first
   quantity; and
                the determining the modification factors of the subbands of the first
   quantity in the current data frame according to the reference information of the
   subbands of the first quantity in the previous data frame specifically includes:
25              determining the modification factors of the subbands of the first quantity
   in the current data frame according to the reference information of the subbands of the
   first quantity in the previous data frame and the signal types of the subbands of the
   third quantity.
   [0019]       With reference to the eleventh possible implementation manner of the first
30 aspect, in a twelfth possible implementation manner, the method of determining the
   modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame and the signal types of the subbands of the third quantity
   includes:
                                                5

               determining a second modification factor of a first subband in the
   subbands of the first quantity in the current data frame according to reference
   information of a second subband in the subbands of the first quantity in the previous
   data frame;
 5             determining a first modification factor of the first subband according to a
   signal type of the first subband; and
               using a product of the first modification factor and the second modification
   factor as a modification factor of the first subband.
   [0020]      With reference to the first aspect or any one of the first possible
10 implementation manner to the twelfth possible implementation manner of the first
   aspect, in a thirteenth possible implementation manner, after the allocating
   quantization bits to the subbands according to modified quantized frequency envelope
   values of the subbands of the first quantity, the method further includes:
               storing reference information of the subbands of the first quantity in the
15 current data frame.
   [0021]      According to a second aspect, an embodiment of the present invention
   provides an encoding apparatus, including:
               an acquiring unit, configured to split spectral coefficients of a current data
   frame into subbands, and acquire quantized frequency envelope values of the split
20 subbands;
               a modifying unit, configured to modify quantized frequency envelope
   values, acquired by the acquiring unit, of subbands of a first quantity in the split
   subbands;
               an allocating unit, configured to allocate quantization bits to the split
25 subbands according to quantized frequency envelope values, modified by the
   modifying unit, of the subbands of the first quantity;
               a quantizing unit, configured to quantize a spectral coefficient of a
   subband to which a quantization bit is allocated by the allocating unit in the split
   subbands; and
30             a multiplexing unit, configured to write the spectral coefficient, quantized
   by the quantizing unit, of the subband to which a quantization bit is allocated into a
   bitstream.
   [0022]      In a first possible implementation manner of the second aspect,
               the acquiring unit is further configured to acquire modification factors of
                                                 6

   the subbands of the first quantity; and
                the modifying unit is further configured to modify, by using the
   modification factors of the subbands of the first quantity acquired by the acquiring
   unit, the quantized frequency envelope values, acquired by the acquiring unit, of the
 5 subbands of the first quantity.
   [0023]       With reference to the first possible implementation manner of the second
   aspect, in a second possible implementation manner, the encoding apparatus further
   includes a determining unit; where:
                the acquiring unit is further configured to acquire signal types of the
10 subbands of the first quantity; and
                the determining unit is configured to determine the modification factors of
   the subbands of the first quantity according to the signal types of the subbands of the
   first quantity acquired by the acquiring unit.
   [0024]       With reference to the second possible implementation manner of the
15 second aspect, in a third possible implementation manner, where:
                a modification factor of the first subband is greater than 1 when a signal
   type, acquired by the acquiring unit, of a first subband in the subbands of the first
   quantity is harmonic; or
                a modification factor of the first subband is less than or equal to 1 when a
20 signal type, acquired by the acquiring unit, of a first subband in the subbands of the
   first quantity is non-harmonic.
   [0025]       With reference to the second possible implementation manner or the third
   possible implementation manner of the second aspect, in a fourth possible
   implementation manner,
25              the acquiring unit is further configured to acquire stored reference
   information of subbands of a second quantity in a previous data frame of the current
   data frame, where the second quantity is less than or equal to the first quantity; and
                the determining unit is specifically        configured to determine        the
   modification factors of the subbands of the first quantity according to the signal types
30 of the subbands of the first quantity and the reference information of the subbands of
   the second quantity that are acquired by the acquiring unit.
   [0026]       With reference to the fourth possible implementation manner of the second
   aspect, in a fifth possible implementation manner,
                the determining unit is further configured to: determine a first modification
                                                 7

   factor of the first subband according to the signal type, acquired by the acquiring unit,
   of the first subband in the subbands of the first quantity; determine a second
   modification factor of the first subband according to reference information, acquired
   by the acquiring unit, of a second subband, corresponding to the first subband, in the
 5 subbands of the second quantity; and use a product of the first modification factor and
   the second modification factor as the modification factor of the first subband.
   [0027]      With reference to the fifth possible implementation manner of the second
   aspect, in a sixth possible implementation manner, where:
               a value of the second modification factor determined by the determining
10 unit is a value of a third modification factor when the reference information of the
   second subband includes a quantization bit allocation status of the second subband; or
               a value of the second modification factor is a value of a fourth
   modification factor when the reference information of the second subband includes a
   signal type of the second subband; or
15             a value of the second modification factor is a product of a value of a third
   modification factor and a value of a fourth modification factor when the reference
   information of the second subband includes a quantization bit allocation status of the
   second subband and a signal type of the second subband.
   [0028]      With reference to the sixth possible implementation manner of the second
20 aspect, in a seventh possible implementation manner,
               the determining unit is further configured to: when the quantization bit
   allocation status of the second subband indicates that no spectral coefficient is
   encoded, determine that the third modification factor is less than 1, or when the
   quantization bit allocation status of the second subband indicates that a spectral
25 coefficient is encoded, determine that the third modification factor is greater than 1;
   and when the signal type of the second subband acquired by the acquiring unit is
   harmonic, determine that the fourth modification factor is greater than 1, or when the
   signal type of the second subband acquired by the acquiring unit is non-harmonic,
   determine that the fourth modification factor is less than or equal to 1.
30 [0029]      With reference to the sixth possible implementation manner or the seventh
   possible implementation manner of the second aspect, in an eighth possible
   implementation manner, the second modification factor of the first subband
   determined by the determining unit is determined according to a ratio of any two
   values of a frequency envelope value of the second subband, an average frequency
                                               8

   envelope value of the subbands of the second quantity, a bandwidth value of the
   subbands of the second quantity, a maximum value of frequency envelope values of
   the subbands of the second quantity, and a frequency envelope variance value of the
   subbands of the second quantity.
 5 [0030]       With reference to the fifth possible implementation manner to the seventh
   possible implementation manner of the second aspect, in a ninth possible
   implementation manner, the first modification factor of the first subband determined
   by the determining unit is determined according to a ratio of any two values of a
   frequency envelope value of the first subband, an average frequency envelope value
10 of the subbands of the first quantity, a bandwidth value of the subbands of the first
   quantity, a maximum value of frequency envelope values of the subbands of the first
   quantity, and a frequency envelope variance value of the subbands of the first
   quantity.
   [0031]       With reference to the first possible implementation manner of the second
15 aspect, in a tenth possible implementation manner,
                the acquiring unit is further configured to acquire reference information,
   stored in a storing unit, of subbands of a first quantity in a previous data frame of the
   current data frame; and
                the determining unit is further configured to determine the modification
20 factors of the subbands of the first quantity in the current data frame according to the
   reference information, acquired by the acquiring unit, of the subbands of the first
   quantity in the previous data frame.
   [0032]       With reference to the tenth possible implementation manner of the second
   aspect, in an eleventh possible implementation manner,
25              the acquiring unit is further configured to acquire signal types of subbands
   of a third quantity in the subbands in the current data frame, where the third quantity
   is less than or equal to the first quantity; and
                the determining unit is specifically configured to: determine the
   modification factors of the subbands of the first quantity in the current data frame
30 according to the reference information of the subbands of the first quantity in the
   previous data frame and the signal types of the subbands of the third quantity that are
   acquired by the acquiring unit.
   [0033]       With reference to the eleventh possible implementation manner of the
   second aspect, in a twelfth possible implementation manner,
                                                  9

                 the determining unit is further configured to: determine a second
   modification factor of a first subband in the subbands of the first quantity in the
   current data frame according to reference information, acquired by the acquiring unit,
   of a second subband in the subbands of the first quantity in the previous data frame;
 5 determine a first modification factor of the first subband according to a signal type of
   the first subband acquired by the acquiring unit; and use a product of the first
   modification factor and the second modification factor as a modification factor of the
   first subband.
   [0034]        With reference to the second aspect or any one of the first possible
10 implementation manner to the twelfth possible implementation manner of the second
   aspect, in a thirteenth possible implementation manner,
                 the storing unit is further configured to store reference information of the
   subbands of the first quantity in the current data frame after the quantization bits are
   allocated to the subbands according to the modified quantized frequency envelope
15 values of the subbands of the first quantity.
   [0034a]        According to a third aspect, an embodiment of the present invention
   provides an audio signal encoding method, comprising:
         splitting, by an encoder, spectral coefficients of a current frame of an audio
   signal into plurality of subbands;
20       quantizing, by the encoder, energy envelope for each of the plurality of subbands
   to obtain initial quantized energy envelope for each of the plurality of subbands;
         adjusting, by the encoder, quantized energy envelopes of some subbands of the
   plurality of subbands, wherein the some subbands comprises a subband having a
   highest frequency in the plurality of subbands and a subband consecutive to the
25 subband having the highest frequency;
         performing, by the encoder, bit allocation based on the adjusted quantized energy
   envelopes of the some subbands and the initial quantized energy envelope of each
   subband besides the some subbands in the plurality of subbands; and
   quantizing, by the encoder, a spectral coefficient of a subband to which at least one bit
30 is allocated after the bit allocation, wherein the quantized spectral coefficient of the
   subband to which at least one bit is allocated after the bit allocation is used for writing
   into a bitstream.
   [0034b]        According to a fourth aspect, an embodiment of the present invention
   provides an audio signal encoder, comprising:
                                                  10

         a memory; and
         a processor coupled to the memory and configured to:
         split spectral coefficients of a current frame of an audio signal into plurality of
   subbands;
 5       quantize energy envelope for each of the plurality of subbands to obtain initial
   quantized energy envelope for each of the plurality of subbands;
         adjust quantized energy envelopes of some subbands of the plurality of subbands,
   wherein the some subbands comprises a subband having a highest frequency in the
   plurality of subbands and a subband consecutive to the subband having the highest
10 frequency;
         perform bit allocation based on the adjusted quantized energy envelopes of the
   some subbands and the initial quantized energy envelope of each subband besides the
   some subbands in the plurality of subbands; and
         quantize a spectral coefficient of a subband to which at least one bit is allocated
15 after the bit allocation, wherein the quantized spectral coefficient of the subband to
   which at least one bit is allocated after the bit allocation is used for writing into a
   bitstream.
   [0035]       According to the encoding method and apparatus provided in the
   embodiments of the present invention, after splitting spectral coefficients of a current
20 data frame into subbands, an encoder acquires quantized frequency envelope values of
   the subbands; the encoder modifies quantized frequency envelope values of subbands
   of a first quantity in the subbands; the encoder allocates quantization bits to the
   subbands according to modified quantized frequency envelope values of the subbands
   of the first quantity; the encoder quantizes a spectral coefficient of a subband to which
25 a quantization bit is allocated in the subbands; and finally, the encoder writes the
   quantized spectral coefficient of the subband to which a quantization bit is allocated
   into a bitstream. According to this solution, before quantization bit allocation is
   performed for spectral coefficients of subbands in a current data frame of an audio
   signal, quantized frequency envelope values of the subbands in the current data frame
30 can be modified according to a signal type of the current data frame and information
   about a previous data frame; therefore, performing quantization bit allocation for the
   spectral coefficients of the subbands according to modified quantized frequency
   envelope values of the subbands and a quantity of available bits can achieve an
   objective of proper quantization bit allocation for spectral coefficients of an audio
                                                11

   signal, thereby improving quality of a signal obtained by a decoder by means of
   decoding.
                         BRIEF DESCRIPTION OF DRAWINGS
   [0036]      To describe the technical solutions in the embodiments of the present
 5 invention more clearly, the following briefly introduces the accompanying drawings
   required for describing the embodiments. Apparently, the accompanying drawings in
   the following description show merely some embodiments of the present invention,
   and a person of ordinary skill in the art may still derive other drawings from these
   accompanying drawings without creative efforts.
10 [0037]      FIG. 1 is a first flowchart of an encoding method according to an
   embodiment of the present invention;
   [0038]      FIG. 2 is a second flowchart of an encoding method according to an
   embodiment of the present invention;
   [0039]      FIG. 3 is a spectral diagram of an audio signal in an encoding method
15 according to an embodiment of the present invention;
   [0040]      FIG. 4 is a first schematic structural diagram of an encoding apparatus
   according to an embodiment of the present invention;
   [0041]      FIG. 5 is a second schematic structural diagram of an encoding apparatus
   according to an embodiment of the present invention;
20 [0042]      FIG. 6 is a third schematic structural diagram of an encoding apparatus
   according to an embodiment of the present invention; and
   [0043]      FIG. 7 is a schematic structural diagram of an encoder according to an
   embodiment of the present invention.
                           DESCRIPTION OF EMBODIMENTS
25 [0044]      The following clearly describes the technical solutions in the embodiments
   of the present invention with reference to the accompanying drawings in the
   embodiments of the present invention. Apparently, the described embodiments are
   merely some but not all of the embodiments of the present invention. All other
   embodiments obtained by a person of ordinary skill in the art based on the
30 embodiments of the present invention without creative efforts shall fall within the
                                              12

   protection scope of the present invention.
                                         Embodiment 1
   [0045]       This embodiment of the present invention provides an encoding method.
   As shown in FIG. 1, the method may include the following steps:
 5 [0046]       S101. After an encoder splits spectral coefficients of a current data frame
   into subbands, the encoder acquires quantized frequency envelope values of the
   subbands.
   [0047]       An encoder (encoder) is a device that encodes data or a signal (for
   example, a bitstream) to convert the data or the signal into a signal that may be used
10 for   communication,      transmission,   and    storing.  The    encoder   has  different
   classifications   in different  technical   fields.   In the   field of communications
   technologies, the encoder may include a video encoder, an audio encoder, and the like.
   [0048]       The encoder provided in this embodiment of the present invention may be
   an audio encoder. An audio encoder is a tool that may compress an analog audio
15 signal into a data encoding file, that is, an audio compression coding tool. Audio
   compression coding may be classified into voice signal compression coding and
   wideband audio signal compression coding. Voice signal compression coding is
   mainly used in digital phone communication. Wideband audio signal compression
   coding is mainly applied to sound in digital audio broadcasting, a VCD (Video
20 Compact Disc, video compact disc), a digital versatile disc (Digital Versatile Disc,
   DVD), and a high definition television (High Definition Television, HDTV).
   [0049]       It should be noted that an audio signal may be transmitted to an encoder
   frame by frame in a data frame form. A data frame is a protocol data unit at a data link
   layer, and a data frame may include a frame header, a data part, and a frame trailer.
25 The frame header and the frame trailer include necessary control information such as
   synchronization information, address information, and error control information. The
   data part includes data transmitted from a network layer, for example, an IP (Internet
   Protocol, Internet Protocol) packet.
   [0050]       The encoder first splits the spectral coefficients of the current data frame
30 into the subbands, and then acquires the quantized frequency envelope values of the
   subbands.
   [0051]       Exemplarily, in the encoding method provided in this embodiment of the
                                                13

   present invention, it is assumed that the current data frame is the yth data frame, and
   after the encoder splits the spectral coefficients of the current data frame, that is, the
   yth data frame, into N subbands, the encoder separately acquires quantized frequency
   envelope values of the N subbands, where N 1, and y>1. The encoder obtains
 5 frequency envelope values of the N subbands in the yth data frame by calculating
   frequency envelopes of the N subbands in the yth data frame; then the encoder
   quantizes the frequency envelope values to obtain index values of the quantized
   frequency envelopes of the N subbands in the yth data frame, and re-creates frequency
   envelopes of the N subbands in the yth data frame according to the index values of the
10 quantized frequency envelopes, so as to obtain the quantized frequency envelope
   values of the N subbands in the yth data frame.
   [0052]      Quantization may include scalar quantization and vector quantization.
   Vector quantization is an efficient data compression technology that has advantages
   such as a large compression ratio, easy decoding, and a small distortion. The vector
15 quantization technology is widely used in image compression and voice encoding.
   [0053]      Optionally, vector quantization may include pyramid lattice vector
   quantization, spherical lattice vector quantization, and the like.
   [0054]      S102. The encoder modifies quantized frequency envelope values of
   subbands of a first quantity in the subbands.
20 [0055]      After the encoder acquires the quantized frequency envelope values of the
   subbands, the encoder modifies the quantized frequency envelope values of the
   subbands of the first quantity, where the subbands of the first quantity may be some
   subbands in the subbands.
   [0056]      In the encoding method provided in this embodiment of the present
25 invention, the encoder divides each data frame of a transmitted audio signal into
   subbands of a same quantity, that is, the current data frame and a previous data frame
   include subbands of a same quantity.
   [0057]      Specifically, after the encoder obtains the quantized frequency envelope
   values of the subbands in the current data frame, the encoder may modify the
30 quantized frequency envelope values of the subbands of the first quantity in the
   current data frame according to signal types of subbands in the current data frame and
   reference information of subbands in the previous data frame, or signal types of
   subbands in the current data frame, or reference information of subbands in the
                                               14

   previous data frame. In this embodiment of the present invention, the current data
   frame is adjacent to the previous data frame.
   [0058]       For example, assuming that a quantity of subbands in each frame is N, the
   encoder may modify the quantized frequency envelope values of the subbands of the
 5 first quantity in the current data frame according to signal types of M subbands in the
   current data frame and/or reference information of L subbands in the previous data
   frame. A value of the first quantity is a larger value between M and L, where 1 MKN,
   and 1 L N. In this embodiment of the present invention, the signal types of the M
   subbands in the current data frame include a signal type of each subband in the M
10 subbands, and the reference information of the L subbands in the previous data frame
   includes reference information of each subband in the L subbands.
   [0059]       A specific data frame dividing method and a specific modification manner
   are described in detail in a subsequent embodiment.
   [0060]       Optionally, a signal type of a subband may be harmonic or non-harmonic.
15 [0061]       It may be understood that because the encoder modifies the quantized
   frequency envelope values of the subbands of the first quantity in the current data
   frame according to the signal types of the subbands in the current data frame and/or
   the reference information of the subbands in the previous data frame, modified
   quantized frequency envelope values of the subbands in the current data frame better
20 meet a characteristic of an audio signal, and spectral coefficients of the previous data
   frame are more continuous with the spectral coefficients of the current data frame.
   [0062]       S103. The encoder allocates quantization bits to the subbands according to
   modified quantized frequency envelope values of the subbands of the first quantity.
   [0063]       After the encoder modifies the quantized frequency envelope values of the
25 subbands of the first quantity in the subbands, the encoder may perform quantization
   bit allocation for the subbands in the current data frame according to the modified
   quantized frequency envelope values of the subbands of the first quantity.
   [0064]       Specifically, after the encoder modifies the quantized frequency envelope
   values of the subbands of the first quantity in the current data frame, the encoder may
30 calculate initial values of importance of the subbands in the current data frame
   (importance of a subband may be measured by using a parameter such as energy or a
   frequency of the subband) according to the modified quantized frequency envelope
   values of the subbands of the first quantity in the current data frame, and then allocate
                                                 15

   available bits to the subbands according to the initial values of importance of the
   subbands, where more bits are allocated to a subband of high importance, and fewer
   bits are allocated to a subband of low importance.
   [0065]       It should be noted that a quantity of available bits refers to a total quantity
 5 of bits that are available in the current data frame. The quantity of available bits is
   determined according to a bit rate of the encoder. A larger bit rate of the encoder
   indicates a larger quantity of available bits.
   [0066]       It may be understood that after the quantized frequency envelope values of
   the subbands in the current data frame are modified, on one hand, because the
10 modified quantized frequency envelope values, used for quantization bit allocation, of
   the subbands in the current data frame better meet the characteristic of the audio
   signal, quantization bit allocation for the spectral coefficients of the subbands is more
   proper; on the other hand, because the modified quantized frequency envelope values
   of the subbands in the current data frame may make the spectral coefficients of the
15 previous data frame more continuous with the spectral coefficients of the current data
   frame, some discrete points on a spectrum during decoding by a decoder are reduced,
   so that the decoder can better complete decoding.
   [0067]       S104. The encoder quantizes a spectral coefficient of a subband to which a
   quantization bit is allocated in the subbands.
20 [0068]       After the encoder performs quantization bit allocation for the spectral
   coefficients of the subbands in the current data frame, the encoder quantizes the
   spectral coefficient of the subband to which a quantization bit is allocated in the
   subbands in the current data frame.
   [0069]       Specifically, after the encoder performs quantization bit allocation for the
25 spectral coefficients of the subbands in the current data frame, the encoder may
   perform normalization processing on the spectral coefficients of the subbands in the
   current data frame according to the modified quantized frequency envelope values of
   the subbands in the current data frame, and then quantize the spectral coefficients of
   the subbands in the current data frame according to quantities of bits separately
30 allocated by the encoder to spectral coefficients of subbands to which quantization
   bits are allocated in the subbands in the current data frame.
   [0070]       Exemplarily, it is assumed that the current data frame is the yth data frame,
   the previous data frame is the (y-1)th data frame, and the encoder divides each data
   frame into N subbands. When quantizing, according to a quantity of bits allocated to
                                                16

   the spectral coefficient of the subband to which a quantization bit is allocated in the N
   subbands in the yth data frame, the spectral coefficient of the subband to which a
   quantization bit is allocated in the N subbands in the yth data frame, the encoder may
   use a pyramid lattice vector quantization method to quantize a spectral coefficient of a
 5 subband to which fewer bits are allocated, so as to obtain the quantized spectral
   coefficient of the subband to which fewer bits are allocated; correspondingly, the
   encoder may use a spherical lattice vector quantization method to quantize a spectral
   coefficient of a subband to which more bits are allocated, so as to obtain the quantized
   spectral coefficient of the subband to which more bits are allocated.
10 [0071]      It should be noted that there may be a subband to which no quantization bit
   is allocated in the subbands in the current data frame. In this embodiment of the
   present invention, the encoder quantizes a spectral coefficient of a subband to which a
   quantization bit is allocated in the subbands in the current data frame. Specifically, if a
   quantization bit is allocated to a subband, the quantization bit allocated to the subband
15 is used to quantize a spectral coefficient of the subband. For example, two
   quantization bits are allocated to a subband, the two quantization bits are used to
   quantize a spectral coefficient of the subband; three bits are allocated to another
   subband, the three quantization bits are used to quantize a spectral coefficient of the
   another subband; if no quantization bit is allocated to a subband, a spectral coefficient
20 of the subband to which no quantization bit is allocated is not quantized.
   [0072]      S105. The encoder writes the quantized spectral coefficient of the subband
   to which a quantization bit is allocated into a bitstream.
   [0073]      After the encoder quantizes the spectral coefficient of the subband to
   which a quantization bit is allocated in the current data frame, the encoder needs to
25 write the quantized spectral coefficient of the subband to which a quantization bit is
   allocated into the bitstream, so that the decoder uses the bitstream to perform
   decoding.
   [0074]      Specifically, after the encoder quantizes the spectral coefficient of the
   subband to which a quantization bit is allocated in the current data frame, the encoder
30 writes the quantized spectral coefficient of the subband to which a quantization bit is
   allocated, the signal types of the subbands in the current data frame, the reference
   information of the subbands in the previous data frame, and quantization frequency
   envelope index values of the subbands in the current data frame into the bitstream,
   and transmits the bitstream to the decoder for decoding.
                                                17

   [0075]      It should be noted that for each data frame of an audio signal, the encoder
   performs encoding according to the foregoing steps S101 to S105, that is, the encoder
   repeatedly executes S101 to S105 until all data frames of the audio signal are
   encoded.
 5 [0076]      It may be understood that after the encoder calculates, quantizes, and
   modifies each data frame of a to-be-encoded audio signal, the encoder needs to write
   corresponding parameters such as the signal types of the subbands in the current data
   frame, the reference information of the subbands in the previous data frame, and the
   quantization frequency envelope index values of the subbands in the current data
10 frame that are obtained in the foregoing process and the quantized spectral coefficient
   of the subband to which a quantization bit is allocated in the current data frame into
   the bitstream, and transmit the bitstream to the decoder, so that the decoder can
   perform processing such as dequantization and denormalization on the bitstream of an
   encoded audio signal according to the corresponding parameters obtained during
15 encoding, and then the encoder obtains, after completing decoding, the audio signal
   before being encoded.
   [0077]      According to the encoding method provided in this embodiment of the
   present invention, after splitting spectral coefficients of a current data frame into
   subbands, an encoder acquires quantized frequency envelope values of the subbands;
20 the encoder modifies quantized frequency envelope values of subbands of a first
   quantity in the subbands; the encoder allocates quantization bits to the subbands
   according to modified quantized frequency envelope values of the subbands of the
   first quantity; the encoder quantizes a spectral coefficient of a subband to which a
   quantization bit is allocated in the subbands; and finally, the encoder writes the
25 quantized spectral coefficient of the subband to which a quantization bit is allocated
   into a bitstream. According to this solution, before quantization bit allocation is
   performed for spectral coefficients of subbands in a current data frame of an audio
   signal, quantized frequency envelope values of the subbands can be modified
   according to a signal type of the current data frame and information about a previous
30 data frame; therefore, performing quantization bit allocation for the spectral
   coefficients of the subbands according to modified quantized frequency envelope
   values of the subbands and a quantity of available bits can achieve an objective of
   proper quantization bit allocation for spectral coefficients of an audio signal, thereby
   improving quality of a signal obtained by a decoder by means of decoding.
                                               18

                                        Embodiment 2
   [0078]       This embodiment of the present invention provides an encoding method.
   In the encoding method provided in this embodiment of the present invention, that a
   current data frame is the yth data frame and a previous data frame is the (y-1)th data
 5 frame is used as an example for description, where y21. As shown in FIG. 2, the
   method may include the following steps:
   [0079]       S201. An encoder performs time-frequency transformation on the yth data
   frame of an audio signal to obtain spectral coefficients of the yth data frame, where
   y 1.
10 [0080]       An encoder is a device that encodes data or a signal (for example, a
   bitstream) to convert the data or the signal into a signal that may be used for
   communication, transmission, and storing. The encoder has different classifications in
   different technical fields. In the field of communications technologies, the encoder
   may include a video encoder, an audio encoder, and the like.
15 [0081]       The encoder provided in this embodiment of the present invention may be
   an audio encoder. An audio encoder is a tool that may compress an analog audio
   signal into a data encoding file, that is, an audio compression coding tool. Audio
   compression coding may be classified into voice signal compression coding and
   wideband audio signal compression coding. Voice signal compression coding is
20 mainly used in digital phone communication. Wideband audio signal compression
   coding is mainly applied to sound in digital audio broadcasting, a VCD, a DVD, and
   an HDTV.
   [0082]       Time-frequency transformation refers to transforming a signal from a time
   domain     to a    frequency   domain.    Currently, commonly used     time-frequency
25 transformation     methods   include   discrete Fourier transform   (Discrete   Fourier
   Transform, DFT), discrete cosine transform (Discrete Cosine Transform, DCT),
   modified discrete cosine transform (Modified Discrete Cosine Transform, MDCT),
   and the like.
   [0083]       It should be noted that an audio signal may be transmitted to an encoder
30 frame by frame in a data frame form. A data frame is a protocol data unit at a data link
   layer, and a data frame may include a frame header, a data part, and a frame trailer.
   The frame header and the frame trailer include necessary control information such as
   synchronization information, address information, and error control information. The
                                                19

   data part includes data transmitted from a network layer, for example, an IP packet.
   [0084]      The encoder transforms the yth data frame of the audio signal from a time
   domain to a frequency domain by using a time-frequency transformation method, so
   as to obtain the spectral coefficients of the yth data frame. It may be understood that in
 5 an encoding process, the encoder successively transforms each data frame of the
   audio signal from the time domain to the frequency domain.
   [0085]      S202. The encoder splits the spectral coefficients of the yth data frame into
   N subbands, where N>1.
   [0086]      A subband refers to a frequency band that has a specific characteristic.
10 [0087]      In the encoding method provided in this embodiment of the present
   invention, after the encoder performs time-frequency transformation on the audio
   signal, the encoder divides each data frame of the audio signal obtained after
   time-frequency transformation into N subbands, that is, the encoder divides any
   transmitted data frame into N subbands. Therefore, the yth data frame and the (y-1 )th
15 data frame have the same quantity of subbands, which is N.
   [0088]      Subbands in the   yth data frame are different frequency bands in the yth data
   frame. Exemplarily, if the spectral coefficients of the yth data frame are from 0 to 8000
   Hz, a frequency band from 0 to 20 Hz is one subband in the yth data frame.
   [0089]      Optionally, during subband dividing, the spectral coefficients of the
20 transformed   yth data frame may be split into subbands with equal intervals, or the
   spectral coefficients of the transformed yth data frame may be split into subbands with
   unequal intervals according to auditory sensing characteristics. Splitting may be
   performed according to an actual splitting requirement, which is not limited in the
   present invention.
25 [0090]      S203. The encoder acquires quantized frequency envelope values of the N
   subbands in the yth data frame.
   [0091]      Quantization may include scalar quantization and vector quantization.
   Vector quantization is an efficient data compression technology that has advantages
   such as a large compression ratio, easy decoding, and a small distortion. The vector
30 quantization technology is widely used in image compression and voice encoding.
   [0092]      The encoder obtains frequency envelope values of the N subbands in the
   yth data frame by calculating frequency envelopes of the N subbands in the yth data
   frame; then the encoder quantizes the frequency envelope values to obtain index
                                                20

   values of quantized frequency envelopes of the N subbands in the yth data frame, and
   re-creates frequency envelopes of the N subbands in the yth data frame according to
   the index values of the quantized frequency envelopes, so as to obtain the quantized
   frequency envelope values of the N subbands in the yth data frame.
 5 [0093]      Optionally, vector quantization may include pyramid lattice vector
   quantization, spherical lattice vector quantization, and the like.
   [0094]      S204. The encoder acquires modification factors of subbands of a first
   quantity in the yth data frame.
   [0095]      In this embodiment of the present invention, preferably, when modifying
10 the quantized frequency envelope values of the N subbands in the yth data frame, the
   encoder needs to modify, according to importance of the subbands in the yth data
   frame, only several subbands that have high importance in the yth data frame, that is,
   several subbands that have higher energy in the yth data frame, that is, several
   subbands that have higher frequencies in the yth data frame. Considering continuity
15 between adjacent data frames, a specific value of the first quantity of subbands to be
   modified in the yth data frame is determined according to a quantity M of subbands
   that have higher frequencies and are selected from the yth data frame and a quantity L
   of subbands that have higher frequencies and are selected from the (y-1 )th data frame,
   that is, the value of the first quantity is a larger value between M and L, where
20 1<M<N, and 1 L N.
   [0096]      Particularly, a method for selecting the M subbands that have higher
   frequencies in the yth data frame or the L subbands that have higher frequencies in the
   (y-1)th data frame is: the encoder may select a reference frequency, and when a start
   frequency of a subband is higher than the reference frequency, the subband is a
25 subband that has a higher frequency. The reference frequency may be 5 kHz, 5.45
   kHz, 5.8 kHz, 6 kHz, 6.2 kHz, 7 kHz, 8 kHz, or 10 kHz, that is, selection of a subband
   that has a higher frequency may be set according to different conditions, which is not
   limited in the present invention.
   [0097]      Further, in this embodiment of the present invention, selection of the
30 reference frequency may be determined according to a highest frequency of a subband
   in the current data frame and a preset frequency range. That is, a reference frequency
   = the highest frequency - a frequency range. For example, if the preset frequency
   range is 2 kHz, and the highest frequency of the subband in the current data frame is
                                               21

   7.45 kHz, the reference frequency       = 7.45 kHz - 2 kHz    =  5.45 kHz; if the preset
   frequency range is 3 kHz, and the highest frequency of the subband in the current data
   frame is 9.2 kHz, the reference frequency       = 9.2 kHz - 3 kHz  = 6.2 kHz. It may be
   understood that the preset frequency range may be set according to a requirement or
 5 experience.
   [0098]       Further, the encoder may modify the M or L subbands in the yth data
   frame. As shown in FIG. 3, the M subbands in the yth data frame are M consecutive
   subbands starting from a subband that has a highest frequency in the N subbands in
   the  yth data frame, and the L subbands in the (y-1)th data frame are L consecutive
10 subbands starting from a subband that has a highest frequency in the N subbands in
   the (y-1 )th data frame.
   [0099]       A case in which M L is used for description in the following.
   [0100]       If M>L, the first quantity is M; if a quantity of the L subbands in the
   (y-1)th data frame is referred to as a second quantity, and the second quantity is less
15 than or equal to the first quantity, subbands of a second quantity in the (y-1)th data
   frame are the L subbands in the (y-1)th data frame. A method for acquiring, by the
   encoder, the modification factors of the subbands of the first quantity in the yth data
   frame includes: determining, by the encoder, the modification factors of the subbands
   of the first quantity in the yth data frame according to signal types of the subbands of
20 the first quantity in the yth data frame; or determining, by the encoder, the
   modification factors of the subbands of the first quantity in the yth data frame
   according to signal types of the subbands of the first quantity in the yth data frame and
   reference information of the subbands of the second quantity in the (y-1)th data frame.
   [0101]       Specifically, the encoder selects a corresponding calculation formula
25 according to a signal type of each subband in the M subbands in the yth data frame to
   determine a value of a modification factor corresponding to each subband in the M
   subbands; or the encoder selects a corresponding calculation formula according to a
   signal type of each subband in the M subbands in the yth data frame and reference
   information of the L subbands in the (y-1)th data frame to determine a modification
30 factor corresponding to each subband in the M subbands in the yth data frame.
   [0102]       It should be noted that the signal types of the M subbands in the yth data
   frame include a signal type of each subband in the M subbands, and each subband in
   the M subbands is corresponding to a modification factor.
                                                22

   [0103]       Further, a method for acquiring, by the encoder, the modification factors of
   the M subbands in the yth data frame is as follows:
   [0104]       (1) The encoder selects the corresponding calculation formula according to
   the signal type of each subband in the M subbands in the yth data frame to determine
 5 the value of the modification factor corresponding to each subband in the M subbands
   in the yth data frame.
   [0105]       Optionally, a signal type of a subband may be harmonic or non-harmonic.
   When a signal type of a first subband in the subbands of the first quantity in the yth
   data frame is harmonic, the encoder determines that a modification factor of the first
10 subband is greater than 1; when a signal type of a first subband in the subbands of the
   first quantity in the yth data frame is non-harmonic, the encoder determines that a
   modification factor of the first subband is less than or equal to 1. That is, if the signal
   type of the first subband in the M subbands in the yth data frame is harmonic, the
   encoder determines that the modification factor corresponding to the first subband is a
15 value greater than 1; or if the signal type of the first subband is non-harmonic, the
   encoder determines that the modification factor corresponding to the first subband is a
   value less than or equal to 1.
   [0106]       Specifically, the modification factor of the first subband is determined
   according to a ratio of any two values of a frequency envelope value of the first
20 subband, an average frequency envelope value of the subbands of the first quantity, a
   bandwidth value of the subbands of the first quantity, a maximum value of frequency
   envelope values of the subbands of the first quantity, and a frequency envelope
   variance value of the subbands of the first quantity. That is, the modification factor of
   the first subband is determined according to a ratio of any two values of the frequency
25 envelope value of the first subband, an average frequency envelope value of the M
   subbands, a bandwidth value of the M subbands, a maximum value of frequency
   envelope values of the M subbands, and a frequency envelope variance value of the M
   subbands. A specific combination form may be selected according to the signal type
   of the first subband, that is, a corresponding formula may be selected according to the
30 signal type of the first subband to calculate the modification factor.
   [0107]       A first formula is as follows:
                 factor(i)= bandlength* Ep tmp[i]* Ep vari
                                          Epavrg2
                                                23

               where bandlength is a quantity of subbands between a subband, except
   the M subbands, in the N subbands and the        ith subband in the M subbands.
                Ep tmp[i]            Ep]
                                 band width[i]    , where Ep[i] is energy of the   ith subband,
    Ep tmp[i] is a frequency envelope value of the         ith  subband, and bandwidth[i] is a
 5 bandwidth of the   ith subband.
                            N
                Ep vari =      | Ep tmp[i] - Ep tmp[i-1]
                                                               , where Ep-vari is a frequency
   envelope variance of a frequency band.
                             N
                Ep_avrg =       Eptmp[i]
                                              where       Epavrg      is an average frequency
   envelope value of several subbands in a frequency band.
10 [0108]      A second formula is as follows:
                factor(i) =1.0                                                           (2)
   [0109]      Exemplarily, if the signal type of the first subband is harmonic, the first
   formula is selected, and a value, obtained by means of calculation, of the modification
   factor corresponding to the first subband is greater than 1; if the signal type of the first
15 subband is non-harmonic, the second formula is selected, and a value, obtained by
   means of calculation, of the modification factor corresponding to the first subband is
   less than or equal to 1.
   [0110]      It may be understood that if the signal type of the first subband is harmonic,
   to better restore a harmonic characteristic of the first subband during decoding, a
20 relatively large quantity of bits needs to be allocated to the first subband. That is,
   when the signal type of the first subband is harmonic, after it is determined that the
   modification factor corresponding to the first subband is a value greater than 1, a
   modified quantized frequency envelope value of the first subband is greater than an
   unmodified quantized frequency envelope value of the first subband, and then a
25 relatively large quantity of bits is allocated to the first subband.
   [0111]      It should be noted that a method for acquiring a modification factor of
   each subband in the subbands of the first quantity in the yth data frame is the same as
   the foregoing method for acquiring the modification factor of the first subband.
   [0112]      (2) The encoder selects the corresponding calculation formula according to
                                                 24

   the signal type of each subband in the M subbands in the yth data frame and the
   reference information of the L subbands in the (y-1)th data frame to determine the
   modification factor corresponding to each subband in the M subbands in the yth data
   frame.
 5 [0113]       It should be noted that M>L, the encoder determines M first modification
   factors according to the signal type of each subband in the M subbands in the yth data
   frame, and the encoder determines L second modification factors according to the
   reference information of the L subbands in the (y-I)th data frame. L first modification
   factors in the M first modification factors and the L second modification factors are
10 used to correspondingly modify quantized frequency envelope values of L subbands
   in the M subbands in the yth data frame, and the encoder correspondingly modifies
   quantized frequency envelope values of M-L remaining subbands in the M subbands
   in the yth data frame according to M-L remaining first modification factors in the M
   first modification factors.
15 [0114]       Specifically, the first subband in the yth data frame is described. If the first
   subband in the yth data frame has corresponding reference information of a second
   subband in the (y-1)th data frame, the encoder determines a first modification factor of
   the first subband according to the signal type of the first subband in the yth data frame,
   and the encoder determines a second modification factor of the first subband
20 according to the reference information of the second subband, corresponding to the
   first subband in the yth data frame, in the subbands of the second quantity in the
   (y-1)th data frame, and finally uses a product of the first modification factor and the
   second modification factor as the modification factor of the first subband. If the first
   subband in the yth data frame does not have corresponding reference information of a
25 second subband in the (y-1)th data frame, the encoder determines a first modification
   factor of the first subband according to the signal type of the first subband in the yth
   data frame, where the modification factor of the first subband is the first modification
   factor.
   [0115]       It should be noted that when the encoder selects a corresponding
30 calculation formula according to the signal type of each subband in the M subbands in
   the  yth data frame to determine a value of the first modification factor corresponding
   to each subband in the M subbands, the value of the first modification factor is
   determined by using the method for determining the modification factor in (1), that is,
                                                25

   the modification factor in (1) is the first modification factor herein.
   [0116]       It should be noted that the reference information of the L subbands in the
   (y-1)th data frame includes reference information of each subband in the L subbands.
   [0117]       Further, before the encoder determines the modification factors of the
 5 subbands of the first quantity in the yth data frame according to the signal types of the
   subbands of the first quantity in the yth data frame, the encoder needs to first acquire
   the signal types of the subbands of the first quantity in the yth data frame; before the
   encoder determines modification factors of the subbands of the second quantity in the
   (y-1)th data frame according to the reference information of the subbands of the
10 second quantity in the (y-1)th data frame, the encoder needs to first acquire the stored
   reference information of the subbands of the second quantity in the (y-1 )th data frame,
   where the reference information of the subbands of the second quantity in the (y-1)th
   data frame is stored when the encoder completes encoding of the (y-1)th data frame.
   [0118]       Optionally, the reference information of the second subband in the (y-1)th
15 data frame includes a quantization bit allocation status of the second subband and/or a
   signal type of the second subband.
   [0119]       When the reference information of the second subband includes the
   quantization bit allocation status of the second subband, the second modification
   factor is a third modification factor; or when the reference information of the second
20 subband includes the signal type of the second subband, the second modification
   factor is a fourth modification factor; or when the reference information of the second
   subband includes the quantization bit allocation status of the second subband and the
   signal type of the second subband, the second modification factor is a product of the
   third modification factor and the fourth modification factor.
25 [0120]       Specifically, the reference information of the L subbands in the (y-1)th data
   frame includes quantization bit allocation statuses of the L subbands in the (y-1)th
   data frame and/or signal types of the L subbands in the (y-1)th data frame. When the
   reference information of the L subbands in the (y-1)th data frame includes the
   quantization bit allocation statuses of the L subbands in the (y-1 )th data frame, the
30 second modification factor is a third modification factor; or when the reference
   information of the L subbands in the (y-1)th data frame includes the signal types of the
   L subbands in the (y-1)th data frame, the second modification factor is a fourth
   modification factor; or when the reference information of the L subbands in the
   (y-1)th data frame includes the quantization bit allocation statuses of the L subbands
                                                 26

   in the  (y-1)th  data frame and the signal types of the L subbands in the (y-1)th data
   frame, the second modification factor is a product of the third modification factor and
   the fourth modification factor.
   [0121]       Preferably, the second modification factor is the product of the third
 5 modification factor and the fourth modification factor.
   [0122]       The encoder may select a corresponding calculation formula according to a
   quantization bit allocation status of each subband in the L subbands in the (y-1)th data
   frame to determine a value of a third modification factor corresponding to each
   subband in the L subbands, select a corresponding calculation formula according to a
10 signal type of each subband in the L subbands in the (y-1)th data frame to determine a
   value of a fourth modification factor corresponding to each subband in the L subbands,
   and determine, according to the third modification factor and/or the fourth
   modification factor corresponding to each subband in the L subbands, a value of a
   second modification factor corresponding to each subband in the L subbands.
15 [0123]       Optionally, if the quantization bit allocation status of the second subband
   in the L subbands in the (y-1)th data frame indicates that a spectral coefficient is
   encoded, the encoder determines that a third modification factor corresponding to the
   second subband is a value greater than 1; or if the quantization bit allocation status of
   the second subband indicates that no spectral coefficient is encoded, the encoder
20 determines that a third modification factor corresponding to the second subband is a
   value less than 1. If the signal type of the second subband is harmonic, the encoder
   determines that a fourth modification factor corresponding to the second subband is a
   value greater than 1; or if the signal type of the second subband is non-harmonic, the
   encoder determines that a fourth modification factor corresponding to the second
25 subband is a value less than or equal to 1.
   [0124]       It should be noted that when the quantization bit allocation status of the
   second subband in the L subbands in the (y-1)th data frame is "1", it indicates that a
   spectral coefficient is encoded; when the quantization bit allocation status of the
   second subband in the L subbands in the (y-1)th data frame is "0", it indicates that no
30 spectral coefficient is encoded. Herein, a method for acquiring the fourth modification
   factor is the same as the foregoing method for acquiring the modification factor in (1).
   [0125]       Specifically, the second modification factor of the first subband is
   determined according to a ratio of any two values of a frequency envelope value of
   the second subband, an average frequency envelope value of the subbands of the
                                                27

   second quantity, a bandwidth value of the subbands of the second quantity, a
   maximum value of frequency envelope values of the subbands of the second quantity,
   and a frequency envelope variance value of the subbands of the second quantity. A
   specific combination form may be selected according to the reference information of
 5 the second subband, that is, a corresponding formula is selected according to the
   quantization bit allocation status of the second subband and/or the signal type of the
   second subband to calculate the third modification factor and the fourth modification
   factor.
   [0126]       A third formula is as follows:
                 factor(i)=Epavrg * Ep tmp[i]* Epavrg
10                                     bandlength               i                     (3)
                where bandlength is a quantity of subbands between a subband, except
   the L subbands, in the N subbands and the     ith subband in the L subbands.
   [0127]       A fourth formula is as follows:
                 factor(i) =           bandlength
                             Epavrg * Ep tmp[i]* Epavrg         i 1                   (4)
15              where bandlength is a quantity of subbands between a subband, except
   the L subbands, in the N subbands and the     ith subband in the L subbands.
   [0128]       Exemplarily, if the quantization bit allocation status of the second subband
   is "1", the third formula is selected, and a value, obtained by means of calculation, of
   the third modification factor corresponding to the second subband is greater than 1; if
20 the quantization bit allocation status of the second subband is "0", the fourth formula
   is selected, and a value, obtained by means of calculation, of the third modification
   factor corresponding to the second subband is less than 1.
   [0129]       If the signal type of the second subband is harmonic, the first formula is
   selected, and a value, obtained by means of calculation, of the fourth modification
25 factor corresponding to the second subband is greater than 1; if the signal type of the
   second subband is non-harmonic, the second formula is selected, and a value,
   obtained by means of calculation, of the fourth modification factor corresponding to
   the second subband is less than or equal to 1.
   [0130]       It may be understood that if the quantization bit allocation status of the
30 second subband in the (y-1)th data frame is "1", to better maintain continuity between
   adjacent data frames of an audio signal during encoding, it indicates that a relatively
                                                28

   large quantity of bits is allocated to the second subband. That is, when the
   quantization bit allocation status of the second subband is "1", after it is determined
   that the third modification factor corresponding to the second subband is a value
   greater than 1, a modified quantized frequency envelope value of a subband,
 5 corresponding to the second subband, in the yth data frame is greater than an
   unmodified quantized frequency envelope value of the subband, corresponding to the
   second subband, in the yth data frame, and then a relatively large quantity of bits is
   allocated to the subband.
   [0131]       It should be noted that a method for acquiring a modification factor of
10 each subband in the subbands of the first quantity in the yth data frame is the same as
   the foregoing method for acquiring the modification factor of the first subband.
   [0132]       A case in which M L is used for description in the following.
   [0133]       If M<L, a value of the first quantity is L; if a quantity of the M subbands in
   the  yth data frame is referred to as a third quantity, subbands of a third quantity in the
15 yth data frame are the M subbands in the yth data frame. The method for acquiring, by
   the encoder, the modification factors of the subbands of the first quantity in the yth
   data frame includes: determining the modification factors of the subbands of the first
   quantity in the yth data frame according to reference information of subbands of the
   first quantity in the (y-1)th data frame; or determining, by the encoder, the
20 modification factors of the subbands of the first quantity in the yth data frame
   according to reference information of subbands of the first quantity in the (y-1)th data
   frame and signal types of the subbands of the third quantity in the yth data frame.
   [0134]       Specifically, the encoder selects a corresponding calculation formula
   according to reference information of each subband in the L subbands in the          (y-1)th
25 data frame to determine a value of a modification factor corresponding to each
   subband in the L subbands in the yth data frame; or the encoder selects a
   corresponding calculation formula according to a signal type of each subband in the
   M subbands in the yth data frame and reference information of the L subbands in the
   (y-1)th data frame to determine a modification factor corresponding to each subband
30 in the L subbands in the yth data frame.
   [0135]       Further, a method for acquiring, by the encoder, the modification factors of
   the L subbands in the   yth data frame is as follows:
   [0136]       (1) The encoder selects the corresponding calculation formula according to
                                                 29

   the reference information of each subband in the L subbands in the (y-1)th data frame
   to determine the value of the modification factor corresponding to each subband in the
   L subbands in the yth data frame.
   [0137]      Further, before the encoder determines modification factors of the
 5 subbands of the third quantity in the yth data frame according to the signal types of the
   subbands of the third quantity in the yth data frame, the encoder needs to first acquire
   the signal types of the subbands of the third quantity in the yth data frame; before the
   encoder determines modification factors of the subbands of the first quantity in the
   (y-1)th data frame according to the reference information of the subbands of the first
10 quantity in the (y-1 )th data frame, the encoder needs to first acquire the stored
   reference information of the subbands of the first quantity in the (y-1)th data frame,
   where the reference information of the subbands of the first quantity in the (y-1)th
   data frame is stored when the encoder completes encoding of the (y-1)th data frame.
   [0138]      It should be noted that when the encoder selects the corresponding
15 calculation formula according to the reference information of each subband in the L
   subbands in the (y-1)th data frame to determine the value of the modification factor
   corresponding to each subband in the L subbands in the yth data frame, the value of
   the modification factor is determined by using the method for determining the
   foregoing second modification factor in (2) in which M L, that is, the foregoing
20 second modification factor in (2) in which M L is the modification factor herein.
   [0139]      (2) The encoder selects the corresponding calculation formula according to
   the signal type of each subband in the M subbands in the yth data frame and the
   reference information of the L subbands in the (y-1)th data frame to determine the
   modification factor corresponding to each subband in the L subbands in the yth data
25 frame.
   [0140]      It should be noted that MKL, the encoder determines M first modification
   factors according to the signal type of each subband in the M subbands in the yth data
   frame, and the encoder determines L second modification factors according to the
   reference information of the L subbands in the (y-1)th data frame. M second
30 modification factors in the L second modification factors and the M first modification
   factors are used to correspondingly modify quantized frequency envelope values of M
   subbands in the L subbands in the yth data frame, and the encoder correspondingly
   modifies quantized frequency envelope values of L-M remaining subbands in the L
                                               30

   subbands in the yth data frame according to L-M remaining second modification
   factors in the L second modification factors.
   [0141]       Specifically, a first subband in the yth data frame is described. If a second
   subband in the    (y-1)th data frame has a corresponding signal type of the first subband
 5 in the  yth data frame, the encoder determines a second modification factor of the first
   subband in the L subbands in the yth data frame according to the reference information
   of the second subband in the L subbands in the (y-1)th data frame, and the encoder
   determines a first modification factor of the first subband according to the signal type
   of the first subband in the yth data frame, and finally uses a product of the first
10 modification factor and the second modification factor as a modification factor of the
   first subband. If a second subband in the (y-1)th data frame does not have a
   corresponding signal type of the first subband in the yth data frame, the encoder
   determines a second modification factor of the first subband in the yth data frame
   according to the reference information of the second subband in the (y-1)th data frame,
15 and the modification factor of the first subband is the second modification factor.
   [0142]       It should be noted that the foregoing method for determining a value of the
   first modification factor and a value of the second modification factor is the same as
   the method, in which M>L, for determining the value of the first modification factor
   and the value of the second modification factor, and details are not described herein
20 again.
   [0143]       S205. The encoder modifies quantized frequency envelope values of the
   subbands of the first quantity in the yth data frame.
   [0144]       After the encoder acquires the modification factors of the subbands of the
   first quantity in the yth data frame, the encoder modifies the quantized frequency
25 envelope values of the subbands of the first quantity in the yth data frame.
   [0145]       Specifically, the encoder modifies the quantized frequency envelope values
   of the subbands of the first quantity by using the modification factors of the subbands
   of the first quantity in the yth data frame.
   [0146]       It should be noted that, in this embodiment of the present invention, when
30 the encoder modifies the quantized frequency envelope values of the subbands of the
   first quantity in the yth data frame, preferably, as shown in FIG. 3, the encoder needs to
   modify, according to importance of subbands in the yth data frame, only M or L
   subbands that have high importance in the yth data frame, and recombine M or L
                                                 31

   subbands in the yth data frame that are modified by the encoder and remaining
   unmodified subbands in the yth data frame to form modified N subbands in the yth data
   frame.
   [0147]      In the encoding method provided in this embodiment of the present
 5 invention, the encoder may first determine, according to values of M and L, a quantity
   (a larger value between M and L) of subbands in the yth data frame that need to be
   modified, then select a modification manner corresponding to a case in which M>L,
   or M<L, or M=L, and then determine modification factors corresponding to the
   modification manner to modify the quantized frequency envelope values of the
10 subbands of the first quantity in the yth data frame.
   [0148]      Optionally, the encoder selects a corresponding modification manner
   according to values of M and L to modify the quantized frequency envelope values of
   the subbands of the first quantity in the yth data frame.
   [0149]      If M>L, a value of the first quantity is M, and the encoder modifies
15 quantized frequency envelope values of M subbands in the yth data frame according to
   signal types of the M subbands in the yth data frame, or signal types of the M
   subbands in the yth data frame and reference information of L subbands in the (y-1 )th
   data frame. The M subbands in the yth data frame are M consecutive subbands starting
   from a subband that has a highest frequency in the N subbands in the yth data frame, L
20 subbands in the yth data frame are L consecutive subbands starting from the subband
   that has the highest frequency in the N subbands in the yth data frame, and the L
   subbands in the (y-1)th data frame are L consecutive subbands starting from a subband
   that has a highest frequency in N subbands in the (y-1)th data frame.
   [0150]      Alternatively,
25             if M<L, a value of the first quantity is L, and the encoder modifies
   quantized frequency envelope values of L subbands in the yth data frame according to
   reference information of L subbands in the (y-1)th data frame, or signal types of M
   subbands in the yth data frame and reference information of L subbands in the (y-1 )th
   data frame.
30 [0151]      Optionally, the encoder may select, according to values of M and L, that is,
   a modification condition, a modification manner corresponding to the modification
   condition, and determine corresponding modification factors according to the
   modification manner to modify the quantized frequency envelope values of the
                                                32

   subbands of the first quantity in the yth data frame. Specifically, the modification
   manner in which the encoder modifies the quantized frequency envelope values of the
   subbands of the first quantity in the yth data frame may be one of the following:
   [0152]      (1) When M>L, a value of the first quantity is M, and the encoder uses the
 5 modification factors to correspondingly modify a quantization frequency envelope
   value of each subband in M subbands in the yth data frame, where the modification
   factors are determined by the encoder according to a signal type of each subband in
   the M subbands in the yth data frame. Specifically, the encoder correspondingly
   multiplies the quantized frequency envelope values of the M subbands in the yth data
10 frame by M modification factors to obtain modified quantized frequency envelope
   values of the M subbands in the yth data frame. Alternatively, the encoder
   correspondingly modifies quantized frequency envelope values of L subbands in the
   M subbands in the yth data frame according to L first modification factors in M first
   modification    factors  and   L    second modification    factors,  and    the  encoder
15 correspondingly modifies quantized frequency envelope values of M-L remaining
   subbands in the M subbands in the yth data frame according to M-L remaining first
   modification factors in the M first modification factors. Specifically, the encoder
   correspondingly multiplies the quantized frequency envelope values of the L
   subbands in the M subbands in the yth data frame by the L first modification factors in
20 the M first modification factors and the L second modification factors to obtain
   modified quantized frequency envelope values of the L subbands in the M subbands
   in the yth data frame, and the encoder correspondingly multiplies the quantized
   frequency envelope values of the M-L remaining subbands in the M subbands in the
   yth data frame by the M-L remaining first modification factors in the M first
25 modification factors to obtain modified quantized frequency envelope values of the
   M-L remaining subbands in the M subbands in the yth data frame.
   [0153]      (2) When M<L, a value of the first quantity is L, and the encoder uses the
   modification factors to correspondingly modify a quantization frequency envelope
   value of each subband in L subbands in the yth data frame, where the modification
30 factors are determined by the encoder according to reference information of each
   subband in L subbands in the (y-1)th data frame. Specifically, the encoder
   correspondingly multiplies the quantized frequency envelope values of the L
   subbands in the yth data frame by L modification factors to obtain modified quantized
                                                33

   frequency envelope values of the L subbands in the yth data frame. Alternatively, the
   encoder correspondingly modifies quantized frequency envelope values of M
   subbands in the yth data frame according to M second modification factors in L second
   modification    factors   and   M    first modification   factors,   and    the  encoder
 5 correspondingly modifies quantized frequency envelope values of L-M remaining
   subbands in the L subbands in the yth data frame according to L-M remaining second
   modification factors in the L second modification factors. Specifically, the encoder
   correspondingly multiplies the quantized frequency envelope values of the M
   subbands in the yth data frame by the M second modification factors in the L second
10 modification factors and the M first modification factors to obtain modified quantized
   frequency envelope values of the M subbands in the yth data frame, and the encoder
   correspondingly multiplies the quantized frequency envelope values of the L-M
   remaining subbands in the L subbands in the yth data frame by the L-M remaining
   second modification factors in the L second modification factors to obtain modified
15 quantized frequency envelope values of the L-M remaining subbands in the L
   subbands in the yth data frame.
   [0154]      Exemplarily, if M=3, and L=2, M>L, and three subbands in the yth data
   frame need to be modified. A modification manner used when M>L is first selected,
   then the encoder correspondingly modifies quantized frequency envelope values of
20 two subbands in three subbands in the yth data frame according to two first
   modification factors in three first modification factors and two second modification
   factors, and the encoder modifies a quantization frequency envelope value of one
   remaining subband in the three subbands in the yth data frame according to one
   remaining first modification factor in the three first modification factors. Specifically,
25 the encoder correspondingly multiplies the quantized frequency envelope values of
   the two subbands in the three subbands in the yth data frame by the two first
   modification factors in the three first modification factors and the two second
   modification factors to obtain modified quantized frequency envelope values of the
   two subbands in the three subbands in the yth data frame, and the encoder multiplies
30 the quantization frequency envelope value of the one remaining subband in the three
   subbands in the yth data frame by the one remaining first modification factor in the
   three first modification factors to obtain a modified quantization frequency envelope
   value of the one remaining subband in the three subband in the yth data frame.
   [0155]      It may be understood that when M=L or M<L, a process in which the
                                               34

   encoder modifies quantized frequency envelope values of M subbands in the yth data
   frame is similar to the foregoing modification process in which M>L, which is
   subsequently described in detail by using an example.
   [0156]      S206. The encoder allocates quantization bits to the subbands according to
 5 modified quantized frequency envelope values of the subbands of the first quantity.
   [0157]      After the encoder modifies the quantized frequency envelope values of the
   subbands of the first quantity in the yth data frame, the encoder may perform
   quantization bit allocation for the N subbands in the yth data frame according to the
   modified quantized frequency envelope values of the subbands of the first quantity.
10 [0158]      Specifically, after the encoder modifies the quantized frequency envelope
   values of the N subbands in the yth data frame, the encoder may calculate initial
   values of importance of the N subbands (importance of a subband may be measured
   by using a parameter such as energy or a frequency of the subband) according to the
   modified quantized frequency envelope values of the N subbands in the yth data frame,
15 and then allocate available bits to the N subbands according to the initial values of
   importance of the N subbands, where more bits are allocated to a subband of high
   importance, and fewer bits are allocated to a subband of low importance.
   [0159]      It should be noted that a quantity of available bits refers to a total quantity
   of bits that are available in the yth data frame. The quantity of available bits is
20 determined according to a bit rate of the encoder. A larger bit rate of the encoder
   indicates a larger quantity of available bits.
   [0160]      It may be understood that after the quantized frequency envelope values of
   the N subbands in the yth data frame are modified, on one hand, because the modified
   quantized frequency envelope values, used for quantization bit allocation, of the N
25 subbands in the yth data frame better meet a characteristic of an audio signal,
   quantization bit allocation for spectral coefficients of the N subbands is more proper;
   on the other hand, because the modified quantized frequency envelope values of the N
   subbands in the    yth data frame may make spectral coefficients of the (y-1 )th data
   frame more continuous with the spectral coefficients of the yth data frame, some
30 discrete points on a spectrum during decoding by a decoder are reduced, so that the
   decoder can better complete decoding.
   [0161]      S207. The encoder quantizes a spectral coefficient of a subband to which a
   quantization bit is allocated in the N subbands.
   [0162]      After the encoder performs quantization bit allocation for the spectral
                                                35

   coefficient of the subband to which a quantization bit is allocated in the N subbands in
   the yth data frame, the encoder quantizes the spectral coefficient of the subband to
   which a quantization bit is allocated in the N subbands in the yth data frame.
   [0163]      Specifically, after the encoder performs quantization bit allocation for the
 5 spectral coefficients of the N subbands in the yth data frame, the encoder may perform
   normalization processing on the spectral coefficients of the N subbands in the yth data
   frame according to the modified quantized frequency envelope values of the N
   subbands in the yth data frame, and then quantize the spectral coefficients of the N
   subbands in the yth data frame according to quantities of bits separately allocated by
10 the encoder to spectral coefficients of subbands to which quantization bits are
   allocated in the N subbands in the yth data frame.
   [0164]      Exemplarily, when quantizing, according to a quantity of bits allocated to
   the spectral coefficient of the subband to which a quantization bit is allocated in the N
   subbands in the    yth data frame, the spectral coefficient of the subband to which a
15 quantization bit is allocated in the N subbands in the yth data frame, the encoder may
   use a pyramid lattice vector quantization method to quantize a spectral coefficient of a
   subband to which fewer bits are allocated, so as to obtain the quantized spectral
   coefficient of the subband to which fewer bits are allocated; correspondingly, the
   encoder may use a spherical lattice vector quantization method to quantize a spectral
20 coefficient of a subband to which more bits are allocated, so as to obtain the quantized
   spectral coefficient of the subband to which more bits are allocated.
   [0165]      It should be noted that there may be a subband to which no quantization bit
   is allocated in the N subbands in the yth data frame. In this embodiment of the present
   invention, the encoder quantizes a spectral coefficient of a subband to which a
25 quantization bit is allocated in the N subbands in the yth data frame.
   [0166]      S208. The encoder writes the quantized spectral coefficient of the subband
   to which a quantization bit is allocated into a bitstream.
   [0167]      After the encoder quantizes the spectral coefficient of the subband to
   which a quantization bit is allocated in the yth data frame, the encoder needs to write
30 the quantized spectral coefficient of the subband to which a quantization bit is
   allocated into the bitstream, so that the decoder uses the bitstream to perform
   decoding.
   [0168]      Specifically, after the encoder quantizes the spectral coefficient of the
   subband to which a quantization bit is allocated in the yth data frame, the encoder
                                                36

   writes the quantized spectral coefficient of the subband to which a quantization bit is
   allocated, the signal types of the M subbands in the yth data frame, the reference
   information of the L subbands in the (y-l)th data frame, and the quantization
   frequency envelope index values of the N subbands in the yth data frame into the
 5 bitstream, and transmits the bitstream to the decoder for decoding.
   [0169]      It should be noted that for each data frame of an audio signal, the encoder
   performs encoding according to the foregoing steps S201 to S208, that is, the encoder
   repeatedly executes S201 to S208 until all data frames of the audio signal are encoded.
   After the encoding is completed, the encoder stores reference information of the
10 subbands of the first quantity in the yth data frame, so that the reference information is
   used when the    y+1th data frame is being encoded.
   [0170]      It may be understood that after the encoder calculates, quantizes, and
   modifies a to-be-encoded audio signal, the encoder needs to write corresponding
   parameters such as the signal types of the M subbands in the yth data frame, the
15 reference information of the L subbands in the (y-1   )th data frame, and the quantization
   frequency envelope index values of the N subbands in the yth data frame that are
   obtained in the foregoing process and the quantized spectral coefficient of the
   subband to which a quantization bit is allocated in the yth data frame into the bitstream,
   and transmit the bitstream to the decoder, so that the decoder can perform processing
20 such as dequantization and denormalization on the bitstream of an encoded audio
   signal according to the corresponding parameters obtained during encoding, and then
   the encoder obtains, after completing decoding, the audio signal before being
   encoded.
   [0171]      The following describes in detail a process of modifying a quantization
25 frequency envelope value in the encoding method provided in this embodiment of the
   present invention by using an example of a specific wideband audio signal, for
   example, the encoder determines the modification factors of the subbands of the first
   quantity in the yth data frame according to the signal types of the M subbands in the
   yth data frame and the reference information of the L subbands in the (y-1)th data
30 frame.
   [0172]      It is assumed that y=6, and N=18, that is, the encoder encodes the sixth
   data frame of the wideband audio signal. After the sixth data frame of the wideband
   audio signal is input into the encoder, the encoder first performs MDCT
   transformation on the sixth data frame to obtain 320 spectral coefficients within 0 to
                                                37

   8000 Hz. As shown in FIG. 3, the encoder splits the 320 spectral coefficients of the
   sixth data frame into 18 subbands with unequal intervals according to auditory
   sensing characteristics. Before the sixth data frame is input into the encoder, the
   encoder obtains 320 spectral coefficients within 0 to 8000 Hz after performing MDCT
 5 transformation on the fifth data frame, input into the encoder, of the wideband audio
   signal, and also splits the 320 spectral coefficients of the fifth data frame into 18
   subbands with unequal intervals according to auditory sensing characteristics. After
   calculating and quantizing frequency envelopes of the 18 subbands in the sixth data
   frame, the encoder obtains quantization frequency envelope index values of the 18
10 subbands in the sixth data frame and quantized frequency envelope values fenv of the
   18 subbands in the sixth data frame.
   [0173]      (1) If three subbands that have higher frequencies in the sixth data frame
   and two subbands that have higher frequencies in the fifth data frame are selected,
   that is, M=3, and L=2, the M subbands in the yth data frame are the sixteenth subband,
15 the seventeenth subband, and the eighteenth subband in the sixth data frame, and the
   L subbands in the (y-1)th data frame are the seventeenth subband and the eighteenth
   subband in the fifth data frame. It is assumed that signal types of the sixteenth
   subband, the seventeenth subband, and the eighteenth subband in the sixth data frame
   are respectively harmonic, non-harmonic, and harmonic, quantization bit allocation
20 statuses of the seventeenth subband and the eighteenth subband in the fifth data frame
   are respectively "1" and "0", and signal types of the seventeenth subband and the
   eighteenth    subband    in the fifth  data frame     are respectively    harmonic     and
   non-harmonic.
   [0174]      Because M>L, preferably, the encoder needs to modify quantized
25 frequency envelope values of only three subbands in the sixth data frame, that is, the
   encoder needs to modify only the sixteenth subband, the seventeenth subband, and the
   eighteenth subband in the sixth data frame.
   [0175]      For ease of description, the following describes in detail a method for
   determining modification factors of the sixteenth subband, the seventeenth subband,
30 and the eighteenth subband.
   [0176]      First, the encoder determines a first modification factor factor 1 as follows:
   the sixteenth subband in the sixth data frame is harmonic, and therefore, a first
   modification factor factor 1 corresponding to the sixteenth subband is a value greater
   than 1; the seventeenth subband in the sixth data frame is non-harmonic, and therefore,
                                               38

   a first modification factor factor 1 corresponding to the seventeenth subband is a
   value less than or equal to 1; likewise, a factor 1 corresponding to the eighteenth
   subband in the sixth data frame is a value greater than 1. If a signal type of a subband
   is harmonic, a factor 1 is obtained by means of calculation by using the first formula;
 5 if a signal type of a subband is non-harmonic, a factor 1 is obtained by means of
   calculation by using the second formula.
   [0177]       Then, the encoder determines a second modification factor factor 2 as
   follows: the encoder needs to first determine a third modification factor and a fourth
   modification factor. For determining a third modification factor, because the
10 quantization bit allocation statuses of the seventeenth subband and the eighteenth
   subband in the fifth data frame are respectively "1" and "0", a third modification
   factor factor 3 corresponding to the seventeenth subband in the fifth data frame is a
   value greater than 1, and a third modification factor factor 3 corresponding to the
   eighteenth subband in the fifth data frame is a value less than 1. If a quantization bit
15 allocation status of a subband is "1", a factor 3 is obtained by means of calculation by
   using the third formula; if a quantization bit allocation status of a subband is "0", a
   factor 3 is obtained by means of calculation by using the fourth formula. For
   determining a fourth modification factor, because the signal types of the seventeenth
   subband and the eighteenth subband in the fifth data frame are respectively harmonic
20 and non-harmonic, a fourth modification factor factor 4 corresponding to the
   seventeenth subband in the fifth data frame is a value greater than 1, and a fourth
   modification factor factor 4 corresponding to the eighteenth subband in the fifth data
   frame is a value less than 1. If a signal type of a subband is harmonic, a factor 4 is
   obtained by means of calculation by using the first formula; if a signal type of a
25 subband is non-harmonic, a factor 4 is obtained by means of calculation by using the
   second formula.
   [0178]       Preferably, a second modification factor used to modify the seventeenth
   subband in the fifth data frame is a product of the third modification factor factor 3
   corresponding to the seventeenth subband in the fifth data frame and the fourth
30 modification factor factor 4 corresponding to the seventeenth subband in the fifth data
   frame, and a second modification factor used to modify the eighteenth subband in the
   fifth data frame is a product of the third modification factor factor 3 corresponding to
   the eighteenth subband in the fifth data frame and the fourth modification factor factor
   4 corresponding to the eighteenth subband in the fifth data frame.
                                               39

   [0179]       Finally, the encoder may correspondingly modify quantized frequency
   envelope values of L subbands in M subbands in the yth data frame according to L first
   modification factors in M first modification factors and L second modification factors,
   and the encoder correspondingly modifies quantized frequency envelope values of
 5 M-L remaining subbands in the M subbands in the yth data frame according to M-L
   remaining first modification factors in the M first modification factors. In this
   example, M=3, and L=2; therefore, in the sixth data frame, the encoder multiplies a
   quantization frequency envelope value of the seventeenth subband in the sixth data
   frame by the first modification factor corresponding to the seventeenth subband in the
10 sixth data frame and the second modification factor corresponding to the seventeenth
   subband in the fifth data frame to obtain a modified quantization frequency envelope
   value of the seventeenth subband in the sixth data frame; concurrently, the encoder
   multiplies a quantization frequency envelope value of the eighteenth subband in the
   sixth data frame by the first modification factor corresponding to the eighteenth
15 subband in the sixth data frame and the second modification factor corresponding to
   the eighteenth subband in the fifth data frame to obtain a modified quantization
   frequency envelope value of the eighteenth subband in the sixth data frame;
   concurrently, the encoder multiplies a quantization frequency envelope value of the
   sixteenth   subband in the        sixth data frame by the first modification         factor
20 corresponding to the sixteenth subband in the sixth data frame to obtain a modified
   quantization frequency envelope value of the sixteenth subband in the sixth data
   frame, so that the encoder modifies the quantized frequency envelope values of the
   sixteenth subband, the seventeenth subband, and the eighteenth subband in the sixth
   data frame. That is:
25 [0180]       For the sixteenth subband in the sixth data frame, modified fenv 16          =
   factor 1 x fenv 16, where the factor 1 is the first modification factor corresponding to
   the sixteenth subband in the sixth data frame, the modified fenv 16 is the modified
   quantization frequency envelope value of the sixteenth subband in the sixth data
   frame, and the fenv 16 is the unmodified quantization frequency envelope value of the
30 sixteenth subband in the sixth data frame.
   [0181]       For the seventeenth subband in the sixth data frame,
                modified fenv 17    = factor 1 x factor 2 x fenv 17, where factor 2 = factor 3
   x factor 4, the factor 1 is the first modification factor corresponding to the seventeenth
   subband in the sixth data frame, the factor 2 is the second modification factor
                                                  40

   corresponding to the seventeenth subband in the fifth data frame, the factor 3 is the
   third modification factor corresponding to the seventeenth subband in the fifth data
   frame, the factor 4 is the fourth modification factor corresponding to the seventeenth
   subband in the fifth data frame, the modified fenv 17 is the modified quantization
 5 frequency envelope value of the seventeenth subband in the sixth data frame, and the
   fenv 17 is the unmodified quantization frequency envelope value of the seventeenth
   subband in the sixth data frame.
   [0182]      Likewise, for the eighteenth subband in the sixth data frame,
               modified fenv 18  =  factor 1 x factor 2 x fenv 18, where the modified fenv
10 18 is the modified quantization frequency envelope value of the eighteenth subband in
   the sixth data frame, and fenv 18 is the unmodified quantization frequency envelope
   value of the eighteenth subband in the sixth data frame.
   [0183]      (2) If three subbands that have higher frequencies in the sixth data frame
   and three subbands that have higher frequencies in the fifth data frame are selected,
15 that is, M=3, and L=3, the M subbands in the yth data frame are the sixteenth subband,
   the seventeenth subband, and the eighteenth subband in the sixth data frame, and the
   L subbands in the (y-1)th data frame are the sixteenth subband, the seventeenth
   subband, and the eighteenth subband in the fifth data frame. A method for determining
   first modification factors corresponding to the sixteenth subband, the seventeenth
20 subband, and the eighteenth subband in the sixth data frame and second modification
   factors corresponding to the sixteenth subband, the seventeenth subband, and the
   eighteenth subband in the fifth data frame is the same as the method used when M>L,
   and details are not described herein again.
   [0184]      Because M=L, the encoder may correspondingly modify the quantized
25 frequency envelope values of the M subbands in the yth data frame according to M
   first modification factors and L second modification factors. In this example, M=3,
   and L=3; therefore, in the sixth data frame, the encoder multiplies a quantization
   frequency envelope value of the sixteenth subband in the sixth data frame by the first
   modification factor corresponding to the sixteenth subband in the sixth data frame and
30 the second modification factor corresponding to the sixteenth subband in the fifth data
   frame to obtain a modified quantization frequency envelope value of the sixteenth
   subband in the sixth data frame; concurrently, the encoder multiplies a quantization
   frequency envelope value of the seventeenth subband in the sixth data frame by the
   first modification factor corresponding to the seventeenth subband in the sixth data
                                               41

   frame and the second modification factor corresponding to the seventeenth subband in
   the fifth data frame to obtain a modified quantization frequency envelope value of the
   seventeenth subband in the sixth data frame; concurrently, the encoder multiplies a
   quantization frequency envelope value of the eighteenth subband in the sixth data
 5 frame by the first modification factor corresponding to the eighteenth subband in the
   sixth data frame and the second modification factor corresponding to the eighteenth
   subband in the fifth data frame to obtain a modified quantization frequency envelope
   value of the eighteenth subband in the sixth data frame, so that the encoder modifies
   the quantized frequency envelope values of the sixteenth subband, the seventeenth
10 subband, and the eighteenth subband in the sixth data frame. That is:
   [0185]      For the sixteenth subband in the sixth data frame,
               Modified fenv 16   = factor 1 x factor 2 x fenv 16, where:
               factor 2  = factor 3 x factor 4, the factor 1 is the first modification factor
   corresponding to the sixteenth subband in the sixth data frame, the factor 2 is the
15 second modification factor corresponding to the sixteenth subband in the fifth data
   frame, the factor 3 is a third modification factor corresponding to the sixteenth
   subband in the fifth data frame, the factor 4 is a fourth modification factor
   corresponding to the sixteenth subband in the fifth data frame, the modified fenv 16 is
   the modified quantization frequency envelope value of the sixteenth subband in the
20 sixth data frame, and the fenv 16 is the unmodified quantization frequency envelope
   value of the sixteenth subband in the sixth data frame.
   [0186]      Likewise, for the seventeenth subband in the sixth data frame,
               modified fenv 17   = factor 1 x factor 2 x fenv 17, where the modified fenv
   17 is the modified quantization frequency envelope value of the seventeenth subband
25 in the sixth data frame, and fenv 17 is the unmodified quantization frequency
   envelope value of the seventeenth subband in the sixth data frame.
   [0187]      Likewise, for the eighteenth subband in the sixth data frame,
               modified fenv 18   = factor 1 x factor 2 x fenv 18, where the modified fenv
   18 is the modified quantization frequency envelope value of the eighteenth subband in
30 the sixth data frame, and fenv 18 is the unmodified quantization frequency envelope
   value of the eighteenth subband in the sixth data frame.
   [0188]      (3) If three subbands that have higher frequencies in the sixth data frame
   and four subbands that have higher frequencies in the fifth data frame are selected,
   that is, M=3, and L=4, the M subbands in the yth data frame are the sixteenth subband,
                                                42

   the seventeenth subband, and the eighteenth subband in the sixth data frame, and the
   L subbands in the (y-1)th data frame are the fifteenth subband, the sixteenth subband,
   the seventeenth subband, and the eighteenth subband in the fifth data frame. A method
   for determining first modification factors that are respectively corresponding to the
 5 sixteenth subband, the seventeenth subband, and the eighteenth subband in the sixth
   data frame, second modification factors that are respectively corresponding to the
   sixteenth subband, the seventeenth subband, and the eighteenth subband in the fifth
   data frame, and a second modification factor corresponding to the fifteenth subband in
   the fifth data frame is the same as the method used when M>L, and details are not
10 described herein again.
   [0189]      Because M<L, preferably, the encoder needs to modify quantized
   frequency envelope values of only four subbands in the sixth data frame, that is, the
   encoder needs to modify only the fifteenth subband, the sixteenth subband, the
   seventeenth subband, and the eighteenth subband in the sixth data frame. When M<L,
15 the encoder correspondingly modifies quantized frequency envelope values of M
   subbands in the yth data frame according to M second modification factors in L second
   modification     factors  and   M   first  modification   factors, and    the   encoder
   correspondingly modifies quantized frequency envelope values of L-M remaining
   subbands in the L subbands in the yth data frame according to L-M remaining second
20 modification factors in the L second modification factors. In this example, M=3, and
   L=4; therefore, in the sixth data frame, the encoder multiplies a quantization
   frequency envelope value of the sixteenth subband in the sixth data frame by the first
   modification factor corresponding to the sixteenth subband in the sixth data frame and
   the second modification factor corresponding to the sixteenth subband in the fifth data
25 frame to obtain a modified quantization frequency envelope value of the sixteenth
   subband in the sixth data frame; concurrently, the encoder multiplies a quantization
   frequency envelope value of the seventeenth subband in the sixth data frame by the
   first modification factor corresponding to the seventeenth subband in the sixth data
   frame and the second modification factor corresponding to the seventeenth subband in
30 the fifth data frame to obtain a modified quantization frequency envelope value of the
   seventeenth subband in the sixth data frame; concurrently, the encoder multiplies a
   quantization frequency envelope value of the eighteenth subband in the sixth data
   frame by the first modification factor corresponding to the eighteenth subband in the
   sixth data frame and the second modification factor corresponding to the eighteenth
                                              43

   subband in the fifth data frame to obtain a modified quantization frequency envelope
   value of the eighteenth subband in the sixth data frame; concurrently, the encoder
   multiplies a quantization frequency envelope value of the fifteenth subband in the
   sixth data frame by the second modification factor of the fifteenth subband in the fifth
 5 data frame to obtain a modified quantization frequency envelope value of the fifteenth
   subband in the sixth data frame, so that the encoder modifies the quantized frequency
   envelope values of the fifteenth subband, the sixteenth subband, the seventeenth
   subband, and the eighteenth subband in the sixth data frame. That is:
   [0190]      For the fifteenth subband in the sixth data frame, modified fenv 15  = factor
10 2 x fenv 15, where factor 2       =  factor 3 x factor 4, the factor 2 is the second
   modification factor corresponding to the fifteenth subband in the fifth data frame, the
   factor 3 is a third modification factor corresponding to the fifteenth subband in the
   fifth data frame, the factor 4 is a fourth modification factor corresponding to the
   fifteenth subband in the fifth data frame, the modified fenv 15 is the modified
15 quantization frequency envelope value of the fifteenth subband in the sixth data frame,
   and the fenv 15 is the unmodified quantization frequency envelope value of the
   fifteenth subband in the sixth data frame.
   [0191]      For the sixteenth subband in the sixth data frame,
               modified fenv 16   = factor 1 x factor 2 x fenv 16, where the factor 1 is the
20 first modification factor corresponding to the sixteenth subband in the sixth data
   frame, the factor 2 is the second modification factor corresponding to the sixteenth
   subband in the fifth data frame, the modified fenv 16 is the modified quantization
   frequency envelope value of the sixteenth subband in the sixth data frame, and the
   fenv 16 is the unmodified quantization frequency envelope value of the sixteenth
25 subband in the sixth data frame.
   [0192]      Likewise, for the seventeenth subband in the sixth data frame,
               modified fenv 17   = factor 1 x factor 2 x fenv 17, where the modified fenv
   17 is the modified quantization frequency envelope value of the seventeenth subband
   in the sixth data frame, and fenv 17 is the unmodified quantization frequency
30 envelope value of the seventeenth subband in the sixth data frame.
   [0193]      Likewise, for the eighteenth subband in the sixth data frame,
               modified fenv 18   = factor 1 x factor 2 x fenv 18, where the modified fenv
   18 is the modified quantization frequency envelope value of the eighteenth subband in
   the sixth data frame, and fenv 18 is the unmodified quantization frequency envelope
                                               44

   value of the eighteenth subband in the sixth data frame.
   [0194]      According to the encoding method provided in this embodiment of the
   present invention, after splitting spectral coefficients of a current data frame into
   subbands, an encoder acquires quantized frequency envelope values of the subbands;
 5 the encoder modifies quantized frequency envelope values of subbands of a first
   quantity in the subbands; the encoder allocates quantization bits to the subbands
   according to modified quantized frequency envelope values of the subbands of the
   first quantity; the encoder quantizes a spectral coefficient of a subband to which a
   quantization bit is allocated in the subbands; and finally, the encoder writes the
10 quantized spectral coefficient of the subband to which a quantization bit is allocated
   into a bitstream. According to this solution, before quantization bit allocation is
   performed for spectral coefficients of subbands in a current data frame of an audio
   signal, quantized frequency envelope values of the subbands can be modified
   according to a signal type of the current data frame and information about a previous
15 data frame; therefore, performing quantization bit allocation for the spectral
   coefficients of the subbands according to modified quantized frequency envelope
   values of the subbands and a quantity of available bits can achieve an objective of
   proper quantization bit allocation for spectral coefficients of an audio signal, thereby
   improving quality of a signal obtained by a decoder by means of decoding.
20                                     Embodiment 3
   [0195]      As shown in FIG. 4, this embodiment of the present invention provides an
   encoding apparatus 1. The encoding apparatus 1 may include:
               an acquiring unit 10, configured to: after splitting spectral coefficients of a
   current data frame into subbands, acquire quantized frequency envelope values of the
25 subbands;
               a modifying unit 11, configured to modify quantized frequency envelope
   values of subbands of a first quantity in the subbands acquired by the acquiring unit
   10;
               an allocating unit 12, configured to allocate quantization bits to the
30 subbands according to quantized frequency envelope values, modified by the
   modifying unit 11, of the subbands of the first quantity;
               a quantizing unit 13, configured to quantize a spectral coefficient of a
                                              45

   subband to which a quantization bit is allocated by the allocating unit 12 in the
   subbands; and
               a multiplexing unit 14, configured to write the spectral coefficient,
   quantized by the quantizing unit 13, of the subband to which a quantization bit is
 5 allocated into a bitstream.
   [0196]      Optionally, the acquiring unit 10 is further configured to acquire
   modification factors of the subbands of the first quantity.
   [0197]      The modifying unit 11 is further configured to modify, by using the
   modification factors of the subbands of the first quantity acquired by the acquiring
10 unit 10, the quantized frequency envelope values, acquired by the acquiring unit 10,
   of the subbands of the first quantity.
   [0198]      Optionally, as shown in FIG. 5, the encoding apparatus 1 further includes a
   determining unit 15.
   [0199]      The acquiring unit 10 is further configured to acquire signal types of the
15 subbands of the first quantity.
   [0200]      The determining unit 15 is configured to determine the modification
   factors of the subbands of the first quantity according to the signal types of the
   subbands of the first quantity acquired by the acquiring unit 10.
   [0201]      The determining unit 15 is further configured to: when a signal type,
20 acquired by the acquiring unit 10, of a first subband in the subbands of the first
   quantity is harmonic, determine that a modification factor of the first subband is
   greater than 1; or when a signal type, acquired by the acquiring unit 10, of a first
   subband in the subbands of the first quantity is non-harmonic, determine that a
   modification factor of the first subband is less than or equal to 1.
25 [0202]      Optionally, the acquiring unit 10 is further configured to: before the
   determining the modification factors of the subbands of the first quantity according to
   the signal types of the subbands of the first quantity, acquire stored reference
   information of subbands of a second quantity in a previous data frame of the current
   data frame, where the second quantity is less than or equal to the first quantity.
30 [0203]      The determining unit 15 is specifically configured to determine the
   modification factors of the subbands of the first quantity according to the signal types
   of the subbands of the first quantity and the reference information of the subbands of
   the second quantity that are acquired by the acquiring unit 10.
   [0204]      Optionally, the determining unit 15 is further configured to: determine a
                                               46

   first modification factor of the first subband according to the signal type of the first
   subband in the subbands of the first quantity acquired by the acquiring unit 10;
   determine a second modification factor of the first subband according to reference
   information, acquired by the acquiring unit 10, of a second subband, corresponding to
 5 the first subband, in the subbands of the second quantity; and use a product of the first
   modification factor and the second modification factor as the modification factor of
   the first subband.
   [0205]       Optionally, the reference information of the second subband acquired by
   the acquiring unit 10 includes a quantization bit allocation status of the second
10 subband and/or a signal type of the second subband, where when the reference
   information of the second subband includes the quantization bit allocation status of
   the second subband, the second modification factor determined by the determining
   unit 15 is a third modification factor; or when the reference information of the second
   subband includes the signal type of the second subband, the second modification
15 factor is a fourth modification factor; or when the reference information of the second
   subband includes the quantization bit allocation status of the second subband and the
   signal type of the second subband, the second modification factor is a product of the
   third modification factor and the fourth modification factor.
   [0206]       Optionally, the determining unit 15 is further configured to: when the
20 quantization bit allocation status of the second subband indicates that no spectral
   coefficient is encoded, determine that the third modification factor is less than 1, or
   when the quantization bit allocation status of the second subband indicates that a
   spectral coefficient is encoded, determine that the third modification factor is greater
   than 1; and when the signal type of the second subband acquired by the acquiring unit
25 10 is harmonic, determine that the fourth modification factor is greater than 1, or
   when the signal type of the second subband acquired by the acquiring unit 10 is
   non-harmonic, determine that the fourth modification factor is less than or equal to 1.
   [0207]       Optionally, the second modification factor of the first subband determined
   by the determining unit 15 is determined according to a ratio of any two values of a
30 frequency envelope value of the second subband, an average frequency envelope
   value of the subbands of the second quantity, a bandwidth value of the subbands of
   the second quantity, a maximum value of frequency envelope values of the subbands
   of the second quantity, and a frequency envelope variance value of the subbands of
   the second quantity.
                                               47

   [0208]       Optionally, the first modification factor of the first subband determined by
   the determining unit 15 is determined according to a ratio of any two values of a
   frequency envelope value of the first subband, an average frequency envelope value
   of the subbands of the first quantity, a bandwidth value of the subbands of the first
 5 quantity, a maximum value of frequency envelope values of the subbands of the first
   quantity, and a frequency envelope variance value of the subbands of the first
   quantity.
   [0209]       Optionally, the acquiring unit 10 is further configured to acquire stored
   reference information of subbands of a first quantity in a previous data frame of the
10 current data frame.
   [0210]       The determining unit 15 is further configured to determine                the
   modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame acquired by the acquiring unit 10.
15 [0211]       Optionally, the acquiring unit 10 is further configured to: before the
   determining the modification factors of the subbands of the first quantity in the
   current data frame according to the reference information of the subbands of the first
   quantity in the previous data frame, acquire signal types of subbands of a third
   quantity in the subbands in the current data frame, where the third quantity is less than
20 or equal to the first quantity.
   [0212]       The determining unit 15 is specifically configured to: determine the
   modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame and the signal types of the subbands of the third quantity that are
25 acquired by the acquiring unit 10.
   [0213]       Optionally, the determining unit 15 is further configured to: determine a
   second modification factor of a first subband in the subbands of the first quantity in
   the current data frame according to reference information of a second subband in the
   subbands of the first quantity in the previous data frame acquired by the acquiring unit
30 10; determine a first modification factor of the first subband according to a signal type
   of the first subband acquired by the acquiring unit 10; and use a product of the first
   modification factor and the second modification factor as a modification factor of the
   first subband.
   [0214]       Optionally, as shown in FIG. 6, the encoding apparatus 1 further includes a
                                                48

   storing unit 16.
   [0215]       The storing unit 16 is further configured to store reference information of
   the subbands of the first quantity after the allocating unit 12 allocates the quantization
   bits to the subbands according to the modified quantized frequency envelope values of
 5 the subbands of the first quantity.
   [0216]       According to the encoding apparatus provided in this embodiment of the
   present invention, after splitting spectral coefficients of a current data frame into
   subbands, the encoding apparatus acquires quantized frequency envelope values of
   the subbands; the encoding apparatus modifies quantized frequency envelope values
10 of subbands of a first quantity in the subbands; the encoding apparatus allocates
   quantization bits to the subbands according to modified quantized frequency envelope
   values of the subbands of the first quantity; the encoding apparatus quantizes a
   spectral coefficient of a subband to which a quantization bit is allocated in the
   subbands; and finally, the encoding apparatus writes the quantized spectral coefficient
15 of the subband to which a quantization bit is allocated into a bitstream. According to
   this solution, before quantization bit allocation is performed for spectral coefficients
   of subbands in a current data frame of an audio signal, quantized frequency envelope
   values of the subbands can be modified according to a signal type of the current data
   frame    and information     about a previous data frame;          therefore,  performing
20 quantization bit allocation for the spectral coefficients of the subbands according to
   modified quantized frequency envelope values of the subbands and a quantity of
   available bits can achieve an objective of proper quantization bit allocation for
   spectral coefficients of an audio signal, thereby improving quality of a signal obtained
   by a decoder by means of decoding.
25                                      Embodiment 4
   [0217]       As shown in FIG. 7, this embodiment of the present invention provides an
   encoder. The encoder may include a processor 20, a memory 21, a communications
   interface 22, and a system bus 23.
   [0218]       The processor 20, the memory 21, and the communications interface 22
30 connects to each other and communicates with each other by using the bus 23.
   [0219]       The processor 20 may be a single-core or multi-core central processing
   unit, or an application-specific integrated circuit, or one or more integrated circuits
                                               49

   configured to implement this embodiment of the present invention.
   [02201      The memory 21 may be a high-speed RAM memory, or may be a
   non-volatile memory, for example, at least one magnetic disk memory.
   [0221]      The memory 21 is configured to store an instruction executed by the
 5 encoder. Specifically, the instruction executed by the encoder may include software
   code and a software program.
   [0222]      Specifically, the processor 20 is configured to: after splitting spectral
   coefficients of a current data frame acquired from the communications interface 22 by
   using the system bus 23 into subbands, acquire quantized frequency envelope values
10 of the subbands; modify quantized frequency envelope values of subbands of a first
   quantity in the subbands; allocate quantization bits to the subbands according to
   modified quantized frequency envelope values of the subbands of the first quantity;
   quantize a spectral coefficient of a subband to which a quantization bit is allocated in
   the subbands; and finally, write, by using the system bus 23, the quantized spectral
15 coefficient of the subband to which a quantization bit is allocated into a bitstream. The
   memory 21 may be configured to store software code of signal types of the subbands
   of the first quantity in the current data frame and software code of reference
   information of subbands of a second quantity in a previous data frame of the current
   data frame, or software code of signal types of subbands of a third quantity in the
20 current data frame and software code of reference information of subbands of a first
   quantity in a previous data frame of the current data frame, and a software program
   for controlling the encoder to complete the foregoing process, so that the processor 20
   can complete the foregoing process by executing the software program stored in the
   memory 21 and by invoking corresponding software code.
25 [0223]      Optionally, the processor 20 is further configured to: acquire modification
   factors of the subbands of the first quantity, and use the modification factors of the
   subbands of the first quantity to modify the quantized frequency envelope values of
   the subbands of the first quantity.
   [0224]      Optionally, the processor 20 is further configured to: acquire the signal
30 types of the subbands of the first quantity from the communications interface 22 by
   using the system bus 23, and determine the modification factors of the subbands of
   the first quantity according to the signal types of the subbands of the first quantity.
   [0225]      Optionally, the processor 20 is further configured to: when a signal type of
   a first subband in the subbands of the first quantity is harmonic, determine that a
                                                50

   modification factor of the first subband is greater than 1; or when a signal type of a
   first subband in the subbands of the first quantity is non-harmonic, determine that a
   modification factor of the first subband is less than or equal to 1.
   [0226]      Optionally, the processor 20 is further configured to: before the
 5 determining the modification factors of the subbands of the first quantity according to
   the signal types of the subbands of the first quantity, acquire the stored reference
   information of the subbands of the second quantity in the previous data frame of the
   current data frame, where the second quantity is less than or equal to the first quantity.
   [0227]      Optionally, the processor 20 is specifically configured to: determine the
10 modification factors of the subbands of the first quantity according to the signal types
   of the subbands of the first quantity and the reference information of the subbands of
   the second quantity.
   [0228]      Optionally, the processor 20 is further configured to: determine a first
   modification factor of the first subband according to the signal type of the first
15 subband in the subbands of the first quantity; determine a second modification factor
   of the first subband according to reference information of a second subband,
   corresponding to the first subband, in the subbands of the second quantity; and use a
   product of the first modification factor and the second modification factor as the
   modification factor of the first subband.
20 [0229]      Optionally, the reference information of the second subband includes a
   quantization bit allocation status of the second subband and/or a signal type of the
   second subband, where when the reference information of the second subband
   includes the quantization bit allocation status of the second subband, the second
   modification factor is a third modification factor; or when the reference information
25 of the second subband includes the signal type of the second subband, the second
   modification factor is a fourth modification factor; or when the reference information
   of the second subband includes the quantization bit allocation status of the second
   subband and the signal type of the second subband, the second modification factor is a
   product of the third modification factor and the fourth modification factor.
30 [0230]      Optionally, the processor 20 is further configured to: when the quantization
   bit allocation status of the second subband indicates that no spectral coefficient is
   encoded, determine that the third modification factor is less than 1, or when the
   quantization bit allocation status of the second subband indicates that a spectral
   coefficient is encoded, determine that the third modification factor is greater than 1;
                                               51

   and when the signal type of the second subband is harmonic, determine that the fourth
   modification factor is greater than 1, or when the signal type of the second subband is
   non-harmonic, determine that the fourth modification factor is less than or equal to 1.
   [0231]      Optionally, the first modification factor of the first subband is determined
 5 according to a ratio of any two values of a frequency envelope value of the first
   subband, an average frequency envelope value of the subbands of the first quantity, a
   bandwidth value of the subbands of the first quantity, a maximum value of frequency
   envelope values of the subbands of the first quantity, and a frequency envelope
   variance value of the subbands of the first quantity; the second modification factor of
10 the first subband is determined according to a ratio of any two values of a frequency
   envelope value of the second subband, an average frequency envelope value of the
   subbands of the second quantity, a bandwidth value of the subbands of the second
   quantity, a maximum value of frequency envelope values of the subbands of the
   second quantity, and a frequency envelope variance value of the subbands of the
15 second quantity.
   [0232]      Optionally, the processor 20 is further configured to acquire the reference
   information of the subbands of the first quantity in the previous data frame of the
   current data frame.
   [0233]      Optionally, the processor 20 is further configured to: determine the
20 modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame.
   [0234]      Optionally, the processor 20 is further configured to: before the
   determining the modification factors of the subbands of the first quantity in the
25 current data frame according to the reference information of the subbands of the first
   quantity in the previous data frame, acquire the signal types of the subbands of the
   third quantity in the subbands in the current data frame, where the third quantity is
   less than or equal to the first quantity.
   [0235]      Optionally, the processor 20 is specifically configured to: determine the
30 modification factors of the subbands of the first quantity in the current data frame
   according to the reference information of the subbands of the first quantity in the
   previous data frame and the signal types of the subbands of the third quantity.
   [0236]      Optionally, the processor 20 is further configured to: determine a second
   modification factor of a first subband in the subbands of the first quantity in the
                                               52

   current data frame according to reference information of a second subband in the
   subbands of the first quantity in the previous data frame; determine a first
   modification factor of the first subband according to a signal type of the first subband;
   and use a product of the first modification factor and the second modification factor as
 5 a modification factor of the first subband.
   [0237]       The processor 20 is further configured to store reference information of the
   subbands of the first quantity after allocating the quantization bits to the subbands
   according to the modified quantized frequency envelope values of the subbands of the
   first quantity.
10 [0238]       According to the encoder provided in this embodiment of the present
   invention, after splitting spectral coefficients of a current data frame into subbands,
   the encoder acquires quantized frequency envelope values of the subbands; the
   encoder modifies quantized frequency envelope values of subbands of a first quantity
   in the subbands; the encoder allocates quantization bits to the subbands according to
15 modified quantized frequency envelope values of the subbands of the first quantity;
   the encoder quantizes a spectral coefficient of a subband to which a quantization bit is
   allocated in the subbands; and finally, the encoder writes the quantized spectral
   coefficient of the subband to which a quantization bit is allocated into a bitstream.
   According to this solution, before quantization bit allocation is performed for spectral
20 coefficients of subbands in a current data frame of an audio signal, quantized
   frequency envelope values of the subbands can be modified according to a signal type
   of the current data frame and information about a previous data frame; therefore,
   performing quantization bit allocation for the spectral coefficients of the subbands
   according to modified quantized frequency envelope values of the subbands and a
25 quantity of available bits can achieve an objective of proper quantization bit allocation
   for spectral coefficients of an audio signal, thereby improving quality of a signal
   obtained by a decoder by means of decoding.
   [0239]       It may be clearly understood by a person skilled in the art that, for the
   purpose of convenient and brief description, division of the foregoing functional
30 modules is taken as an example for illustration. In actual application, the foregoing
   functions can be allocated to different functional modules and implemented according
   to a requirement, that is, an inner structure of an apparatus is divided into different
   functional modules to implement all or some of the functions described above. For a
   detailed working process of the foregoing system, apparatus, and unit, reference may
                                                53

   be made to a corresponding process in the foregoing method embodiments, and
   details are not described herein again.
   [0240]       In the several embodiments provided in the present application, it should
   be understood that the disclosed system, apparatus, and method may be implemented
 5 in other manners. For example, the described apparatus embodiment is merely
   exemplary. For example, the module or unit division is merely logical function
   division and may be other division in actual implementation. For example, a plurality
   of units or components may be combined or integrated into another system, or some
   features may be ignored or not performed. In addition, the displayed or discussed
10 mutual couplings or direct couplings or communication connections may be
   implemented by using some interfaces. The indirect couplings or communication
   connections between the apparatuses or units may be implemented in electronic,
   mechanical, or other forms.
   [0241]       The units described as separate parts may or may not be physically
15 separate, and parts displayed as units may or may not be physical units, may be
   located in one position, or may be distributed on a plurality of network units. Some or
   all of the units may be selected according to actual needs to achieve the objectives of
   the solutions of the embodiments.
   [0242]       In addition, functional units in the embodiments of the present invention
20 may be integrated into one processing unit, or each of the units may exist alone
   physically, or two or more units are integrated into one unit. The integrated unit may
   be implemented in a form of hardware, or may be implemented in a form of a
   software functional unit.
   [0243]       When the integrated unit is implemented in the form of a software
25 functional unit and sold or used as an independent product, the integrated unit may be
   stored in a computer-readable storage medium. Based on such an understanding, the
   technical solutions of the present invention essentially, or the part contributing to the
   prior art, or all or some of the technical solutions may be implemented in the form of
   a software product. The software product is stored in a storage medium and includes
30 several instructions for instructing a computer device (which may be a personal
   computer, a server, or a network device) or a processor (processor) to perform all or
   some of the steps of the methods described in the embodiments of the present
   invention. The foregoing storage medium includes: any medium that can store
   program code, such as a USB flash drive, a removable hard disk, a read-only memory
                                                54

  (ROM, Read-Only Memory), a random access memory (RAM, Random Access
  Memory), a magnetic disk, or an optical disc.
  [0244]      The foregoing descriptions are merely specific implementation manners of
  the present invention, but are not intended to limit the protection scope of the present
5 invention. Any variation or replacement readily figured out by a person skilled in the
  art within the technical scope disclosed in the present invention shall fall within the
  protection scope of the present invention. Therefore, the protection scope of the
  present invention shall be subject to the protection scope of the claims.
                                              55

                                            CLAIMS
         1. An audio signal encoding method, comprising:
        splitting, by an encoder, spectral coefficients of a current frame of an audio
   signal into plurality of subbands;
 5      quantizing, by the encoder, energy envelope for each of the plurality of subbands
   to obtain initial quantized energy envelope for each of the plurality of subbands;
        adjusting, by the encoder, quantized energy envelopes of some subbands of the
   plurality of subbands, wherein the some subbands comprises a subband having a
   highest frequency in the plurality of subbands and a subband consecutive to the
10 subband having the highest frequency;
        performing, by the encoder, bit allocation based on the adjusted quantized energy
   envelopes of the some subbands and the initial quantized energy envelope of each
   subband besides the some subbands in the plurality of subbands; and
        quantizing, by the encoder, a spectral coefficient of a subband to which at least
15 one bit is allocated after the bit allocation, wherein the quantized spectral coefficient
   of the subband to which at least one bit is allocated after the bit allocation is used for
   writing into a bitstream.
        2. The audio signal encoding method according to claim 1, wherein the quantized
20 energy envelope of each of the some subbands is adjusted according to a determined
   adjustment factor for each of the some subbands respectively.
        3. The audio signal encoding method according to claim 2, wherein the
   adjustment factor for each of the some subbands is determined according to a flag
25 indicates signal type of each of the some subbands respectively.
        4. The audio signal encoding method according to claim 3, wherein the signal
   type of each of the some subbands is either harmonic or not harmonic.
30      5. The audio signal encoding method according to claim 4, wherein the
   adjustment factor for a particular subband of the some subbands is no less than 1
   when the signal type of the particular subband is harmonic.
                                                56

        6. The audio signal encoding method according to claim 3, wherein the
   adjustment factor for each of the some subbands is further determined according to
   reference information of a previous frame adjacent to the current frame.
 5
        7. The audio signal encoding method according to claim 1, wherein quantity of
   the some subbands is two.
         8. The audio signal encoding method according to claim 2, wherein the
10 adjustment factor is equal to 1.
        9. The audio signal encoding method according to claim 6, wherein the reference
   information of the previous frame indicates whether two consecutive subbands in the
   previous frame are allocated with bits.
15
         10. The audio signal encoding method according to claim 9, wherein the two
   consecutive subbands in the previous frame comprises the subband having a highest
   frequency in the previous frame.
20       11. An audio signal encoder, comprising:
        a memory; and
        a processor coupled to the memory and configured to:
        split spectral coefficients of a current frame of an audio signal into plurality of
   subbands;
25      quantize energy envelope for each of the plurality of subbands to obtain initial
   quantized energy envelope for each of the plurality of subbands;
        adjust quantized energy envelopes of some subbands of the plurality of subbands,
   wherein the some subbands comprises a subband having a highest frequency in the
   plurality of subbands and a subband consecutive to the subband having the highest
30 frequency;
        perform bit allocation based on the adjusted quantized energy envelopes of the
   some subbands and the initial quantized energy envelope of each subband besides the
   some subbands in the plurality of subbands; and
        quantize a spectral coefficient of a subband to which at least one bit is allocated
                                               57

   after the bit allocation, wherein the quantized spectral coefficient of the subband to
   which at least one bit is allocated after the bit allocation is used for writing into a
   bitstream.
 5       12. The audio signal encoder according to claim 11, wherein the quantized
   energy envelope of each of the some subbands is adjusted according to a determined
   adjustment factor for each of the some subbands respectively.
         13. The audio signal encoder according to claim 12, wherein the adjustment
10 factor for each of the some subbands is determined according to a flag indicates signal
   type of each of the some subbands respectively.
         14. The audio signal encoder according to claim 13, wherein the signal type of
   each of the some subbands is either harmonic or not harmonic.
15
         15. The audio signal encoder according to claim 14, wherein the adjustment
   factor for a particular subband of the some subbands is no less than 1 when the signal
   type of the particular subband is harmonic.
20       16. The audio signal encoder according to claim 13, wherein the adjustment
   factor for each of the some subbands is further determined according to reference
   information of a previous frame adjacent to the current frame.
         17. The audio signal encoder according to claim 11, wherein quantity of the
25 some subbands is two.
         18. The audio signal encoder according to claim 12, wherein the adjustment
   factor is equal to 1.
30       19. The audio signal encoder according to claim 16, wherein the reference
   information of the previous frame indicates whether two consecutive subbands in the
   previous frame are allocated with bits.
         20. The audio signal encoder according to claim 19, wherein the two consecutive
                                               58

subbands in the previous frame comprises a subband having a highest frequency in
the previous frame.
                                       59

                                                   1/6
<removed-date>
                After an encoder splits spectral coefficients of a current data   S101
                  frame into subbands, the encoder acquires quantization
                         frequency envelope values of the subbands
              The encoder modifies quantization frequency envelope values of      S102
<removed-apn>
                       subbands of a first quantity in the subbands
                  The encoder allocates quantization bits to the subbands
               according to modified quantization frequency envelope values       S103
                            of the subbands of the first quantity
                The encoder quantizes a spectral coefficient of a subband to
                                                                                  S104
                   which a quantization bit is allocated in the subbands
                The encoder writes the quantized spectral coefficient of the
              subband to which a quantization bit is allocated into a bitstream   S105
                                                 FIG. 1

                                                  2/6
<removed-date>
              An encoder performs time-frequency transformation on the yth
              data frame of an audio signal to obtain spectral coefficients of     S201
                              the yth data frame, where y 1
              The encoder splits the spectral coefficients of the yth data frame
                               into N subbands, where N 1                          S202
<removed-apn>
              The encoder acquires quantization frequency envelope values
                                                                                   S203
                        of the N subbands in the yth data frame
                The encoder acquires modification factors of subbands of a
                                                                                   S204
                            first quantity in the yth data frame
              The encoder modifies quantization frequency envelope values          S205
                of the subbands of the first quantity in the yth data frame
                 The encoder allocates quantization bits to the subbands
              according to modified quantization frequency envelope values         S206
                           of the subbands of the first quantity
               The encoder quantizes a spectral coefficient of a subband to
                                                                                   S207
                 which a quantization bit is allocated in the N subbands
                The encoder writes the quantized spectral coefficient of the       S208
              subband to which a quantization bit is allocated into a bitstream
                                                FIG. 2

                                                    3/6
<removed-date>
                              The yth data frame
              Power (W)                                      M subbands
<removed-apn>
                                          <U+2701><U+2701>
                          0                                                      8k Frequency
                                                      The        The        The        (Hz)
                                                   sixteenth seventeenth eighteenth
                                                   subband subband subband
                              The (y 1)th data                          Correspondence
              Power (W)            frame                               between subbands
                                           <U+2701><U+2701>
                          0                                                      8k
                                                                                      Frequency
                                                      The        The        The          (Hz)
                                                   sixteenth seventeenth eighteenth
                                                   subband subband subband
                                                                 L subbands
                                                   FIG. 3

                        4/6
<removed-date>
                                    1
              Encoding apparatus
                                   10
                Acquiring unit
                                   11
<removed-apn>
                Modifying unit
                                   12
                Allocating unit
                                   13
                Quantizing unit
                                   14
               Multiplexing unit
                       FIG. 4

                         5/6
<removed-date>
                                    1
              Encoding apparatus
                                   10
                 Acquiring unit
                                   11
<removed-apn>
                Modifying unit
                                   12
                 Allocating unit
                                   13
                Quantizing unit
                                   14
               Multiplexing unit
                                   15
                Determining unit
                        FIG. 5

                                   6/6
<removed-date>
                                                    1
                        Encoding apparatus
                                                  10
                           Acquiring unit
                                                  11
                           Modifyng unit
<removed-apn>
                                                  12
                           Allocating unit
                                                  13
                          Quantizing unit
                                                  14
                         Multiplexing unit
                                                  16
                            Storing unit
                                  FIG. 6
              Encoder
                                  22
                   Communications                            21
                      interface                 Memory
                                             Software code
                                              and software
              23                                program
                             Processor
                                       20
                                  FIG. 7

